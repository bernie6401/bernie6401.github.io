<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Fastbot Android
  #

以下流程皆是參考CSDN-Android APP穩定性測試工具Fastbot和官方中文教學

  一般使用
  #


把repo clone下來，並且把一些檔案複製到手機
$ git clone https://github.com/bytedance/Fastbot_Android.git
$ cd Fastbot_Android
$ adb push fastbot-thirdpart.jar /sdcard
$ adb push framework.jar /sdcard
$ adb push monkeyq.jar /sdcard
$ adb push libs/. /data/local/tmp/

dump apk內部會使用到的strings，並且複製到手機
$ aapt2 dump strings <your apk name> > max.valid.strings
$ adb push max.valid.strings /sdcard 

獲取device number和package name
$ adb devices
List of devices attached
24121JEGR04513  device
$ aapt2 dump badging &#34;Spotify_ Music and Podcasts_8.9.60.560_APKPure.apk&#34; | findstr &#34;package&#34;
package: name='com.spotify.music' versionCode='116920144' versionName='8.9.60.560' platformBuildVersionName='14' platformBuildVersionCode='34' compileSdkVersion='34' compileSdkVersionCodename='14'
uses-permission: name='com.sec.android.app.clockpackage.permission.READ_ALARM'

實際測試
$ adb shell CLASSPATH=/sdcard/monkeyq.jar:/sdcard/framework.jar:/sdcard/fastbot-thirdpart.jar exec app_process /system/bin com.android.commands.monkey.Monkey -p <package name> --agent reuseq --running-minutes <遍歷時長> --throttle <事件頻率> -v -v
---
$ adb shell CLASSPATH=/sdcard/monkeyq.jar:/sdcard/framework.jar:/sdcard/fastbot-thirdpart.jar exec app_process /system/bin com.android.commands.monkey.Monkey -p com.spotify.music --agent reuseq --running-minutes 1 --throttle 500 -v -v --output-directory /sdcard/fastbot_results&amp;adb pull /sdcard/fastbot_results D:\Downloads



  輸入自訂Strings
  #


Download ADBKeyBoard，安裝後設定預設keyboard為ADBKeyboard
$ wget https://github.com/senzhk/ADBKeyBoard/raw/master/ADBKeyboard.apk
$ adb install ADBKeyboard.apk
$ adb shell ime enable com.android.adbkeyboard/.AdbIME
$ adb shell ime set com.android.adbkeyboard/.AdbIME

設定config並push到手機
$ echo &#34;max.randomPickFromStringList = true&#34; > max.config
$ adb push max.config /sdcard

設定像要輸入的strings並push到手機
$ echo &#34;test string&#34; > max.strings
$ adb push max.strings /sdcard


:::info"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/tools/others/android-app-crawler/fastbot-android/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Fastbot Android"><meta property="og:description" content="Fastbot Android # 以下流程皆是參考CSDN-Android APP穩定性測試工具Fastbot和官方中文教學
一般使用 # 把repo clone下來，並且把一些檔案複製到手機 $ git clone https://github.com/bytedance/Fastbot_Android.git $ cd Fastbot_Android $ adb push fastbot-thirdpart.jar /sdcard $ adb push framework.jar /sdcard $ adb push monkeyq.jar /sdcard $ adb push libs/. /data/local/tmp/ dump apk內部會使用到的strings，並且複製到手機 $ aapt2 dump strings <your apk name> > max.valid.strings $ adb push max.valid.strings /sdcard 獲取device number和package name $ adb devices List of devices attached 24121JEGR04513 device $ aapt2 dump badging &#34;Spotify_ Music and Podcasts_8.9.60.560_APKPure.apk&#34; | findstr &#34;package&#34; package: name='com.spotify.music' versionCode='116920144' versionName='8.9.60.560' platformBuildVersionName='14' platformBuildVersionCode='34' compileSdkVersion='34' compileSdkVersionCodename='14' uses-permission: name='com.sec.android.app.clockpackage.permission.READ_ALARM' 實際測試 $ adb shell CLASSPATH=/sdcard/monkeyq.jar:/sdcard/framework.jar:/sdcard/fastbot-thirdpart.jar exec app_process /system/bin com.android.commands.monkey.Monkey -p <package name> --agent reuseq --running-minutes <遍歷時長> --throttle <事件頻率> -v -v --- $ adb shell CLASSPATH=/sdcard/monkeyq.jar:/sdcard/framework.jar:/sdcard/fastbot-thirdpart.jar exec app_process /system/bin com.android.commands.monkey.Monkey -p com.spotify.music --agent reuseq --running-minutes 1 --throttle 500 -v -v --output-directory /sdcard/fastbot_results&amp;adb pull /sdcard/fastbot_results D:\Downloads 輸入自訂Strings # Download ADBKeyBoard，安裝後設定預設keyboard為ADBKeyboard $ wget https://github.com/senzhk/ADBKeyBoard/raw/master/ADBKeyboard.apk $ adb install ADBKeyboard.apk $ adb shell ime enable com.android.adbkeyboard/.AdbIME $ adb shell ime set com.android.adbkeyboard/.AdbIME 設定config並push到手機 $ echo &#34;max.randomPickFromStringList = true&#34; > max.config $ adb push max.config /sdcard 設定像要輸入的strings並push到手機 $ echo &#34;test string&#34; > max.strings $ adb push max.strings /sdcard :::info"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="tools"><meta property="article:tag" content="Tools"><title>Fastbot Android | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/tools/others/android-app-crawler/fastbot-android/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Fastbot Android</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#一般使用>一般使用</a></li><li><a href=#輸入自訂strings>輸入自訂Strings</a></li><li><a href=#自訂前期的script>自訂前期的Script</a><ul><li><a href=#設定config>設定config</a></li><li><a href=#注意>注意</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=fastbot-android>Fastbot Android
<a class=anchor href=#fastbot-android>#</a></h1><p>以下流程皆是參考<a href=https://blog.csdn.net/u010698107/article/details/127347704>CSDN-Android APP穩定性測試工具Fastbot</a>和<a href=https://github.com/bytedance/Fastbot_Android/blob/main/handbook-cn.md>官方中文教學</a></p><h2 id=一般使用>一般使用
<a class=anchor href=#%e4%b8%80%e8%88%ac%e4%bd%bf%e7%94%a8>#</a></h2><ol><li>把repo clone下來，並且把一些檔案複製到手機<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ git clone https://github.com/bytedance/Fastbot_Android.git
</span></span><span style=display:flex><span>$ cd Fastbot_Android
</span></span><span style=display:flex><span>$ adb push fastbot-thirdpart.jar /sdcard
</span></span><span style=display:flex><span>$ adb push framework.jar /sdcard
</span></span><span style=display:flex><span>$ adb push monkeyq.jar /sdcard
</span></span><span style=display:flex><span>$ adb push libs/. /data/local/tmp/
</span></span></code></pre></div></li><li>dump apk內部會使用到的strings，並且複製到手機<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ aapt2 dump strings &lt;your apk name&gt; &gt; max.valid.strings
</span></span><span style=display:flex><span>$ adb push max.valid.strings /sdcard 
</span></span></code></pre></div></li><li>獲取device number和package name<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb devices
</span></span><span style=display:flex><span>List of devices attached
</span></span><span style=display:flex><span>24121JEGR04513  device
</span></span><span style=display:flex><span>$ aapt2 dump badging <span style=color:#e6db74>&#34;Spotify_ Music and Podcasts_8.9.60.560_APKPure.apk&#34;</span> | findstr <span style=color:#e6db74>&#34;package&#34;</span>
</span></span><span style=display:flex><span>package: name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;com.spotify.music&#39;</span> versionCode<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;116920144&#39;</span> versionName<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;8.9.60.560&#39;</span> platformBuildVersionName<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;14&#39;</span> platformBuildVersionCode<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;34&#39;</span> compileSdkVersion<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;34&#39;</span> compileSdkVersionCodename<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;14&#39;</span>
</span></span><span style=display:flex><span>uses-permission: name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;com.sec.android.app.clockpackage.permission.READ_ALARM&#39;</span>
</span></span></code></pre></div></li><li>實際測試<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb shell CLASSPATH<span style=color:#f92672>=</span>/sdcard/monkeyq.jar:/sdcard/framework.jar:/sdcard/fastbot-thirdpart.jar exec app_process /system/bin com.android.commands.monkey.Monkey -p &lt;package name&gt; --agent reuseq --running-minutes &lt;遍歷時長&gt; --throttle &lt;事件頻率&gt; -v -v
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>$ adb shell CLASSPATH<span style=color:#f92672>=</span>/sdcard/monkeyq.jar:/sdcard/framework.jar:/sdcard/fastbot-thirdpart.jar exec app_process /system/bin com.android.commands.monkey.Monkey -p com.spotify.music --agent reuseq --running-minutes <span style=color:#ae81ff>1</span> --throttle <span style=color:#ae81ff>500</span> -v -v --output-directory /sdcard/fastbot_results&amp;adb pull /sdcard/fastbot_results D:<span style=color:#ae81ff>\D</span>ownloads
</span></span></code></pre></div></li></ol><h2 id=輸入自訂strings>輸入自訂Strings
<a class=anchor href=#%e8%bc%b8%e5%85%a5%e8%87%aa%e8%a8%82strings>#</a></h2><ol><li>Download ADBKeyBoard，安裝後設定預設keyboard為ADBKeyboard<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ wget https://github.com/senzhk/ADBKeyBoard/raw/master/ADBKeyboard.apk
</span></span><span style=display:flex><span>$ adb install ADBKeyboard.apk
</span></span><span style=display:flex><span>$ adb shell ime enable com.android.adbkeyboard/.AdbIME
</span></span><span style=display:flex><span>$ adb shell ime set com.android.adbkeyboard/.AdbIME
</span></span></code></pre></div></li><li>設定config並push到手機<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;max.randomPickFromStringList = true&#34;</span> &gt; max.config
</span></span><span style=display:flex><span>$ adb push max.config /sdcard
</span></span></code></pre></div></li><li>設定像要輸入的strings並push到手機<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;test string&#34;</span> &gt; max.strings
</span></span><span style=display:flex><span>$ adb push max.strings /sdcard
</span></span></code></pre></div></li></ol><p>:::info</p><ul><li>如何設定成原本的keyboard<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb shell ime reset
</span></span></code></pre></div></li><li>傳送text<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb shell am broadcast -a ADB_INPUT_TEXT --es msg <span style=color:#e6db74>&#39;test&#39;</span>
</span></span></code></pre></div></li><li>全選目前textview的strings<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb shell am broadcast -a ADB_INPUT_TEXT --es mcode <span style=color:#e6db74>&#39;4096,29&#39;</span>
</span></span></code></pre></div></li><li>Delete Strings<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb shell am broadcast -a ADB_INPUT_CODE --ei code <span style=color:#ae81ff>67</span>
</span></span></code></pre></div></li></ul><p>:::</p><h2 id=自訂前期的script>自訂前期的Script
<a class=anchor href=#%e8%87%aa%e8%a8%82%e5%89%8d%e6%9c%9f%e7%9a%84script>#</a></h2><p>如果想要自行設定前期的登入或是註冊這樣的flow，就可以利用這個模式，只要先設定好XPATH和action，Fastbot就會按照我們給定的config去執行，執行完了之後就會繼續執行我們前面給的command依序crawl</p><h3 id=設定config>設定config
<a class=anchor href=#%e8%a8%ad%e5%ae%9aconfig>#</a></h3><p>這個部分有點複雜，如果是像spotify這樣因為無法screenshot而無法使用Appium Inspector工具的就會更複雜</p><ol><li>在PC上創一個<code>max.xpath.actions</code>文件</li><li>利用Maxim知道目前的activity name<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ git clone https://github.com/zhangzhao4444/Maxim.git
</span></span><span style=display:flex><span>$ cd Maxim
</span></span><span style=display:flex><span>$ adb push framework.jar /sdcard
</span></span><span style=display:flex><span>$ adb push monkey.jar /sdcard
</span></span><span style=display:flex><span>$ adb shell CLASSPATH<span style=color:#f92672>=</span>/sdcard/Maxim/monkey.jar:/sdcard/Maxim/framework.jar exec app_process /system/bin tv.panda.test.monkey.api.CurrentActivity
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Maxim<span style=color:#f92672>]</span> current activity:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Maxim<span style=color:#f92672>]</span> // com.spotify.login.loginflowimpl.LoginActivity
</span></span></code></pre></div></li><li>獲取想要互動的View的XPATH
如果可以screenshot的話，就可以利用Appium-Inspector，否則可以用我給的script慢慢爬，只要手機USB連線，並且開啟想要爬的activity頁面，執行下方script，就會print出目前和該app有關的clickable/editable view XPATH，以下用spotify為例
:::spoiler Fetch XPATH Script<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> uiautomator2 <span style=color:#66d9ef>as</span> u2
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> xml.etree.ElementTree <span style=color:#66d9ef>as</span> ET
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>adb_devices</span>() <span style=color:#f92672>-&gt;</span> str:  <span style=color:#75715e># 取得所有模擬器名稱與狀態</span>
</span></span><span style=display:flex><span>    cmd <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;adb devices&#39;</span>
</span></span><span style=display:flex><span>    process <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>popen(cmd)
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> process<span style=color:#f92672>.</span>read()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>    text <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> result:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;List of devices&#39;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> line <span style=color:#f92672>and</span> line <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#f92672>and</span> line <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39; &#39;</span>:  <span style=color:#75715e># 去掉標題跟空白字串</span>
</span></span><span style=display:flex><span>            text<span style=color:#f92672>.</span>append(line)
</span></span><span style=display:flex><span>    devices <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(text)):
</span></span><span style=display:flex><span>        words <span style=color:#f92672>=</span> text[i]<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\t</span><span style=color:#e6db74>&#39;</span>)  <span style=color:#75715e># 格式: emulator-5554\tdevice</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;device&#39;</span> <span style=color:#f92672>in</span> words[<span style=color:#ae81ff>1</span>]:  <span style=color:#75715e># 只存有啟動的模擬器</span>
</span></span><span style=display:flex><span>            devices[i] <span style=color:#f92672>=</span> words[<span style=color:#ae81ff>0</span>]  <span style=color:#75715e># 用模擬器index當key</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(devices) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;[x] None emulator is running&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> devices
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>connect_single_device</span>(emulator: str) <span style=color:#f92672>-&gt;</span> u2<span style=color:#f92672>.</span>Device:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        d <span style=color:#f92672>=</span> u2<span style=color:#f92672>.</span>connect(emulator)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> d
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;[x] Unable to connect to the emulator&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_xpath</span>(view):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    根据视图的属性生成 XPath。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param view: 视图的属性字典
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :return: 生成的 XPath 字符串
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    xpath <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;//</span><span style=color:#e6db74>{</span>view[<span style=color:#e6db74>&#39;class&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    conditions <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> view[<span style=color:#e6db74>&#39;index&#39;</span>]:
</span></span><span style=display:flex><span>        conditions<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;@index=&#39;</span><span style=color:#e6db74>{</span>view[<span style=color:#e6db74>&#39;index&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> view[<span style=color:#e6db74>&#39;text&#39;</span>]:
</span></span><span style=display:flex><span>        conditions<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;@text=&#39;</span><span style=color:#e6db74>{</span>view[<span style=color:#e6db74>&#39;text&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> view[<span style=color:#e6db74>&#39;resource-id&#39;</span>]:
</span></span><span style=display:flex><span>        conditions<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;@resource-id=&#39;</span><span style=color:#e6db74>{</span>view[<span style=color:#e6db74>&#39;resource-id&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> view[<span style=color:#e6db74>&#39;package&#39;</span>]:
</span></span><span style=display:flex><span>        conditions<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;@package=&#39;</span><span style=color:#e6db74>{</span>view[<span style=color:#e6db74>&#39;package&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> view[<span style=color:#e6db74>&#39;content-desc&#39;</span>]:
</span></span><span style=display:flex><span>        conditions<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;@content-desc=&#39;</span><span style=color:#e6db74>{</span>view[<span style=color:#e6db74>&#39;content-desc&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> view[<span style=color:#e6db74>&#39;clickable&#39;</span>]:
</span></span><span style=display:flex><span>        conditions<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;@clickable=&#39;</span><span style=color:#e6db74>{</span>view[<span style=color:#e6db74>&#39;clickable&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> conditions:
</span></span><span style=display:flex><span>        xpath <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;[&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; and &#34;</span><span style=color:#f92672>.</span>join(conditions) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;]&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> xpath
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>(emulator: str):
</span></span><span style=display:flex><span>    d <span style=color:#f92672>=</span> connect_single_device(emulator)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># get the UI hierarchy dump content</span>
</span></span><span style=display:flex><span>    xml <span style=color:#f92672>=</span> d<span style=color:#f92672>.</span>dump_hierarchy(compressed<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, pretty<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, max_depth<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>    root <span style=color:#f92672>=</span> ET<span style=color:#f92672>.</span>fromstring(xml)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> clickable_views<span style=color:#f92672>.</span>get(activity_level) <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        clickable_views[activity_level] <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> editable_views<span style=color:#f92672>.</span>get(activity_level) <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        editable_views[activity_level] <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Find all clickable &amp; editable views</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> view <span style=color:#f92672>in</span> root<span style=color:#f92672>.</span>iter():
</span></span><span style=display:flex><span>        resource_id <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span>attrib<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;resource-id&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        clickable <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span>attrib<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;clickable&#39;</span>, <span style=color:#e6db74>&#39;false&#39;</span>)
</span></span><span style=display:flex><span>        package_name <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span>attrib<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;package&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> any(app_name<span style=color:#f92672>.</span>lower() <span style=color:#f92672>in</span> a <span style=color:#66d9ef>for</span> a <span style=color:#f92672>in</span> [resource_id, package_name]) <span style=color:#f92672>and</span> clickable <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;true&#39;</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Clickable View XPATH: &#34;</span>, generate_xpath(view<span style=color:#f92672>.</span>attrib))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> view <span style=color:#f92672>in</span> root<span style=color:#f92672>.</span>findall(<span style=color:#e6db74>&#34;.//*[@class=&#39;android.widget.EditText&#39;]&#34;</span>):
</span></span><span style=display:flex><span>        resource_id <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span>attrib<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;resource-id&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> app_name<span style=color:#f92672>.</span>lower() <span style=color:#f92672>in</span> resource_id:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Editable View XPATH: &#34;</span>, generate_xpath(view<span style=color:#f92672>.</span>attrib))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    clickable_views <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>    editable_views <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>    app_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Spotify&#39;</span>
</span></span><span style=display:flex><span>    activity_level <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        emulators <span style=color:#f92672>=</span> adb_devices()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;[x] Cannot get the list of emulators, the program will be terminated. Please use adb devices to check if the emulator is running&#39;</span>)
</span></span><span style=display:flex><span>        exit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    main(emulators[<span style=color:#ae81ff>0</span>])
</span></span></code></pre></div>:::<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python fetchXPATH.py
</span></span><span style=display:flex><span>Clickable View XPATH:  //android.widget.Button<span style=color:#f92672>[</span>@index<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0&#39;</span> and @text<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Sign up free&#39;</span> and @package<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;com.spotify.music&#39;</span> and @clickable<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;true&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Clickable View XPATH:  //android.widget.Button<span style=color:#f92672>[</span>@index<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;1&#39;</span> and @text<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Continue with Google&#39;</span> and @package<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;com.spotify.music&#39;</span> and @clickable<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;true&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Clickable View XPATH:  //android.widget.Button<span style=color:#f92672>[</span>@index<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2&#39;</span> and @text<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Continue with Facebook&#39;</span> and @package<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;com.spotify.music&#39;</span> and @clickable<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;true&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Clickable View XPATH:  //android.widget.Button<span style=color:#f92672>[</span>@index<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;3&#39;</span> and @text<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Log in&#39;</span> and @package<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;com.spotify.music&#39;</span> and @clickable<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;true&#39;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div></li><li>接下來就把XPATH貼到下方格式的地方就可以了
在同一個activity的步驟不需要拆分，詳細說明可以看<a href=https://github.com/bytedance/Fastbot_Android/blob/main/handbook-cn.md#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6%E5%BA%8F%E5%88%97>Fastbot handbook</a><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;prob&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;activity&#34;</span>: <span style=color:#e6db74>&#34;com.spotify.login.loginflowimpl.LoginActivity&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;times&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;actions&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;xpath&#34;</span>: <span style=color:#e6db74>&#34;//android.widget.Button[@index=&#39;3&#39; and @text=&#39;Log in&#39; and @package=&#39;com.spotify.music&#39; and @clickable=&#39;true&#39;&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;action&#34;</span>: <span style=color:#e6db74>&#34;CLICK&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;throttle&#34;</span> : <span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;xpath&#34;</span>: <span style=color:#e6db74>&#34;//*[@resource-id=&#39;com.spotify.music:id/username_text&#39;]&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;action&#34;</span>: <span style=color:#e6db74>&#34;CLICK&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;text&#34;</span>: <span style=color:#e6db74>&#34;username&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;throttle&#34;</span> : <span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;xpath&#34;</span>: <span style=color:#e6db74>&#34;//*[@resource-id=&#39;com.spotify.music:id/password_text&#39;]&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;action&#34;</span>: <span style=color:#e6db74>&#34;CLICK&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;text&#34;</span>: <span style=color:#e6db74>&#34;password&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;throttle&#34;</span> : <span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;xpath&#34;</span>: <span style=color:#e6db74>&#34;//*[@resource-id=&#39;com.spotify.music:id/login_button&#39; and @text=&#39;Log in&#39;]&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;action&#34;</span>: <span style=color:#e6db74>&#34;CLICK&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;throttle&#34;</span> : <span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>]
</span></span></code></pre></div>把以上json格式填寫好後，丟到<a href=https://www.json.cn/>Json Checker</a>檢查有無問題，注意最一開始和最後一定是中括號，格式正確後再填寫到==max.xpath.actions==，並且丟到手機上<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb push max.xpath.actions /sdcard
</span></span></code></pre></div></li></ol><h3 id=注意>注意
<a class=anchor href=#%e6%b3%a8%e6%84%8f>#</a></h3><p>:::info</p><ol><li>如果有想要填寫文字的情況就一定要保證是用ADBKeyboard的狀態下才會如實的填寫我們設定好的text</li><li>Fastbot預設會到/sdcard抓max.xpath.actions，所以不要放到其他地方
:::</li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#一般使用>一般使用</a></li><li><a href=#輸入自訂strings>輸入自訂Strings</a></li><li><a href=#自訂前期的script>自訂前期的Script</a><ul><li><a href=#設定config>設定config</a></li><li><a href=#注意>注意</a></li></ul></li></ul></nav></div></aside></main></body></html>