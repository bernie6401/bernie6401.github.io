<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Drozer Cheat Sheet
  #


  Basic Console
  #

基本上最常用的command就是
dz> run <drozer module> <optional object> # 啟動內建的module做到依稀操作
dz> help <drozer module> # 查看該module的說明以及參數設定
dz> run app.package.list #列出所有已安裝的app package
dz> run app.package.list -f <key word> #列出特定的app package 
dz> run app.package.info -a <app package name> # 列出該app的基本訊息
dz> run app.package.manifest <app package name e.g. jakhar.aseem.diva> # 查看AndroidManifest.xml的資訊
dz> run app.package.attacksurface <app package name e.g. com.mwr.example.sieve> # 查看該app有什麼攻擊面
Attack Surface:
    3 activities exported # 也許可以啟動一個activity並且bypass某種應該阻止我啟動他的權限
    0 broadcast receivers exported
    2 content providers exported # 也許可以fetch private data或是利用某些漏洞 e.g. sqli or path traversal
    2 services exported
        is debuggable
接著根據得到的資訊看要用以下哪一種的攻擊模式"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/tools/others/android-related/drozer/drozer-cheat-sheet/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Drozer Cheat Sheet"><meta property="og:description" content="Drozer Cheat Sheet # Basic Console # 基本上最常用的command就是
dz> run <drozer module> <optional object> # 啟動內建的module做到依稀操作 dz> help <drozer module> # 查看該module的說明以及參數設定 dz> run app.package.list #列出所有已安裝的app package dz> run app.package.list -f <key word> #列出特定的app package dz> run app.package.info -a <app package name> # 列出該app的基本訊息 dz> run app.package.manifest <app package name e.g. jakhar.aseem.diva> # 查看AndroidManifest.xml的資訊 dz> run app.package.attacksurface <app package name e.g. com.mwr.example.sieve> # 查看該app有什麼攻擊面 Attack Surface: 3 activities exported # 也許可以啟動一個activity並且bypass某種應該阻止我啟動他的權限 0 broadcast receivers exported 2 content providers exported # 也許可以fetch private data或是利用某些漏洞 e.g. sqli or path traversal 2 services exported is debuggable 接著根據得到的資訊看要用以下哪一種的攻擊模式"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="tools"><meta property="article:tag" content="Android"><meta property="article:tag" content="Drozer"><title>Drozer Cheat Sheet | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/tools/others/android-related/drozer/drozer-cheat-sheet/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Drozer Cheat Sheet</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#basic-console>Basic Console</a><ul><li><a href=#activities-exported>activities exported</a></li><li><a href=#services-exported>services exported</a></li><li><a href=#broadcast-receivers-exported>broadcast receivers exported</a></li><li><a href=#content-providers-exported>content providers exported</a></li><li><a href=#is-debuggable>is debuggable</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=drozer-cheat-sheet>Drozer Cheat Sheet
<a class=anchor href=#drozer-cheat-sheet>#</a></h1><h2 id=basic-console>Basic Console
<a class=anchor href=#basic-console>#</a></h2><p>基本上最常用的command就是</p><pre tabindex=0><code class=language-bash! data-lang=bash!>dz&gt; run &lt;drozer module&gt; &lt;optional object&gt; # 啟動內建的module做到依稀操作
dz&gt; help &lt;drozer module&gt; # 查看該module的說明以及參數設定
</code></pre><pre tabindex=0><code class=language-bash! data-lang=bash!>dz&gt; run app.package.list #列出所有已安裝的app package
dz&gt; run app.package.list -f &lt;key word&gt; #列出特定的app package 
dz&gt; run app.package.info -a &lt;app package name&gt; # 列出該app的基本訊息
dz&gt; run app.package.manifest &lt;app package name e.g. jakhar.aseem.diva&gt; # 查看AndroidManifest.xml的資訊
dz&gt; run app.package.attacksurface &lt;app package name e.g. com.mwr.example.sieve&gt; # 查看該app有什麼攻擊面
Attack Surface:
    3 activities exported # 也許可以啟動一個activity並且bypass某種應該阻止我啟動他的權限
    0 broadcast receivers exported
    2 content providers exported # 也許可以fetch private data或是利用某些漏洞 e.g. sqli or path traversal
    2 services exported
        is debuggable
</code></pre><p>接著根據得到的資訊看要用以下哪一種的攻擊模式</p><h3 id=activities-exported>activities exported
<a class=anchor href=#activities-exported>#</a></h3><p>如果確定該app的AndroidManifest.xml有設定==android:export=&ldquo;true&rdquo;==，就代表有機會bypass他的權限，根據[^csdn-androidmanifest-xml]這個地方的風險如下:</p><blockquote><p>android:exported
這個屬性用於指示該服務是否能夠被其他應用程序組件call或跟它interact。如果設置為true，則callable或interactable，否則不能。設置為false時，只有同一個應用程序的組件或帶有相同用戶ID的應用程序才能啟動或綁定該服務。</p></blockquote><ol><li>列出export activities有哪些<pre tabindex=0><code class=language-bash! data-lang=bash!>dz&gt; run app.activity.info -a &lt;app package name&gt;
</code></pre></li><li>啟動activity<pre tabindex=0><code class=language-bash! data-lang=bash!>dz&gt; run app.activity.start --component &lt;app package name&gt; &lt;activity name fetched by above command&gt;
</code></pre>此時會看到手機啟動Sieve App，並且原本應該是需要password才能access的activity，居然可以直接bypass
![Screenshot_20240603-163856](<a href=https://hackmd.io/_uploads/rkrr-ZsNA.png>https://hackmd.io/_uploads/rkrr-ZsNA.png</a> =200x)</li></ol><h3 id=services-exported>services exported
<a class=anchor href=#services-exported>#</a></h3><p>和上面的問題差不多，只是差在被export的是services</p><ol><li>列出export services有哪些<pre tabindex=0><code class=language-bash! data-lang=bash!>dz&gt; run app.service.info -a &lt;app package nam&gt;
</code></pre></li><li>與該services互動
這邊就不是像上一個activity一樣是啟動，而是要和他互動，因為service本來就是一個運行在背景的服務，他沒有畫面，無法和一般使用者互動，會需要的module如下<pre tabindex=0><code>app.service.send            Send a Message to a service, and display the reply
app.service.start           Start Service
app.service.stop            Stop Service
</code></pre>如果去看<code>app.service.send</code>該如何使用，可以直接看範例就好，簡單來說我們可以丟給service一連串東西，就看逆向之後該service怎麼寫，如果參數不夠，可以用<code>--extra</code>去包後面的參數<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>    dz&gt; run app.service.send com.example.srv com.example.srv.Service --msg <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> --extra float value 0.1324 --extra string test value
</span></span><span style=display:flex><span>    Got a reply from com.example.srv/com.example.srv.Service:
</span></span><span style=display:flex><span>      what: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      arg1: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>      arg2: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>    Data:
</span></span><span style=display:flex><span>      value <span style=color:#f92672>(</span>float<span style=color:#f92672>)</span> : 0.1324
</span></span><span style=display:flex><span>      test <span style=color:#f92672>(</span>string<span style=color:#f92672>)</span> : value
</span></span></code></pre></div></li></ol><h3 id=broadcast-receivers-exported>broadcast receivers exported
<a class=anchor href=#broadcast-receivers-exported>#</a></h3><p>根據[^pixnet-android-broadcast]的說明，broadcast屬於process之間的通訊，根據教學:</p><blockquote><p>發現這些廣播接收器後，您應該檢查它們的代碼。特別注意<strong>onReceive</strong>函數，因為它將處理接收到的消息。</p></blockquote><ol><li>檢測broadcast receiver<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.broadcast.info <span style=color:#75715e># 檢測所有broadcast receiver</span>
</span></span><span style=display:flex><span>dz&gt; run app.broadcast.info -a &lt;app package name&gt; <span style=color:#75715e># 檢查特定app內的broadcast receiver</span>
</span></span></code></pre></div></li><li>和前面的exported service一樣，我們要和他們互動，但至於要傳送什麼也是要透過逆向來後來判斷<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>app.broadcast.info          Get information about broadcast receivers
</span></span><span style=display:flex><span>app.broadcast.send          Send broadcast using an intent
</span></span><span style=display:flex><span>app.broadcast.sniff         Register a broadcast receiver that can sniff particular intents
</span></span></code></pre></div>根據help的提示如下，可以知道該如何使用send→Sends an intent to broadcast receivers.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.broadcast.send --action &lt;action name fetch by AndroidManifest.xml&gt; --component &lt;path to the <span style=color:#66d9ef>function</span> name&gt; &lt;<span style=color:#66d9ef>function</span> name&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Examples:
</span></span><span style=display:flex><span>Attempt to send the BOOT_COMPLETED broadcast message:
</span></span><span style=display:flex><span>    dz&gt; run app.broadcast.send --action android.intent.action.BOOT_COMPLETED
</span></span><span style=display:flex><span>    java.lang.SecurityException: Permission Denial: not allowed to send broadcast
</span></span><span style=display:flex><span>android.intent.action.BOOT_COMPLETED from pid<span style=color:#f92672>=</span>955, uid<span style=color:#f92672>=</span><span style=color:#ae81ff>10044</span>
</span></span></code></pre></div></li></ol><h3 id=content-providers-exported>content providers exported
<a class=anchor href=#content-providers-exported>#</a></h3><ol><li>檢查Content Provider的exported狀況<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.info -a &lt;app package name&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Drozer可以猜測並嘗試多個URI，這樣我們才知道確切的URI長怎樣</span>
</span></span><span style=display:flex><span>dz&gt; run scanner.provider.finduris -a &lt;app package name&gt;
</span></span></code></pre></div></li><li>利用逆向判斷他是基於database還是基於file system的Content Provider<ul><li>基於DataBase<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#1. 查詢內容</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query &lt;URI&gt; <span style=color:#f92672>[</span>--projection <span style=color:#f92672>[</span>columns ...<span style=color:#f92672>]]</span> <span style=color:#f92672>[</span>--selection conditions<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--selection-args <span style=color:#f92672>[</span>arg ...<span style=color:#f92672>]]</span> <span style=color:#f92672>[</span>--order by_column<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--vertical<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#2. 插入內容</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.insert &lt;URI&gt; <span style=color:#f92672>[</span>--string key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--double key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--float key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--integer key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--long key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--short key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--boolean key value<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#3. 更新內容</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#總而言之就是要選擇更新的地方，和要更新的內容為何</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#selection參數有點像是一般常見的&#34;WHERE &lt;conditions&gt;&#34;</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.update &lt;URI&gt; --selection &lt;指定是哪一個欄位, format: <span style=color:#e6db74>&#34;column name=?&#34;</span>&gt; --selection-args &lt;用來取代前面selection的問號，可以不只一個&gt; <span style=color:#f92672>[</span>--string key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--double key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--float key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--integer key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--long key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--short key value<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--boolean key value<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#4. 刪除內容</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#幾乎和前面一樣，也就是要指定刪除的位置</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.delete &lt;URI&gt; --selection &lt;指定是哪一個欄位, format: <span style=color:#e6db74>&#34;column name=?&#34;</span>&gt; --selection-args &lt;用來取代前面selection的問號，可以不只一個&gt; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#5. SQLi</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#這邊是利用query來達到sqli，利用--selection和--projection這兩個參數，</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#projection這個參數，原文的解釋: </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#the columns to SELECT from the database, as in &#34;SELECT &lt;projection&gt; FROM ...&#34;</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query &lt;URI&gt; --selection <span style=color:#e6db74>&#34;&#39;&#34;</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query &lt;URI&gt; --projection <span style=color:#e6db74>&#34;*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#6. Drozer自動發現SQLi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>dz&gt; run scanner.provider.injection -a &lt;app package name&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>dz&gt; run scanner.provider.sqltables -a &lt;app package name&gt;
</span></span></span></code></pre></div></li><li>基於File System<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#1. 讀取文件</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.read &lt;URI+path&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#2. Path Traversal</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.read &lt;URI+../../../../+path&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#3. Drozer自動發現Path Traversal</span>
</span></span><span style=display:flex><span>dz&gt; run scanner.provider.traversal -a &lt;app package name&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#4. Download File to Local</span>
</span></span><span style=display:flex><span>run app.provider.download &lt;URI+path&gt; hosts
</span></span></code></pre></div></li></ul></li></ol><h3 id=is-debuggable>is debuggable
<a class=anchor href=#is-debuggable>#</a></h3><p>可以直接用drozer找，或者是直接看AndroidManifest.xml中有無提到==debuggable=&ldquo;true&rdquo;==</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 找到所有debuggable的app</span>
</span></span><span style=display:flex><span>dz&gt; run app.package.debuggable
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#basic-console>Basic Console</a><ul><li><a href=#activities-exported>activities exported</a></li><li><a href=#services-exported>services exported</a></li><li><a href=#broadcast-receivers-exported>broadcast receivers exported</a></li><li><a href=#content-providers-exported>content providers exported</a></li><li><a href=#is-debuggable>is debuggable</a></li></ul></li></ul></nav></div></aside></main></body></html>