<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  TaiwanHolyHigh - Windows Forensics - $MFT Resident / Non-Resident File
  #

:::spoiler TOC
[TOC]
:::

  Background
  #

$MFT儲存的內容

==Status==
==$MFT Record==(File Identify/Location)
==Timestamp==

Standard Info
Filename


==Resident==

特性如下:

$SO\ne 0$: 意思就是resident file的前面一定有其他檔案，而他一定不會是$MFT的開頭
No File Slack: 沒有檔案暫存區，意味著他會住在一個剛剛好的大小的房間中
Physical Size = Logical Size: 這個就和前一個有相關，logical size就是實際住進去房間的檔案大小，而physical size就是飯店給予我們房間的大小，所以$physical_size\ge logical_size$
如果resident file因為駭客的攻擊(injection/trojan/backdoor&mldr;)使得檔案大小變大，而失去原本resident file的身分，則該檔案就會被搬出目前的地方，就算之後檔案大小變回來，還是無法再住回原本的地方，這就是攻擊方所遺留的攻擊痕跡


如何判斷?如果檔名後面接的是18 00 00 00 01 00就是resident file，例如：
:::spoiler 範例

:::
或者是看18 00 00 00 10 00的前面第二個byte(就是non-resident flag)，是00代表不是non-resident file，反之就是
:::spoiler flag範例

:::
檔案大小
18 00 00 00 10 00後面接著的四個bytes就是檔案大小$\to$換成10禁制就對了，另外如果此檔案是resident file，則檔案大小後面除了固定的18 00 00 00以外，後面還會有該檔案原本的file signature，以此為例就是89 50 4E 47也就是png的magical header
:::spoiler flag範例

此範例就是02 02$\to$514 bytes
:::


==non-Resident File==
如果是non-resident file，檔名的後面一點會接的是80 00 00 00 48 00 00 00，再後面就是non-resident flag

另外，檔案的大小會在flag往後數40個bytes的地方，以底下範例來說就是F6 09 00 00



  Lab - Resident File
  #


  Lab - Offset 43208704(d)
  #

先找檔名，後面會跟著18 00 00 00 01 00，前面會有non-resident flag(前面第二個byte)，再後面會跟著檔案大小D0 01，再後面一點會跟著原本這個file的signature"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/tai.holyhigh/windows-os-forensics/taiwanholyhigh---windows-forensics---mft-resident-_-non-resident-file/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="TaiwanHolyHigh - Windows Forensics - $MFT Resident / Non-Resident File"><meta property="og:description" content="TaiwanHolyHigh - Windows Forensics - $MFT Resident / Non-Resident File # :::spoiler TOC [TOC] :::
Background # $MFT儲存的內容
==Status== ==$MFT Record==(File Identify/Location) ==Timestamp== Standard Info Filename ==Resident== 特性如下: $SO\ne 0$: 意思就是resident file的前面一定有其他檔案，而他一定不會是$MFT的開頭 No File Slack: 沒有檔案暫存區，意味著他會住在一個剛剛好的大小的房間中 Physical Size = Logical Size: 這個就和前一個有相關，logical size就是實際住進去房間的檔案大小，而physical size就是飯店給予我們房間的大小，所以$physical_size\ge logical_size$ 如果resident file因為駭客的攻擊(injection/trojan/backdoor…)使得檔案大小變大，而失去原本resident file的身分，則該檔案就會被搬出目前的地方，就算之後檔案大小變回來，還是無法再住回原本的地方，這就是攻擊方所遺留的攻擊痕跡 如何判斷?如果檔名後面接的是18 00 00 00 01 00就是resident file，例如： :::spoiler 範例 ::: 或者是看18 00 00 00 10 00的前面第二個byte(就是non-resident flag)，是00代表不是non-resident file，反之就是 :::spoiler flag範例 ::: 檔案大小 18 00 00 00 10 00後面接著的四個bytes就是檔案大小$\to$換成10禁制就對了，另外如果此檔案是resident file，則檔案大小後面除了固定的18 00 00 00以外，後面還會有該檔案原本的file signature，以此為例就是89 50 4E 47也就是png的magical header :::spoiler flag範例 此範例就是02 02$\to$514 bytes ::: ==non-Resident File== 如果是non-resident file，檔名的後面一點會接的是80 00 00 00 48 00 00 00，再後面就是non-resident flag 另外，檔案的大小會在flag往後數40個bytes的地方，以底下範例來說就是F6 09 00 00 Lab - Resident File # Lab - Offset 43208704(d) # 先找檔名，後面會跟著18 00 00 00 01 00，前面會有non-resident flag(前面第二個byte)，再後面會跟著檔案大小D0 01，再後面一點會跟著原本這個file的signature"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="TaiwanHolyHigh"><meta property="article:tag" content="Forensics"><meta property="article:tag" content="Windows"><title>TaiwanHolyHigh - Windows Forensics - $MFT Resident / Non-Resident File | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/tai.holyhigh/windows-os-forensics/taiwanholyhigh---windows-forensics---mft-resident-_-non-resident-file/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>TaiwanHolyHigh - Windows Forensics - $MFT Resident / Non-Resident File</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#lab---resident-file>Lab - Resident File</a><ul><li><a href=#lab---offset-43208704d>Lab - Offset 43208704(d)</a></li><li><a href=#lab---offset-43110400d>Lab - Offset 43110400(d)</a></li></ul></li><li><a href=#lab---non-resident-file>Lab - Non-Resident File</a><ul><li><a href=#lab---offset-43462656d>Lab - Offset 43462656(d)</a></li><li><a href=#lab---offset-43485184d>Lab - Offset 43485184(d)</a></li><li><a href=#lab---offset-62343168d>Lab - Offset 62343168(d)</a></li></ul></li><li><a href=#現場考試>現場考試</a><ul><li><a href=#offset-51472384d>Offset 51472384(d)</a></li><li><a href=#offset-65898496d>Offset 65898496(d)</a></li><li><a href=#offset-64329728d>Offset 64329728(d)</a></li><li><a href=#offset-65873920d>Offset 65873920(d)</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=taiwanholyhigh---windows-forensics---mft-resident--non-resident-file>TaiwanHolyHigh - Windows Forensics - $MFT Resident / Non-Resident File
<a class=anchor href=#taiwanholyhigh---windows-forensics---mft-resident--non-resident-file>#</a></h1><p>:::spoiler TOC
[TOC]
:::</p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>$MFT儲存的內容</p><ol><li>==Status==</li><li>==$MFT Record==(File Identify/Location)</li><li>==Timestamp==<ul><li>Standard Info</li><li>Filename</li></ul></li><li>==Resident==<ul><li>特性如下:<ul><li>$SO\ne 0$: 意思就是resident file的前面一定有其他檔案，而他一定不會是$MFT的開頭</li><li>No File Slack: 沒有檔案暫存區，意味著他會住在一個剛剛好的大小的房間中</li><li>Physical Size = Logical Size: 這個就和前一個有相關，logical size就是實際住進去房間的檔案大小，而physical size就是飯店給予我們房間的大小，所以$physical_size\ge logical_size$</li><li>如果resident file因為駭客的攻擊(injection/trojan/backdoor&mldr;)使得檔案大小變大，而失去原本resident file的身分，則該檔案就會被搬出目前的地方，就算之後檔案大小變回來，還是無法再住回原本的地方，這就是攻擊方所遺留的攻擊痕跡</li></ul></li><li>如何判斷?如果檔名後面接的是<code>18 00 00 00 01 00</code>就是resident file，例如：
:::spoiler 範例
<img src=https://hackmd.io/_uploads/rynQ2dFGp.png alt>
:::
或者是看<code>18 00 00 00 10 00</code>的前面第二個byte(就是non-resident flag)，是<code>00</code>代表不是non-resident file，反之就是
:::spoiler flag範例
<img src=https://hackmd.io/_uploads/HkAy6_tMa.png alt>
:::</li><li>檔案大小
<code>18 00 00 00 10 00</code>後面接著的四個bytes就是檔案大小$\to$換成10禁制就對了，另外如果此檔案是resident file，則檔案大小後面除了固定的<code>18 00 00 00</code>以外，後面還會有該檔案原本的file signature，以此為例就是<code>89 50 4E 47</code>也就是png的magical header
:::spoiler flag範例
<img src=https://hackmd.io/_uploads/SkwzAOtGa.png alt>
此範例就是<code>02 02</code>$\to$514 bytes
:::</li></ul></li><li>==non-Resident File==
如果是non-resident file，檔名的後面一點會接的是<code>80 00 00 00 48 00 00 00</code>，再後面就是non-resident flag
<img src=https://hackmd.io/_uploads/HJk7NFtf6.png alt>
另外，檔案的大小會在flag往後數40個bytes的地方，以底下範例來說就是<code>F6 09 00 00</code>
<img src=https://hackmd.io/_uploads/BJWMBtKMT.png alt></li></ol><h2 id=lab---resident-file>Lab - Resident File
<a class=anchor href=#lab---resident-file>#</a></h2><h3 id=lab---offset-43208704d>Lab - Offset 43208704(d)
<a class=anchor href=#lab---offset-43208704d>#</a></h3><p>先找檔名，後面會跟著<code>18 00 00 00 01 00</code>，前面會有non-resident flag(前面第二個byte)，再後面會跟著檔案大小<code>D0 01</code>，再後面一點會跟著原本這個file的signature</p><ul><li>Non-Resident Flag: <code>00</code></li><li>File Size: <code>D0 01</code> = 464 bytes</li></ul><h3 id=lab---offset-43110400d>Lab - Offset 43110400(d)
<a class=anchor href=#lab---offset-43110400d>#</a></h3><ul><li>Non-Resident Flag: <code>00</code></li><li>File Size: <code>FE 01</code> = 510 bytes</li></ul><h2 id=lab---non-resident-file>Lab - Non-Resident File
<a class=anchor href=#lab---non-resident-file>#</a></h2><h3 id=lab---offset-43462656d>Lab - Offset 43462656(d)
<a class=anchor href=#lab---offset-43462656d>#</a></h3><ul><li>Non-Resident Flag: <code>01</code></li><li>File Size: <code>F6 09</code> = 2550 bytes</li></ul><h3 id=lab---offset-43485184d>Lab - Offset 43485184(d)
<a class=anchor href=#lab---offset-43485184d>#</a></h3><ul><li>Non-Resident Flag: <code>01</code></li><li>File Size: <code>42 0E</code> = 3650 bytes</li></ul><h3 id=lab---offset-62343168d>Lab - Offset 62343168(d)
<a class=anchor href=#lab---offset-62343168d>#</a></h3><ul><li>Non-Resident Flag: <code>01</code></li><li>File Size: <code>F7 12</code> = 4855 bytes</li></ul><h2 id=現場考試>現場考試
<a class=anchor href=#%e7%8f%be%e5%a0%b4%e8%80%83%e8%a9%a6>#</a></h2><h3 id=offset-51472384d>Offset 51472384(d)
<a class=anchor href=#offset-51472384d>#</a></h3><p>Non-Resient File</p><ul><li>Status: <code>01 00</code> $\to$ file</li><li>$MFT Record: <code>5A C4</code> $\to$ <code>0x3116800</code></li><li>Standard Info<ul><li>Create Time = Modify Time = <code>1997, 12, 8, 8, 0</code></li><li>$MFT Modify Time = Access Time = <code>2010, 8, 11, 2, 30, 18, 151785</code></li></ul></li><li>Filename Timestamp: <code>2010, 8, 11, 2, 30, 18, 151785</code></li><li>Non-Resident Flag: <code>01</code></li><li>File Size: <code>FD 02</code> $\to$ 765 bytes</li></ul><h3 id=offset-65898496d>Offset 65898496(d)
<a class=anchor href=#offset-65898496d>#</a></h3><p>Resident File</p><ul><li>Status: <code>00 00</code> $\to$ file</li><li>$MFT Record: <code>62 FB</code> $\to$ <code>0x3ed8800</code></li><li>Standard Info<ul><li>Create Time = Access Time = <code>2011, 2, 1, 2, 6, 16</code></li><li>Modify Time = <code>2011, 2, 1, 2, 4, 21</code></li><li>$MFT Modify Time = <code>2011, 2, 9, 2, 21, 46, 662258</code></li></ul></li><li>Filename Timestamp: <code>2011, 2, 9, 2, 16, 36, 547024</code></li><li>Non-Resident Flag: <code>00</code></li><li>File Size: <code>99 01</code> $\to$ 409 bytes</li></ul><h3 id=offset-64329728d>Offset 64329728(d)
<a class=anchor href=#offset-64329728d>#</a></h3><p>Non-Resident File(曾經是resident file)</p><ul><li>Status: <code>01 00</code> $\to$ file</li><li>$MFT Record: <code>66 F5</code> $\to$ <code>0x3d59800</code></li><li>Standard Info<ul><li>Create Time = Access Time = <code>2011, 2, 3, 1, 17, 53, 184265</code></li><li>Modify Time = <code>2011, 2, 3, 1, 17, 53, 272156</code></li><li>$MFT Modify Time = <code>2011, 2, 8, 23, 27, 47, 201321</code></li></ul></li><li>Filename Time: <code>2011, 2, 3, 1, 17, 53, 184265</code></li><li>Non-Resident Flag: <code>01</code></li><li>File Size: <code>21 01</code> $\to$ 289 bytes</li></ul><h3 id=offset-65873920d>Offset 65873920(d)
<a class=anchor href=#offset-65873920d>#</a></h3><p>Non-Resident File</p><ul><li>Status: <code>00 00</code> $\to$ deleted file</li><li>$MFT Record: <code>4A FB</code> $\to$ <code>0x3ed2800</code></li><li>Standard Info<ul><li>Create Time = Access Time = <code>2011, 2, 1, 2, 7, 42</code></li><li>Modify Time = <code>2011, 2, 1, 2, 7, 22</code></li><li>$MFT Modify Time = <code>2011, 2, 9, 2, 21, 46, 701321</code></li></ul></li><li>Filename Time: <code>2011, 2, 9, 2, 16, 36, 400539</code></li><li>Non-Resident Flag: <code>01</code></li><li>File Size: <code>6E 02</code> $\to$ 622 bytes</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#lab---resident-file>Lab - Resident File</a><ul><li><a href=#lab---offset-43208704d>Lab - Offset 43208704(d)</a></li><li><a href=#lab---offset-43110400d>Lab - Offset 43110400(d)</a></li></ul></li><li><a href=#lab---non-resident-file>Lab - Non-Resident File</a><ul><li><a href=#lab---offset-43462656d>Lab - Offset 43462656(d)</a></li><li><a href=#lab---offset-43485184d>Lab - Offset 43485184(d)</a></li><li><a href=#lab---offset-62343168d>Lab - Offset 62343168(d)</a></li></ul></li><li><a href=#現場考試>現場考試</a><ul><li><a href=#offset-51472384d>Offset 51472384(d)</a></li><li><a href=#offset-65898496d>Offset 65898496(d)</a></li><li><a href=#offset-64329728d>Offset 64329728(d)</a></li><li><a href=#offset-65873920d>Offset 65873920(d)</a></li></ul></li></ul></nav></div></aside></main></body></html>