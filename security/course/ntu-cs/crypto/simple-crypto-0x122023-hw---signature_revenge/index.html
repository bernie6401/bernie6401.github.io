<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  Simple Crypto 0x12(2023 HW - signature_revenge)
  #


  Background
  #




  Source code
  #

:::spoiler Source Code
from Crypto.Util.number import *
from hashlib import sha256, md5
from ecdsa import SECP256k1
from ecdsa.ecdsa import Public_key, Private_key
from secret import FLAG
import os
E = SECP256k1
G, n = E.generator, E.order
d = bytes_to_long( os.urandom(32 - len(FLAG)) + FLAG )
pubkey = Public_key(G, d*G)
prikey = Private_key(pubkey, d)

magic1 = md5(d.to_bytes(32, "big")).digest()
magic2 = md5(d.to_bytes(32, "big")[::-1]).digest()

h1 = sha256(b"https://www.youtube.com/watch?v=IBnrn2pnPG8").digest()
h2 = sha256(b"https://www.youtube.com/watch?v=1H2cyhWYXrE").digest()

k1 = bytes_to_long(magic1 + magic2)
k2 = bytes_to_long(magic2 + magic1)

sig1 = prikey.sign(bytes_to_long(h1), k1)
sig2 = prikey.sign(bytes_to_long(h2), k2)

print(f&#39;P = ({pubkey.point.x()}, {pubkey.point.y()})&#39;)
print(f&#39;sig1 = ({sig1.r}, {sig1.s})&#39;)
print(f&#39;sig2 = ({sig2.r}, {sig2.s})&#39;)

# P = (70427896289635684269185763735464004880272487387417064603929487585697794861713, 83106938517126976838986116917338443942453391221542116900720022828358221631968)
# sig1 = (26150478759659181410183574739595997895638116875172347795980556499925372918857, 50639168022751577246163934860133616960953696675993100806612269138066992704236)
# sig2 = (8256687378196792904669428303872036025324883507048772044875872623403155644190, 90323515158120328162524865800363952831516312527470472160064097576156608261906)
:::'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntu-cs/crypto/simple-crypto-0x122023-hw---signature_revenge/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Simple Crypto 0x12(2023 HW - signature_revenge)"><meta property="og:description" content='Simple Crypto 0x12(2023 HW - signature_revenge) # Background # Source code # :::spoiler Source Code
from Crypto.Util.number import * from hashlib import sha256, md5 from ecdsa import SECP256k1 from ecdsa.ecdsa import Public_key, Private_key from secret import FLAG import os E = SECP256k1 G, n = E.generator, E.order d = bytes_to_long( os.urandom(32 - len(FLAG)) + FLAG ) pubkey = Public_key(G, d*G) prikey = Private_key(pubkey, d) magic1 = md5(d.to_bytes(32, "big")).digest() magic2 = md5(d.to_bytes(32, "big")[::-1]).digest() h1 = sha256(b"https://www.youtube.com/watch?v=IBnrn2pnPG8").digest() h2 = sha256(b"https://www.youtube.com/watch?v=1H2cyhWYXrE").digest() k1 = bytes_to_long(magic1 + magic2) k2 = bytes_to_long(magic2 + magic1) sig1 = prikey.sign(bytes_to_long(h1), k1) sig2 = prikey.sign(bytes_to_long(h2), k2) print(f&#39;P = ({pubkey.point.x()}, {pubkey.point.y()})&#39;) print(f&#39;sig1 = ({sig1.r}, {sig1.s})&#39;) print(f&#39;sig2 = ({sig2.r}, {sig2.s})&#39;) # P = (70427896289635684269185763735464004880272487387417064603929487585697794861713, 83106938517126976838986116917338443942453391221542116900720022828358221631968) # sig1 = (26150478759659181410183574739595997895638116875172347795980556499925372918857, 50639168022751577246163934860133616960953696675993100806612269138066992704236) # sig2 = (8256687378196792904669428303872036025324883507048772044875872623403155644190, 90323515158120328162524865800363952831516312527470472160064097576156608261906) :::'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="Eductf"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Crypto"><title>Simple Crypto 0x12(2023 HW - signature_revenge) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntu-cs/crypto/simple-crypto-0x122023-hw---signature_revenge/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Simple Crypto 0x12(2023 HW - signature_revenge)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit---lattice>Exploit - Lattice</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=simple-crypto-0x122023-hw---signature_revenge>Simple Crypto 0x12(2023 HW - signature_revenge)
<a class=anchor href=#simple-crypto-0x122023-hw---signature_revenge>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><img src=https://hackmd.io/_uploads/Skf4o1tGp.png alt>
<img src=https://hackmd.io/_uploads/B16No1FzT.png alt></p><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler Source Code</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> hashlib <span style=color:#f92672>import</span> sha256, md5
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> ecdsa <span style=color:#f92672>import</span> SECP256k1
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> ecdsa.ecdsa <span style=color:#f92672>import</span> Public_key, Private_key
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> secret <span style=color:#f92672>import</span> FLAG
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>E <span style=color:#f92672>=</span> SECP256k1
</span></span><span style=display:flex><span>G, n <span style=color:#f92672>=</span> E<span style=color:#f92672>.</span>generator, E<span style=color:#f92672>.</span>order
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> bytes_to_long( os<span style=color:#f92672>.</span>urandom(<span style=color:#ae81ff>32</span> <span style=color:#f92672>-</span> len(FLAG)) <span style=color:#f92672>+</span> FLAG )
</span></span><span style=display:flex><span>pubkey <span style=color:#f92672>=</span> Public_key(G, d<span style=color:#f92672>*</span>G)
</span></span><span style=display:flex><span>prikey <span style=color:#f92672>=</span> Private_key(pubkey, d)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>magic1 <span style=color:#f92672>=</span> md5(d<span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>32</span>, <span style=color:#e6db74>&#34;big&#34;</span>))<span style=color:#f92672>.</span>digest()
</span></span><span style=display:flex><span>magic2 <span style=color:#f92672>=</span> md5(d<span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>32</span>, <span style=color:#e6db74>&#34;big&#34;</span>)[::<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])<span style=color:#f92672>.</span>digest()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>h1 <span style=color:#f92672>=</span> sha256(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;https://www.youtube.com/watch?v=IBnrn2pnPG8&#34;</span>)<span style=color:#f92672>.</span>digest()
</span></span><span style=display:flex><span>h2 <span style=color:#f92672>=</span> sha256(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;https://www.youtube.com/watch?v=1H2cyhWYXrE&#34;</span>)<span style=color:#f92672>.</span>digest()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>k1 <span style=color:#f92672>=</span> bytes_to_long(magic1 <span style=color:#f92672>+</span> magic2)
</span></span><span style=display:flex><span>k2 <span style=color:#f92672>=</span> bytes_to_long(magic2 <span style=color:#f92672>+</span> magic1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sig1 <span style=color:#f92672>=</span> prikey<span style=color:#f92672>.</span>sign(bytes_to_long(h1), k1)
</span></span><span style=display:flex><span>sig2 <span style=color:#f92672>=</span> prikey<span style=color:#f92672>.</span>sign(bytes_to_long(h2), k2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;P = (</span><span style=color:#e6db74>{</span>pubkey<span style=color:#f92672>.</span>point<span style=color:#f92672>.</span>x()<span style=color:#e6db74>}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>{</span>pubkey<span style=color:#f92672>.</span>point<span style=color:#f92672>.</span>y()<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#39;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;sig1 = (</span><span style=color:#e6db74>{</span>sig1<span style=color:#f92672>.</span>r<span style=color:#e6db74>}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>{</span>sig1<span style=color:#f92672>.</span>s<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#39;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;sig2 = (</span><span style=color:#e6db74>{</span>sig2<span style=color:#f92672>.</span>r<span style=color:#e6db74>}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>{</span>sig2<span style=color:#f92672>.</span>s<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># P = (70427896289635684269185763735464004880272487387417064603929487585697794861713, 83106938517126976838986116917338443942453391221542116900720022828358221631968)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sig1 = (26150478759659181410183574739595997895638116875172347795980556499925372918857, 50639168022751577246163934860133616960953696675993100806612269138066992704236)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sig2 = (8256687378196792904669428303872036025324883507048772044875872623403155644190, 90323515158120328162524865800363952831516312527470472160064097576156608261906)</span>
</span></span></code></pre></div><p>:::</p><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>仔細看source code會發現他和上課講的例子很不一樣，上課講的方式是考慮已知$k1$, $k2$的長度是符合用lattice找的情況，用LLL找到$k1, k2$再回推d，但這一題一開始遇到最大的困難在於
$$
k_1=2^{128} magic_1+magic_2\
k_2=2^{128} magic_2+magic_1
$$
很明顯$k_1, k_2$的bit_length都已經超過用Lattice找的範圍($K&lt;n^{1\over 2}$，所以如果換個想法呢?我們不找$k_1, k_2$，我們改找$magic_1, magic_2$，之後再回推$k_1, k_2$再回推$d$是不是和原本的目的一樣，設想:</p><p>$k_1 + tk_2 + u \equiv 0\ (mod\ n)$
$\to magic_1<em>2^{128} + magic_2 + t(magic_2</em>2^{128} + magic_1) + u \equiv 0 (mod\ n)$
$\to (t+2^{128})magic_1 + (1 + t<em>2^{128})<em>magic_2+u\equiv 0 (mod\ n)$
$\to magic_1+(1 + t</em>2^{128})(t+2^{128})^{-1}magic_2+(t+2^{128})^{-1}u\equiv 0 (mod\ n)$
此時新的$t,u$
$$
new_t=(1 + t</em>2^{128})(t+2^{128})^{-1}\
new_u=(t+2^{128})^{-1}u
$$</p><hr><p>接著就是我一直困惑的地方，也是非常需要感謝Yaan的地方，LLL算出來是三個basi，然後做線性組合才會是投影片上的$vec=(-k1, k2, K)$(或是有一定的倍數)，並不是一開就會是那個vector</p><h2 id=exploit---lattice>Exploit - Lattice
<a class=anchor href=#exploit---lattice>#</a></h2><ol><li><p>建立已知的訊息</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>E <span style=color:#f92672>=</span> SECP256k1
</span></span><span style=display:flex><span>G, n <span style=color:#f92672>=</span> E<span style=color:#f92672>.</span>generator, E<span style=color:#f92672>.</span>order
</span></span><span style=display:flex><span>P <span style=color:#f92672>=</span> (<span style=color:#ae81ff>70427896289635684269185763735464004880272487387417064603929487585697794861713</span>, <span style=color:#ae81ff>83106938517126976838986116917338443942453391221542116900720022828358221631968</span>)
</span></span><span style=display:flex><span>sig1 <span style=color:#f92672>=</span> (<span style=color:#ae81ff>26150478759659181410183574739595997895638116875172347795980556499925372918857</span>, <span style=color:#ae81ff>50639168022751577246163934860133616960953696675993100806612269138066992704236</span>)
</span></span><span style=display:flex><span>sig2 <span style=color:#f92672>=</span> (<span style=color:#ae81ff>8256687378196792904669428303872036025324883507048772044875872623403155644190</span>, <span style=color:#ae81ff>90323515158120328162524865800363952831516312527470472160064097576156608261906</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>h1 <span style=color:#f92672>=</span> bytes_to_long(sha256(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;https://www.youtube.com/watch?v=IBnrn2pnPG8&#34;</span>)<span style=color:#f92672>.</span>digest())
</span></span><span style=display:flex><span>h2 <span style=color:#f92672>=</span> bytes_to_long(sha256(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;https://www.youtube.com/watch?v=1H2cyhWYXrE&#34;</span>)<span style=color:#f92672>.</span>digest())
</span></span></code></pre></div></li><li><p>實作一下原本的公式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>r1, s1 <span style=color:#f92672>=</span> sig1
</span></span><span style=display:flex><span>r2, s2 <span style=color:#f92672>=</span> sig2
</span></span><span style=display:flex><span>s1_inv <span style=color:#f92672>=</span> inverse(s1, n)
</span></span><span style=display:flex><span>s2_inv <span style=color:#f92672>=</span> inverse(s2, n)
</span></span><span style=display:flex><span>r1_inv <span style=color:#f92672>=</span> inverse(r1, n)
</span></span><span style=display:flex><span>r2_inv <span style=color:#f92672>=</span> inverse(r2, n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>t <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>s1_inv <span style=color:#f92672>*</span> s2 <span style=color:#f92672>*</span> r1 <span style=color:#f92672>*</span> r2_inv
</span></span><span style=display:flex><span>u <span style=color:#f92672>=</span> s1_inv <span style=color:#f92672>*</span> r1 <span style=color:#f92672>*</span> h2 <span style=color:#f92672>*</span> r2_inv <span style=color:#f92672>-</span> s1_inv <span style=color:#f92672>*</span> h1
</span></span><span style=display:flex><span>b_matrix_K <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>128</span>
</span></span><span style=display:flex><span>dommy <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>128</span>
</span></span></code></pre></div></li><li><p>建立B matrix</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>new_t <span style=color:#f92672>=</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> dommy <span style=color:#f92672>*</span> t) <span style=color:#f92672>*</span> inverse((dommy <span style=color:#f92672>+</span> t), n)
</span></span><span style=display:flex><span>new_u <span style=color:#f92672>=</span> u <span style=color:#f92672>*</span> inverse((dommy <span style=color:#f92672>+</span> t), n)
</span></span><span style=display:flex><span>b_matrix <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    [int(n<span style=color:#f92672>.</span>digits()), <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [new_t, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [new_u, <span style=color:#ae81ff>0</span>, b_matrix_K]
</span></span><span style=display:flex><span>]
</span></span></code></pre></div></li><li><p>解LLL找最小的vector</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>LLL_reduced_basis <span style=color:#f92672>=</span> matrix(b_matrix)<span style=color:#f92672>.</span>LLL()
</span></span><span style=display:flex><span>basis0 <span style=color:#f92672>=</span> LLL_reduced_basis[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>basis1 <span style=color:#f92672>=</span> LLL_reduced_basis[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>basis2 <span style=color:#f92672>=</span> LLL_reduced_basis[<span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>print(basis0, basis1, basis2)
</span></span></code></pre></div></li><li><p>有了$magic_1, magic_2$之後就可以爆搜找$d$，並還原出原本的flag $\to$ 非常感謝Yaan提供script給我參考，最主要是這邊有障礙，首先可以先看一下找到的LLL長怎樣</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>-221227854189652752387006500971265535677, 154796202886613489929017650654193194295, 0<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>-78316557126501995251733139438552596659, 1809028261633383948620558940699892506, 340282366920938463463374607431768211456<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>-190260135239507154352414451870270937822, -390278805794181212650296278313898033211, 0<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>會發現只有basis1的後面是跟著K，代表線性組合的係數$j$不能為零，因為這樣就會讓我們想要的vector(-m1, m2, K)的最後那個K不是K而是零，而且後面在算factor的inverse時也會出現錯誤，所以詳細的推倒會變成:
$$
\begin{aligned}
vector&=i<em>basis_0+j</em>basis_1+k<em>basis_2\
=&(i</em>basis_0[x]+j<em>basis_1[x]+k</em>basis_2[x]\
&,i<em>basis_0[y]+j</em>basis_1[y]+k<em>basis_2[y]\
&,i</em>basis_0[z]+j<em>basis_1[z]+k</em>basis_2[z])\
&= (-j<em>m1, j</em>m2, j<em>K)
\end{aligned}
$$
可以看一下為甚麼會變成這樣，原因是從LLL找到的basis，第一個和第三個basis，他們的最後一個dimension都是零，代表vector的最後一個dimension$\to i</em>basis_0[z]+j<em>basis_1[z]+k</em>basis_2[z] = j*basis_1[z]$，所以當我們找到正確的i, j, k時，要記得把$j$取inverse除掉，才會是正確的$maic_1, magic_2$</p><p>有了$magic_1, magic_2$之後，就是找$k_1$和$d$，最後我們就可以拿到flag了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>verify</span>(d):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;FLAG&#34;</span> <span style=color:#f92672>in</span> long_to_bytes(d)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> k <span style=color:#f92672>in</span> range(<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> j:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            vec <span style=color:#f92672>=</span> i<span style=color:#f92672>*</span>basis0 <span style=color:#f92672>+</span> j<span style=color:#f92672>*</span>basis1 <span style=color:#f92672>+</span> k<span style=color:#f92672>*</span>basis2
</span></span><span style=display:flex><span>            factor_inv <span style=color:#f92672>=</span> pow(j,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,n)
</span></span><span style=display:flex><span>            m1 <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>(factor_inv<span style=color:#f92672>*</span>vec[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>            m2 <span style=color:#f92672>=</span> factor_inv<span style=color:#f92672>*</span>vec[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            k1 <span style=color:#f92672>=</span> m1<span style=color:#f92672>*</span>(<span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>128</span>)<span style=color:#f92672>+</span>m2
</span></span><span style=display:flex><span>            d <span style=color:#f92672>=</span> ((s1<span style=color:#f92672>*</span>k1<span style=color:#f92672>-</span>h1)<span style=color:#f92672>*</span>r1_inv)<span style=color:#f92672>%</span>n
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> verify(d):
</span></span><span style=display:flex><span>                print(long_to_bytes(d))
</span></span><span style=display:flex><span>                check_flag <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> check_flag:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> check_flag:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span></code></pre></div></li></ol><p>:::spoiler 完整的script</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> hashlib <span style=color:#f92672>import</span> sha256, md5
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> ecdsa <span style=color:#f92672>import</span> SECP256k1
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> secret <span style=color:#f92672>import</span> FLAG
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>E <span style=color:#f92672>=</span> SECP256k1
</span></span><span style=display:flex><span>G, n <span style=color:#f92672>=</span> E<span style=color:#f92672>.</span>generator, E<span style=color:#f92672>.</span>order
</span></span><span style=display:flex><span>P <span style=color:#f92672>=</span> (<span style=color:#ae81ff>70427896289635684269185763735464004880272487387417064603929487585697794861713</span>, <span style=color:#ae81ff>83106938517126976838986116917338443942453391221542116900720022828358221631968</span>)
</span></span><span style=display:flex><span>sig1 <span style=color:#f92672>=</span> (<span style=color:#ae81ff>26150478759659181410183574739595997895638116875172347795980556499925372918857</span>, <span style=color:#ae81ff>50639168022751577246163934860133616960953696675993100806612269138066992704236</span>)
</span></span><span style=display:flex><span>sig2 <span style=color:#f92672>=</span> (<span style=color:#ae81ff>8256687378196792904669428303872036025324883507048772044875872623403155644190</span>, <span style=color:#ae81ff>90323515158120328162524865800363952831516312527470472160064097576156608261906</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>h1 <span style=color:#f92672>=</span> bytes_to_long(sha256(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;https://www.youtube.com/watch?v=IBnrn2pnPG8&#34;</span>)<span style=color:#f92672>.</span>digest())
</span></span><span style=display:flex><span>h2 <span style=color:#f92672>=</span> bytes_to_long(sha256(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;https://www.youtube.com/watch?v=1H2cyhWYXrE&#34;</span>)<span style=color:#f92672>.</span>digest())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r1, s1 <span style=color:#f92672>=</span> sig1
</span></span><span style=display:flex><span>r2, s2 <span style=color:#f92672>=</span> sig2
</span></span><span style=display:flex><span>s1_inv <span style=color:#f92672>=</span> inverse(s1, n)
</span></span><span style=display:flex><span>s2_inv <span style=color:#f92672>=</span> inverse(s2, n)
</span></span><span style=display:flex><span>r1_inv <span style=color:#f92672>=</span> inverse(r1, n)
</span></span><span style=display:flex><span>r2_inv <span style=color:#f92672>=</span> inverse(r2, n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>t <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>s1_inv <span style=color:#f92672>*</span> s2 <span style=color:#f92672>*</span> r1 <span style=color:#f92672>*</span> r2_inv
</span></span><span style=display:flex><span>u <span style=color:#f92672>=</span> s1_inv <span style=color:#f92672>*</span> r1 <span style=color:#f92672>*</span> h2 <span style=color:#f92672>*</span> r2_inv <span style=color:#f92672>-</span> s1_inv <span style=color:#f92672>*</span> h1
</span></span><span style=display:flex><span>b_matrix_K <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>128</span>
</span></span><span style=display:flex><span>dommy <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>128</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>new_t <span style=color:#f92672>=</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> dommy <span style=color:#f92672>*</span> t) <span style=color:#f92672>*</span> inverse((dommy <span style=color:#f92672>+</span> t), n)
</span></span><span style=display:flex><span>new_u <span style=color:#f92672>=</span> u <span style=color:#f92672>*</span> inverse((dommy <span style=color:#f92672>+</span> t), n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>b_matrix <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    [int(n<span style=color:#f92672>.</span>digits()), <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [new_t, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [new_u, <span style=color:#ae81ff>0</span>, b_matrix_K]
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LLL_reduced_basis <span style=color:#f92672>=</span> matrix(b_matrix)<span style=color:#f92672>.</span>LLL()
</span></span><span style=display:flex><span>basis0 <span style=color:#f92672>=</span> LLL_reduced_basis[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>basis1 <span style=color:#f92672>=</span> LLL_reduced_basis[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>basis2 <span style=color:#f92672>=</span> LLL_reduced_basis[<span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>print(basis0, basis1, basis2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>verify</span>(d):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;FLAG&#34;</span> <span style=color:#f92672>in</span> long_to_bytes(d)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> k <span style=color:#f92672>in</span> range(<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> j:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            vec <span style=color:#f92672>=</span> i<span style=color:#f92672>*</span>basis0 <span style=color:#f92672>+</span> j<span style=color:#f92672>*</span>basis1 <span style=color:#f92672>+</span> k<span style=color:#f92672>*</span>basis2
</span></span><span style=display:flex><span>            factor_inv <span style=color:#f92672>=</span> pow(j,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,n)
</span></span><span style=display:flex><span>            m1 <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>(factor_inv<span style=color:#f92672>*</span>vec[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>            m2 <span style=color:#f92672>=</span> factor_inv<span style=color:#f92672>*</span>vec[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            k1 <span style=color:#f92672>=</span> m1<span style=color:#f92672>*</span>(<span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>128</span>)<span style=color:#f92672>+</span>m2
</span></span><span style=display:flex><span>            d <span style=color:#f92672>=</span> ((s1<span style=color:#f92672>*</span>k1<span style=color:#f92672>-</span>h1)<span style=color:#f92672>*</span>r1_inv)<span style=color:#f92672>%</span>n
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> verify(d):
</span></span><span style=display:flex><span>                print(long_to_bytes(d))
</span></span><span style=display:flex><span>                check_flag <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> check_flag:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> check_flag:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># (-221227854189652752387006500971265535677, 154796202886613489929017650654193194295, 0) (-78316557126501995251733139438552596659, 1809028261633383948620558940699892506, 340282366920938463463374607431768211456) (-190260135239507154352414451870270937822, -390278805794181212650296278313898033211, 0)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># b&#39;\xad\xc4u\xcf\x11\x1f\xd7R$FLAG{LLLisreaLLyusefuL}&#39;        </span>
</span></span></code></pre></div><p>:::</p><p>Flag: <code>FLAG{LLLisreaLLyusefuL}</code></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit---lattice>Exploit - Lattice</a></li></ul></nav></div></aside></main></body></html>