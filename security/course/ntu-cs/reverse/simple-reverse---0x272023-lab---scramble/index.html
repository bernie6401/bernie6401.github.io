<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Simple Reverse - 0x27(2023 Lab - Scramble)
  #


  Source code
  #

:::spoiler scramble.py
import random


def generate_scramble_pattern(pattern_length, max_shift, max_add_sub):
    scramble_pattern = []
    for _ in range(random.randint(1, pattern_length)):
        operation = random.randint(0, 3)
        
        if operation == 0:
            sub_value = random.randint(1, max_add_sub)
        elif operation == 1:
            add_value = random.randint(1, max_add_sub)
            scramble_pattern.append(('add', add_value))
        elif operation == 2:
            sub_value = random.randint(1, max_add_sub)
            scramble_pattern.append(('sub', sub_value))
        elif operation == 3:
            shift_value = random.randint(1, max_shift)
            scramble_pattern.append(('lsh', shift_value))
    
    return scramble_pattern

def apply_scramble_pattern(input_bytes, patterns):
    result = []
    for i, operations in enumerate(patterns):
        src = input_bytes[i]
        for operation in operations:
            if operation is None:
                continue
            elif operation[0] == 'add':
                src += operation[1]
            elif operation[0] == 'sub':
                src -= operation[1]
            elif operation[0] == 'lsh':
                src <<= operation[1]
            src &= 0xffffffff

        result.append(src)
    
    return result


k_FLAG = b'FLAG{REDACTED}' 
patterns = [generate_scramble_pattern(6, max_shift=10, max_add_sub=0xffff) for i in range(len(k_FLAG)) ]
scrambled_result = apply_scramble_pattern(k_FLAG, patterns)

print(&#34;Input Bytes:&#34;, k_FLAG, len(k_FLAG))
# REDACTED, 42
print(&#34;Scramble Pattern:&#34;, patterns)
# [[('sub', 20935)], [('sub', 31575), ('lsh', 9), ('add', 45363), ('add', 35372), ('sub', 15465)], [('add', 19123), ('add', 35260), ('sub', 49421), ('lsh', 8)], [('lsh', 1), ('sub', 4977), ('sub', 55837)], [('add', 16937)], [('sub', 56984), ('lsh', 2), ('sub', 32363), ('sub', 46293)], [('sub', 94), ('sub', 48860), ('sub', 18342), ('lsh', 3)], [('add', 37549), ('sub', 36283), ('lsh', 6), ('add', 6253)], [('add', 34661), ('sub', 13281), ('sub', 64107)], [('sub', 8525), ('sub', 30349), ('sub', 26744)], [('lsh', 2), ('sub', 18120), ('sub', 63091), ('add', 17287), ('sub', 37618), ('add', 2237)], [('sub', 48573), ('sub', 4449), ('add', 36013), ('sub', 64051)], [('add', 10415), ('lsh', 3), ('lsh', 10)], [('add', 5676), ('lsh', 3), ('lsh', 10), ('add', 32002), ('sub', 60775)], [('add', 35939), ('sub', 32666), ('sub', 45639), ('add', 2077), ('sub', 16253)], [('sub', 30392), ('sub', 26913), ('sub', 14009), ('sub', 62416)], [('sub', 15056), ('sub', 40527)], [('lsh', 5)], [('lsh', 1), ('sub', 16070)], [('add', 2045)], [('lsh', 8), ('add', 37087), ('sub', 22013), ('lsh', 10), ('lsh', 2)], [('add', 31880), ('sub', 56557), ('lsh', 6), ('lsh', 5), ('lsh', 8), ('add', 15535)], [('add', 22937), ('add', 4060)], [('add', 8462), ('sub', 4463), ('sub', 45810), ('lsh', 1)], [('sub', 10144), ('lsh', 8), ('lsh', 5), ('lsh', 1), ('lsh', 8)], [('add', 49937), ('lsh', 2), ('add', 60982), ('sub', 24799)], [('lsh', 4), ('add', 53340), ('add', 50619), ('sub', 56111), ('add', 6134), ('lsh', 1)], [('sub', 22577), ('sub', 50645)], [('add', 21265), ('sub', 41440)], [('add', 63314), ('sub', 45755), ('add', 62216)], [('sub', 52616)], [('add', 21192)], [('add', 62573), ('sub',18811)], [('add', 35452), ('sub', 11573), ('sub', 49079), ('sub', 36361), ('sub', 26862), ('lsh', 9)], [('add', 13610), ('lsh', 7), ('lsh', 3), ('sub', 28490), ('lsh', 10), ('add', 44742)], [('lsh', 10), ('sub', 1797), ('sub', 10564), ('add', 12394)], [('add', 45165), ('lsh', 10), ('sub', 60610), ('sub', 63002), ('sub', 14851), ('lsh', 1)], [('add', 34840), ('lsh', 3), ('sub', 16907)], [('add', 4404), ('lsh', 3), ('lsh', 7), ('lsh', 6)], [('lsh', 6), ('add', 51738), ('sub', 24621), ('add', 58646)], [('lsh', 1)], [('add', 29375), ('sub', 419), ('add', 2854), ('sub', 11878), ('lsh', 10), ('add', 40151)], [('add', 22953)]]
print(&#34;Scrambled Result:&#34;, scrambled_result)
# [4294946431, 4278905078, 1286912, 4294906624, 17060, 4294661164, 4294429720, 94573, 4294924666, 4294901787, 4294868383, 4294886344, 86147072, 47247259, 4294910851, 4294833676, 4294911813, 3040, 4294951460, 2160, 171843584, 4734127, 27100, 4294883864, 884998144, 236375, 111420, 4294894192, 4294947222, 79889, 4294914775, 21308, 43873, 4249743360, 1477674694, 113697, 92442178, 262757, 295239680, 91843, 210, 20569303, 23078]
:::
:::spoiler output.txt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntu-cs/reverse/simple-reverse---0x272023-lab---scramble/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Simple Reverse - 0x27(2023 Lab - Scramble)"><meta property="og:description" content="Simple Reverse - 0x27(2023 Lab - Scramble) # Source code # :::spoiler scramble.py
import random def generate_scramble_pattern(pattern_length, max_shift, max_add_sub): scramble_pattern = [] for _ in range(random.randint(1, pattern_length)): operation = random.randint(0, 3) if operation == 0: sub_value = random.randint(1, max_add_sub) elif operation == 1: add_value = random.randint(1, max_add_sub) scramble_pattern.append(('add', add_value)) elif operation == 2: sub_value = random.randint(1, max_add_sub) scramble_pattern.append(('sub', sub_value)) elif operation == 3: shift_value = random.randint(1, max_shift) scramble_pattern.append(('lsh', shift_value)) return scramble_pattern def apply_scramble_pattern(input_bytes, patterns): result = [] for i, operations in enumerate(patterns): src = input_bytes[i] for operation in operations: if operation is None: continue elif operation[0] == 'add': src += operation[1] elif operation[0] == 'sub': src -= operation[1] elif operation[0] == 'lsh': src <<= operation[1] src &= 0xffffffff result.append(src) return result k_FLAG = b'FLAG{REDACTED}' patterns = [generate_scramble_pattern(6, max_shift=10, max_add_sub=0xffff) for i in range(len(k_FLAG)) ] scrambled_result = apply_scramble_pattern(k_FLAG, patterns) print(&#34;Input Bytes:&#34;, k_FLAG, len(k_FLAG)) # REDACTED, 42 print(&#34;Scramble Pattern:&#34;, patterns) # [[('sub', 20935)], [('sub', 31575), ('lsh', 9), ('add', 45363), ('add', 35372), ('sub', 15465)], [('add', 19123), ('add', 35260), ('sub', 49421), ('lsh', 8)], [('lsh', 1), ('sub', 4977), ('sub', 55837)], [('add', 16937)], [('sub', 56984), ('lsh', 2), ('sub', 32363), ('sub', 46293)], [('sub', 94), ('sub', 48860), ('sub', 18342), ('lsh', 3)], [('add', 37549), ('sub', 36283), ('lsh', 6), ('add', 6253)], [('add', 34661), ('sub', 13281), ('sub', 64107)], [('sub', 8525), ('sub', 30349), ('sub', 26744)], [('lsh', 2), ('sub', 18120), ('sub', 63091), ('add', 17287), ('sub', 37618), ('add', 2237)], [('sub', 48573), ('sub', 4449), ('add', 36013), ('sub', 64051)], [('add', 10415), ('lsh', 3), ('lsh', 10)], [('add', 5676), ('lsh', 3), ('lsh', 10), ('add', 32002), ('sub', 60775)], [('add', 35939), ('sub', 32666), ('sub', 45639), ('add', 2077), ('sub', 16253)], [('sub', 30392), ('sub', 26913), ('sub', 14009), ('sub', 62416)], [('sub', 15056), ('sub', 40527)], [('lsh', 5)], [('lsh', 1), ('sub', 16070)], [('add', 2045)], [('lsh', 8), ('add', 37087), ('sub', 22013), ('lsh', 10), ('lsh', 2)], [('add', 31880), ('sub', 56557), ('lsh', 6), ('lsh', 5), ('lsh', 8), ('add', 15535)], [('add', 22937), ('add', 4060)], [('add', 8462), ('sub', 4463), ('sub', 45810), ('lsh', 1)], [('sub', 10144), ('lsh', 8), ('lsh', 5), ('lsh', 1), ('lsh', 8)], [('add', 49937), ('lsh', 2), ('add', 60982), ('sub', 24799)], [('lsh', 4), ('add', 53340), ('add', 50619), ('sub', 56111), ('add', 6134), ('lsh', 1)], [('sub', 22577), ('sub', 50645)], [('add', 21265), ('sub', 41440)], [('add', 63314), ('sub', 45755), ('add', 62216)], [('sub', 52616)], [('add', 21192)], [('add', 62573), ('sub',18811)], [('add', 35452), ('sub', 11573), ('sub', 49079), ('sub', 36361), ('sub', 26862), ('lsh', 9)], [('add', 13610), ('lsh', 7), ('lsh', 3), ('sub', 28490), ('lsh', 10), ('add', 44742)], [('lsh', 10), ('sub', 1797), ('sub', 10564), ('add', 12394)], [('add', 45165), ('lsh', 10), ('sub', 60610), ('sub', 63002), ('sub', 14851), ('lsh', 1)], [('add', 34840), ('lsh', 3), ('sub', 16907)], [('add', 4404), ('lsh', 3), ('lsh', 7), ('lsh', 6)], [('lsh', 6), ('add', 51738), ('sub', 24621), ('add', 58646)], [('lsh', 1)], [('add', 29375), ('sub', 419), ('add', 2854), ('sub', 11878), ('lsh', 10), ('add', 40151)], [('add', 22953)]] print(&#34;Scrambled Result:&#34;, scrambled_result) # [4294946431, 4278905078, 1286912, 4294906624, 17060, 4294661164, 4294429720, 94573, 4294924666, 4294901787, 4294868383, 4294886344, 86147072, 47247259, 4294910851, 4294833676, 4294911813, 3040, 4294951460, 2160, 171843584, 4734127, 27100, 4294883864, 884998144, 236375, 111420, 4294894192, 4294947222, 79889, 4294914775, 21308, 43873, 4249743360, 1477674694, 113697, 92442178, 262757, 295239680, 91843, 210, 20569303, 23078] ::: :::spoiler output.txt"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="Eductf"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Reverse"><title>Simple Reverse - 0x27(2023 Lab - Scramble) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntu-cs/reverse/simple-reverse---0x272023-lab---scramble/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Simple Reverse - 0x27(2023 Lab - Scramble)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=simple-reverse---0x272023-lab---scramble>Simple Reverse - 0x27(2023 Lab - Scramble)
<a class=anchor href=#simple-reverse---0x272023-lab---scramble>#</a></h1><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler scramble.py</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> random
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_scramble_pattern</span>(pattern_length, max_shift, max_add_sub):
</span></span><span style=display:flex><span>    scramble_pattern <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(random<span style=color:#f92672>.</span>randint(<span style=color:#ae81ff>1</span>, pattern_length)):
</span></span><span style=display:flex><span>        operation <span style=color:#f92672>=</span> random<span style=color:#f92672>.</span>randint(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> operation <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            sub_value <span style=color:#f92672>=</span> random<span style=color:#f92672>.</span>randint(<span style=color:#ae81ff>1</span>, max_add_sub)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> operation <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>            add_value <span style=color:#f92672>=</span> random<span style=color:#f92672>.</span>randint(<span style=color:#ae81ff>1</span>, max_add_sub)
</span></span><span style=display:flex><span>            scramble_pattern<span style=color:#f92672>.</span>append((<span style=color:#e6db74>&#39;add&#39;</span>, add_value))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> operation <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>:
</span></span><span style=display:flex><span>            sub_value <span style=color:#f92672>=</span> random<span style=color:#f92672>.</span>randint(<span style=color:#ae81ff>1</span>, max_add_sub)
</span></span><span style=display:flex><span>            scramble_pattern<span style=color:#f92672>.</span>append((<span style=color:#e6db74>&#39;sub&#39;</span>, sub_value))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> operation <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>            shift_value <span style=color:#f92672>=</span> random<span style=color:#f92672>.</span>randint(<span style=color:#ae81ff>1</span>, max_shift)
</span></span><span style=display:flex><span>            scramble_pattern<span style=color:#f92672>.</span>append((<span style=color:#e6db74>&#39;lsh&#39;</span>, shift_value))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> scramble_pattern
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>apply_scramble_pattern</span>(input_bytes, patterns):
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i, operations <span style=color:#f92672>in</span> enumerate(patterns):
</span></span><span style=display:flex><span>        src <span style=color:#f92672>=</span> input_bytes[i]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> operation <span style=color:#f92672>in</span> operations:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> operation <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> operation[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;add&#39;</span>:
</span></span><span style=display:flex><span>                src <span style=color:#f92672>+=</span> operation[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> operation[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;sub&#39;</span>:
</span></span><span style=display:flex><span>                src <span style=color:#f92672>-=</span> operation[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> operation[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;lsh&#39;</span>:
</span></span><span style=display:flex><span>                src <span style=color:#f92672>&lt;&lt;=</span> operation[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            src <span style=color:#f92672>&amp;=</span> <span style=color:#ae81ff>0xffffffff</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        result<span style=color:#f92672>.</span>append(src)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>k_FLAG <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;FLAG</span><span style=color:#e6db74>{REDACTED}</span><span style=color:#e6db74>&#39;</span> 
</span></span><span style=display:flex><span>patterns <span style=color:#f92672>=</span> [generate_scramble_pattern(<span style=color:#ae81ff>6</span>, max_shift<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>, max_add_sub<span style=color:#f92672>=</span><span style=color:#ae81ff>0xffff</span>) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(k_FLAG)) ]
</span></span><span style=display:flex><span>scrambled_result <span style=color:#f92672>=</span> apply_scramble_pattern(k_FLAG, patterns)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Input Bytes:&#34;</span>, k_FLAG, len(k_FLAG))
</span></span><span style=display:flex><span><span style=color:#75715e># REDACTED, 42</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Scramble Pattern:&#34;</span>, patterns)
</span></span><span style=display:flex><span><span style=color:#75715e># [[(&#39;sub&#39;, 20935)], [(&#39;sub&#39;, 31575), (&#39;lsh&#39;, 9), (&#39;add&#39;, 45363), (&#39;add&#39;, 35372), (&#39;sub&#39;, 15465)], [(&#39;add&#39;, 19123), (&#39;add&#39;, 35260), (&#39;sub&#39;, 49421), (&#39;lsh&#39;, 8)], [(&#39;lsh&#39;, 1), (&#39;sub&#39;, 4977), (&#39;sub&#39;, 55837)], [(&#39;add&#39;, 16937)], [(&#39;sub&#39;, 56984), (&#39;lsh&#39;, 2), (&#39;sub&#39;, 32363), (&#39;sub&#39;, 46293)], [(&#39;sub&#39;, 94), (&#39;sub&#39;, 48860), (&#39;sub&#39;, 18342), (&#39;lsh&#39;, 3)], [(&#39;add&#39;, 37549), (&#39;sub&#39;, 36283), (&#39;lsh&#39;, 6), (&#39;add&#39;, 6253)], [(&#39;add&#39;, 34661), (&#39;sub&#39;, 13281), (&#39;sub&#39;, 64107)], [(&#39;sub&#39;, 8525), (&#39;sub&#39;, 30349), (&#39;sub&#39;, 26744)], [(&#39;lsh&#39;, 2), (&#39;sub&#39;, 18120), (&#39;sub&#39;, 63091), (&#39;add&#39;, 17287), (&#39;sub&#39;, 37618), (&#39;add&#39;, 2237)], [(&#39;sub&#39;, 48573), (&#39;sub&#39;, 4449), (&#39;add&#39;, 36013), (&#39;sub&#39;, 64051)], [(&#39;add&#39;, 10415), (&#39;lsh&#39;, 3), (&#39;lsh&#39;, 10)], [(&#39;add&#39;, 5676), (&#39;lsh&#39;, 3), (&#39;lsh&#39;, 10), (&#39;add&#39;, 32002), (&#39;sub&#39;, 60775)], [(&#39;add&#39;, 35939), (&#39;sub&#39;, 32666), (&#39;sub&#39;, 45639), (&#39;add&#39;, 2077), (&#39;sub&#39;, 16253)], [(&#39;sub&#39;, 30392), (&#39;sub&#39;, 26913), (&#39;sub&#39;, 14009), (&#39;sub&#39;, 62416)], [(&#39;sub&#39;, 15056), (&#39;sub&#39;, 40527)], [(&#39;lsh&#39;, 5)], [(&#39;lsh&#39;, 1), (&#39;sub&#39;, 16070)], [(&#39;add&#39;, 2045)], [(&#39;lsh&#39;, 8), (&#39;add&#39;, 37087), (&#39;sub&#39;, 22013), (&#39;lsh&#39;, 10), (&#39;lsh&#39;, 2)], [(&#39;add&#39;, 31880), (&#39;sub&#39;, 56557), (&#39;lsh&#39;, 6), (&#39;lsh&#39;, 5), (&#39;lsh&#39;, 8), (&#39;add&#39;, 15535)], [(&#39;add&#39;, 22937), (&#39;add&#39;, 4060)], [(&#39;add&#39;, 8462), (&#39;sub&#39;, 4463), (&#39;sub&#39;, 45810), (&#39;lsh&#39;, 1)], [(&#39;sub&#39;, 10144), (&#39;lsh&#39;, 8), (&#39;lsh&#39;, 5), (&#39;lsh&#39;, 1), (&#39;lsh&#39;, 8)], [(&#39;add&#39;, 49937), (&#39;lsh&#39;, 2), (&#39;add&#39;, 60982), (&#39;sub&#39;, 24799)], [(&#39;lsh&#39;, 4), (&#39;add&#39;, 53340), (&#39;add&#39;, 50619), (&#39;sub&#39;, 56111), (&#39;add&#39;, 6134), (&#39;lsh&#39;, 1)], [(&#39;sub&#39;, 22577), (&#39;sub&#39;, 50645)], [(&#39;add&#39;, 21265), (&#39;sub&#39;, 41440)], [(&#39;add&#39;, 63314), (&#39;sub&#39;, 45755), (&#39;add&#39;, 62216)], [(&#39;sub&#39;, 52616)], [(&#39;add&#39;, 21192)], [(&#39;add&#39;, 62573), (&#39;sub&#39;,18811)], [(&#39;add&#39;, 35452), (&#39;sub&#39;, 11573), (&#39;sub&#39;, 49079), (&#39;sub&#39;, 36361), (&#39;sub&#39;, 26862), (&#39;lsh&#39;, 9)], [(&#39;add&#39;, 13610), (&#39;lsh&#39;, 7), (&#39;lsh&#39;, 3), (&#39;sub&#39;, 28490), (&#39;lsh&#39;, 10), (&#39;add&#39;, 44742)], [(&#39;lsh&#39;, 10), (&#39;sub&#39;, 1797), (&#39;sub&#39;, 10564), (&#39;add&#39;, 12394)], [(&#39;add&#39;, 45165), (&#39;lsh&#39;, 10), (&#39;sub&#39;, 60610), (&#39;sub&#39;, 63002), (&#39;sub&#39;, 14851), (&#39;lsh&#39;, 1)], [(&#39;add&#39;, 34840), (&#39;lsh&#39;, 3), (&#39;sub&#39;, 16907)], [(&#39;add&#39;, 4404), (&#39;lsh&#39;, 3), (&#39;lsh&#39;, 7), (&#39;lsh&#39;, 6)], [(&#39;lsh&#39;, 6), (&#39;add&#39;, 51738), (&#39;sub&#39;, 24621), (&#39;add&#39;, 58646)], [(&#39;lsh&#39;, 1)], [(&#39;add&#39;, 29375), (&#39;sub&#39;, 419), (&#39;add&#39;, 2854), (&#39;sub&#39;, 11878), (&#39;lsh&#39;, 10), (&#39;add&#39;, 40151)], [(&#39;add&#39;, 22953)]]</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Scrambled Result:&#34;</span>, scrambled_result)
</span></span><span style=display:flex><span><span style=color:#75715e># [4294946431, 4278905078, 1286912, 4294906624, 17060, 4294661164, 4294429720, 94573, 4294924666, 4294901787, 4294868383, 4294886344, 86147072, 47247259, 4294910851, 4294833676, 4294911813, 3040, 4294951460, 2160, 171843584, 4734127, 27100, 4294883864, 884998144, 236375, 111420, 4294894192, 4294947222, 79889, 4294914775, 21308, 43873, 4249743360, 1477674694, 113697, 92442178, 262757, 295239680, 91843, 210, 20569303, 23078]</span>
</span></span></code></pre></div><p>:::
:::spoiler output.txt</p><pre tabindex=0><code>[[(&#39;sub&#39;, 20935)], [(&#39;sub&#39;, 31575), (&#39;lsh&#39;, 9), (&#39;add&#39;, 45363), (&#39;add&#39;, 35372), (&#39;sub&#39;, 15465)], [(&#39;add&#39;, 19123), (&#39;add&#39;, 35260), (&#39;sub&#39;, 49421), (&#39;lsh&#39;, 8)], [(&#39;lsh&#39;, 1), (&#39;sub&#39;, 4977), (&#39;sub&#39;, 55837)], [(&#39;add&#39;, 16937)], [(&#39;sub&#39;, 56984), (&#39;lsh&#39;, 2), (&#39;sub&#39;, 32363), (&#39;sub&#39;, 46293)], [(&#39;sub&#39;, 94), (&#39;sub&#39;, 48860), (&#39;sub&#39;, 18342), (&#39;lsh&#39;, 3)], [(&#39;add&#39;, 37549), (&#39;sub&#39;, 36283), (&#39;lsh&#39;, 6), (&#39;add&#39;, 6253)], [(&#39;add&#39;, 34661), (&#39;sub&#39;, 13281), (&#39;sub&#39;, 64107)], [(&#39;sub&#39;, 8525), (&#39;sub&#39;, 30349), (&#39;sub&#39;, 26744)], [(&#39;lsh&#39;, 2), (&#39;sub&#39;, 18120), (&#39;sub&#39;, 63091), (&#39;add&#39;, 17287), (&#39;sub&#39;, 37618), (&#39;add&#39;, 2237)], [(&#39;sub&#39;, 48573), (&#39;sub&#39;, 4449), (&#39;add&#39;, 36013), (&#39;sub&#39;, 64051)], [(&#39;add&#39;, 10415), (&#39;lsh&#39;, 3), (&#39;lsh&#39;, 10)], [(&#39;add&#39;, 5676), (&#39;lsh&#39;, 3), (&#39;lsh&#39;, 10), (&#39;add&#39;, 32002), (&#39;sub&#39;, 60775)], [(&#39;add&#39;, 35939), (&#39;sub&#39;, 32666), (&#39;sub&#39;, 45639), (&#39;add&#39;, 2077), (&#39;sub&#39;, 16253)], [(&#39;sub&#39;, 30392), (&#39;sub&#39;, 26913), (&#39;sub&#39;, 14009), (&#39;sub&#39;, 62416)], [(&#39;sub&#39;, 15056), (&#39;sub&#39;, 40527)], [(&#39;lsh&#39;, 5)], [(&#39;lsh&#39;, 1), (&#39;sub&#39;, 16070)], [(&#39;add&#39;, 2045)], [(&#39;lsh&#39;, 8), (&#39;add&#39;, 37087), (&#39;sub&#39;, 22013), (&#39;lsh&#39;, 10), (&#39;lsh&#39;, 2)], [(&#39;add&#39;, 31880), (&#39;sub&#39;, 56557), (&#39;lsh&#39;, 6), (&#39;lsh&#39;, 5), (&#39;lsh&#39;, 8), (&#39;add&#39;, 15535)], [(&#39;add&#39;, 22937), (&#39;add&#39;, 4060)], [(&#39;add&#39;, 8462), (&#39;sub&#39;, 4463), (&#39;sub&#39;, 45810), (&#39;lsh&#39;, 1)], [(&#39;sub&#39;, 10144), (&#39;lsh&#39;, 8), (&#39;lsh&#39;, 5), (&#39;lsh&#39;, 1), (&#39;lsh&#39;, 8)], [(&#39;add&#39;, 49937), (&#39;lsh&#39;, 2), (&#39;add&#39;, 60982), (&#39;sub&#39;, 24799)], [(&#39;lsh&#39;, 4), (&#39;add&#39;, 53340), (&#39;add&#39;, 50619), (&#39;sub&#39;, 56111), (&#39;add&#39;, 6134), (&#39;lsh&#39;, 1)], [(&#39;sub&#39;, 22577), (&#39;sub&#39;, 50645)], [(&#39;add&#39;, 21265), (&#39;sub&#39;, 41440)], [(&#39;add&#39;, 63314), (&#39;sub&#39;, 45755), (&#39;add&#39;, 62216)], [(&#39;sub&#39;, 52616)], [(&#39;add&#39;, 21192)], [(&#39;add&#39;, 62573), (&#39;sub&#39;,18811)], [(&#39;add&#39;, 35452), (&#39;sub&#39;, 11573), (&#39;sub&#39;, 49079), (&#39;sub&#39;, 36361), (&#39;sub&#39;, 26862), (&#39;lsh&#39;, 9)], [(&#39;add&#39;, 13610), (&#39;lsh&#39;, 7), (&#39;lsh&#39;, 3), (&#39;sub&#39;, 28490), (&#39;lsh&#39;, 10), (&#39;add&#39;, 44742)], [(&#39;lsh&#39;, 10), (&#39;sub&#39;, 1797), (&#39;sub&#39;, 10564), (&#39;add&#39;, 12394)], [(&#39;add&#39;, 45165), (&#39;lsh&#39;, 10), (&#39;sub&#39;, 60610), (&#39;sub&#39;, 63002), (&#39;sub&#39;, 14851), (&#39;lsh&#39;, 1)], [(&#39;add&#39;, 34840), (&#39;lsh&#39;, 3), (&#39;sub&#39;, 16907)], [(&#39;add&#39;, 4404), (&#39;lsh&#39;, 3), (&#39;lsh&#39;, 7), (&#39;lsh&#39;, 6)], [(&#39;lsh&#39;, 6), (&#39;add&#39;, 51738), (&#39;sub&#39;, 24621), (&#39;add&#39;, 58646)], [(&#39;lsh&#39;, 1)], [(&#39;add&#39;, 29375), (&#39;sub&#39;, 419), (&#39;add&#39;, 2854), (&#39;sub&#39;, 11878), (&#39;lsh&#39;, 10), (&#39;add&#39;, 40151)], [(&#39;add&#39;, 22953)]]
[4294946431, 4278905078, 1286912, 4294906624, 17060, 4294661164, 4294429720, 94573, 4294924666, 4294901787, 4294868383, 4294886344, 86147072, 47247259, 4294910851, 4294833676, 4294911813, 3040, 4294951460, 2160, 171843584, 4734127, 27100, 4294883864, 884998144, 236375, 111420, 4294894192, 4294947222, 79889, 4294914775, 21308, 43873, 4249743360, 1477674694, 113697, 92442178, 262757, 295239680, 91843, 210, 20569303, 23078]
</code></pre><p>:::</p><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>這一題先看source code會發現他做了一連串的scramble動作，包含加減和移位，而次數也不一定，他主要是針對flag中的每一個字元都做1~6次不等的操作，可能是加也可能是減甚至是移位，不過題目也有給我們這些pattern所以應該是可以直接透過這些pattern進行還原，但我們可以用z3下一大堆constraint就可以不用那麼麻煩了</p><p>z3的大致步驟:</p><ol><li>建立一個solver</li><li>建立符號 - 以此lab來說就是建立43個符號對應每一個flag字元</li><li>加上constraint - 以此lab來說每一個flag字元都應該限制在空白到0x7f之間，另外還要加上每一個符號(就是flag字元)，經過我們已知的scramble pattern之後應該要是最後的target</li><li>判斷有無解，如果有的話就把每一個符號的值取出來</li></ol><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> z3 <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>patters <span style=color:#f92672>=</span> [[(<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>20935</span>)], [(<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>31575</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>9</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>45363</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>35372</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>15465</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>19123</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>35260</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>49421</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>8</span>)], [(<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>1</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>4977</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>55837</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>16937</span>)], [(<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>56984</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>2</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>32363</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>46293</span>)], [(<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>94</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>48860</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>18342</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>3</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>37549</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>36283</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>6</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>6253</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>34661</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>13281</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>64107</span>)], [(<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>8525</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>30349</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>26744</span>)], [(<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>2</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>18120</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>63091</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>17287</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>37618</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>2237</span>)], [(<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>48573</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>4449</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>36013</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>64051</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>10415</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>3</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>10</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>5676</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>3</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>10</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>32002</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>60775</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>35939</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>32666</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>45639</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>2077</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>16253</span>)], [(<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>30392</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>26913</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>14009</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>62416</span>)], [(<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>15056</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>40527</span>)], [(<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>5</span>)], [(<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>1</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>16070</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>2045</span>)], [(<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>8</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>37087</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>22013</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>10</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>2</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>31880</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>56557</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>6</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>5</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>8</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>15535</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>22937</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>4060</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>8462</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>4463</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>45810</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>1</span>)], [(<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>10144</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>8</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>5</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>1</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>8</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>49937</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>2</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>60982</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>24799</span>)], [(<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>4</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>53340</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>50619</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>56111</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>6134</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>1</span>)], [(<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>22577</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>50645</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>21265</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>41440</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>63314</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>45755</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>62216</span>)], [(<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>52616</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>21192</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>62573</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>,<span style=color:#ae81ff>18811</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>35452</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>11573</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>49079</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>36361</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>26862</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>9</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>13610</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>7</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>3</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>28490</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>10</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>44742</span>)], [(<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>10</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>1797</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>10564</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>12394</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>45165</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>10</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>60610</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>63002</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>14851</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>1</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>34840</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>3</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>16907</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>4404</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>3</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>7</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>6</span>)], [(<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>6</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>51738</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>24621</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>58646</span>)], [(<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>1</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>29375</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>419</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>2854</span>), (<span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#ae81ff>11878</span>), (<span style=color:#e6db74>&#39;lsh&#39;</span>, <span style=color:#ae81ff>10</span>), (<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>40151</span>)], [(<span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#ae81ff>22953</span>)]]
</span></span><span style=display:flex><span>targets <span style=color:#f92672>=</span> [<span style=color:#ae81ff>4294946431</span>, <span style=color:#ae81ff>4278905078</span>, <span style=color:#ae81ff>1286912</span>, <span style=color:#ae81ff>4294906624</span>, <span style=color:#ae81ff>17060</span>, <span style=color:#ae81ff>4294661164</span>, <span style=color:#ae81ff>4294429720</span>, <span style=color:#ae81ff>94573</span>, <span style=color:#ae81ff>4294924666</span>, <span style=color:#ae81ff>4294901787</span>, <span style=color:#ae81ff>4294868383</span>, <span style=color:#ae81ff>4294886344</span>, <span style=color:#ae81ff>86147072</span>, <span style=color:#ae81ff>47247259</span>, <span style=color:#ae81ff>4294910851</span>, <span style=color:#ae81ff>4294833676</span>, <span style=color:#ae81ff>4294911813</span>, <span style=color:#ae81ff>3040</span>, <span style=color:#ae81ff>4294951460</span>, <span style=color:#ae81ff>2160</span>, <span style=color:#ae81ff>171843584</span>, <span style=color:#ae81ff>4734127</span>, <span style=color:#ae81ff>27100</span>, <span style=color:#ae81ff>4294883864</span>, <span style=color:#ae81ff>884998144</span>, <span style=color:#ae81ff>236375</span>, <span style=color:#ae81ff>111420</span>, <span style=color:#ae81ff>4294894192</span>, <span style=color:#ae81ff>4294947222</span>, <span style=color:#ae81ff>79889</span>, <span style=color:#ae81ff>4294914775</span>, <span style=color:#ae81ff>21308</span>, <span style=color:#ae81ff>43873</span>, <span style=color:#ae81ff>4249743360</span>, <span style=color:#ae81ff>1477674694</span>, <span style=color:#ae81ff>113697</span>, <span style=color:#ae81ff>92442178</span>, <span style=color:#ae81ff>262757</span>, <span style=color:#ae81ff>295239680</span>, <span style=color:#ae81ff>91843</span>, <span style=color:#ae81ff>210</span>, <span style=color:#ae81ff>20569303</span>, <span style=color:#ae81ff>23078</span>]
</span></span><span style=display:flex><span>flag_len <span style=color:#f92672>=</span> <span style=color:#ae81ff>43</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 起手式 - 開一個Solver</span>
</span></span><span style=display:flex><span>s <span style=color:#f92672>=</span> Solver()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 建立符號 - 以此lab來說就是建立43個符號對應每一個flag字元</span>
</span></span><span style=display:flex><span>bvs <span style=color:#f92672>=</span> [BitVec(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;bt_</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>, <span style=color:#ae81ff>32</span>) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(flag_len)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 加上constraint - 以此lab來說每一個flag字元都應該限制在空白到0x7f之間</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> bv <span style=color:#f92672>in</span> bvs:
</span></span><span style=display:flex><span>    s<span style=color:#f92672>.</span>add(And(bv <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0x20</span>, bv <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0x7f</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i, patter <span style=color:#f92672>in</span> enumerate(patters):
</span></span><span style=display:flex><span>    formula <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;bvs[</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>]&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> step <span style=color:#f92672>in</span> patter:
</span></span><span style=display:flex><span>        op <span style=color:#f92672>=</span> step[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        value <span style=color:#f92672>=</span> step[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> op <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;add&#39;</span>:
</span></span><span style=display:flex><span>            formula <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;(</span><span style=color:#e6db74>{</span>formula<span style=color:#e6db74>}</span><span style=color:#e6db74> + </span><span style=color:#e6db74>{</span>value<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> op <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;sub&#39;</span>:
</span></span><span style=display:flex><span>            formula <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;(</span><span style=color:#e6db74>{</span>formula<span style=color:#e6db74>}</span><span style=color:#e6db74> - </span><span style=color:#e6db74>{</span>value<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> op <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;lsh&#39;</span>:
</span></span><span style=display:flex><span>            formula <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;(</span><span style=color:#e6db74>{</span>formula<span style=color:#e6db74>}</span><span style=color:#e6db74> &lt;&lt; </span><span style=color:#e6db74>{</span>value<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>formula<span style=color:#e6db74>}</span><span style=color:#e6db74> == </span><span style=color:#e6db74>{</span>targets[i]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>    s<span style=color:#f92672>.</span>add(eval(formula) <span style=color:#f92672>==</span> targets[i])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 如果有解的話就會做以下操作</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> s<span style=color:#f92672>.</span>check() <span style=color:#f92672>==</span> sat:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#39;Find ~~~&#39;</span>)
</span></span><span style=display:flex><span>    print(s<span style=color:#f92672>.</span>model())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> bv <span style=color:#f92672>in</span> bvs:
</span></span><span style=display:flex><span>        flag <span style=color:#f92672>+=</span> chr(s<span style=color:#f92672>.</span>model()[bv]<span style=color:#f92672>.</span>as_long())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(flag)
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></nav></div></aside></main></body></html>