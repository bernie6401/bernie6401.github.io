<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Simple Buffer Overflow - 0x02
  #


  tags: CTF PWN
  #


  Why we&rsquo;d like to create shellcode?
  #

In pwn problem, most of the program don&rsquo;t have the secret function that we can take the shell. Thus, we can create a shellcode by ourselves and use bof to overlap the original address by shellcode address. Then we can take the shell.

  How to create a shellcode in BOF?
  #

In lecture 0x01, we can see sub-function that create a shell using command:"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntu-cs/pwn/simple-buffer-overflow---0x02/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Simple Buffer Overflow - 0x02"><meta property="og:description" content="Simple Buffer Overflow - 0x02 # tags: CTF PWN # Why we’d like to create shellcode? # In pwn problem, most of the program don’t have the secret function that we can take the shell. Thus, we can create a shellcode by ourselves and use bof to overlap the original address by shellcode address. Then we can take the shell.
How to create a shellcode in BOF? # In lecture 0x01, we can see sub-function that create a shell using command:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="CTF"><meta property="article:tag" content="PWN"><meta property="article:tag" content="NTUSTISC"><title>Simple Buffer Overflow - 0x02 | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntu-cs/pwn/simple-buffer-overflow---0x02/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Simple Buffer Overflow - 0x02</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#why-wed-like-to-create-shellcode>Why we&rsquo;d like to create shellcode?</a></li><li><a href=#how-to-create-a-shellcode-in-bof>How to create a shellcode in BOF?</a><ul><li><a href=#implement>Implement</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=simple-buffer-overflow---0x02>Simple Buffer Overflow - 0x02
<a class=anchor href=#simple-buffer-overflow---0x02>#</a></h1><h6 id=tags-ctf-pwn>tags: <code>CTF</code> <code>PWN</code>
<a class=anchor href=#tags-ctf-pwn>#</a></h6><h2 id=why-wed-like-to-create-shellcode>Why we&rsquo;d like to create shellcode?
<a class=anchor href=#why-wed-like-to-create-shellcode>#</a></h2><p>In pwn problem, most of the program don&rsquo;t have the secret function that we can take the shell. Thus, we can create a shellcode by ourselves and use <code>bof</code> to overlap the original address by shellcode address. Then we can take the shell.</p><h2 id=how-to-create-a-shellcode-in-bof>How to create a shellcode in BOF?
<a class=anchor href=#how-to-create-a-shellcode-in-bof>#</a></h2><p>In lecture <a href=https://hackmd.io/@UHzVfhAITliOM3mFSo6mfA/HJm5x_Ocs>0x01</a>, we can see sub-function that create a shell using command:</p><pre tabindex=0><code class=language-bash! data-lang=bash!>execve(&#34;/bin/sh&#34;, (char *[]){0}, (char *[]){0});
</code></pre><p>According to <a href=https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/>Linux System Call Table for x86 64</a>, we can see that <font color=FF0000><code>execve</code></font> is a system call and the parameter sequence is as the same as <a href=https://en.wikipedia.org/wiki/X86_calling_conventions>normal calling convention</a>.</p><ul><li>Note that in <code>x86-64</code> →<blockquote><p>The kernel interface uses <code>RDI</code>, <code>RSI</code>, <code>RDX</code>, <code>R10</code>, <code>R8</code> and <code>R9</code>. In C++, this is the first parameter.</p></blockquote></li></ul><table><thead><tr><th style=text-align:center>%rax</th><th style=text-align:center>System Call</th><th style=text-align:center>%rdi</th><th style=text-align:center>%rsi</th><th style=text-align:center>%rdx</th><th style=text-align:center>%r10</th><th style=text-align:center>%r8</th><th style=text-align:center>%r9</th></tr></thead><tbody><tr><td style=text-align:center>59(0x3B)</td><td style=text-align:center>sys_execve</td><td style=text-align:center>const char *filename</td><td style=text-align:center>const char *const argv[]</td><td style=text-align:center>const char *const envp[]</td><td style=text-align:center></td><td style=text-align:center></td><td></td></tr></tbody></table><p>Therefore, <code>%rdi</code> store address of <code>/bin/sh</code> and <code>%rsi</code>, <code>%rdx</code> can temporarily set <code>0</code></p><h3 id=implement>Implement
<a class=anchor href=#implement>#</a></h3><pre tabindex=0><code class=language-assembly! data-lang=assembly!>mov    rbx, 0x68732f6e69622f
push   rbx
mov    rdi, rsp
xor    rsi, rsi
xor    rdx, rdx
mov    rax, 0x3b
syscall
</code></pre><ul><li>We can use <a href=https://string-functions.com/hex-string.aspx>hex2text tool</a> to parse .<code>0x68732f6e69622f</code> and we obtain <code>?hs/nib/</code></li><li>First 3 line, we push <code>/bin/sh</code> to stack and <code>%rsp</code> is the top of the stack address, so we <code>%rdi</code> will obtain <code>/bin/sh</code> address from <code>%rsp</code></li><li>Then, let <code>%rsi</code> and <code>%rdx</code> be <code>0</code></li><li>To set <code>%rax</code> to right system call number, that is <code>0x3b</code></li><li>Finally, we did it!!!</li></ul><p><img src=https://imgur.com/EtW8yZu.png alt></p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><p><a href=https://youtu.be/PBgHHWtjtFA>NTUSTISC - Pwn Basic 2 [2019.03.19]</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#why-wed-like-to-create-shellcode>Why we&rsquo;d like to create shellcode?</a></li><li><a href=#how-to-create-a-shellcode-in-bof>How to create a shellcode in BOF?</a><ul><li><a href=#implement>Implement</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>