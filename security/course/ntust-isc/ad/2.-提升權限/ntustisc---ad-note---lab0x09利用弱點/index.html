<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  NTUSTISC - AD Note - Lab(利用弱點)
  #

[TOC]
Lecture Video: 2022/05/04 AD 安全1

  Background
  #


Internet Information Services(IIS)

IIS是縮寫，全稱Internet Information Services ( IIS,互聯網信息服務 ),是由微軟公司提供的基於運行Microsoft Windows的互聯網基本服務。
IIS是指World Wide Web server服務，IIS是一種Web（網頁）服務組件，專業的說，IIS可以賦予一部主機電腦一組以上的IP地址，而且還可以有一個以上的域名作為Web網站。做過服務器配置的都應該知道IIS。制作好了網站怎麽才能讓別人瀏覽，就是通過網站服務器來實現的。IIS只是網站服務器的一種而已。

  簡單來說：
  #

Internet Information Service（IIS）是windows開設web網頁服務的組件，用來搭載網站運行程序的平台的。還能提供FTP，SMTP等服務。
在UNIX或Linux平台上，Apache就是網站服務器。
而對於Windows NT/2000來說，IIS就是標準的網站服務器。
IIS是一種服務，是Windows 2000 Server系列的一個組件。不同於一般的應用程序，它就像驅動程序一樣是操作系統的一部分，具有在系統啟動時被同時啟動的服務功能。
如果想知道如何在win10啟用IIS或是建置網站server，可以看這個影片1

一般權限(就像前面的lab那樣)

取得網域使用者資訊
Scan Port
Check Group Policy Object


高權限好處

Dump Password or Hash
Turn off Defender
Check the other users&rsquo; info


本地特出使用者

==NT Authority\System==(本地端真正的最高權限使用者)
NT Authority\Network Service
NT Authority\Local Service
NT Authority\IUSR


提權方法

利用弱點(通常是直接用Windows CVE直接打看看)，可參考2
Hijack Token
Guess Password
就像前面環境觀察中提到的一樣，可以從Active Directory Users and Computers的description中看看有沒有密碼的提示，或是查看$ net user變更密碼的時間是哪時候，然後考慮爆破

Local Admin比Domain Admin好拿
通常是固定密碼

所有主機都相同
可能很多人知道
弱密碼
系統初始化包


Solution: 可以參考本機系統管理員密碼解決方案(LAPS)


管理服務
錯誤配置




  Lab Time - 本地提權
  #


  ==利用弱點==
  #

$ git clone https://github.com/bitsadmin/wesng.git --depth 1
$ cd wesng
$ python wes.py --update
$ systeminfo.exe > systeminfo.txt # 這條指令是windows內建的指令，所以一定要在cmd中操作
$ python wes.py systeminfo.txt
:::spoiler Result"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntust-isc/ad/2.-%E6%8F%90%E5%8D%87%E6%AC%8A%E9%99%90/ntustisc---ad-note---lab0x09%E5%88%A9%E7%94%A8%E5%BC%B1%E9%BB%9E/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="NTUSTISC - AD Note - Lab(利用弱點)"><meta property="og:description" content="NTUSTISC - AD Note - Lab(利用弱點) # [TOC]
Lecture Video: 2022/05/04 AD 安全1
Background # Internet Information Services(IIS) IIS是縮寫，全稱Internet Information Services ( IIS,互聯網信息服務 ),是由微軟公司提供的基於運行Microsoft Windows的互聯網基本服務。
IIS是指World Wide Web server服務，IIS是一種Web（網頁）服務組件，專業的說，IIS可以賦予一部主機電腦一組以上的IP地址，而且還可以有一個以上的域名作為Web網站。做過服務器配置的都應該知道IIS。制作好了網站怎麽才能讓別人瀏覽，就是通過網站服務器來實現的。IIS只是網站服務器的一種而已。
簡單來說： # Internet Information Service（IIS）是windows開設web網頁服務的組件，用來搭載網站運行程序的平台的。還能提供FTP，SMTP等服務。
在UNIX或Linux平台上，Apache就是網站服務器。
而對於Windows NT/2000來說，IIS就是標準的網站服務器。
IIS是一種服務，是Windows 2000 Server系列的一個組件。不同於一般的應用程序，它就像驅動程序一樣是操作系統的一部分，具有在系統啟動時被同時啟動的服務功能。 如果想知道如何在win10啟用IIS或是建置網站server，可以看這個影片1
一般權限(就像前面的lab那樣) 取得網域使用者資訊 Scan Port Check Group Policy Object 高權限好處 Dump Password or Hash Turn off Defender Check the other users’ info 本地特出使用者 ==NT Authority\System==(本地端真正的最高權限使用者) NT Authority\Network Service NT Authority\Local Service NT Authority\IUSR 提權方法 利用弱點(通常是直接用Windows CVE直接打看看)，可參考2 Hijack Token Guess Password 就像前面環境觀察中提到的一樣，可以從Active Directory Users and Computers的description中看看有沒有密碼的提示，或是查看$ net user變更密碼的時間是哪時候，然後考慮爆破 Local Admin比Domain Admin好拿 通常是固定密碼 所有主機都相同 可能很多人知道 弱密碼 系統初始化包 Solution: 可以參考本機系統管理員密碼解決方案(LAPS) 管理服務 錯誤配置 Lab Time - 本地提權 # ==利用弱點== # $ git clone https://github.com/bitsadmin/wesng.git --depth 1 $ cd wesng $ python wes.py --update $ systeminfo.exe > systeminfo.txt # 這條指令是windows內建的指令，所以一定要在cmd中操作 $ python wes.py systeminfo.txt :::spoiler Result"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="Information Security"><meta property="article:tag" content="NTUSTISC"><meta property="article:tag" content="AD"><title>NTUSTISC - AD Note - Lab(利用弱點) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntust-isc/ad/2.-%E6%8F%90%E5%8D%87%E6%AC%8A%E9%99%90/ntustisc---ad-note---lab0x09%E5%88%A9%E7%94%A8%E5%BC%B1%E9%BB%9E/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>NTUSTISC - AD Note - Lab(利用弱點)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#background>Background</a><ul><li><a href=#簡單來說>簡單來說：</a></li></ul></li><li><a href=#lab-time---本地提權>Lab Time - 本地提權</a><ul><li><a href=#利用弱點>==利用弱點==</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=ntustisc---ad-note---lab利用弱點>NTUSTISC - AD Note - Lab(利用弱點)
<a class=anchor href=#ntustisc---ad-note---lab%e5%88%a9%e7%94%a8%e5%bc%b1%e9%bb%9e>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/Cv2gNQkDM8Q?si=M0LV3dBCMCOy58LN&amp;t=3600">2022/05/04 AD 安全1</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><ul><li><a href=https://zhuanlan.zhihu.com/p/145430397>Internet Information Services(IIS)</a><blockquote><p>IIS是縮寫，全稱Internet Information Services ( IIS,互聯網信息服務 ),是由微軟公司提供的基於運行Microsoft Windows的互聯網基本服務。</p><p>IIS是指World Wide Web server服務，IIS是一種Web（網頁）服務組件，專業的說，IIS可以賦予一部主機電腦一組以上的IP地址，而且還可以有一個以上的域名作為Web網站。做過服務器配置的都應該知道IIS。制作好了網站怎麽才能讓別人瀏覽，就是通過網站服務器來實現的。IIS只是網站服務器的一種而已。</p><h3 id=簡單來說>簡單來說：
<a class=anchor href=#%e7%b0%a1%e5%96%ae%e4%be%86%e8%aa%aa>#</a></h3><p>Internet Information Service（IIS）是windows開設web網頁服務的組件，用來搭載網站運行程序的平台的。還能提供FTP，SMTP等服務。</p><p><font color=ff0000>在UNIX或Linux平台上，Apache就是網站服務器。</p><p>而對於Windows NT/2000來說，IIS就是標準的網站服務器。</font></p><p>IIS是一種服務，是Windows 2000 Server系列的一個組件。不同於一般的應用程序，它就像驅動程序一樣是操作系統的一部分，具有在系統啟動時被同時啟動的服務功能。
如果想知道如何在win10啟用IIS或是建置網站server，可以看這個影片<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p></blockquote></li><li>一般權限(就像前面的lab那樣)<ul><li>取得網域使用者資訊</li><li>Scan Port</li><li>Check Group Policy Object</li></ul></li><li>高權限好處<ul><li>Dump Password or Hash</li><li>Turn off Defender</li><li>Check the other users&rsquo; info</li></ul></li><li>本地特出使用者<ul><li>==NT Authority\System==(本地端真正的最高權限使用者)</li><li>NT Authority\Network Service</li><li>NT Authority\Local Service</li><li>NT Authority\IUSR</li></ul></li><li>提權方法<ul><li>利用弱點(通常是直接用Windows CVE直接打看看)，可參考<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></li><li>Hijack Token</li><li>Guess Password
就像前面環境觀察中提到的一樣，可以從<code>Active Directory Users and Computers</code>的description中看看有沒有密碼的提示，或是查看<code>$ net user</code>變更密碼的時間是哪時候，然後考慮爆破<ul><li>Local Admin比Domain Admin好拿</li><li>通常是固定密碼<ul><li>所有主機都相同</li><li>可能很多人知道</li><li>弱密碼</li><li>系統初始化包</li></ul></li><li>Solution: 可以參考<a href=https://learn.microsoft.com/zh-tw/windows-server/identity/laps/laps-overview>本機系統管理員密碼解決方案(LAPS)</a></li></ul></li><li>管理服務</li><li>錯誤配置</li></ul></li></ul><h2 id=lab-time---本地提權>Lab Time - 本地提權
<a class=anchor href=#lab-time---%e6%9c%ac%e5%9c%b0%e6%8f%90%e6%ac%8a>#</a></h2><h3 id=利用弱點>==利用弱點==
<a class=anchor href=#%e5%88%a9%e7%94%a8%e5%bc%b1%e9%bb%9e>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ git clone https://github.com/bitsadmin/wesng.git --depth <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>$ cd wesng
</span></span><span style=display:flex><span>$ python wes.py --update
</span></span><span style=display:flex><span>$ systeminfo.exe &gt; systeminfo.txt <span style=color:#75715e># 這條指令是windows內建的指令，所以一定要在cmd中操作</span>
</span></span><span style=display:flex><span>$ python wes.py systeminfo.txt
</span></span></code></pre></div><p>:::spoiler Result</p><pre tabindex=0><code>python wes.py systeminfo.txt
Windows Exploit Suggester 1.03 ( https://github.com/bitsadmin/wesng/ )
[+] Parsing systeminfo output
[+] Operating System
    - Name: Windows 11 for x64-based Systems
    - Generation: 11
    - Build: 5
    - Version: None
    - Architecture: x64-based
    - Installed hotfixes (3): KB5028948, KB5029263, KB5028756
[+] Loading definitions
    - Creation date of definitions: 20230901
[+] Determining missing patches
[!] Found vulnerabilities!

Date: 20211214
CVE: CVE-2019-0887
KB: KB5008215
Title: Remote Desktop Services?Remote Code Execution Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Remote Code Execution
Exploit: n/a

Date: 20211214
CVE: CVE-2020-0655
KB: KB5008215
Title: Remote Desktop Services?Remote Code Execution Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Remote Code Execution
Exploit: n/a

Date: 20211216
CVE: CVE-2021-43216
KB: KB5008215
Title: Microsoft Local Security Authority (LSA) Server Information Disclosure Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Information Disclosure
Exploit: n/a

Date: 20211215
CVE: CVE-2021-43217
KB: KB5008215
Title: Windows Encrypting File System (EFS) Remote Code Execution Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Critical
Impact: Remote Code Execution
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43219
KB: KB5008215
Title: DirectX Graphics Kernel File Denial of Service Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Denial of Service
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43222
KB: KB5008215
Title: Microsoft Message Queuing Information Disclosure Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Information Disclosure
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43224
KB: KB5008215
Title: Windows Common Log File System Driver Information Disclosure Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Information Disclosure
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43226
KB: KB5008215
Title: Windows Common Log File System Driver Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43227
KB: KB5008215
Title: Storage Spaces Controller Information Disclosure Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Information Disclosure
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43228
KB: KB5008215
Title: SymCrypt Denial of Service Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Denial of Service
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43229
KB: KB5008215
Title: Windows NTFS Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43230
KB: KB5008215
Title: Windows NTFS Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43231
KB: KB5008215
Title: Windows NTFS Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43232
KB: KB5008215
Title: Windows Event Tracing Remote Code Execution Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Remote Code Execution
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43233
KB: KB5008215
Title: Remote Desktop Client Remote Code Execution Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Critical
Impact: Remote Code Execution
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43234
KB: KB5008215
Title: Windows Fax Service Remote Code Execution Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Remote Code Execution
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43235
KB: KB5008215
Title: Storage Spaces Controller Information Disclosure Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Information Disclosure
Exploit: n/a

Date: 20211216
CVE: CVE-2021-43236
KB: KB5008215
Title: Microsoft Message Queuing Information Disclosure Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Information Disclosure
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43237
KB: KB5008215
Title: Windows Setup Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43238
KB: KB5008215
Title: Windows Remote Access Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43239
KB: KB5008215
Title: Windows Recovery Environment Agent Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43240
KB: KB5008215
Title: NTFS Set Short Name Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43246
KB: KB5008215
Title: Windows Hyper-V Denial of Service Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Denial of Service
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43247
KB: KB5008215
Title: Windows TCP/IP Driver Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211216
CVE: CVE-2021-43248
KB: KB5008215
Title: Windows Digital Media Receiver Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211214
CVE: CVE-2021-41333
KB: KB5008215
Title: Windows Print Spooler Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43207
KB: KB5008215
Title: Windows Common Log File System Driver Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211214
CVE: CVE-2021-43880
KB: KB5008215
Title: Windows Mobile Device Management Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211216
CVE: CVE-2021-43883
KB: KB5008215
Title: Windows Installer Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

Date: 20211216
CVE: CVE-2021-43893
KB: KB5008215
Title: Windows Encrypting File System (EFS) Elevation of Privilege Vulnerability
Affected product: Windows 11 for x64-based Systems
Affected component: Microsoft
Severity: Important
Impact: Elevation of Privilege
Exploit: n/a

[-] Missing patches: 1
    - KB5008215: patches 30 vulnerabilities
[I] KB with the most recent release date
    - ID: KB5008215
    - Release date: 20211216
[+] Done. Displaying 30 of the 30 vulnerabilities found.
</code></pre><p>:::</p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href="https://youtu.be/he6Ndmx3V5I?si=QzyDH441M2z7NwIk">【網站伺服器 IIS】Windows 10 IIS 安裝與啟用 ASP.NET 網站設定 </a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://ithelp.ithome.com.tw/articles/10281994>Day32 - Windows 提權(3)-Windows Exploit Suggester</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#background>Background</a><ul><li><a href=#簡單來說>簡單來說：</a></li></ul></li><li><a href=#lab-time---本地提權>Lab Time - 本地提權</a><ul><li><a href=#利用弱點>==利用弱點==</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>