<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  NTUSTISC - AD Note - Lab(錯誤配置)
  #

[TOC]
Lecture Video: 2022/05/04 AD 安全1

  Background
  #


提權方法

利用弱點
Hijack Token
Guess Password
管理服務
錯誤配置

服務使用高權限執行且檔案權限配置錯誤，所以只要把這項服務替換成惡意程式，最後再利用前面提到的print operator重開機，就可以達到控制的目的
透過accesschk.exe找出有問題的地方
$ accesschk.exe <user> <path>

For example
$ accesschk.exe "Administrator" "C:\Program Files\"

Accesschk v6.15 - Reports effective permissions for securable objects
Copyright (C) 2006-2022 Mark Russinovich
Sysinternals - www.sysinternals.com
RW C:\Program Files







  Lab Time - 本地提權
  #


  ==錯誤配置==
  #

找出low有存取權限的service檔案'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntust-isc/ad/2.-%E6%8F%90%E5%8D%87%E6%AC%8A%E9%99%90/ntustisc---ad-note---lab0x12%E9%8C%AF%E8%AA%A4%E9%85%8D%E7%BD%AE/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="NTUSTISC - AD Note - Lab(錯誤配置)"><meta property="og:description" content='NTUSTISC - AD Note - Lab(錯誤配置) # [TOC]
Lecture Video: 2022/05/04 AD 安全1
Background # 提權方法 利用弱點 Hijack Token Guess Password 管理服務 錯誤配置 服務使用高權限執行且檔案權限配置錯誤，所以只要把這項服務替換成惡意程式，最後再利用前面提到的print operator重開機，就可以達到控制的目的 透過accesschk.exe找出有問題的地方 $ accesschk.exe <user> <path> For example $ accesschk.exe "Administrator" "C:\Program Files\" Accesschk v6.15 - Reports effective permissions for securable objects Copyright (C) 2006-2022 Mark Russinovich Sysinternals - www.sysinternals.com RW C:\Program Files Lab Time - 本地提權 # ==錯誤配置== # 找出low有存取權限的service檔案'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="NTUSTISC"><meta property="article:tag" content="AD"><meta property="article:tag" content="Information Security"><title>NTUSTISC - AD Note - Lab(錯誤配置) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntust-isc/ad/2.-%E6%8F%90%E5%8D%87%E6%AC%8A%E9%99%90/ntustisc---ad-note---lab0x12%E9%8C%AF%E8%AA%A4%E9%85%8D%E7%BD%AE/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>NTUSTISC - AD Note - Lab(錯誤配置)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#lab-time---本地提權>Lab Time - 本地提權</a><ul><li><a href=#錯誤配置>==錯誤配置==</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=ntustisc---ad-note---lab錯誤配置>NTUSTISC - AD Note - Lab(錯誤配置)
<a class=anchor href=#ntustisc---ad-note---lab%e9%8c%af%e8%aa%a4%e9%85%8d%e7%bd%ae>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/Cv2gNQkDM8Q?si=M0LV3dBCMCOy58LN&amp;t=3600">2022/05/04 AD 安全1</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><ul><li>提權方法<ul><li>利用弱點</li><li>Hijack Token</li><li>Guess Password</li><li>管理服務</li><li>錯誤配置<ul><li>服務使用高權限執行且檔案權限配置錯誤，所以只要把這項服務替換成惡意程式，最後再利用前面提到的print operator重開機，就可以達到控制的目的</li><li>透過<a href=https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk>accesschk.exe</a>找出有問題的地方<pre tabindex=0><code class=language-bash! data-lang=bash!>$ accesschk.exe &lt;user&gt; &lt;path&gt;
</code></pre></li><li>For example<pre tabindex=0><code class=language-bash! data-lang=bash!>$ accesschk.exe &#34;Administrator&#34; &#34;C:\Program Files\&#34;

Accesschk v6.15 - Reports effective permissions for securable objects
Copyright (C) 2006-2022 Mark Russinovich
Sysinternals - www.sysinternals.com
RW C:\Program Files
</code></pre></li></ul></li></ul></li></ul><h2 id=lab-time---本地提權>Lab Time - 本地提權
<a class=anchor href=#lab-time---%e6%9c%ac%e5%9c%b0%e6%8f%90%e6%ac%8a>#</a></h2><h3 id=錯誤配置>==錯誤配置==
<a class=anchor href=#%e9%8c%af%e8%aa%a4%e9%85%8d%e7%bd%ae>#</a></h3><p>找出low有存取權限的service檔案</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ accesschk.exe &#34;low&#34; &#34;C:\tools&#34;

Accesschk v6.15 - Reports effective permissions for securable objects
Copyright (C) 2006-2022 Mark Russinovich
Sysinternals - www.sysinternals.com

RW C:\tools\AccessChk
RW C:\tools\accesschk.exe
RW C:\tools\AccessChk.zip
RW C:\tools\BloodHound-master
RW C:\tools\BloodHound-win32-x64
RW C:\tools\BloodHound-win32-x64-4.0.3.zip
RW C:\tools\BloodHound-win32-x64-4.1.0
RW C:\tools\BloodHound-win32-x64-4.1.0.zip
RW C:\tools\Certify.exe
RW C:\tools\DNSAdmin-DLL.dll
RW C:\tools\KDU-1.1.0
RW C:\tools\KmdManager.exe
RW C:\tools\mimikatz_trunk
RW C:\tools\neo4j-community-4.3.4
RW C:\tools\neo4j-community-4.3.4-windows.zip
RW C:\tools\nopad
RW C:\tools\openssl.zip
RW C:\tools\PrintSpoofer64.exe
RW C:\tools\Procdump
RW C:\tools\ProcessExplorer
RW C:\tools\PSTools
RW C:\tools\Rubeus.exe
RW C:\tools\Windows-Kernel-Explorer-master
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#lab-time---本地提權>Lab Time - 本地提權</a><ul><li><a href=#錯誤配置>==錯誤配置==</a></li></ul></li></ul></nav></div></aside></main></body></html>