<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  NTU Malware Reverse HW 1 write up
  #


  tags: NTU_MR Malware Reverse Engineering and Analysis NTU
  #

[TOC]

  Task 1
  #


  Analyze the Lab06-01.exe
  #



What is the major code construct found in the only subroutine called by main?
Ans: It has only an if statement in the main function.



What is the subroutine located at 0x40105F?
Ans: It’s just a printf function. At the beginning, I can not recognize this code block do exactly until I analyze the program behavior by using string side bar to search the specific string in the code."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntu-mr/ntu-malware-reverse-hw-1-write-up/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="NTU Malware Reverse HW 1 write up"><meta property="og:description" content="NTU Malware Reverse HW 1 write up # tags: NTU_MR Malware Reverse Engineering and Analysis NTU # [TOC]
Task 1 # Analyze the Lab06-01.exe # What is the major code construct found in the only subroutine called by main? Ans: It has only an if statement in the main function. What is the subroutine located at 0x40105F? Ans: It’s just a printf function. At the beginning, I can not recognize this code block do exactly until I analyze the program behavior by using string side bar to search the specific string in the code."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="NTU_MR"><meta property="article:tag" content="Malware Reverse Engineering and Analysis"><meta property="article:tag" content="NTU"><title>NTU Malware Reverse HW 1 write up | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntu-mr/ntu-malware-reverse-hw-1-write-up/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>NTU Malware Reverse HW 1 write up</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#task-1>Task 1</a><ul><li><a href=#analyze-the-lab06-01exe>Analyze the <code>Lab06-01.exe</code></a></li></ul></li><li><a href=#task-2>Task 2</a><ul><li><a href=#analyze-the-lab06-02exe>Analyze the <code>Lab06-02.exe</code></a></li></ul></li><li><a href=#task-3>Task 3</a><ul><li><a href=#analyze-the-lab06-03exe>Analyze the <code>Lab06-03.exe</code></a></li></ul></li><li><a href=#task-4>Task 4</a><ul><li><a href=#analyze-the-lab06-04exe>Analyze the <code>Lab06-04.exe</code></a></li></ul></li><li><a href=#task-5>Task 5</a><ul><li><a href=#please-analyze-easy_crackmeexe-use-ida-pro>Please analyze <code>Easy_CrackMe.exe.</code> (Use IDA PRO)</a></li></ul></li><li><a href=#task-6>Task 6</a><ul><li><a href=#please-analyze-easy_keygenexe-use-ida-pro>Please analyze <code>Easy_Keygen.exe.</code> (Use IDA PRO)</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=ntu-malware-reverse-hw-1-write-up>NTU Malware Reverse HW 1 write up
<a class=anchor href=#ntu-malware-reverse-hw-1-write-up>#</a></h1><h6 id=tags-ntu_mr-malware-reverse-engineering-and-analysis-ntu>tags: <code>NTU_MR</code> <code>Malware Reverse Engineering and Analysis</code> <code>NTU</code>
<a class=anchor href=#tags-ntu_mr-malware-reverse-engineering-and-analysis-ntu>#</a></h6><p>[TOC]</p><h2 id=task-1>Task 1
<a class=anchor href=#task-1>#</a></h2><h3 id=analyze-the-lab06-01exe>Analyze the <code>Lab06-01.exe</code>
<a class=anchor href=#analyze-the-lab06-01exe>#</a></h3><ul><li><p>What is the major code construct found in the only subroutine called by main?
Ans: It has only an if statement in the main function.
<img src=https://imgur.com/JZiz0BC.png alt></p></li><li><p>What is the subroutine located at 0x40105F?
Ans: It’s just a <code>printf</code> function. At the beginning, I can not recognize this code block do exactly until I analyze the program behavior by using string side bar to search the specific string in the code.</p></li><li><p>What is the purpose of this program?
Ans: This program’s main purpose is to check if the device connects the internet or not. If the variable returns true, it’ll print the string <code>Success: Internet Connection</code> on the command panel. Otherwise, it’ll show <code>Error 1.1: No Internet</code>.</p></li></ul><h2 id=task-2>Task 2
<a class=anchor href=#task-2>#</a></h2><h3 id=analyze-the-lab06-02exe>Analyze the <code>Lab06-02.exe</code>
<a class=anchor href=#analyze-the-lab06-02exe>#</a></h3><ul><li><p>What operation does the first subroutine called by the main perform?
Ans: The main perform is called subroutine to check if the internet connection or not. If there is no internet, just return and do nothing, otherwise, continue to execute.</p></li><li><p>What is the subroutine located at 0x40117F?
Ans: It’s a <code>printf</code> function.</p></li><li><p>What does the second subroutine called by main do?
Ans:</p><ul><li>The second subroutine called by the main function is sub_401040 which is located at 0x401040. The main purpose of this block is to open the internet connection and get the web page information then close the internet handle at the end.</li><li>According to the web page document, <code>InternetOpenA</code> function is the first <code>WinINet</code> function called by an application. It tells the Internet <code>DLL</code> to initialize internal data structures and prepare for future calls from the application. When the application finishes using the Internet functions, it should call <code>InternetCloseHandle</code> to free the handle and any associated resources. It’ll return a valid handle if true, otherwise, return null.</li><li>According to the web page document, this function is a general function that an application can use to retrieve data over any of the protocols that <code>WinINet</code> supports. This function is especially useful when the application does not need to access the particulars of a protocol, but only requires the data corresponding to a URL. For instance, the URL provided by the author exists as a global variable though this page has nothing response but a 404 error. It’ll return a valid handle if true, otherwise, return null.</li><li>According to the web page document, <code>InternetReadFile</code> function operates much like the base <code>ReadFile</code> function, with a few exceptions. Typically, <code>InternetReadFile</code> retrieves data from an <code>HINTERNET</code> handle as a sequential stream of bytes. It’ll return true if successful, or false otherwise.</li><li>According to the web page document, <code>InternetCloseHandle</code> function terminates any pending operations on the handle and discards any outstanding data. And it returns TRUE if the handle is successfully closed, or FALSE otherwise.</li></ul></li><li><p>What type of code construct is used in this subroutine?
Ans: It’ll use character array to call <code>loc_40109D</code> function (<code>InternetReadFile</code>). If connection failed, it’ll print “Error 2.1: Fail to OpenUrl” and close the handle procedure.
<img src=https://imgur.com/srwCZI9.png alt>
<img src=https://imgur.com/HxuA1cB.png alt></p></li><li><p>Are there any network-based indicators for this program?
Ans: There’re two network-based indicator in this program shown as below. The program also used <code>url</code> string and user agent string to set up the internet environment which shown as below as well.
<img src=https://imgur.com/v39bOOb.png alt>
<img src=https://imgur.com/DCDMFOY.png alt></p></li><li><p>What is the purpose of this malware?
Ans: The main purpose of this block is to check the internet connection first and then open the internet connection to get the web page information if the connection success. Finally, close the internet handle and sleep one minute at the end.</p></li></ul><h2 id=task-3>Task 3
<a class=anchor href=#task-3>#</a></h2><h3 id=analyze-the-lab06-03exe>Analyze the <code>Lab06-03.exe</code>
<a class=anchor href=#analyze-the-lab06-03exe>#</a></h3><ul><li>Compare the calls in main to <code>Lab6-2’s</code> main method. What is the new function called from this main?
Ans: The new function is called sub_401150 and it’ll do something based on what it get from the page.
<img src=https://imgur.com/RsxJaYh.png alt></li><li>What parameters does this new function take?
Ans: It must have character <code>a1</code> as a case number and <code>LPCSTR</code> <code>lpExistingFileName</code> which is representing the name of an existing file.</li><li>What major code construct does this function contain?
Ans: It contains a simple switch case structure to decide what it can do.</li><li>What can this function do?
Ans: It can create a directory the in specified path, copy a file, delete a file, open the specified registry key, sleep 100 seconds, or print an error message by default.</li><li>Are there any host-based indicators for this malware?
Ans: <code>Subkey</code> parameter and Data parameter can be host-based indicator in this malware.
<img src=https://imgur.com/GFfAUJj.png alt></li></ul><h2 id=task-4>Task 4
<a class=anchor href=#task-4>#</a></h2><h3 id=analyze-the-lab06-04exe>Analyze the <code>Lab06-04.exe</code>
<a class=anchor href=#analyze-the-lab06-04exe>#</a></h3><ul><li>What is the difference between the calls made from the main method in <code>Lab6-3</code> and <code>6-4</code>?
Ans: In <code>Lab6-3</code>, the main block just executes one time if it got something from the domain name address. But in <code>Lab6-4</code>, there’s a for loop wrapping the main block to repeat it 1440 times.</li><li>What new code construct has been added to the main?
Ans: There’s a for loop in the main block to execute the program repeatedly 1440 times.</li><li>What is the difference between this lab’s parse HTML function and those of the previous labs?
Ans: In <code>Lab6-3</code>, it just accesses <code>Internet Explorer 7.5/pma</code> string to Windows API named <code>InternetOpenA</code>. But in <code>Lab6-4</code>, it connects character <code>a1</code> string which is generated by for loop looks like <code>Internet Explorer 7.50/pma%d</code>(%d is in which the parameter <code>a1</code> should be put).</li><li>How long will this program run? (Assume that it is connected to the Internet)
Ans: Assume to ignore the internet checking time and ignore if statement checking time Assume executing time for case a is A second, for case b is B second, for case c is C second, for case d is D second, for case e is 100 second, and the probability of all cases that we get are the same. The average of execution time is <code>T= (A+B+C+D+100)/5</code>. So, the whole execution time of this program is approximately <code>1440*(T+60)</code> seconds.</li><li>Are there any new network-based indicators for this malware?
Ans: No.</li><li>What is the purpose of this malware?
Ans: First, check the internet connection like above and continue to execute if successful, return zero otherwise. Then get the info from the URL which is set up by default in this program and close the internet handle when it is finished. Finally, do something according to what you get from the page such as creating a directory the in specified path, copying a file, deleting a file or opening the specified registry key, and repeatedly 1440 times until the end.</li></ul><h2 id=task-5>Task 5
<a class=anchor href=#task-5>#</a></h2><h3 id=please-analyze-easy_crackmeexe-use-ida-pro>Please analyze <code>Easy_CrackMe.exe.</code> (Use IDA PRO)
<a class=anchor href=#please-analyze-easy_crackmeexe-use-ida-pro>#</a></h3><p>After you run the <code>exe</code> file, you will see an input box like
<img src=https://imgur.com/4dfSoEB.png alt>
Please Find the correct Password and you will get the correct response.
<img src=https://imgur.com/HRouxSn.png alt></p><ul><li>Ans: The correct password is “Ea5yR3versing”.</li></ul><h2 id=task-6>Task 6
<a class=anchor href=#task-6>#</a></h2><h3 id=please-analyze-easy_keygenexe-use-ida-pro>Please analyze <code>Easy_Keygen.exe.</code> (Use IDA PRO)
<a class=anchor href=#please-analyze-easy_keygenexe-use-ida-pro>#</a></h3><p>You need to run the <code>exe</code> file in <code>cmd</code> like
<img src=https://imgur.com/WC5As8K.png alt>
In this case, you need to enter the Input Name and Input Serial. If Name and Serial are matched, you will get correct response. Please find the Input Name when the Input Serial is 5B134977135E7D13.
<img src=https://imgur.com/YjtwGlP.png alt></p><ul><li>Ans: <code>K3yg3nm3</code></li><li>Write Up:<ul><li><img src=https://imgur.com/LGEcoDe.png alt>
First, you can check the declaration of <code>v6</code> to <code>v8</code> and <code>v12</code> to <code>v14</code> that they connected respectively.
<img src=https://imgur.com/sqSoUJo.png alt></li><li>By the way, v9 is the variable stored what you input
<img src=https://imgur.com/Fq3FgzO.png alt></li><li>The main concept of this PE file is in this for loop. To get the address of v9 and plus v3, then get actual value by * operator. That means every time will compute just one character and one by one until every character you enter has been computed.</li><li>Operator ^ means bitwise of XOR in C and the operand is *(&amp;v6 + i). When you get the reverse of this operation, you’ll get 16 char with hex value(4B337967336E6D33). Put these value to Hex2ASCII online converter, you can get the password answer.</li></ul></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#task-1>Task 1</a><ul><li><a href=#analyze-the-lab06-01exe>Analyze the <code>Lab06-01.exe</code></a></li></ul></li><li><a href=#task-2>Task 2</a><ul><li><a href=#analyze-the-lab06-02exe>Analyze the <code>Lab06-02.exe</code></a></li></ul></li><li><a href=#task-3>Task 3</a><ul><li><a href=#analyze-the-lab06-03exe>Analyze the <code>Lab06-03.exe</code></a></li></ul></li><li><a href=#task-4>Task 4</a><ul><li><a href=#analyze-the-lab06-04exe>Analyze the <code>Lab06-04.exe</code></a></li></ul></li><li><a href=#task-5>Task 5</a><ul><li><a href=#please-analyze-easy_crackmeexe-use-ida-pro>Please analyze <code>Easy_CrackMe.exe.</code> (Use IDA PRO)</a></li></ul></li><li><a href=#task-6>Task 6</a><ul><li><a href=#please-analyze-easy_keygenexe-use-ida-pro>Please analyze <code>Easy_Keygen.exe.</code> (Use IDA PRO)</a></li></ul></li></ul></nav></div></aside></main></body></html>