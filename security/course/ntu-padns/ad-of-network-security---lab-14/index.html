<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  A&amp;D of Network Security - Lab 14
  #


  tags: Practicum of A&amp;D of NS NTU
  #


  Video
  #

Class Description
Lab Implementation

  Background
  #


snort Rule
:::spoiler Rule Screenshot

Format

Action

Option

Option - Payload

:::




  Lab
  #


  Lab 1: Packet sniffer Mode show出 sniff ICMP封包的結果
  #

Payload:
$ sudo snort -vd -i eth0 -q
:::spoiler Result Screenshot

:::


  Lab 2: Attacker SSH爆破攻擊，利用 Snort偵測攻擊行為是否發生，show出偵測結果 ，並說明snort rule
  #


  Threat Model
  #

"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntu-padns/ad-of-network-security---lab-14/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="A&D of Network Security - Lab 14"><meta property="og:description" content="A&amp;D of Network Security - Lab 14 # tags: Practicum of A&amp;D of NS NTU # Video # Class Description Lab Implementation
Background # snort Rule :::spoiler Rule Screenshot Format Action Option Option - Payload ::: Lab # Lab 1: Packet sniffer Mode show出 sniff ICMP封包的結果 # Payload:
$ sudo snort -vd -i eth0 -q :::spoiler Result Screenshot :::
Lab 2: Attacker SSH爆破攻擊，利用 Snort偵測攻擊行為是否發生，show出偵測結果 ，並說明snort rule # Threat Model #"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="NTU"><meta property="article:tag" content="NTU_PADNS"><title>A&amp;D of Network Security - Lab 14 | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntu-padns/ad-of-network-security---lab-14/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>A&amp;D of Network Security - Lab 14</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#video>Video</a></li><li><a href=#background>Background</a></li><li><a href=#lab>Lab</a><ul><li><a href=#lab-1-packet-sniffer-mode-show出-sniff-icmp封包的結果>Lab 1: Packet sniffer Mode show出 sniff ICMP封包的結果</a></li><li><a href=#lab-2-attacker-ssh爆破攻擊利用-snort偵測攻擊行為是否發生show出偵測結果-並說明snort-rule>Lab 2: Attacker SSH爆破攻擊，利用 Snort偵測攻擊行為是否發生，show出偵測結果 ，並說明snort rule</a></li><li><a href=#lab-3-1-使用nmap進行攻擊並使用-wireshark側錄封包分析可能可以成為snort的規則>Lab 3-1: 使用Nmap進行攻擊並使用 Wireshark側錄封包分析可能可以成為snort的規則</a></li><li><a href=#lab-3-2-撰寫snort-rule並偵測出攻擊偵測的-lert需包含你的學號>Lab 3-2: 撰寫snort rule並偵測出攻擊，偵測的 lert需包含你的學號</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=ad-of-network-security---lab-14>A&amp;D of Network Security - Lab 14
<a class=anchor href=#ad-of-network-security---lab-14>#</a></h1><h6 id=tags-practicum-of-ad-of-ns-ntu>tags: <code>Practicum of A&amp;D of NS</code> <code>NTU</code>
<a class=anchor href=#tags-practicum-of-ad-of-ns-ntu>#</a></h6><h2 id=video>Video
<a class=anchor href=#video>#</a></h2><p><a href="https://files-1.dlc.ntu.edu.tw/cool-video/202305/f4f0b276-7211-448a-812b-89b3d194ccde/transcoded.mp4?AWSAccessKeyId=C6ueMrUe5JyPkWQJAyKp&amp;Expires=1685444669&amp;Signature=XXKzQ0FHD31E%2FdKWhlcyX%2BcLQXg%3D">Class Description</a>
<a href="https://files-1.dlc.ntu.edu.tw/cool-video/202305/b494d4d3-0d67-4672-95ab-37a8c35b70b3/transcoded.mp4?AWSAccessKeyId=C6ueMrUe5JyPkWQJAyKp&amp;Expires=1685432006&amp;Signature=sJvf4b%2BWXnkZY3dCFmX4vHCcyy0%3D">Lab Implementation</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><ul><li>snort Rule
:::spoiler Rule Screenshot<ul><li>Format
<img src=https://hackmd.io/_uploads/S1pKEV7Ln.png alt></li><li>Action
<img src=https://hackmd.io/_uploads/HygsNEXI2.png alt></li><li>Option
<img src=https://hackmd.io/_uploads/By83VNQUh.png alt></li><li>Option - Payload
<img src=https://hackmd.io/_uploads/rJ6p44QI2.png alt>
:::</li></ul></li></ul><h2 id=lab>Lab
<a class=anchor href=#lab>#</a></h2><h3 id=lab-1-packet-sniffer-mode-show出-sniff-icmp封包的結果>Lab 1: Packet sniffer Mode show出 sniff ICMP封包的結果
<a class=anchor href=#lab-1-packet-sniffer-mode-show%e5%87%ba-sniff-icmp%e5%b0%81%e5%8c%85%e7%9a%84%e7%b5%90%e6%9e%9c>#</a></h3><p>Payload:</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ sudo snort -vd -i eth0 -q
</code></pre><p>:::spoiler Result Screenshot
<img src=https://hackmd.io/_uploads/BJVrHN78h.png alt>
:::</p><hr><h3 id=lab-2-attacker-ssh爆破攻擊利用-snort偵測攻擊行為是否發生show出偵測結果-並說明snort-rule>Lab 2: Attacker SSH爆破攻擊，利用 Snort偵測攻擊行為是否發生，show出偵測結果 ，並說明snort rule
<a class=anchor href=#lab-2-attacker-ssh%e7%88%86%e7%a0%b4%e6%94%bb%e6%93%8a%e5%88%a9%e7%94%a8-snort%e5%81%b5%e6%b8%ac%e6%94%bb%e6%93%8a%e8%a1%8c%e7%82%ba%e6%98%af%e5%90%a6%e7%99%bc%e7%94%9fshow%e5%87%ba%e5%81%b5%e6%b8%ac%e7%b5%90%e6%9e%9c-%e4%b8%a6%e8%aa%aa%e6%98%8esnort-rule>#</a></h3><h4 id=threat-model>Threat Model
<a class=anchor href=#threat-model>#</a></h4><p><img src=https://hackmd.io/_uploads/SkDltNQU3.png alt></p><ul><li>Attacker use SSH brute force attack and try to log in the victim snort</li><li>Need to write rule to detect attacker’s SSH brute force attack</li></ul><h4 id=lab-process>Lab Process
<a class=anchor href=#lab-process>#</a></h4><ol><li><p>Set up environment - <font color=FF0000>Host Only</font></p><ul><li>In Kali-Linux 1(Attacker) - <code>192.168.56.129</code>
:::spoiler Result Screenshot
<img src=https://hackmd.io/_uploads/Hkd6FEmI3.png alt>
:::</li><li>In Kali-Linux 2(Victim) - <code>192.168.56.104</code>
:::spoiler Result Screenshot
<img src=https://hackmd.io/_uploads/HkoYt4QU2.png alt>
:::</li></ul></li><li><p>Write your rule and Test it in victim VM
Payload:</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ sudo vim /etc/snort/rules/local.rules

# Insert rules below in this file
alert tcp any any -&gt; any 22 ( msg:&#34;SSH Brute Force Attempt&#34;; flow:established,to_server; content:&#34;SSH&#34;; nocase; offset:0; depth:4; detection_filter:track by_src, count 2, seconds 1; sid:1000001; rev:1;)

# Test the rule if success
$ sudo snort -T -c /etc/snort/snort.conf
...
Snort successfully validated the configuration!
Snort exiting
</code></pre></li><li><p>Check SSH Connection if turn on (From inactive to active)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo systemctl status ssh
</span></span><span style=display:flex><span>● ssh.service - OpenBSD Secure Shell server
</span></span><span style=display:flex><span>     Loaded: loaded <span style=color:#f92672>(</span>/lib/systemd/system/ssh.service; disabled; vendor preset: disabled<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     Active: inactive <span style=color:#f92672>(</span>dead<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>       Docs: man:sshd<span style=color:#f92672>(</span>8<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>             man:sshd_config<span style=color:#f92672>(</span>5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>$ sudo systemctl start ssh
</span></span><span style=display:flex><span>$ sudo systemctl status ssh
</span></span><span style=display:flex><span>● ssh.service - OpenBSD Secure Shell server
</span></span><span style=display:flex><span>     Loaded: loaded <span style=color:#f92672>(</span>/lib/systemd/system/ssh.service; disabled; vendor preset: disabled<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     Active: active <span style=color:#f92672>(</span>running<span style=color:#f92672>)</span> since Tue 2023-05-30 05:04:10 EDT; 2s ago
</span></span><span style=display:flex><span>       Docs: man:sshd<span style=color:#f92672>(</span>8<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>             man:sshd_config<span style=color:#f92672>(</span>5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Process: <span style=color:#ae81ff>2670</span> ExecStartPre<span style=color:#f92672>=</span>/usr/sbin/sshd -t <span style=color:#f92672>(</span>code<span style=color:#f92672>=</span>exited, status<span style=color:#f92672>=</span>0/SUCCESS<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   Main PID: <span style=color:#ae81ff>2671</span> <span style=color:#f92672>(</span>sshd<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      Tasks: <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>limit: 9466<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     Memory: 1.1M
</span></span><span style=display:flex><span>        CPU: 15ms
</span></span><span style=display:flex><span>     CGroup: /system.slice/ssh.service
</span></span><span style=display:flex><span>             └─2671 sshd: /usr/sbin/sshd -D <span style=color:#f92672>[</span>listener<span style=color:#f92672>]</span> <span style=color:#ae81ff>0</span> of 10-100 startups
</span></span></code></pre></div></li><li><p>Run snort in victim</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ sudo snort -A console -q -c /etc/snort/snort.conf -i eth0
</code></pre></li><li><p>Activate Attacking in Attacker VM</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ sudo hydra -l root -P /usr/share/wordlists/rockyou.txt 192.168.56.104 -t 4 ssh
</code></pre></li><li><p>Result Screenshot in Victim VM
<img src=https://hackmd.io/_uploads/SJ0U0VmUh.png alt></p></li></ol><hr><h3 id=lab-3-1-使用nmap進行攻擊並使用-wireshark側錄封包分析可能可以成為snort的規則>Lab 3-1: 使用Nmap進行攻擊並使用 Wireshark側錄封包分析可能可以成為snort的規則
<a class=anchor href=#lab-3-1-%e4%bd%bf%e7%94%a8nmap%e9%80%b2%e8%a1%8c%e6%94%bb%e6%93%8a%e4%b8%a6%e4%bd%bf%e7%94%a8-wireshark%e5%81%b4%e9%8c%84%e5%b0%81%e5%8c%85%e5%88%86%e6%9e%90%e5%8f%af%e8%83%bd%e5%8f%af%e4%bb%a5%e6%88%90%e7%82%basnort%e7%9a%84%e8%a6%8f%e5%89%87>#</a></h3><h4 id=threat-model-1>Threat Model
<a class=anchor href=#threat-model-1>#</a></h4><p><img src=https://hackmd.io/_uploads/H1LrJHQ83.png alt></p><ol><li>Nmap to the snort machine. (Any Nmap scan command is available)</li><li>Write your own Rules on the snort machine</li><li>Screenshot the output alert</li></ol><h4 id=lab-process-1>Lab Process
<a class=anchor href=#lab-process-1>#</a></h4><ol><li><p>Open Wireshark and Record the packets and choose <code>any</code> to record</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ sudo wireshark
</code></pre><p><img src=https://hackmd.io/_uploads/S1WJxrmLn.png alt></p></li><li><p>Try to attack in attacker VM</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ sudo nmap sS 192.168.56.129
</code></pre><p>:::spoiler Final Result Screenshot
<img src=https://hackmd.io/_uploads/rk3cCEQIn.png alt>
:::</p></li></ol><hr><h3 id=lab-3-2-撰寫snort-rule並偵測出攻擊偵測的-lert需包含你的學號>Lab 3-2: 撰寫snort rule並偵測出攻擊，偵測的 lert需包含你的學號
<a class=anchor href=#lab-3-2-%e6%92%b0%e5%af%absnort-rule%e4%b8%a6%e5%81%b5%e6%b8%ac%e5%87%ba%e6%94%bb%e6%93%8a%e5%81%b5%e6%b8%ac%e7%9a%84-lert%e9%9c%80%e5%8c%85%e5%90%ab%e4%bd%a0%e7%9a%84%e5%ad%b8%e8%99%9f>#</a></h3><p>From the result above, try to observe the common rules of these <font color=FF0000>Red</font> packets(unsuccessful packets) $\to$ The length of each packets are $0$</p><p>Thus, we can use it to construct the snort payload as below(just insert the payload to <code>/etc/snort/rules/local.rules</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>alert tcp any any -&gt; any any <span style=color:#f92672>(</span>msg: <span style=color:#e6db74>&#34;r11921a16: TCP Scan Alert&#34;</span>; sid:1000002;dsize:&lt;5;<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=try-to-attack>Try to attack
<a class=anchor href=#try-to-attack>#</a></h4><p>In victim VM:</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ sudo snort -A console -q -u snort -g snort -c /etc/snort/snort.conf -i eth0
</code></pre><p>In attacker VM:</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ sudo nmap sS 192.168.56.104
</code></pre><p>:::spoiler Final Result Screenshot
<img src=https://hackmd.io/_uploads/Sy8hCNQI2.png alt>
:::</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#video>Video</a></li><li><a href=#background>Background</a></li><li><a href=#lab>Lab</a><ul><li><a href=#lab-1-packet-sniffer-mode-show出-sniff-icmp封包的結果>Lab 1: Packet sniffer Mode show出 sniff ICMP封包的結果</a></li><li><a href=#lab-2-attacker-ssh爆破攻擊利用-snort偵測攻擊行為是否發生show出偵測結果-並說明snort-rule>Lab 2: Attacker SSH爆破攻擊，利用 Snort偵測攻擊行為是否發生，show出偵測結果 ，並說明snort rule</a></li><li><a href=#lab-3-1-使用nmap進行攻擊並使用-wireshark側錄封包分析可能可以成為snort的規則>Lab 3-1: 使用Nmap進行攻擊並使用 Wireshark側錄封包分析可能可以成為snort的規則</a></li><li><a href=#lab-3-2-撰寫snort-rule並偵測出攻擊偵測的-lert需包含你的學號>Lab 3-2: 撰寫snort rule並偵測出攻擊，偵測的 lert需包含你的學號</a></li></ul></li></ul></nav></div></aside></main></body></html>