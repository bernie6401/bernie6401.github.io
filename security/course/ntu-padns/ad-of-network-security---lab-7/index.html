<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  A&amp;D of Network Security - Lab 7
  #


  tags: Practicum of A&amp;D of NS NTU
  #


  Background
  #

What is foremost and How to use it?

  RSA CTF
  #


  Exercise - RSA
  #

Given
p =  9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483
q =  11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407
e =  65537
c =  83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034
Then I can use decrypt function to fetch plaintext.
Flag(hex): 12058e43d9e0c22559c19774
:::spoiler source code
from Crypto.Util.number import long_to_bytes, inverse, bytes_to_long

p =  9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483
q =  11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407
e =  65537
c =  83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034

n = p * q
phi = (q-1)*(p-1)
d = inverse(e, phi)
print(long_to_bytes(pow(c,d,n)).hex())
:::"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntu-padns/ad-of-network-security---lab-7/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="A&D of Network Security - Lab 7"><meta property="og:description" content="A&amp;D of Network Security - Lab 7 # tags: Practicum of A&amp;D of NS NTU # Background # What is foremost and How to use it?
RSA CTF # Exercise - RSA # Given
p = 9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483 q = 11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407 e = 65537 c = 83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034 Then I can use decrypt function to fetch plaintext. Flag(hex): 12058e43d9e0c22559c19774 :::spoiler source code
from Crypto.Util.number import long_to_bytes, inverse, bytes_to_long p = 9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483 q = 11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407 e = 65537 c = 83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034 n = p * q phi = (q-1)*(p-1) d = inverse(e, phi) print(long_to_bytes(pow(c,d,n)).hex()) :::"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="NTU"><meta property="article:tag" content="NTU_PADNS"><title>A&amp;D of Network Security - Lab 7 | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntu-padns/ad-of-network-security---lab-7/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>A&amp;D of Network Security - Lab 7</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#rsa-ctf>RSA CTF</a><ul><li><a href=#exercise---rsa>Exercise - RSA</a></li><li><a href=#exercise---decrypt_rsa>Exercise - Decrypt_RSA</a></li></ul></li><li><a href=#stego-ctf>Stego CTF</a><ul><li><a href=#exercise-1---zip-extension>Exercise 1 - <code>zip</code> Extension</a></li><li><a href=#exercise-2---foremost>Exercise 2 - Foremost</a></li><li><a href=#exercise-3---unzip-twice>Exercise 3 - Unzip twice</a></li><li><a href=#exercise-4>Exercise 4</a></li><li><a href=#exercise-5---change-palette>Exercise 5 - Change Palette</a></li><li><a href=#exercise-6>Exercise 6</a></li></ul></li><li><a href=#reference>Reference</a><ul><li><a href=#exercise-decrypt_rsa>Exercise Decrypt_RSA</a></li><li><a href=#exercise-4-1>Exercise 4</a></li><li><a href=#exercise-5>Exercise 5</a></li><li><a href=#exercise-6-1>Exercise 6</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=ad-of-network-security---lab-7>A&amp;D of Network Security - Lab 7
<a class=anchor href=#ad-of-network-security---lab-7>#</a></h1><h6 id=tags-practicum-of-ad-of-ns-ntu>tags: <code>Practicum of A&amp;D of NS</code> <code>NTU</code>
<a class=anchor href=#tags-practicum-of-ad-of-ns-ntu>#</a></h6><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://darkranger.no-ip.org/archives/v5/document/linux/foremost_recovery.htm>What is foremost and How to use it?</a></p><h2 id=rsa-ctf>RSA CTF
<a class=anchor href=#rsa-ctf>#</a></h2><h3 id=exercise---rsa>Exercise - RSA
<a class=anchor href=#exercise---rsa>#</a></h3><p>Given</p><pre tabindex=0><code>p =  9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483
q =  11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407
e =  65537
c =  83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034
</code></pre><p>Then I can use decrypt function to fetch plaintext.
Flag(hex): <code>12058e43d9e0c22559c19774</code>
:::spoiler source code</p><pre tabindex=0><code class=language-python! data-lang=python!>from Crypto.Util.number import long_to_bytes, inverse, bytes_to_long

p =  9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483
q =  11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407
e =  65537
c =  83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034

n = p * q
phi = (q-1)*(p-1)
d = inverse(e, phi)
print(long_to_bytes(pow(c,d,n)).hex())
</code></pre><p>:::</p><h3 id=exercise---decrypt_rsa>Exercise - Decrypt_RSA
<a class=anchor href=#exercise---decrypt_rsa>#</a></h3><p>Given <code>public-key.pem</code> and <code>flag.txt</code>
File: <code>public-key.pem</code></p><pre tabindex=0><code>-----BEGIN PUBLIC KEY-----
MGwwDQYJKoZIhvcNAQEBBQADWwAwWAJRAK5btPJmADJZz5pvUhw8A0EBds8W31OV
NHbq47Ie3mw8ewO9yiCzHABn/6eX5OkQWXhz7vETpg/szZXetbK/EAZr4iJKzinV
MtwLWnTS0AbxAgMBAAE=
-----END PUBLIC KEY-----
</code></pre><ol><li>Recon
Obviously, you can notice that public key file is generated by such like <code>openssl</code> tool. So, there&rsquo;s a way to turn it to text.</li><li>Transform<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ openssl rsa -pubin -in public-key.pem -text
</span></span><span style=display:flex><span>RSA Public-Key: <span style=color:#f92672>(</span><span style=color:#ae81ff>640</span> bit<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Modulus:
</span></span><span style=display:flex><span>    00:ae:5b:b4:f2:66:00:32:59:cf:9a:6f:52:1c:3c:
</span></span><span style=display:flex><span>    03:41:01:76:cf:16:df:53:95:34:76:ea:e3:b2:1e:
</span></span><span style=display:flex><span>    de:6c:3c:7b:03:bd:ca:20:b3:1c:00:67:ff:a7:97:
</span></span><span style=display:flex><span>    e4:e9:10:59:78:73:ee:f1:13:a6:0f:ec:cd:95:de:
</span></span><span style=display:flex><span>    b5:b2:bf:10:06:6b:e2:22:4a:ce:29:d5:32:dc:0b:
</span></span><span style=display:flex><span>    5a:74:d2:d0:06:f1
</span></span><span style=display:flex><span>Exponent: <span style=color:#ae81ff>65537</span> <span style=color:#f92672>(</span>0x10001<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>writing RSA key
</span></span><span style=display:flex><span>-----BEGIN PUBLIC KEY-----
</span></span><span style=display:flex><span>MGwwDQYJKoZIhvcNAQEBBQADWwAwWAJRAK5btPJmADJZz5pvUhw8A0EBds8W31OV
</span></span><span style=display:flex><span>NHbq47Ie3mw8ewO9yiCzHABn/6eX5OkQWXhz7vETpg/szZXetbK/EAZr4iJKzinV
</span></span><span style=display:flex><span>MtwLWnTS0AbxAgMBAAE<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>-----END PUBLIC KEY-----
</span></span></code></pre></div></li></ol><p>Then after the transformation, you can see that <code>n=p*q=0x00ae...</code> and <code>e=65537</code></p><ol start=3><li><p>Hex to Decimal</p><pre tabindex=0><code class=language-bash! data-lang=bash!>&gt;&gt;&gt; int(&#34;00ae5bb4f266003259cf9a6f521c3c03410176cf16df53953476eae3b21ede6c3c7b03bdca20b31c0067ffa797e4e910597873eef113a60feccd95deb5b2bf10066be2224ace29d532dc0b5a74d2d006f1&#34;, 16)
3107418240490043721350750035888567930037346022842727545720161948823206440518081504556346829671723286782437916272838033415471073108501919548529007337724822783525742386454014691736602477652346609
</code></pre></li><li><p>Factoring Small <code>n</code>
Just using the <a href=http://factordb.com/index.php>online tool</a> and you&rsquo;ll get <code>p</code> and <code>q</code>
<code>p=1634733645809253848443133883865090859841783670033092312181110852389333100104508151212118167511579</code>
<code>q=1900871281664822113126851573935413975471896789968515493666638539088027103802104498957191261465571</code></p></li><li><p>Decrypt Cipher</p><pre tabindex=0><code class="language-python=" data-lang="python=">from Crypto.Util.number import long_to_bytes, inverse, bytes_to_long, isPrime
from base64 import b64decode

cipher = open(&#34;./flag.txt&#34;, &#34;rb&#34;).read().hex()
cipher = int(cipher, 16)


p = 1634733645809253848443133883865090859841783670033092312181110852389333100104508151212118167511579
q = 1900871281664822113126851573935413975471896789968515493666638539088027103802104498957191261465571
e = 65537
n = p * q
phi = (q-1)*(p-1)
d = inverse(e, phi)
print(bytes.fromhex(long_to_bytes(pow(cipher,d,n)).hex()).decode(&#34;cp437&#34;))
</code></pre><p>Flag: <code>FLAG_IS_WeAK_rSA</code></p></li></ol><h2 id=stego-ctf>Stego CTF
<a class=anchor href=#stego-ctf>#</a></h2><h3 id=exercise-1---zip-extension>Exercise 1 - <code>zip</code> Extension
<a class=anchor href=#exercise-1---zip-extension>#</a></h3><ol><li>Use <code>binwalk</code> to Recon<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ binwalk Exercise<span style=color:#ae81ff>\ </span>1<span style=color:#ae81ff>\ </span>-<span style=color:#ae81ff>\ </span>example.jpg
</span></span><span style=display:flex><span>DECIMAL       HEXADECIMAL     DESCRIPTION
</span></span><span style=display:flex><span>--------------------------------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>             0x0             JPEG image data, EXIF standard
</span></span><span style=display:flex><span><span style=color:#ae81ff>12</span>            0xC             TIFF image data, big-endian, offset of first image directory: <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>9298</span>          0x2452          TIFF image data, little-endian offset of first image directory: <span style=color:#ae81ff>662</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>9692</span>          0x25DC          JPEG image data, JFIF standard 1.01
</span></span><span style=display:flex><span><span style=color:#ae81ff>14241</span>         0x37A1          Copyright string: <span style=color:#e6db74>&#34;Copyright 2003 Apple Computer Inc., all rights reserved.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1972141</span>       0x1E17AD        Zip archive data, at least v1.0 to extract, compressed size: 20, uncompressed size: 20, name: secret.txt
</span></span><span style=display:flex><span><span style=color:#ae81ff>1972309</span>       0x1E1855        End of Zip archive, footer length: <span style=color:#ae81ff>22</span>
</span></span></code></pre></div>You can see that it contained a <code>zip</code> file at the end of data</li><li>Change Extension
Thus, you can change the extension manually and <code>unzip</code> it</li><li>Get Secret
:::spoiler secret flag
<code>supa_secret_flagzor</code>
:::</li></ol><h3 id=exercise-2---foremost>Exercise 2 - Foremost
<a class=anchor href=#exercise-2---foremost>#</a></h3><ol><li>Recon<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$</span> pngcheck Exercise\ <span style=color:#ae81ff>2</span>\ <span style=color:#f92672>-</span>\ PurpleThing<span style=color:#f92672>.</span>png
</span></span><span style=display:flex><span>Exercise <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> PurpleThing<span style=color:#f92672>.</span>png  EOF <span style=color:#66d9ef>while</span> reading CRC value
</span></span><span style=display:flex><span>ERROR: Exercise <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> PurpleThing<span style=color:#f92672>.</span>png
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$</span> binwalk Exercise\ <span style=color:#ae81ff>2</span>\ <span style=color:#f92672>-</span>\ PurpleThing<span style=color:#f92672>.</span>png
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DECIMAL       HEXADECIMAL     DESCRIPTION
</span></span><span style=display:flex><span><span style=color:#f92672>--------------------------------------------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>             <span style=color:#ae81ff>0x0</span>             PNG image, <span style=color:#ae81ff>3200</span> x <span style=color:#ae81ff>2953</span>, <span style=color:#ae81ff>8</span><span style=color:#f92672>-</span>bit<span style=color:#f92672>/</span>color RGBA, non<span style=color:#f92672>-</span>interlaced
</span></span><span style=display:flex><span><span style=color:#ae81ff>85</span>            <span style=color:#ae81ff>0x55</span>            Zlib compressed data, best compression
</span></span><span style=display:flex><span><span style=color:#ae81ff>2757</span>          <span style=color:#ae81ff>0xAC5</span>           Zlib compressed data, best compression
</span></span><span style=display:flex><span><span style=color:#ae81ff>765455</span>        <span style=color:#ae81ff>0xBAE0F</span>         JPEG image data, JFIF standard <span style=color:#ae81ff>1.01</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>765485</span>        <span style=color:#ae81ff>0xBAE2D</span>         TIFF image data, big<span style=color:#f92672>-</span>endian, offset of first image directory: <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1809691</span>       <span style=color:#ae81ff>0x1B9D1B</span>        StuffIt Deluxe Segment (data): f
</span></span></code></pre></div>First, I used <code>pngcheck</code> to observe the data structure and it returned CRC error means something wrong at the end of file.
Therefore, I used <code>binwalk</code> to check the extra information. It seemed has another file in it.</li><li>Use <code>Foremost</code> to parse hiding files<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ foremost -v Exercise<span style=color:#ae81ff>\ </span>2<span style=color:#ae81ff>\ </span>-<span style=color:#ae81ff>\ </span>PurpleThing.png
</span></span><span style=display:flex><span>Foremost version 1.5.7 by Jesse Kornblum, Kris Kendall, and Nick Mikus
</span></span><span style=display:flex><span>Audit File
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Foremost started at Mon Apr <span style=color:#ae81ff>10</span> 22:47:57 <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>Invocation: foremost -v Exercise <span style=color:#ae81ff>2</span> - PurpleThing.png
</span></span><span style=display:flex><span>Output directory: /mnt/d/NTU/First Year/2nd semester/Practicum of Attacking and Defense of Network Security/Lab/Lec07/Practice/output
</span></span><span style=display:flex><span>Configuration file: /etc/foremost.conf
</span></span><span style=display:flex><span>Processing: Exercise <span style=color:#ae81ff>2</span> - PurpleThing.png
</span></span><span style=display:flex><span>|------------------------------------------------------------------
</span></span><span style=display:flex><span>File: Exercise <span style=color:#ae81ff>2</span> - PurpleThing.png
</span></span><span style=display:flex><span>Start: Mon Apr <span style=color:#ae81ff>10</span> 22:47:57 <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>Length: <span style=color:#ae81ff>2</span> MB <span style=color:#f92672>(</span><span style=color:#ae81ff>2354256</span> bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Num      Name <span style=color:#f92672>(</span>bs<span style=color:#f92672>=</span>512<span style=color:#f92672>)</span>         Size      File Offset     Comment
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>0:      00001495.jpg           <span style=color:#ae81ff>1</span> MB          <span style=color:#ae81ff>765455</span>
</span></span><span style=display:flex><span>*|
</span></span><span style=display:flex><span>Finish: Mon Apr <span style=color:#ae81ff>10</span> 22:47:57 <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> FILES EXTRACTED
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>jpg:<span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>------------------------------------------------------------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Foremost finished at Mon Apr <span style=color:#ae81ff>10</span> 22:47:57 <span style=color:#ae81ff>2023</span>
</span></span></code></pre></div>Then it&rsquo;ll extract a folder named <code>output</code>
:::spoiler <code>secret flag</code>
<img src=https://i.imgur.com/EQGV3sN.jpg alt>
:::</li></ol><h3 id=exercise-3---unzip-twice>Exercise 3 - Unzip twice
<a class=anchor href=#exercise-3---unzip-twice>#</a></h3><ol><li>Use <code>binwalk</code> to recon<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ binwalk Exercise<span style=color:#ae81ff>\ </span>3<span style=color:#ae81ff>\ </span>-<span style=color:#ae81ff>\ </span>stego2.jpg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DECIMAL       HEXADECIMAL     DESCRIPTION
</span></span><span style=display:flex><span>--------------------------------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>             0x0             JPEG image data, JFIF standard 1.01
</span></span><span style=display:flex><span><span style=color:#ae81ff>40804</span>         0x9F64          Zip archive data, at least v2.0 to extract, compressed size: 32993, uncompressed size: 33783, name: got2.jpg
</span></span><span style=display:flex><span><span style=color:#ae81ff>73941</span>         0x120D5         End of Zip archive, footer length: <span style=color:#ae81ff>22</span>
</span></span></code></pre></div></li><li>Unzip it</li><li><code>binwalk</code> again<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ binwalk got2.jpg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DECIMAL       HEXADECIMAL     DESCRIPTION
</span></span><span style=display:flex><span>--------------------------------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>             0x0             JPEG image data, JFIF standard 1.02
</span></span><span style=display:flex><span><span style=color:#ae81ff>33587</span>         0x8333          Zip archive data, at least v1.0 to extract, compressed size: 32, uncompressed size: 32, name: txt.txt
</span></span><span style=display:flex><span><span style=color:#ae81ff>33761</span>         0x83E1          End of Zip archive, footer length: <span style=color:#ae81ff>22</span>
</span></span></code></pre></div></li><li>Unzip it again</li><li>Get flag
:::spoiler
Flag: <code>6307834008eb8edbe18c7a20ee4a909d</code>
:::</li></ol><h3 id=exercise-4>Exercise 4
<a class=anchor href=#exercise-4>#</a></h3><ol><li><p>Recon</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pngcheck -cv Exercise<span style=color:#ae81ff>\ </span>4<span style=color:#ae81ff>\ </span>-<span style=color:#ae81ff>\ </span>stego1.png
</span></span><span style=display:flex><span>File: Exercise <span style=color:#ae81ff>4</span> - stego1.png <span style=color:#f92672>(</span><span style=color:#ae81ff>11037</span> bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  chunk IHDR at offset 0x0000c, length <span style=color:#ae81ff>13</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>800</span> x <span style=color:#ae81ff>800</span> image, 24-bit RGB, non-interlaced
</span></span><span style=display:flex><span>  chunk IDAT at offset 0x00025, length <span style=color:#ae81ff>10980</span>
</span></span><span style=display:flex><span>    zlib: deflated, 32K window, default compression
</span></span><span style=display:flex><span>  chunk IEND at offset 0x02b15, length <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>No errors detected in Exercise <span style=color:#ae81ff>4</span> - stego1.png <span style=color:#f92672>(</span><span style=color:#ae81ff>3</span> chunks, 99.4% compression<span style=color:#f92672>)</span>.
</span></span></code></pre></div><p>Seems there is nothing special information however, TA&rsquo;s hint is <code>png filter</code>. Refer to <a href=https://www.w3.org/TR/PNG-Filters.html>W3C spec</a>, I am aware that there are several filter types that can be applied, such as None <code>(byte 0x0)</code>, Sub <code>(byte 0x1)</code>, Up <code>(byte 0x2)</code> etc.</p><p>Bytes of these filter types can be used to hide information, i.e. the flag, in the PNG.
In our case, we have to decompress the PNG <code>IDAT</code> chunk data and extract the filter type bytes from the decompressed data.</p></li><li><p>Decompressed Flag by Using Script below</p><pre tabindex=0><code class=language-bash! data-lang=bash!>./Exercise\ 4-exp.py Exercise\ 4\ -\ stego1.png
PNG Signature: (b&#39;\x89&#39;, b&#39;P&#39;, b&#39;N&#39;, b&#39;G&#39;, b&#39;\r&#39;, b&#39;\n&#39;, b&#39;\x1a&#39;, b&#39;\n&#39;)
Pos : 8
Type: b&#39;IHDR&#39;
Size: 13
CRC : b&#39;5412913F&#39;
Pos : 33
Type: b&#39;IDAT&#39;
Size: 10980
CRC : b&#39;98F96EEB&#39;
Pos : 11025
Type: b&#39;IEND&#39;
Size: 0
CRC : b&#39;AE426082&#39;
Data length in PNG file :  10980
Decompressed data length:  1920800
Flag: DrgnS{WhenYouGazeIntoThePNGThePNGAlsoGazezIntoYou}
</code></pre><p>:::spoiler source code</p><pre tabindex=0><code class="language-python=" data-lang="python=">#!/usr/bin/env python

from struct import unpack
from binascii import hexlify, unhexlify
import sys, zlib

# Returns [Position, Chunk Size, Chunk Type, Chunk Data, Chunk CRC]
def getChunk(buf, pos):
    a = []
    a.append(pos)
    size = unpack(&#39;!I&#39;, buf[pos:pos+4])[0]
    # Chunk Size
    a.append(buf[pos:pos+4])
    # Chunk Type
    a.append(buf[pos+4:pos+8])
    # Chunk Data
    a.append(buf[pos+8:pos+8+size])
    # Chunk CRC
    a.append(buf[pos+8+size:pos+12+size])
    return a

def printChunk(buf, pos):
    print(&#39;Pos : &#39;+str(pos)+&#39;&#39;)
    print(&#39;Type: &#39; + str(buf[pos+4:pos+8]))
    size = unpack(&#39;!I&#39;, buf[pos:pos+4])[0]
    print(&#39;Size: &#39; + str(size))
    #print(&#39;Cont: &#39; + str(hexlify(buf[pos+8:pos+8+size])))
    print(&#39;CRC : &#39; + str(hexlify(buf[pos+size+8:pos+size+12]).upper()))
    print

if len(sys.argv)!=2:
    print(&#39;Usage: ./this Stegano_PNG&#39;)
    sys.exit(2)

with open(sys.argv[1], &#39;rb&#39;) as f:
    buf = f.read()
    pos=0

    print(&#34;PNG Signature: &#34; + str(unpack(&#39;cccccccc&#39;, buf[pos:pos+8])))
    pos+=8

    chunks = []
    for i in range(3):
        chunks.append(getChunk(buf, pos))
        printChunk(buf, pos)
        pos+=unpack(&#39;!I&#39;,chunks[i][1])[0]+12


    decompressed = zlib.decompress(chunks[1][3])
    # Decompressed data length = height x (width * 3 + 1)
    print(&#34;Data length in PNG file : &#34;, len(chunks[1][3]))
    print(&#34;Decompressed data length: &#34;, len(decompressed))

    height = unpack(&#39;!I&#39;,(chunks[0][3][4:8]))[0]
    width = unpack(&#39;!I&#39;,(chunks[0][3][:4]))[0]
    blocksize = width * 3 + 1
    filterbits = &#39;&#39;
    for i in range(0,len(decompressed),blocksize):
        bit = unpack(&#39;2401c&#39;, decompressed[i:i+blocksize])[0]
        if bit == b&#39;\x00&#39;: filterbits+=&#39;0&#39;
        elif bit == b&#39;\x01&#39;: filterbits+=&#39;1&#39;
        else:
            print(&#39;Bit is not 0 or 1... Default is 0 - MAGIC!&#39;)
            sys.exit(3)

    s = filterbits
    endianess_filterbits = [filterbits[i:i+8][::-1] for i in range(0, len(filterbits), 8)]

    flag = &#39;&#39;
    for x in endianess_filterbits:
        if x==&#39;00000000&#39;: break
        flag += unhexlify(&#39;%x&#39; % int(&#39;0b&#39;+str(x), 2)).decode()

    print(&#39;Flag: &#39; + flag)
</code></pre><p>:::</p></li></ol><h3 id=exercise-5---change-palette>Exercise 5 - Change Palette
<a class=anchor href=#exercise-5---change-palette>#</a></h3><ol><li><p>Recon
First, I used <a href=https://aperisolve.fr/>online tool</a> to fetch some info but all of them are useless.
So, I used <code>stegsolve.jar</code> to analyze the figure, and something blurry appeared at the right of picture shown below
<img src=https://i.imgur.com/p3rSNzy.png alt>
<img src=https://i.imgur.com/jtwsvlp.png alt></p></li><li><p>Try to change palette
I found a useful code on <a href=https://stackoverflow.com/questions/1158736/changing-palettes-of-8-bit-png-images-using-python-pil/1214765#1214765>Stack Overflow</a>, and after some debugging, I can use it successfully. This program is aimed to allow us to write out 256 images, each one highlighting a single entry in white while blacking out the others:</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ for i in {0..255}; do ./change_palette.py doge_stege.png &#34;single-color-${i}.png&#34; &#34;${i}&#34;; done
</code></pre><p>:::info
At the first time using, you should uncomment line 32 and comment line 34 to find which page can be decrypted
:::
<img src=https://i.imgur.com/foDYV20.png alt>
You can observe that <code>single-color-127.png</code> has some strings that we met in <code>stegsolve.jar</code>, so that is the magic number that we can continue decrypting.</p></li><li><p>Continue changing palette</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ for i in {0..128}; do ./change_palette.py doge_stege.png &#34;range-color-127+${i}.png&#34; &#34;${i}&#34;; done
</code></pre><p>:::info
Note that you should uncomment line 34 and comment line 32 to decrypt it further.
:::
<img src=https://i.imgur.com/Qu62Q6l.png alt>
You can notice that most of the results have clearly flag strings in the pictures.
:::spoiler source code</p></li></ol><pre tabindex=0><code class="language-python=" data-lang="python=">#!/usr/bin/env python

import sys
import struct
from zlib import crc32
import os

# PNG file format signature
pngsig = b&#39;\x89PNG\r\n\x1a\n&#39;

def swap_palette(filename, n):
    # open in read+write mode
    with open(filename, &#39;r+b&#39;) as f:
        f.seek(0)
        # verify that we have a PNG file
        if f.read(len(pngsig)) != pngsig:
            raise RuntimeError(&#39;not a png file!&#39;)

        while True:
            chunkstr = f.read(8)
            if len(chunkstr) != 8:
                # end of file
                break

            # decode the chunk header
            length, chtype = struct.unpack(&#39;&gt;L4s&#39;, chunkstr)
            # we only care about palette chunks
            if chtype == b&#39;PLTE&#39;:
                curpos = f.tell()
                paldata = f.read(length)
                # replace palette entry n with white, the rest with black
                # paldata = (&#34;\x00\x00\x00&#34; * n) + &#34;\xff\xff\xff&#34; + (&#34;\x00\x00\x00&#34; * (256 - n - 1))
                # replace palette entry 127 to 127 + n with white, the rest with black
                paldata = (b&#34;\x00\x00\x00&#34; * 127) + (b&#34;\xff\xff\xff&#34;*n) + (b&#34;\x00\x00\x00&#34; * (256 - (127 + n)))

                # go back and write the modified palette in-place
                f.seek(curpos)
                f.write(paldata)
                f.write(struct.pack(&#39;&gt;L&#39;, crc32(chtype+paldata)&amp;0xffffffff))
            else:
                # skip over non-palette chunks
                f.seek(length+4, os.SEEK_CUR)

if __name__ == &#39;__main__&#39;:
    import shutil
    shutil.copyfile(sys.argv[1], sys.argv[2])
    swap_palette(sys.argv[2], int(sys.argv[3]))
</code></pre><p>:::</p><h3 id=exercise-6>Exercise 6
<a class=anchor href=#exercise-6>#</a></h3><p>TA&rsquo;s Hint: LSB and brute force</p><ol><li><p>Fetch LSB from Each Pixel</p><pre tabindex=0><code class=language-python! data-lang=python!>from PIL import Image

FLAG = &#34;&#34;
flag_image = Image.open(&#34;./Exercise 6 - bonas.png&#34;)
pixel = flag_image.getdata()

for i in pixel:
    FLAG += bin(i)[-1]
</code></pre></li><li><p>Observe the data type
After getting LSB from each pixel, you can observe the extension of this file from the beginning bytes</p><pre tabindex=0><code class=language-python! data-lang=python!>...
for i in range(4):
    print(chr(int(FLAG[i*8:(i+1)*8], 2)))
...
</code></pre><p>The output is: <code>Rar!</code></p></li><li><p>Transform a proper file
So, we can modify the file extension and store it in bytes.</p><pre tabindex=0><code class=language-python! data-lang=python!>...
output = open(&#34;./data.rar&#34;, &#34;wb&#34;)
for j in range(0, len(FLAG), 8):
    output.write(chr(int(FLAG[j:j+8], 2)).encode())
...
</code></pre></li><li><p>Brute force to decrypt it
However if we&rsquo;d like to unzip it, it needs 5 char password. So, I found a wordlist in <a href=https://www.bestwordlist.com/5letterwords.htm>this page</a> and try to unzip it.</p><pre tabindex=0><code class=language-python! data-lang=python!>...
import subprocess, re

password = open(&#34;password.txt&#34;, &#34;r&#34;).read().split(&#34; &#34;)
for passwd in password:
    # print(passwd)
    result = subprocess.getstatusoutput(&#34;unrar x data.rar - inul -p&#34; + passwd)
    if result[0] == 0:
        print(&#34;Sucess!! Password is {}&#34;.format(passwd))
        break
...
</code></pre></li><li><p>After Unzip it
You&rsquo;ll get a <code>flag.txt</code> and the flag is: <code>LSB_is_ubiquitous</code></p></li></ol><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><h3 id=exercise-decrypt_rsa>Exercise Decrypt_RSA
<a class=anchor href=#exercise-decrypt_rsa>#</a></h3><p><a href=https://superuser.com/questions/1644533/how-do-i-use-the-openssl-command-to-decode-a-public-key-pem-file>How do I use the openssl command to decode a public key .PEM file?</a></p><h3 id=exercise-4-1>Exercise 4
<a class=anchor href=#exercise-4-1>#</a></h3><p><a href=https://www.w3.org/TR/PNG-Filters.html>PNG (Portable Network Graphics) Specification</a>
<a href=https://github.com/ctfs/write-ups-2015/blob/master/confidence-ctf-teaser-2015/stegano/a-png-tale-200/README.md>CONFidence CTF Teaser A PNG Tale - Write Up</a>
<a href=https://xz.aliyun.com/t/1836>Misc 总结 &mdash;-隐写术之图片隐写(二）</a></p><h3 id=exercise-5>Exercise 5
<a class=anchor href=#exercise-5>#</a></h3><p><a href=https://github.com/ctfs/write-ups-2014/blob/master/plaid-ctf-2014/doge-stege/README.md>Plaid CTF 2014: doge_stege</a>
<a href=https://wiki.jyoken.net/ctf/lesson/%E7%AC%AC8%E5%9B%9E>doge_stege write up - 第8回資料</a>
<a href=https://kuanyuchen.gitbooks.io/python3-tutorial/content/er_jin_zhi_chu_li_fang_shi.html>二進制處理方式</a></p><h3 id=exercise-6-1>Exercise 6
<a class=anchor href=#exercise-6-1>#</a></h3><p><a href=https://whitesnake1004.tistory.com/352>Multimedia - 정말 커다란 이미지가 있습니다.</a>
<a href=https://liam.page/2017/08/06/pil-tutorial-pixel-operations-and-image-filter/>PIL Image.getdata() 教程</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#rsa-ctf>RSA CTF</a><ul><li><a href=#exercise---rsa>Exercise - RSA</a></li><li><a href=#exercise---decrypt_rsa>Exercise - Decrypt_RSA</a></li></ul></li><li><a href=#stego-ctf>Stego CTF</a><ul><li><a href=#exercise-1---zip-extension>Exercise 1 - <code>zip</code> Extension</a></li><li><a href=#exercise-2---foremost>Exercise 2 - Foremost</a></li><li><a href=#exercise-3---unzip-twice>Exercise 3 - Unzip twice</a></li><li><a href=#exercise-4>Exercise 4</a></li><li><a href=#exercise-5---change-palette>Exercise 5 - Change Palette</a></li><li><a href=#exercise-6>Exercise 6</a></li></ul></li><li><a href=#reference>Reference</a><ul><li><a href=#exercise-decrypt_rsa>Exercise Decrypt_RSA</a></li><li><a href=#exercise-4-1>Exercise 4</a></li><li><a href=#exercise-5>Exercise 5</a></li><li><a href=#exercise-6-1>Exercise 6</a></li></ul></li></ul></nav></div></aside></main></body></html>