<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  Simple Web 0x14(Lab - Debug)
  #


  tags: NTUSTWS CTF Web
  #

Challenge: http://h4ck3r.quest:9020/

  Background
  #


  Source code
  #

:::spoiler source code
from flask import Flask, request, Response
import urllib.request
import json

app = Flask(__name__)

app.config[&#39;FLAG&#39;] = "FL4G{fake_flag}"

@app.route(&#39;/&#39;)
def index():
    return &#39;&#39;&#39;
<form action="/proxy">
    <input type="text" name="url" placeholder="URL">
    <input type="submit">
</form>
<p><a href="/source">Source Code</a> | <a href="/debug">Debug</a></p>
&#39;&#39;&#39;

@app.route("/proxy")
def proxy():
    url = request.args.get("url")
    if url is None:
        return "No URL provided"
    if "https://" not in url:
        url = "https://" + url
    try:
        with urllib.request.urlopen(url) as response:
            return response.read()
    except urllib.error.HTTPError as e:
        return str(e)

@app.route("/debug")
def debug():
    # only allow access for localhost
    if request.remote_addr != "127.0.0.1":
        return "Access denied", 403
    return json.dumps(app.config, default=lambda _: None)

@app.route("/source")
def source():
    import re
    source_code = open(__file__).read()
    source_code = re.sub(r&#39;FLAG{.*}&#39;, r&#39;FL4G{fake_flag}&#39;, source_code, count=1)
    return Response(source_code, mimetype=&#39;text/plain&#39;)
:::'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/course/ntust-ws/ssrf/simple-web-0x14lab---debug/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Simple Web 0x14(Lab - Debug)"><meta property="og:description" content='Simple Web 0x14(Lab - Debug) # tags: NTUSTWS CTF Web # Challenge: http://h4ck3r.quest:9020/
Background # Source code # :::spoiler source code
from flask import Flask, request, Response import urllib.request import json app = Flask(__name__) app.config[&#39;FLAG&#39;] = "FL4G{fake_flag}" @app.route(&#39;/&#39;) def index(): return &#39;&#39;&#39; <form action="/proxy"> <input type="text" name="url" placeholder="URL"> <input type="submit"> </form> <p><a href="/source">Source Code</a> | <a href="/debug">Debug</a></p> &#39;&#39;&#39; @app.route("/proxy") def proxy(): url = request.args.get("url") if url is None: return "No URL provided" if "https://" not in url: url = "https://" + url try: with urllib.request.urlopen(url) as response: return response.read() except urllib.error.HTTPError as e: return str(e) @app.route("/debug") def debug(): # only allow access for localhost if request.remote_addr != "127.0.0.1": return "Access denied", 403 return json.dumps(app.config, default=lambda _: None) @app.route("/source") def source(): import re source_code = open(__file__).read() source_code = re.sub(r&#39;FLAG{.*}&#39;, r&#39;FL4G{fake_flag}&#39;, source_code, count=1) return Response(source_code, mimetype=&#39;text/plain&#39;) :::'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="NTUSTWS"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Web"><title>Simple Web 0x14(Lab - Debug) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/course/ntust-ws/ssrf/simple-web-0x14lab---debug/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Simple Web 0x14(Lab - Debug)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a><ul><li><a href=#analyze>Analyze</a></li></ul></li><li><a href=#exploit---ssrf>Exploit - SSRF</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=simple-web-0x14lab---debug>Simple Web 0x14(Lab - Debug)
<a class=anchor href=#simple-web-0x14lab---debug>#</a></h1><h6 id=tags-ntustws-ctf-web>tags: <code>NTUSTWS</code> <code>CTF</code> <code>Web</code>
<a class=anchor href=#tags-ntustws-ctf-web>#</a></h6><p>Challenge: <a href=http://h4ck3r.quest:9020/>http://h4ck3r.quest:9020/</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler source code</p><pre tabindex=0><code class="language-python=" data-lang="python=">from flask import Flask, request, Response
import urllib.request
import json

app = Flask(__name__)

app.config[&#39;FLAG&#39;] = &#34;FL4G{fake_flag}&#34;

@app.route(&#39;/&#39;)
def index():
    return &#39;&#39;&#39;
&lt;form action=&#34;/proxy&#34;&gt;
    &lt;input type=&#34;text&#34; name=&#34;url&#34; placeholder=&#34;URL&#34;&gt;
    &lt;input type=&#34;submit&#34;&gt;
&lt;/form&gt;
&lt;p&gt;&lt;a href=&#34;/source&#34;&gt;Source Code&lt;/a&gt; | &lt;a href=&#34;/debug&#34;&gt;Debug&lt;/a&gt;&lt;/p&gt;
&#39;&#39;&#39;

@app.route(&#34;/proxy&#34;)
def proxy():
    url = request.args.get(&#34;url&#34;)
    if url is None:
        return &#34;No URL provided&#34;
    if &#34;https://&#34; not in url:
        url = &#34;https://&#34; + url
    try:
        with urllib.request.urlopen(url) as response:
            return response.read()
    except urllib.error.HTTPError as e:
        return str(e)

@app.route(&#34;/debug&#34;)
def debug():
    # only allow access for localhost
    if request.remote_addr != &#34;127.0.0.1&#34;:
        return &#34;Access denied&#34;, 403
    return json.dumps(app.config, default=lambda _: None)

@app.route(&#34;/source&#34;)
def source():
    import re
    source_code = open(__file__).read()
    source_code = re.sub(r&#39;FLAG{.*}&#39;, r&#39;FL4G{fake_flag}&#39;, source_code, count=1)
    return Response(source_code, mimetype=&#39;text/plain&#39;)
</code></pre><p>:::</p><h3 id=analyze>Analyze
<a class=anchor href=#analyze>#</a></h3><ul><li><code>/index</code> page
It has a blank that can type arbitrary URL and it&rsquo;ll send to <code>/proxy</code> route page to verify.</li><li><code>/proxy</code> page
It&rsquo;ll add <code>https://</code> if the URL has no the string</li><li><font color=FF0000><code>/debug</code> page</font>
If the request URL is not <code>127.0.0.1</code> then it&rsquo;ll forbidden the request, otherwise, it&rsquo;ll print the configuration with json type
hint: it has loaded the flag in app configuration already, so we just tried to use <code>SSRF</code> to access to <code>/debug</code>.</li></ul><h2 id=exploit---ssrf>Exploit - SSRF
<a class=anchor href=#exploit---ssrf>#</a></h2><p>We need to bypass <code>https://</code> constraint and add in our URL like below.
Payload: <code>http://127.0.0.1/debug?https://</code></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a><ul><li><a href=#analyze>Analyze</a></li></ul></li><li><a href=#exploit---ssrf>Exploit - SSRF</a></li></ul></nav></div></aside></main></body></html>