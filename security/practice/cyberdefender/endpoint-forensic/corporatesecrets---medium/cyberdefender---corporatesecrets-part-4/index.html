<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  CyberDefender - CorporateSecrets (Part 4)
  #

Challenge: https://cyberdefenders.org/blueteam-ctf-challenges/33
Part 1: https://hackmd.io/@SBK6401/r18z7VIm6
Part 2: https://hackmd.io/@SBK6401/ByFhEE8X6
Part 3: https://hackmd.io/@SBK6401/HyHp4NLQT
:::spoiler TOC
[TOC]
:::

  Tools:
  #


FTK Imager
Registry Explorer
RegRipper
HxD
DB Browser for SQLite
HindSight
Event Log Explorer
MFTDump


  ==Q28==
  #


What cloud service was a Startup item for the user admin?

  Recon
  #

直接看admin的NTUSER.DAT中的./Software/Microsoft/Windows/CurrentVersion/Run就可以了

  Exploit
  #


:::spoiler Flag
Flag: OneDrive
:::

  ==Q29==
  #


Which Firefox prefetch file has the most runtimes?
(Flag format is )"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/cyberdefender/endpoint-forensic/corporatesecrets---medium/cyberdefender---corporatesecrets-part-4/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="CyberDefender - CorporateSecrets (Part 4)"><meta property="og:description" content="CyberDefender - CorporateSecrets (Part 4) # Challenge: https://cyberdefenders.org/blueteam-ctf-challenges/33 Part 1: https://hackmd.io/@SBK6401/r18z7VIm6 Part 2: https://hackmd.io/@SBK6401/ByFhEE8X6 Part 3: https://hackmd.io/@SBK6401/HyHp4NLQT
:::spoiler TOC [TOC] :::
Tools: # FTK Imager Registry Explorer RegRipper HxD DB Browser for SQLite HindSight Event Log Explorer MFTDump ==Q28== # What cloud service was a Startup item for the user admin?
Recon # 直接看admin的NTUSER.DAT中的./Software/Microsoft/Windows/CurrentVersion/Run就可以了
Exploit # :::spoiler Flag Flag: OneDrive :::
==Q29== # Which Firefox prefetch file has the most runtimes? (Flag format is )"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="CyberDefender"><meta property="article:tag" content="Endpoint Forensics"><title>CyberDefender - CorporateSecrets (Part 4) | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/cyberdefender/endpoint-forensic/corporatesecrets---medium/cyberdefender---corporatesecrets-part-4/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>CyberDefender - CorporateSecrets (Part 4)</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#tools>Tools:</a></li><li><a href=#q28>==Q28==</a><ul><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#q29>==Q29==</a><ul><li><a href=#exploit-1>Exploit</a></li></ul></li><li><a href=#q30>==Q30==</a><ul><li><a href=#exploit-2>Exploit</a></li></ul></li><li><a href=#q31>==Q31==</a><ul><li><a href=#recon-1>Recon</a></li><li><a href=#exploit-3>Exploit</a></li></ul></li><li><a href=#q32>==Q32==</a><ul><li><a href=#recon-2>Recon</a></li><li><a href=#exploit-4>Exploit</a></li></ul></li><li><a href=#q33>==Q33==</a><ul><li><a href=#recon-3>Recon</a></li><li><a href=#exploit-5>Exploit</a></li></ul></li><li><a href=#q34>==Q34==</a><ul><li><a href=#recon-4>Recon</a></li><li><a href=#exploit-6>Exploit</a></li></ul></li><li><a href=#q35>==Q35==</a><ul><li><a href=#recon-5>Recon</a></li><li><a href=#exploit-7>Exploit</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=cyberdefender---corporatesecrets-part-4>CyberDefender - CorporateSecrets (Part 4)
<a class=anchor href=#cyberdefender---corporatesecrets-part-4>#</a></h1><p>Challenge: <a href=https://cyberdefenders.org/blueteam-ctf-challenges/33>https://cyberdefenders.org/blueteam-ctf-challenges/33</a>
Part 1: <a href=https://hackmd.io/@SBK6401/r18z7VIm6>https://hackmd.io/@SBK6401/r18z7VIm6</a>
Part 2: <a href=https://hackmd.io/@SBK6401/ByFhEE8X6>https://hackmd.io/@SBK6401/ByFhEE8X6</a>
Part 3: <a href=https://hackmd.io/@SBK6401/HyHp4NLQT>https://hackmd.io/@SBK6401/HyHp4NLQT</a></p><p>:::spoiler TOC
[TOC]
:::</p><h2 id=tools>Tools:
<a class=anchor href=#tools>#</a></h2><ul><li>FTK Imager</li><li>Registry Explorer</li><li>RegRipper</li><li>HxD</li><li>DB Browser for SQLite</li><li>HindSight</li><li>Event Log Explorer</li><li>MFTDump</li></ul><h2 id=q28>==Q28==
<a class=anchor href=#q28>#</a></h2><blockquote><p>What cloud service was a Startup item for the user admin?</p></blockquote><h3 id=recon>Recon
<a class=anchor href=#recon>#</a></h3><p>直接看admin的NTUSER.DAT中的<code>./Software/Microsoft/Windows/CurrentVersion/Run</code>就可以了</p><h3 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h3><p><img src=https://hackmd.io/_uploads/BJodWuDmp.png alt=圖片.png></p><p>:::spoiler Flag
Flag: <code>OneDrive</code>
:::</p><h2 id=q29>==Q29==
<a class=anchor href=#q29>#</a></h2><blockquote><p>Which Firefox prefetch file has the most runtimes?
(Flag format is )</p></blockquote><h3 id=exploit-1>Exploit
<a class=anchor href=#exploit-1>#</a></h3><p>直接export出和firefox有關的prefetch file，再用PECmd去parse他就可以看到各個執行檔執行的次數</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ ./PECmd.exe -f FIREFOX\ INSTALLER.EXE-71BB164E.pf | grep &#34;Run count&#34;
Run count: 1
$ ./PECmd.exe -f FIREFOX.EXE-20153F0F.pf | grep &#34;Run count&#34;
Run count: 10
$ ./PECmd.exe -f FIREFOX.EXE-A606B53C.pf | grep &#34;Run count&#34;
Run count: 21
$ ./PECmd.exe -f FIREFOX.EXE-B4420372.pf | grep &#34;Run count&#34;
Run count: 4
$ ./PECmd.exe -f FIRSTLOGONANIM.EXE-674CDAB9.pf | grep &#34;Run count&#34;
Run count: 1
</code></pre><p>:::spoiler Flag
Flag: <code>FIREFOX.EXE-A606B53C.pf/21</code>
:::</p><h2 id=q30>==Q30==
<a class=anchor href=#q30>#</a></h2><blockquote><p>What was the last IP address the machine was connected to?</p></blockquote><h3 id=exploit-2>Exploit
<a class=anchor href=#exploit-2>#</a></h3><p>直接看<code>SYSTEM/ControlSet001/Services/Tcpip/Parameters/Interfaces/</code>
<img src=https://hackmd.io/_uploads/S18wduPQT.png alt=圖片.png></p><p>:::spoiler Flag
Flag: <code>192.168.2.242</code>
:::</p><h2 id=q31>==Q31==
<a class=anchor href=#q31>#</a></h2><blockquote><p>Which user had the most items pinned to their taskbar?</p></blockquote><h3 id=recon-1>Recon
<a class=anchor href=#recon-1>#</a></h3><p>這一題也是新的觀念，taskbar items會在<code>C:\Users\USERNAME\AppData\Roaming\Microsoft\Internet Explorer\Quick Launch\User Pinned\TaskBar</code></p><h3 id=exploit-3>Exploit
<a class=anchor href=#exploit-3>#</a></h3><ul><li>admin
<img src=https://hackmd.io/_uploads/Hk8oCKw76.png alt=圖片.png></li><li>jim.tomato
<img src=https://hackmd.io/_uploads/Hy4pRtwma.png alt=圖片.png></li><li>hansel.apricot
<img src=https://hackmd.io/_uploads/BkD-J9v7a.png alt=圖片.png></li><li>miriam.grapes
<img src=https://hackmd.io/_uploads/H1rQkcvm6.png alt=圖片.png></li><li>suzy.strawberry
<img src=https://hackmd.io/_uploads/Sk1SyqvmT.png alt=圖片.png></li></ul><p>:::spoiler Flag
Flag: <code>admin</code>
:::</p><h2 id=q32>==Q32==
<a class=anchor href=#q32>#</a></h2><blockquote><p>What was the last run date of the executable with an MFT record number of 164885?
(Format: MM/DD/YYYY HH:MM:SS (UTC).)</p></blockquote><h3 id=recon-2>Recon
<a class=anchor href=#recon-2>#</a></h3><p>直覺會看第26題用mftdump的結果，然後去看164885的offset address，再去看$MFT的timestamp，不過後來想想，$MFT的timestamp所記錄的是<code>Creat Time + Modified Time + $MFT Modified Time + Access Time</code>，並不是最後執行的timestamp，所以應該是去看是哪一個檔案，然後去看他的prefetch file</p><h3 id=exploit-4>Exploit
<a class=anchor href=#exploit-4>#</a></h3><ol><li>Record No. 164885 $\to$ 0x0a105400</li><li><code>7zG.exe</code>
<img src=https://hackmd.io/_uploads/Syb-8KD7a.png alt=圖片.png></li><li>Export Prefetch
<img src=https://hackmd.io/_uploads/SJgmLFvQp.png alt=圖片.png></li><li>Parse Prefetch File<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./PECmd.exe -f 7ZG.EXE-0F8C4081.pf | grep <span style=color:#e6db74>&#34;Last run&#34;</span>
</span></span><span style=display:flex><span>Last run: 2020-04-12 02:32:09
</span></span></code></pre></div></li></ol><p>:::spoiler Flag
Flag: <code>04/12/2020 02:32:09</code>
:::</p><h2 id=q33>==Q33==
<a class=anchor href=#q33>#</a></h2><blockquote><p>What is the log file sequence number for the file &ldquo;fruit_Assortment.jpg&rdquo;?</p></blockquote><h3 id=recon-3>Recon
<a class=anchor href=#recon-3>#</a></h3><p>這也是一個新觀念，log file sequence number就是在$MFT的magic header(FILE0)的後面(SO=8, LE=8)，並且倒著看再轉換成十進制就可以了，當然也可以直接用像<a href=https://ericzimmerman.github.io/#!index.md>MFTEcmd</a>這樣的parser</p><h3 id=exploit-5>Exploit
<a class=anchor href=#exploit-5>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt;&gt;&gt; num <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;60 BA 1A 4C 00 00 00 00&#39;</span>
</span></span><span style=display:flex><span>&gt;&gt;&gt; int<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;&#34;</span>.join<span style=color:#f92672>(</span>num.split<span style=color:#f92672>(</span><span style=color:#e6db74>&#39; &#39;</span><span style=color:#f92672>)[</span>::-1<span style=color:#f92672>])</span>, 16<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1276820064</span>
</span></span></code></pre></div><p>:::spoiler Flag
Flag: <code>1276820064</code>
:::</p><h2 id=q34>==Q34==
<a class=anchor href=#q34>#</a></h2><blockquote><p>Jim has some dirt on the company stored in a docx file. Find it, the flag is the fourth secret, in the format of &lt;&ldquo;The flag is a sentence you put in quotes&rdquo;>.
(Secrets, secrets are no fun)</p></blockquote><h3 id=recon-4>Recon
<a class=anchor href=#recon-4>#</a></h3><p>這一題很複雜，一開始想說是類似docx forensics的這種CTF類型，所以找了一下其他的.docx files</p><h3 id=exploit-6>Exploit
<a class=anchor href=#exploit-6>#</a></h3><ol><li>Search .docx Files
從recycle bin中可以看到Jim的SID(1003)有丟棄一些docx file的痕跡，直接把這些file export出來</li><li>一番操作之後都沒有甚麼結果，所以就參考<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>的作法，和<a href=https://hackmd.io/@SBK6401/H1w0vImC2>之前的經驗</a>，先把extension改成zip，然後解壓縮他</li><li>再把<code>./Document1/Content.xml</code>用Microsoft Word開啟，就可以看到主要的內容了，這神奇的操作也是第一次看到
<img src=https://hackmd.io/_uploads/SytYatPmT.png alt=圖片.png></li></ol><p>:::spoiler Flag
Flag: <code>Customer data is not stored securely</code>
:::</p><h2 id=q35>==Q35==
<a class=anchor href=#q35>#</a></h2><blockquote><p>In the company Slack, what is threatened to be deactivated if the user gets their email deactivated?</p></blockquote><h3 id=recon-5>Recon
<a class=anchor href=#recon-5>#</a></h3><h3 id=exploit-7>Exploit
<a class=anchor href=#exploit-7>#</a></h3><p>我覺得<sup id=fnref1:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>解法比較有效率，不然慢慢找真的會瘋掉</p><ol><li>先找到有誰使用slack這套軟體，因為之前在寫前面的東西的時候就翻到了，所以可以參考就好<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ find . -type d -name <span style=color:#e6db74>&#39;Slack&#39;</span>
</span></span><span style=display:flex><span>./Users/hansel.apricot/AppData/Roaming/Slack
</span></span></code></pre></div></li><li>接著看有沒有和題目相關的字眼<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ grep -r -i <span style=color:#e6db74>&#39;deactivate&#39;</span> ./Users/hansel.apricot/AppData/Roaming/Slack &gt; grep_deactivate.txt
</span></span></code></pre></div></li><li>看哪一個file有和<code>deactivate</code>有關係，前面一大段是Cache就不用理他
<img src=https://hackmd.io/_uploads/Hyr_PqvQ6.png alt=圖片.png>
可以看到應該是<code>./Users/hansel.apricot/AppData/Roaming/Slack/IndexedDB/https_app.slack.com_0.indexeddb.leveldb/000003.log matches</code>比較符合</li><li>直接strings search<pre tabindex=0><code class=language-bash! data-lang=bash!>$ strings ./Users/hansel.apricot/AppData/Roaming/Slack/IndexedDB/https_app.slack.com_0.indexeddb.leveldb/000003.lo
g | grep text &gt; log_dump.txt
</code></pre></li><li>仔細看其中的內容，看來看去<code>kneecaps</code>應該就是答案，但我不確定這一題到底在幹嘛，或者說出題意義不明<pre tabindex=0><code>text&#34;5And so do your kneecaps, well, as much as they do now{
</code></pre></li></ol><p>:::spoiler Flag
Flag: <code>kneecaps</code>
:::</p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://forensicskween.com/ctf/cyberdefenders/corporatesecrets/>CyberDefenders: CorporateSecrets</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#tools>Tools:</a></li><li><a href=#q28>==Q28==</a><ul><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#q29>==Q29==</a><ul><li><a href=#exploit-1>Exploit</a></li></ul></li><li><a href=#q30>==Q30==</a><ul><li><a href=#exploit-2>Exploit</a></li></ul></li><li><a href=#q31>==Q31==</a><ul><li><a href=#recon-1>Recon</a></li><li><a href=#exploit-3>Exploit</a></li></ul></li><li><a href=#q32>==Q32==</a><ul><li><a href=#recon-2>Recon</a></li><li><a href=#exploit-4>Exploit</a></li></ul></li><li><a href=#q33>==Q33==</a><ul><li><a href=#recon-3>Recon</a></li><li><a href=#exploit-5>Exploit</a></li></ul></li><li><a href=#q34>==Q34==</a><ul><li><a href=#recon-4>Recon</a></li><li><a href=#exploit-6>Exploit</a></li></ul></li><li><a href=#q35>==Q35==</a><ul><li><a href=#recon-5>Recon</a></li><li><a href=#exploit-7>Exploit</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>