<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  CyberDefender - PoisonedCredentials
  #

Challenge: https://cyberdefenders.org/blueteam-ctf-challenges/146#nav-questions
:::spoiler TOC
[TOC]
:::

  Scenario
  #


Your organization&rsquo;s security team has detected a surge in suspicious network activity. There are concerns that LLMNR (Link-Local Multicast Name Resolution) and NBT-NS (NetBIOS Name Service) poisoning attacks may be occurring within your network. These attacks are known for exploiting these protocols to intercept network traffic and potentially compromise user credentials. Your task is to investigate the network logs and examine captured network traffic."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/cyberdefender/network-forensic/cyberdefender---poisonedcredentials/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="CyberDefender - PoisonedCredentials"><meta property="og:description" content="CyberDefender - PoisonedCredentials # Challenge: https://cyberdefenders.org/blueteam-ctf-challenges/146#nav-questions
:::spoiler TOC [TOC] :::
Scenario # Your organization’s security team has detected a surge in suspicious network activity. There are concerns that LLMNR (Link-Local Multicast Name Resolution) and NBT-NS (NetBIOS Name Service) poisoning attacks may be occurring within your network. These attacks are known for exploiting these protocols to intercept network traffic and potentially compromise user credentials. Your task is to investigate the network logs and examine captured network traffic."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="CyberDefender"><meta property="article:tag" content="Network Forensics"><title>CyberDefender - PoisonedCredentials | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/cyberdefender/network-forensic/cyberdefender---poisonedcredentials/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>CyberDefender - PoisonedCredentials</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#scenario>Scenario</a></li><li><a href=#background>Background</a><ul><li><a href=#功能>功能</a></li></ul></li><li><a href=#q1>==Q1==</a><ul><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#q2>==Q2==</a><ul><li><a href=#recon-1>Recon</a></li><li><a href=#exploit-1>Exploit</a></li></ul></li><li><a href=#q3>==Q3==</a><ul><li><a href=#exploit-2>Exploit</a></li></ul></li><li><a href=#q4>==Q4==</a><ul><li><a href=#recon-2>Recon</a></li><li><a href=#exploit-3>Exploit</a></li></ul></li><li><a href=#q5>==Q5==</a><ul><li><a href=#exploit-4>Exploit</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=cyberdefender---poisonedcredentials>CyberDefender - PoisonedCredentials
<a class=anchor href=#cyberdefender---poisonedcredentials>#</a></h1><p>Challenge: <a href=https://cyberdefenders.org/blueteam-ctf-challenges/146#nav-questions>https://cyberdefenders.org/blueteam-ctf-challenges/146#nav-questions</a></p><p>:::spoiler TOC
[TOC]
:::</p><h2 id=scenario>Scenario
<a class=anchor href=#scenario>#</a></h2><blockquote><p>Your organization&rsquo;s security team has detected a surge in suspicious network activity. There are concerns that LLMNR (Link-Local Multicast Name Resolution) and NBT-NS (NetBIOS Name Service) poisoning attacks may be occurring within your network. These attacks are known for exploiting these protocols to intercept network traffic and potentially compromise user credentials. Your task is to investigate the network logs and examine captured network traffic.</p></blockquote><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><ul><li><a href="https://youtu.be/s2YIU2w9T9Q?si=ZCj8xuSR6Jp_7WTW">NetBIOS and LLMNR Poisoning | Attack Demonstration</a></li><li><a href=https://netpc.pixnet.net/blog/post/12409336>本機多點傳送名稱解析 (LLMNR)</a><blockquote><p>同時允許 IPv6 和 IPv4 主機為鄰接電腦執行名稱解析，而不需設定 DNS 伺服器或 DNS 用戶端。</p><p>也就是，這是在LAN才會出現的，例如:嘗試使用WakeOnLan的時候，故若你沒有提出此要求，而發現有此封包在攻擊你的電腦時，它肯定就是病毒啦!!</p></blockquote></li><li><a href=https://www.jendow.com.tw/wiki/NBNS>NetBIOS & NBNS</a><blockquote><h3 id=功能>功能
<a class=anchor href=#%e5%8a%9f%e8%83%bd>#</a></h3><p>不管使用哪一種傳輸方式，NetBIOS提供三種不同的服務：</p><ol><li>名字服務：名字登記和解析</li><li>會話服務：可靠的基於連線的通信</li><li>數據包服務：不可靠的無連線通信</li></ol><p>當NetBIOS是數據鏈路層協定時，可以通過5Ch中斷訪問其功能。傳遞給這些函式的訊息使用NCB格式。
NetBIOS和NetBEUI被設計為僅僅用於區域網路，因此不支持路由，並且最多只能處理72個節點或者設備。NetBIOS和NetBEUI經常使用廣播實現，尤其是名字服務的相關操作。</p></blockquote></li></ul><h2 id=q1>==Q1==
<a class=anchor href=#q1>#</a></h2><blockquote><p>In the context of the incident described in the scenario, the attacker initiated their actions by taking advantage of benign network traffic from legitimate machines. Can you identify the specific mistyped query made by the machine with the IP address 192.168.232.162?</p></blockquote><h3 id=recon>Recon
<a class=anchor href=#recon>#</a></h3><p>從scenario和題目敘述可以知道幾件事情</p><ol><li>部門遭受LLMNT和NBT-NS poisoning attack，所以重點應該著重在llmnr / nbns這兩個protocol上</li><li>Victim應該是192.168.232.162</li></ol><h3 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h3><p>Filter Payload: <code>nbns and ip.addr == 192.168.232.162</code>
<img src=https://hackmd.io/_uploads/H1APnx4Ip.png alt=image></p><p>:::spoiler Flag
Flag: <code>fileshaare</code>
:::</p><h2 id=q2>==Q2==
<a class=anchor href=#q2>#</a></h2><blockquote><p>We are investigating a network security incident. For a thorough investigation, we need to determine the IP address of the rogue machine. What is the IP address of the machine acting as the rogue entity?</p></blockquote><h3 id=recon-1>Recon
<a class=anchor href=#recon-1>#</a></h3><p>從前一題可以知道，192.168.232.162是一個victim，所以我們的目標應該是去看誰和他溝通，不管是傳送payload / 檔案等等，就可以確定攻擊的人是誰</p><h3 id=exploit-1>Exploit
<a class=anchor href=#exploit-1>#</a></h3><p>可以直接看wireshark的conversation，就知道唯一和他連線溝通的，只有==192.168.232.215==
<img src=https://hackmd.io/_uploads/rywJRbN8T.png alt=image></p><p>:::spoiler Flag
Flag: <code>192.168.232.215</code>
:::</p><h2 id=q3>==Q3==
<a class=anchor href=#q3>#</a></h2><blockquote><p>During our investigation, it&rsquo;s crucial to identify all affected machines. What is the IP address of the second machine that received poisoned responses from the rogue machine?</p></blockquote><h3 id=exploit-2>Exploit
<a class=anchor href=#exploit-2>#</a></h3><p>和上一題相關，如果是想要直接看誰和attacker連線就直接看conversation最快</p><p>:::spoiler Flag
Flag: <code>192.168.232.176</code>
:::</p><h2 id=q4>==Q4==
<a class=anchor href=#q4>#</a></h2><blockquote><p>We suspect that user accounts may have been compromised. To assess this, we must determine the username associated with the compromised account. What is the username of the account that the attacker compromised?</p></blockquote><h3 id=recon-2>Recon
<a class=anchor href=#recon-2>#</a></h3><p>從題目可以知道，受害者是前一題的==192.168.232.176==，而attacker是==192.168.232.215==，另外兩者溝通的管道通常是smb</p><h3 id=exploit-3>Exploit
<a class=anchor href=#exploit-3>#</a></h3><p>Filter Payload: <code>smb2 and ip.src==192.168.232.215 and ip.dst==192.168.232.176</code>
<img src=https://hackmd.io/_uploads/S17LNzEI6.png alt=image></p><p>:::spoiler Flag
Flag: <code>janesmith</code>
:::</p><h2 id=q5>==Q5==
<a class=anchor href=#q5>#</a></h2><blockquote><p>As part of our investigation, we aim to understand the extent of the attacker&rsquo;s activities. What is the hostname of the machine that the attacker accessed via SMB?</p></blockquote><h3 id=exploit-4>Exploit
<a class=anchor href=#exploit-4>#</a></h3><p>這一題是看<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>的說明，有一個ntlm challenge的error，進去看會發現NetBIOS Computer
Filter Payload: <code>(ip.addr == 192.168.232.162 or ip.addr == 192.168.232.176 or ip.addr == 192.168.232.215) and (smb2)</code>
<img src=https://hackmd.io/_uploads/SJUFGQV8p.png alt=image></p><p>:::spoiler Flag
Flag: <code>accountingpc</code>
:::</p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://medium.com/@anas.hey/poisonedcredentials-cyberdefenders-7b62dfeb1205>PoisonedCredentials-CyberDefenders</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#scenario>Scenario</a></li><li><a href=#background>Background</a><ul><li><a href=#功能>功能</a></li></ul></li><li><a href=#q1>==Q1==</a><ul><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#q2>==Q2==</a><ul><li><a href=#recon-1>Recon</a></li><li><a href=#exploit-1>Exploit</a></li></ul></li><li><a href=#q3>==Q3==</a><ul><li><a href=#exploit-2>Exploit</a></li></ul></li><li><a href=#q4>==Q4==</a><ul><li><a href=#recon-2>Recon</a></li><li><a href=#exploit-3>Exploit</a></li></ul></li><li><a href=#q5>==Q5==</a><ul><li><a href=#exploit-4>Exploit</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>