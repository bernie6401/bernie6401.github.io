<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  PicoCTF - OTP Implementation
  #


  Source code
  #

:::spoiler IDA Main Function
int __cdecl main(int argc, const char **argv, const char **envp)
{
  char v4; // al
  char v5; // dl
  unsigned int v6; // eax
  int i; // [rsp+18h] [rbp-E8h]
  int j; // [rsp+1Ch] [rbp-E4h]
  char input_key[112]; // [rsp+20h] [rbp-E0h] BYREF
  char tmp_key[104]; // [rsp+90h] [rbp-70h] BYREF
  unsigned __int64 v11; // [rsp+F8h] [rbp-8h]

  v11 = __readfsqword(0x28u);
  if ( argc > 1 )
  {
    strncpy(input_key, argv[1], 0x64uLL);
    input_key[100] = 0;
    for ( i = 0; valid_char(input_key[i]); ++i )// 確認字元是否在[0-9|a-f]之間
    {
      if ( i )
      {
        v4 = jumble(input_key[i]);
        v5 = tmp_key[i - 1] + v4;
        v6 = ((tmp_key[i - 1] + v4) >> 31) >> 28;
        tmp_key[i] = ((v6 + v5) & 0xF) - v6;
      }
      else
      {
        tmp_key[0] = jumble(input_key[0]) % 16;
      }
    }
    for ( j = 0; j < i; ++j )
      tmp_key[j] += 0x61;
    if ( i == 100
      && !strncmp(
            tmp_key,
            "bajbgfapbcclgoejgpakmdilalpomfdlkngkhaljlcpkjgndlgmpdgmnmepfikanepopbapfkdgleilhkfgilgabldofbcaedgfe",
            100uLL) )
    {
      puts("You got the key, congrats! Now xor it with the flag!");
      return 0;
    }
    else
    {
      puts("Invalid key!");
      return 1;
    }
  }
  else
  {
    printf("USAGE: %s [KEY]\n", *argv);
    return 1;
  }
}
:::'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/picoctf/reverse/picoctf---otp-implementation/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="PicoCTF - OTP Implementation"><meta property="og:description" content='PicoCTF - OTP Implementation # Source code # :::spoiler IDA Main Function
int __cdecl main(int argc, const char **argv, const char **envp) { char v4; // al char v5; // dl unsigned int v6; // eax int i; // [rsp+18h] [rbp-E8h] int j; // [rsp+1Ch] [rbp-E4h] char input_key[112]; // [rsp+20h] [rbp-E0h] BYREF char tmp_key[104]; // [rsp+90h] [rbp-70h] BYREF unsigned __int64 v11; // [rsp+F8h] [rbp-8h] v11 = __readfsqword(0x28u); if ( argc > 1 ) { strncpy(input_key, argv[1], 0x64uLL); input_key[100] = 0; for ( i = 0; valid_char(input_key[i]); ++i )// 確認字元是否在[0-9|a-f]之間 { if ( i ) { v4 = jumble(input_key[i]); v5 = tmp_key[i - 1] + v4; v6 = ((tmp_key[i - 1] + v4) >> 31) >> 28; tmp_key[i] = ((v6 + v5) & 0xF) - v6; } else { tmp_key[0] = jumble(input_key[0]) % 16; } } for ( j = 0; j < i; ++j ) tmp_key[j] += 0x61; if ( i == 100 && !strncmp( tmp_key, "bajbgfapbcclgoejgpakmdilalpomfdlkngkhaljlcpkjgndlgmpdgmnmepfikanepopbapfkdgleilhkfgilgabldofbcaedgfe", 100uLL) ) { puts("You got the key, congrats! Now xor it with the flag!"); return 0; } else { puts("Invalid key!"); return 1; } } else { printf("USAGE: %s [KEY]\n", *argv); return 1; } } :::'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="PicoCTF"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Reverse"><title>PicoCTF - OTP Implementation | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/picoctf/reverse/picoctf---otp-implementation/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>PicoCTF - OTP Implementation</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=picoctf---otp-implementation>PicoCTF - OTP Implementation
<a class=anchor href=#picoctf---otp-implementation>#</a></h1><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler IDA Main Function</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#66d9ef>__cdecl</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>envp)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>char</span> v4; <span style=color:#75715e>// al
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> v5; <span style=color:#75715e>// dl
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> v6; <span style=color:#75715e>// eax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>int</span> i; <span style=color:#75715e>// [rsp+18h] [rbp-E8h]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>int</span> j; <span style=color:#75715e>// [rsp+1Ch] [rbp-E4h]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> input_key[<span style=color:#ae81ff>112</span>]; <span style=color:#75715e>// [rsp+20h] [rbp-E0h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> tmp_key[<span style=color:#ae81ff>104</span>]; <span style=color:#75715e>// [rsp+90h] [rbp-70h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>__int64</span> v11; <span style=color:#75715e>// [rsp+F8h] [rbp-8h]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  v11 <span style=color:#f92672>=</span> __readfsqword(<span style=color:#ae81ff>0x28u</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( argc <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    strncpy(input_key, argv[<span style=color:#ae81ff>1</span>], <span style=color:#ae81ff>0x64uLL</span>);
</span></span><span style=display:flex><span>    input_key[<span style=color:#ae81ff>100</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> ( i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; valid_char(input_key[i]); <span style=color:#f92672>++</span>i )<span style=color:#75715e>// 確認字元是否在[0-9|a-f]之間
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> ( i )
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        v4 <span style=color:#f92672>=</span> jumble(input_key[i]);
</span></span><span style=display:flex><span>        v5 <span style=color:#f92672>=</span> tmp_key[i <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> v4;
</span></span><span style=display:flex><span>        v6 <span style=color:#f92672>=</span> ((tmp_key[i <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> v4) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>31</span>) <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>28</span>;
</span></span><span style=display:flex><span>        tmp_key[i] <span style=color:#f92672>=</span> ((v6 <span style=color:#f92672>+</span> v5) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xF</span>) <span style=color:#f92672>-</span> v6;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        tmp_key[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> jumble(input_key[<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>%</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> ( j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; j <span style=color:#f92672>&lt;</span> i; <span style=color:#f92672>++</span>j )
</span></span><span style=display:flex><span>      tmp_key[j] <span style=color:#f92672>+=</span> <span style=color:#ae81ff>0x61</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ( i <span style=color:#f92672>==</span> <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>strncmp(
</span></span><span style=display:flex><span>            tmp_key,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;bajbgfapbcclgoejgpakmdilalpomfdlkngkhaljlcpkjgndlgmpdgmnmepfikanepopbapfkdgleilhkfgilgabldofbcaedgfe&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>100uLL</span>) )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      puts(<span style=color:#e6db74>&#34;You got the key, congrats! Now xor it with the flag!&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      puts(<span style=color:#e6db74>&#34;Invalid key!&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    printf(<span style=color:#e6db74>&#34;USAGE: %s [KEY]</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#f92672>*</span>argv);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>:::</p><p>:::spoiler IDA Jumble Function</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>__int64</span> <span style=color:#66d9ef>__fastcall</span> <span style=color:#a6e22e>jumble</span>(<span style=color:#66d9ef>char</span> input_key_char)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>char</span> v2; <span style=color:#75715e>// [rsp+0h] [rbp-4h]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> v3; <span style=color:#75715e>// [rsp+0h] [rbp-4h]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  v2 <span style=color:#f92672>=</span> input_key_char;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( input_key_char <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0x60</span> )
</span></span><span style=display:flex><span>    v2 <span style=color:#f92672>=</span> input_key_char <span style=color:#f92672>+</span> <span style=color:#ae81ff>9</span>;
</span></span><span style=display:flex><span>  v3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> (v2 <span style=color:#f92672>%</span> <span style=color:#ae81ff>16</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( v3 <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>15</span> )
</span></span><span style=display:flex><span>    <span style=color:#f92672>++</span>v3;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> v3;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>:::
:::spoiler IDA Valid Function</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>_BOOL8 <span style=color:#66d9ef>__fastcall</span> <span style=color:#a6e22e>valid_char</span>(<span style=color:#66d9ef>char</span> a1)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( a1 <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0x2F</span> <span style=color:#f92672>&amp;&amp;</span> a1 <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0x39</span> )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1LL</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> a1 <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0x60</span> <span style=color:#f92672>&amp;&amp;</span> a1 <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0x66</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>:::</p><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>這一題頗難，我寫的script也沒有很好，readability頗低，但我就爛，懶得優化了</p><ol><li><p>這一題簡單來說就是把我們輸入的key做一些操作，然後把它和<code>bajbgfa...</code>做比較，如果對了我們就可以直接和他提供的flag進行xor，然後轉換成ASCII</p></li><li><p>有幾個重點，首先透過valid_char function可以知道我們輸入的key一定介於[0-9a-f]之間(這是個伏筆，因為他最後會直接和他提供的ciphertext進行xor，所以其實就是hex字元)</p></li><li><p>接著可以從後面推回來，第一個flag做了一些操作，之後就直接加上0x61，再和<code>bajbgfa...</code>做比較，所以我們先減回去
:::spoiler tmp_key
<code>[1, 0, 9, 1, 6, 5, 0, 15, 1, 2, 2, 11, 6, 14, 4, 9, 6, 15, 0, 10, 12, 3, 8, 11, 0, 11, 15, 14, 12, 5, 3, 11, 10, 13, 6, 10, 7, 0, 11, 9, 11, 2, 15, 10, 9, 6, 13, 3, 11, 6, 12, 15, 3, 6, 12, 13, 12, 4, 15, 5, 8, 10, 0, 13, 4, 15, 14, 15, 1, 0, 15, 5, 10, 3, 6, 11, 4, 8, 11, 7, 10, 5, 6, 8, 11, 6, 0, 1, 11, 3, 14, 5, 1, 2, 0, 4, 3, 6, 5, 4]</code>
:::</p></li><li><p>接著我們分析jumble function在幹嘛，簡單來說，如果傳入的是</p><ul><li>&lsquo;0&rsquo;-&lsquo;9&rsquo;$\to$return 0 2 4 6 8 10 12 14 17 19</li><li>&lsquo;a&rsquo;-&lsquo;f&rsquo;$\to$return 21 23 25 27 29 31</li></ul></li><li><p>跟著if statement走<code>tmp_key[0] = jumble(input_key[0]) % 16;</code>
我們知道<code>tmp_key[0]=0x1</code>(因為key的第一個字元是<code>b</code>$\to$<code>0x62</code>，減掉<code>0x61=0x1</code>)，所以仔細推敲jumble(input_key[0])的return value是<code>0 2 4 6 8 10 12 14 1 3 5 7 9 11 13 15</code>(對應到的是[0-9a-f])，所以代表0x1在經過mod運算是0x11(要+16)，而正確的key就是對應到的8</p></li><li><p>接著換下一個字元，先破哏，if statement裡面的v6基本上是零，畢竟右移那麼多次，也不知道作者設計這個有甚麼用，可能是混淆逆向的?!但反正</p><pre tabindex=0><code>v4 -&gt; jumble(tmp_key[i-1])([0 2 4 6 8 10 12 14 , .... , 31])
v5 -&gt; [0-15]+v4
v6 -&gt; v5 &gt;&gt; 59 (基本上是0)
tmp_key[i] = v5 &amp; 0xf
</code></pre><p>可以看到tmp_key[i]是v5和0xf做and operation，意思是他只會保留一個byte的後四個bits，跟一下gdb會發現前四bits，有可能存在，所以我們可以透過v5-v4是正還是負判斷前四bits有沒有數值，舉個例子，tmp_key[1]是0，而要判斷v5是0x0還是0x10可以透過減掉tmp_key[0]=1來決定，當結果是負的，就要加0x10，所以v5是0x10，v4是0xf，此時會發現沒有相對應的數值可以轉換，因為jumble function的return value並不包含0xf，所以我們要再加上0x10=0x1f，因為其實v5真正的數值是0x20才對，有了v4=31，就可以知道key[1]=&lsquo;f&rsquo;</p></li><li><p>就這樣不斷做下去，就能拿到key了，開寫script</p></li></ol><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>enc_key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;bajbgfapbcclgoejgpakmdilalpomfdlkngkhaljlcpkjgndlgmpdgmnmepfikanepopbapfkdgleilhkfgilgabldofbcaedgfe&#34;</span>
</span></span><span style=display:flex><span>enc_key_1 <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>jumble_table <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0</span>:{<span style=color:#e6db74>&#39;0&#39;</span>:<span style=color:#e6db74>&#39;0&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>2</span>:{<span style=color:#e6db74>&#39;2&#39;</span>:<span style=color:#e6db74>&#39;1&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>4</span>:{<span style=color:#e6db74>&#39;4&#39;</span>:<span style=color:#e6db74>&#39;2&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>6</span>:{<span style=color:#e6db74>&#39;6&#39;</span>:<span style=color:#e6db74>&#39;3&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>8</span>:{<span style=color:#e6db74>&#39;8&#39;</span>:<span style=color:#e6db74>&#39;4&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>10</span>:{<span style=color:#e6db74>&#39;10&#39;</span>:<span style=color:#e6db74>&#39;5&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>12</span>:{<span style=color:#e6db74>&#39;12&#39;</span>:<span style=color:#e6db74>&#39;6&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>14</span>:{<span style=color:#e6db74>&#39;14&#39;</span>:<span style=color:#e6db74>&#39;7&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>1</span>:{<span style=color:#e6db74>&#39;17&#39;</span>:<span style=color:#e6db74>&#39;8&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>3</span>:{<span style=color:#e6db74>&#39;19&#39;</span>:<span style=color:#e6db74>&#39;9&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>5</span>:{<span style=color:#e6db74>&#39;21&#39;</span>:<span style=color:#e6db74>&#39;a&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>7</span>:{<span style=color:#e6db74>&#39;23&#39;</span>:<span style=color:#e6db74>&#39;b&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>9</span>:{<span style=color:#e6db74>&#39;25&#39;</span>:<span style=color:#e6db74>&#39;c&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>11</span>:{<span style=color:#e6db74>&#39;27&#39;</span>:<span style=color:#e6db74>&#39;d&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>13</span>:{<span style=color:#e6db74>&#39;29&#39;</span>:<span style=color:#e6db74>&#39;e&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>15</span>:{<span style=color:#e6db74>&#39;31&#39;</span>:<span style=color:#e6db74>&#39;f&#39;</span>},
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>FLAG<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_flag</span>(str_1):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> str_1 <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> jumble_table[str_1][str(str_1)]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> jumble_table[str_1][str(str_1 <span style=color:#f92672>+</span> <span style=color:#ae81ff>16</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i, single_chr <span style=color:#f92672>in</span> enumerate(enc_key):
</span></span><span style=display:flex><span>    enc_key_1<span style=color:#f92672>.</span>append(ord(single_chr) <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x61</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        FLAG <span style=color:#f92672>+=</span> get_flag(enc_key_1[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        tmp <span style=color:#f92672>=</span> enc_key_1[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>-</span> enc_key_1[<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> tmp <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            tmp <span style=color:#f92672>+=</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>        FLAG <span style=color:#f92672>+=</span> get_flag(tmp)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cipher_text <span style=color:#f92672>=</span> open(<span style=color:#e6db74>&#34;./flag.txt&#34;</span>, <span style=color:#e6db74>&#34;r&#34;</span>)<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>xor_tmp <span style=color:#f92672>=</span> int(cipher_text, <span style=color:#ae81ff>16</span>) <span style=color:#f92672>^</span> int(FLAG, <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>print(bytes<span style=color:#f92672>.</span>fromhex(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{:x}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(xor_tmp))<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>))
</span></span></code></pre></div><p>Flag: <code>picoCTF{cust0m_jumbl3s_4r3nt_4_g0Od_1d3A_42dad069}</code></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></nav></div></aside></main></body></html>