<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  PicoCTF - Easy as GDB
  #


  Source code
  #

:::spoiler IDA Main Function
int __cdecl main(int argc, const char **argv, const char **envp)
{
  char *str_len; // eax
  int v5; // [esp-8h] [ebp-20h]
  int v6; // [esp-4h] [ebp-1Ch]
  char *input_flag; // [esp+4h] [ebp-14h]
  size_t str_len_1; // [esp+8h] [ebp-10h]
  char *src; // [esp+Ch] [ebp-Ch]

  input_flag = calloc(0x200u, 1u);
  printf("input the flag: ");
  fgets(input_flag, 512, stdin);
  str_len = strnlen(aZNh, 512, v5, v6);
  src = enc_input(str_len, str_len);
  sub_7C2(src, 1, 1);
  if ( check_flag(src, str_len_1) == 1 )
    puts("Correct!");
  else
    puts("Incorrect.");
  return 0;
}
:::'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/picoctf/reverse/picoctf---easy-as-gdb/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="PicoCTF - Easy as GDB"><meta property="og:description" content='PicoCTF - Easy as GDB # Source code # :::spoiler IDA Main Function
int __cdecl main(int argc, const char **argv, const char **envp) { char *str_len; // eax int v5; // [esp-8h] [ebp-20h] int v6; // [esp-4h] [ebp-1Ch] char *input_flag; // [esp+4h] [ebp-14h] size_t str_len_1; // [esp+8h] [ebp-10h] char *src; // [esp+Ch] [ebp-Ch] input_flag = calloc(0x200u, 1u); printf("input the flag: "); fgets(input_flag, 512, stdin); str_len = strnlen(aZNh, 512, v5, v6); src = enc_input(str_len, str_len); sub_7C2(src, 1, 1); if ( check_flag(src, str_len_1) == 1 ) puts("Correct!"); else puts("Incorrect."); return 0; } :::'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="PicoCTF"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Reverse"><title>PicoCTF - Easy as GDB | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/picoctf/reverse/picoctf---easy-as-gdb/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>PicoCTF - Easy as GDB</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=picoctf---easy-as-gdb>PicoCTF - Easy as GDB
<a class=anchor href=#picoctf---easy-as-gdb>#</a></h1><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler IDA Main Function</p><pre tabindex=0><code class="language-cpp=" data-lang="cpp=">int __cdecl main(int argc, const char **argv, const char **envp)
{
  char *str_len; // eax
  int v5; // [esp-8h] [ebp-20h]
  int v6; // [esp-4h] [ebp-1Ch]
  char *input_flag; // [esp+4h] [ebp-14h]
  size_t str_len_1; // [esp+8h] [ebp-10h]
  char *src; // [esp+Ch] [ebp-Ch]

  input_flag = calloc(0x200u, 1u);
  printf(&#34;input the flag: &#34;);
  fgets(input_flag, 512, stdin);
  str_len = strnlen(aZNh, 512, v5, v6);
  src = enc_input(str_len, str_len);
  sub_7C2(src, 1, 1);
  if ( check_flag(src, str_len_1) == 1 )
    puts(&#34;Correct!&#34;);
  else
    puts(&#34;Incorrect.&#34;);
  return 0;
}
</code></pre><p>:::</p><p>:::spoiler IDA Main Encryption Part</p><pre tabindex=0><code class="language-cpp=" data-lang="cpp=">char *__cdecl sub_82B(char *src, size_t enc_flag_len)
{
  unsigned int i; // [esp+0h] [ebp-18h]
  char *dest; // [esp+Ch] [ebp-Ch]
  size_t enc_flag_len_and; // [esp+24h] [ebp+Ch]

  enc_flag_len_and = (enc_flag_len &amp; 0xFFFFFFFC) + 4;
  dest = malloc(enc_flag_len_and + 1);
  strncpy(dest, src, enc_flag_len_and);
  for ( i = 0xABCF00D; i &lt; 0xDEADBEEF; i += 0x1FAB4D )
    main_enc_part(dest, enc_flag_len_and, i);
  return dest;
}
</code></pre><p>:::
:::spoiler IDA Main Encryption Part 2</p><pre tabindex=0><code class="language-cpp=" data-lang="cpp=">unsigned int __cdecl sub_6BD(int dest, unsigned int enc_flag_len_and, int idx)
{
  unsigned int result; // eax
  unsigned int i; // [esp+14h] [ebp-14h]
  char v5[4]; // [esp+18h] [ebp-10h]
  unsigned int v6; // [esp+1Ch] [ebp-Ch]

  v6 = __readgsdword(0x14u);
  v5[0] = HIBYTE(idx);                          // 0x0a
  v5[1] = BYTE2(idx);                           // 0xbc
  v5[2] = BYTE1(idx);                           // 0xf0
  v5[3] = idx;                                  // 0x0d
  for ( i = 0; i &lt; enc_flag_len_and; ++i )
    *(dest + i) ^= v5[i &amp; 3];
  result = __readgsdword(0x14u) ^ v6;
  if ( result )
    sub_B20();
  return result;
}
</code></pre><p>:::</p><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>這一題算簡單，但搞了好久，一方面是ida有些東西翻的很醜，一方面gdb看不出來main, encryption等等function symbol，所以一些動態的address的提示都沒有，會有點妨礙，但整體來說他做的事情就是他先把index的每一個bytes，都獨立出來，以0x0abcf00d來說，
v5[0]=0x0a
v5[1]=0xbc
v5[2]=0xf0
v5[3]=0x0d
然後跟我們的input的每一個bytes都進行XOR，當第一round結束後new index = 0x0abcf00d + 0x1FAB4D，然後重複前面執行的部分，所以我們要做的事情就只是重複剛剛所有的過程，就可以拿到flag了。
至於要比較的ciphertext可以直接從gdb的動態看出來</p><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><pre tabindex=0><code class="language-python=" data-lang="python=">cipher = bytes.fromhex(&#34;2E6E40681D53657C175816436D5862366F436230016347333F6314636d7a00&#34;)

flag = []
for i in range(len(cipher)):
    flag.append(hex(cipher[i])[2:])


for i in range(0xABCF00D, 0xdea62e4b, 0x1FAB4D):
    tmp_idx = hex(i)[2:].encode()
    if len(tmp_idx) &lt; 8:
        tmp_idx = b&#39;0&#39; + tmp_idx
    key = [int(tmp_idx[-8:-6], 16), int(tmp_idx[-6:-4], 16), int(tmp_idx[-4:-2], 16), int(tmp_idx[-2:], 16)]

    for j in range(len(cipher)):
        tmp = hex(int(flag[j], 16) ^ key[j % 4])[2:]
        flag[j] = tmp
        # cipher[j] = bytes.fromhex(hex(cipher[j] ^ key[j % 4])[2:])
print(bytes.fromhex(&#34;&#34;.join(flag)).decode(&#39;cp437&#39;))
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></nav></div></aside></main></body></html>