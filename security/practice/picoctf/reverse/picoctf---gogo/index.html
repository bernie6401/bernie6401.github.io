<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  PicoCTF - gogo
  #


  Source code
  #

:::spoiler IDA Main Function
// main.main
void __cdecl main_main()
{
  _slice_interface_ typ[2]; // [esp+0h] [ebp-58h] BYREF
  string *second_flag; // [esp+20h] [ebp-38h]
  string *flag; // [esp+24h] [ebp-34h]
  _slice_interface_ v3; // [esp+28h] [ebp-30h] BYREF
  string *v4; // [esp+34h] [ebp-24h]
  _DWORD v5[2]; // [esp+38h] [ebp-20h] BYREF
  _DWORD v6[2]; // [esp+40h] [ebp-18h] BYREF
  _slice_interface_ v7; // [esp+48h] [ebp-10h] BYREF
  string *v8; // [esp+54h] [ebp-4h]

  flag = runtime_newobject(&amp;RTYPE_string_0);
  typ[0].array = "Enter Password: ";
  typ[0].len = 16;
  memset(&amp;typ[0].cap, 0, sizeof(_slice_interface_));
  fmt_Printf(*&amp;typ[0].array, *&amp;typ[0].cap);
  v6[0] = &amp;RTYPE__ptr_string;
  v6[1] = flag;
  typ[0].array = "%s\n";
  typ[0].len = 3;
  typ[0].cap = v6;
  *&amp;typ[1].array = 0x100000001LL;
  fmt_Scanf(*&amp;typ[0].array, *&amp;typ[0].cap);
  if ( main_checkPassword(*flag) )
  {
    v5[0] = &amp;RTYPE_string_0;
    v5[1] = &amp;main_statictmp_0;
    typ[0].array = v5;
    *&amp;typ[0].len = 0x100000001LL;
    fmt_Println(typ[0]);
    v3.cap = &amp;RTYPE_string_0;
    v4 = &amp;main_statictmp_1;
    typ[0].array = &amp;v3.cap;
    *&amp;typ[0].len = 0x100000001LL;
    fmt_Println(typ[0]);
    v3.array = &amp;RTYPE_string_0;
    v3.len = &amp;main_statictmp_2;
    typ[0].array = &amp;v3;
    *&amp;typ[0].len = 0x100000001LL;
    fmt_Println(typ[0]);
    second_flag = runtime_newobject(&amp;RTYPE_string_0);
    v7.cap = &amp;RTYPE__ptr_string;
    v8 = second_flag;
    typ[0].array = "%s\n";
    typ[0].len = 3;
    typ[0].cap = &amp;v7.cap;
    *&amp;typ[1].array = 0x100000001LL;
    fmt_Scanf(*&amp;typ[0].array, *&amp;typ[0].cap);
    main_ambush(*second_flag);
    runtime_deferproc(0, &amp;stru_81046A0);
  }
  else
  {
    v7.array = &amp;RTYPE_string_0;
    v7.len = &amp;main_statictmp_3;
    typ[0].array = &amp;v7;
    *&amp;typ[0].len = 0x100000001LL;
    fmt_Println(typ[0]);
  }
  runtime_deferreturn(typ[0].array);
}
:::'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/picoctf/reverse/picoctf---gogo/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="PicoCTF - gogo"><meta property="og:description" content='PicoCTF - gogo # Source code # :::spoiler IDA Main Function
// main.main void __cdecl main_main() { _slice_interface_ typ[2]; // [esp+0h] [ebp-58h] BYREF string *second_flag; // [esp+20h] [ebp-38h] string *flag; // [esp+24h] [ebp-34h] _slice_interface_ v3; // [esp+28h] [ebp-30h] BYREF string *v4; // [esp+34h] [ebp-24h] _DWORD v5[2]; // [esp+38h] [ebp-20h] BYREF _DWORD v6[2]; // [esp+40h] [ebp-18h] BYREF _slice_interface_ v7; // [esp+48h] [ebp-10h] BYREF string *v8; // [esp+54h] [ebp-4h] flag = runtime_newobject(&amp;RTYPE_string_0); typ[0].array = "Enter Password: "; typ[0].len = 16; memset(&amp;typ[0].cap, 0, sizeof(_slice_interface_)); fmt_Printf(*&amp;typ[0].array, *&amp;typ[0].cap); v6[0] = &amp;RTYPE__ptr_string; v6[1] = flag; typ[0].array = "%s\n"; typ[0].len = 3; typ[0].cap = v6; *&amp;typ[1].array = 0x100000001LL; fmt_Scanf(*&amp;typ[0].array, *&amp;typ[0].cap); if ( main_checkPassword(*flag) ) { v5[0] = &amp;RTYPE_string_0; v5[1] = &amp;main_statictmp_0; typ[0].array = v5; *&amp;typ[0].len = 0x100000001LL; fmt_Println(typ[0]); v3.cap = &amp;RTYPE_string_0; v4 = &amp;main_statictmp_1; typ[0].array = &amp;v3.cap; *&amp;typ[0].len = 0x100000001LL; fmt_Println(typ[0]); v3.array = &amp;RTYPE_string_0; v3.len = &amp;main_statictmp_2; typ[0].array = &amp;v3; *&amp;typ[0].len = 0x100000001LL; fmt_Println(typ[0]); second_flag = runtime_newobject(&amp;RTYPE_string_0); v7.cap = &amp;RTYPE__ptr_string; v8 = second_flag; typ[0].array = "%s\n"; typ[0].len = 3; typ[0].cap = &amp;v7.cap; *&amp;typ[1].array = 0x100000001LL; fmt_Scanf(*&amp;typ[0].array, *&amp;typ[0].cap); main_ambush(*second_flag); runtime_deferproc(0, &amp;stru_81046A0); } else { v7.array = &amp;RTYPE_string_0; v7.len = &amp;main_statictmp_3; typ[0].array = &amp;v7; *&amp;typ[0].len = 0x100000001LL; fmt_Println(typ[0]); } runtime_deferreturn(typ[0].array); } :::'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="PicoCTF"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Reverse"><title>PicoCTF - gogo | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/picoctf/reverse/picoctf---gogo/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>PicoCTF - gogo</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=picoctf---gogo>PicoCTF - gogo
<a class=anchor href=#picoctf---gogo>#</a></h1><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler IDA Main Function</p><pre tabindex=0><code class="language-cpp=" data-lang="cpp=">// main.main
void __cdecl main_main()
{
  _slice_interface_ typ[2]; // [esp+0h] [ebp-58h] BYREF
  string *second_flag; // [esp+20h] [ebp-38h]
  string *flag; // [esp+24h] [ebp-34h]
  _slice_interface_ v3; // [esp+28h] [ebp-30h] BYREF
  string *v4; // [esp+34h] [ebp-24h]
  _DWORD v5[2]; // [esp+38h] [ebp-20h] BYREF
  _DWORD v6[2]; // [esp+40h] [ebp-18h] BYREF
  _slice_interface_ v7; // [esp+48h] [ebp-10h] BYREF
  string *v8; // [esp+54h] [ebp-4h]

  flag = runtime_newobject(&amp;RTYPE_string_0);
  typ[0].array = &#34;Enter Password: &#34;;
  typ[0].len = 16;
  memset(&amp;typ[0].cap, 0, sizeof(_slice_interface_));
  fmt_Printf(*&amp;typ[0].array, *&amp;typ[0].cap);
  v6[0] = &amp;RTYPE__ptr_string;
  v6[1] = flag;
  typ[0].array = &#34;%s\n&#34;;
  typ[0].len = 3;
  typ[0].cap = v6;
  *&amp;typ[1].array = 0x100000001LL;
  fmt_Scanf(*&amp;typ[0].array, *&amp;typ[0].cap);
  if ( main_checkPassword(*flag) )
  {
    v5[0] = &amp;RTYPE_string_0;
    v5[1] = &amp;main_statictmp_0;
    typ[0].array = v5;
    *&amp;typ[0].len = 0x100000001LL;
    fmt_Println(typ[0]);
    v3.cap = &amp;RTYPE_string_0;
    v4 = &amp;main_statictmp_1;
    typ[0].array = &amp;v3.cap;
    *&amp;typ[0].len = 0x100000001LL;
    fmt_Println(typ[0]);
    v3.array = &amp;RTYPE_string_0;
    v3.len = &amp;main_statictmp_2;
    typ[0].array = &amp;v3;
    *&amp;typ[0].len = 0x100000001LL;
    fmt_Println(typ[0]);
    second_flag = runtime_newobject(&amp;RTYPE_string_0);
    v7.cap = &amp;RTYPE__ptr_string;
    v8 = second_flag;
    typ[0].array = &#34;%s\n&#34;;
    typ[0].len = 3;
    typ[0].cap = &amp;v7.cap;
    *&amp;typ[1].array = 0x100000001LL;
    fmt_Scanf(*&amp;typ[0].array, *&amp;typ[0].cap);
    main_ambush(*second_flag);
    runtime_deferproc(0, &amp;stru_81046A0);
  }
  else
  {
    v7.array = &amp;RTYPE_string_0;
    v7.len = &amp;main_statictmp_3;
    typ[0].array = &amp;v7;
    *&amp;typ[0].len = 0x100000001LL;
    fmt_Println(typ[0]);
  }
  runtime_deferreturn(typ[0].array);
}
</code></pre><p>:::</p><p>:::spoiler IDA First Stage Checker</p><pre tabindex=0><code class="language-cpp=" data-lang="cpp=">// main.checkPassword
bool __golang main_checkPassword(string flag)
{
  __int32 idx; // eax
  int check_counter; // ebx
  uint8 key[32]; // [esp+4h] [ebp-40h] BYREF
  char enc_flag[32]; // [esp+24h] [ebp-20h]

  if ( flag.len &lt; 32 )
    os_Exit(0);
  (loc_8090B18)();
  qmemcpy(key, &#34;861836f13e3d627dfa375bdb8389214e&#34;, sizeof(key));
  (loc_8090FE0)();
  idx = 0;
  check_counter = 0;
  while ( idx &lt; 32 )
  {
    if ( idx &gt;= flag.len || idx &gt;= 0x20 )
      runtime_panicindex();
    if ( (key[idx] ^ flag.str[idx]) == enc_flag[idx] )
      ++check_counter;
    ++idx;
  }
  return check_counter == 32;
}
</code></pre><p>:::</p><p>:::spoiler IDA Second Stage Checker</p><pre tabindex=0><code class="language-cpp=" data-lang="cpp=">// main.ambush
void __golang main_ambush(string second_flag)
{
  int j; // eax
  _slice_uint8 v2; // [esp+0h] [ebp-94h]
  _slice_uint8 s; // [esp+4h] [ebp-90h]
  _slice_uint8 dataa; // [esp+Ch] [ebp-88h]
  string data; // [esp+Ch] [ebp-88h]
  string data_4; // [esp+10h] [ebp-84h]
  uint8 v7; // [esp+1Fh] [ebp-75h]
  unsigned __int32 i; // [esp+20h] [ebp-74h]
  uint8 hashed[16]; // [esp+24h] [ebp-70h] BYREF
  uint8 key[32]; // [esp+34h] [ebp-60h] BYREF
  uint8 buf[32]; // [esp+54h] [ebp-40h] BYREF
  uint8 v12[32]; // [esp+74h] [ebp-20h] BYREF

  dataa = runtime_stringtoslicebyte(buf, second_flag);
  crypto_md5_Sum(dataa);
  (loc_8091008)();
  (loc_8090B18)();
  qmemcpy(key, &#34;861836f13e3d627dfa375bdb8389214e&#34;, sizeof(key));
  for ( j = 0; j &lt; 16; j = i + 1 )
  {
    i = j;
    v2.array = hashed;
    *&amp;v2.len = 0x1000000010LL;
    data = encoding_hex_EncodeToString(v2);
    if ( i &gt;= data.len
      || (v7 = data.str[i],
          s.array = key,
          *&amp;s.len = 0x2000000020LL,
          data_4 = runtime_slicebytetostring(v12, s),
          i &gt;= data_4.len) )
    {
      runtime_panicindex();
    }
    if ( v7 != data_4.str[i] )
      os_Exit(0);
  }
}
</code></pre><p>:::</p><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>終於有一點像樣的題目出現了，這一題有兩個關卡需要克服</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ file enter_password
</span></span><span style=display:flex><span>enter_password: ELF 32-bit LSB executable, Intel 80386, version <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>SYSV<span style=color:#f92672>)</span>, statically linked, Go BuildID<span style=color:#f92672>=</span>3-hVI6nMz0HbfIUMSEzq/TkiA8oRk8FHsCuRXIle2/C1my_KvOIt2KUk44LyQs/-XrwOx7UDhcGGdtF5xpG, with debug_info, not stripped
</span></span></code></pre></div><p>用IDA和gdb跟一下整體的流程</p><ol><li>首先他先把我們輸入的flag，丟到main_checkPassword function檢查，而跟了一下gdb發現他是先跟<code>861836f13e3d627dfa375bdb8389214e</code>的每一個數值進行xor然後跟enc_flag的字元做比較，而enc_flag是run time的時候需要從memory撈的資料，這就需要慢慢跟然後慢慢看，大概就像下面撈的那樣，反著作就可以得到第一階段的flag</li><li>過了第一階段後他還會叫你要再輸入一次另外一個flag，然後會丟到main_ambush function做檢查，他會先把我們輸入的second flag進行md5的hash，然後和<code>861836f13e3d627dfa375bdb8389214e</code>進行比對，所以我們要做的事情是推測甚麼樣的字串，他的md5 hash是<code>861836f13e3d627dfa375bdb8389214e</code>，這個可以用online tool做到這件事情</li></ol><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><ol><li><p>Script For 1st Stage</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>enc_flag <span style=color:#f92672>=</span> [<span style=color:#ae81ff>74</span>, <span style=color:#ae81ff>83</span>, <span style=color:#ae81ff>71</span>, <span style=color:#ae81ff>93</span>, <span style=color:#ae81ff>65</span>, <span style=color:#ae81ff>69</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>84</span>, <span style=color:#ae81ff>93</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>90</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>83</span>, <span style=color:#ae81ff>87</span>, <span style=color:#ae81ff>69</span>, <span style=color:#ae81ff>13</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>93</span>, <span style=color:#ae81ff>85</span>, <span style=color:#ae81ff>84</span>, <span style=color:#ae81ff>16</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>14</span>, <span style=color:#ae81ff>65</span>, <span style=color:#ae81ff>85</span>, <span style=color:#ae81ff>87</span>, <span style=color:#ae81ff>75</span>, <span style=color:#ae81ff>69</span>, <span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>70</span>, <span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0x38</span>, <span style=color:#ae81ff>0x36</span>, <span style=color:#ae81ff>0x31</span>, <span style=color:#ae81ff>0x38</span>, <span style=color:#ae81ff>0x33</span>, <span style=color:#ae81ff>0x36</span>, <span style=color:#ae81ff>0x66</span>, <span style=color:#ae81ff>0x31</span>, <span style=color:#ae81ff>0x33</span>, <span style=color:#ae81ff>0x65</span>, <span style=color:#ae81ff>0x33</span>, <span style=color:#ae81ff>0x64</span>, <span style=color:#ae81ff>0x36</span>, <span style=color:#ae81ff>0x32</span>, <span style=color:#ae81ff>0x37</span>, <span style=color:#ae81ff>0x64</span>, <span style=color:#ae81ff>0x66</span>, <span style=color:#ae81ff>0x61</span>, <span style=color:#ae81ff>0x33</span>, <span style=color:#ae81ff>0x37</span>, <span style=color:#ae81ff>0x35</span>, <span style=color:#ae81ff>0x62</span>, <span style=color:#ae81ff>0x64</span>, <span style=color:#ae81ff>0x62</span>, <span style=color:#ae81ff>0x38</span>, <span style=color:#ae81ff>0x33</span>, <span style=color:#ae81ff>0x38</span>, <span style=color:#ae81ff>0x39</span>, <span style=color:#ae81ff>0x32</span>, <span style=color:#ae81ff>0x31</span>, <span style=color:#ae81ff>0x34</span>, <span style=color:#ae81ff>0x65</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>FLAG <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> a, b <span style=color:#f92672>in</span> zip(enc_flag, key):
</span></span><span style=display:flex><span>    FLAG<span style=color:#f92672>.</span>append(bytes<span style=color:#f92672>.</span>fromhex(hex(a <span style=color:#f92672>^</span> b)[<span style=color:#ae81ff>2</span>:])<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join(FLAG))
</span></span></code></pre></div></li><li><p>Use <a href=https://md5.gromweb.com/>online tool</a> to unhash
<img src=https://hackmd.io/_uploads/HkEBMjztn.png alt></p></li><li><p>Conclusion</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ nc mercury.picoctf.net <span style=color:#ae81ff>4052</span>
</span></span><span style=display:flex><span>Enter Password: reverseengineericanbarelyforward
</span></span><span style=display:flex><span><span style=color:#f92672>=========================================</span>
</span></span><span style=display:flex><span>This challenge is interrupted by psociety
</span></span><span style=display:flex><span>What is the unhashed key?
</span></span><span style=display:flex><span>goldfish
</span></span><span style=display:flex><span>Flag is:  picoCTF<span style=color:#f92672>{</span>p1kap1ka_p1c09a4dd7f3<span style=color:#f92672>}</span>
</span></span></code></pre></div></li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></nav></div></aside></main></body></html>