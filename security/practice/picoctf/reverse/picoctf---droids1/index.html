<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  PicoCTF - droids1
  #


  Backgroud
  #

 Android App 逆向入門之一：拆開與重組 apk : 強烈建議新手在打之前可以先看一下這篇，稍微了解一下整體怎麼包apk以及比要檔案有哪些，或是他們儲存的資料類型之類的

  Tools
  #


apktool
跟著installation guide就可以安裝成功，此工具目的在於拆解apk，我們知道apk就是一個壓縮檔，如果直接用unzip這種指令，也可以打開，只不過一些經過編譯後的byte code就還是byte code，而apktool可以在解壓縮的同時還原這些byte code
Android Studio: 此工具目的在於利用emulator把該軟體安裝後跑起來
JADX: 和ApkTool一樣，可以反編譯apk，但有GUI(Recommended)
 $ wget https://github.com/skylot/jadx/releases/download/v1.1.0/jadx-1.1.0.zip
 $ unzip jadx-1.1.0.zip -d jadx
 $ cd jadx
 $ cd ./bin
 $ ./jadx-gui



  Recon
  #

這一題有兩種方法可以反編譯apk，一種是利用ApkTool，另外一個是JADX，兩者差在有無GUI(JADX有)，主要是參考1的WP

  Exploit
  #


  ApkTools
  #

$ apktool d one.apk
I: Using Apktool 2.8.1 on one.apk
I: Loading resource table...
I: Decoding AndroidManifest.xml with resources...
I: Loading resource table from file: C:\Users\Bernie\AppData\Local\apktool\framework\1.apk
I: Regular manifest package...
I: Decoding file-resources...
I: Decoding values */* XMLs...
I: Baksmaling classes.dex...
I: Copying assets and libs...
I: Copying unknown files...
I: Copying original files...
如果有按照上面的guide把apktool裝起來，就可以直接下指令，參數d代表decode，對於比較熟Android架構的人來說應該綽綽有餘，畢竟要到哪邊找code/strings之類的，通常都會是那幾個地方，例如：
Code會放在./smali/com/hellocmu/picoctf/(PS: 只不過code很醜，畢竟是smali)
Strings會放在./res/values/strings.xml"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/picoctf/reverse/picoctf---droids1/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="PicoCTF - droids1"><meta property="og:description" content="PicoCTF - droids1 # Backgroud # Android App 逆向入門之一：拆開與重組 apk : 強烈建議新手在打之前可以先看一下這篇，稍微了解一下整體怎麼包apk以及比要檔案有哪些，或是他們儲存的資料類型之類的
Tools # apktool 跟著installation guide就可以安裝成功，此工具目的在於拆解apk，我們知道apk就是一個壓縮檔，如果直接用unzip這種指令，也可以打開，只不過一些經過編譯後的byte code就還是byte code，而apktool可以在解壓縮的同時還原這些byte code Android Studio: 此工具目的在於利用emulator把該軟體安裝後跑起來 JADX: 和ApkTool一樣，可以反編譯apk，但有GUI(Recommended) $ wget https://github.com/skylot/jadx/releases/download/v1.1.0/jadx-1.1.0.zip $ unzip jadx-1.1.0.zip -d jadx $ cd jadx $ cd ./bin $ ./jadx-gui Recon # 這一題有兩種方法可以反編譯apk，一種是利用ApkTool，另外一個是JADX，兩者差在有無GUI(JADX有)，主要是參考1的WP
Exploit # ApkTools # $ apktool d one.apk I: Using Apktool 2.8.1 on one.apk I: Loading resource table... I: Decoding AndroidManifest.xml with resources... I: Loading resource table from file: C:\Users\Bernie\AppData\Local\apktool\framework\1.apk I: Regular manifest package... I: Decoding file-resources... I: Decoding values */* XMLs... I: Baksmaling classes.dex... I: Copying assets and libs... I: Copying unknown files... I: Copying original files... 如果有按照上面的guide把apktool裝起來，就可以直接下指令，參數d代表decode，對於比較熟Android架構的人來說應該綽綽有餘，畢竟要到哪邊找code/strings之類的，通常都會是那幾個地方，例如： Code會放在./smali/com/hellocmu/picoctf/(PS: 只不過code很醜，畢竟是smali) Strings會放在./res/values/strings.xml"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="PicoCTF"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Reverse"><title>PicoCTF - droids1 | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/picoctf/reverse/picoctf---droids1/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>PicoCTF - droids1</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#backgroud>Backgroud</a></li><li><a href=#tools>Tools</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a><ul><li><a href=#apktools>ApkTools</a></li><li><a href=#jadx>JADX</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=picoctf---droids1>PicoCTF - droids1
<a class=anchor href=#picoctf---droids1>#</a></h1><h2 id=backgroud>Backgroud
<a class=anchor href=#backgroud>#</a></h2><p><a href=https://blog.huli.tw/2023/04/27/android-apk-decompile-intro-1/>Android App 逆向入門之一：拆開與重組 apk </a>: 強烈建議新手在打之前可以先看一下這篇，稍微了解一下整體怎麼包apk以及比要檔案有哪些，或是他們儲存的資料類型之類的</p><h2 id=tools>Tools
<a class=anchor href=#tools>#</a></h2><ul><li><a href=https://ibotpeaches.github.io/Apktool/>apktool</a>
跟著<a href=https://apktool.org/docs/install>installation guide</a>就可以安裝成功，此工具目的在於拆解apk，我們知道apk就是一個壓縮檔，如果直接用unzip這種指令，也可以打開，只不過一些經過編譯後的byte code就還是byte code，而apktool可以在解壓縮的同時還原這些byte code</li><li><a href=https://developer.android.com/studio>Android Studio</a>: 此工具目的在於利用emulator把該軟體安裝後跑起來</li><li><a href=https://github.com/skylot/jadx>JADX</a>: 和ApkTool一樣，可以反編譯apk，但有GUI(Recommended)<pre tabindex=0><code class=language-bash! data-lang=bash!> $ wget https://github.com/skylot/jadx/releases/download/v1.1.0/jadx-1.1.0.zip
 $ unzip jadx-1.1.0.zip -d jadx
 $ cd jadx
 $ cd ./bin
 $ ./jadx-gui
</code></pre></li></ul><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>這一題有兩種方法可以反編譯apk，一種是利用ApkTool，另外一個是JADX，兩者差在有無GUI(JADX有)，主要是參考<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>的WP</p><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><h3 id=apktools>ApkTools
<a class=anchor href=#apktools>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ apktool d one.apk
</span></span><span style=display:flex><span>I: Using Apktool 2.8.1 on one.apk
</span></span><span style=display:flex><span>I: Loading resource table...
</span></span><span style=display:flex><span>I: Decoding AndroidManifest.xml with resources...
</span></span><span style=display:flex><span>I: Loading resource table from file: C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\B</span>ernie<span style=color:#ae81ff>\A</span>ppData<span style=color:#ae81ff>\L</span>ocal<span style=color:#ae81ff>\a</span>pktool<span style=color:#ae81ff>\f</span>ramework<span style=color:#ae81ff>\1</span>.apk
</span></span><span style=display:flex><span>I: Regular manifest package...
</span></span><span style=display:flex><span>I: Decoding file-resources...
</span></span><span style=display:flex><span>I: Decoding values */* XMLs...
</span></span><span style=display:flex><span>I: Baksmaling classes.dex...
</span></span><span style=display:flex><span>I: Copying assets and libs...
</span></span><span style=display:flex><span>I: Copying unknown files...
</span></span><span style=display:flex><span>I: Copying original files...
</span></span></code></pre></div><p>如果有按照上面的guide把apktool裝起來，就可以直接下指令，參數<code>d</code>代表decode，對於比較熟Android架構的人來說應該綽綽有餘，畢竟要到哪邊找code/strings之類的，通常都會是那幾個地方，例如：
Code會放在<code>./smali/com/hellocmu/picoctf/</code>(PS: 只不過code很醜，畢竟是smali)
Strings會放在<code>./res/values/strings.xml</code></p><p>根據<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>的教學:</p><blockquote><p>在我們利用 apktool d 拆開的內容中，有一個資料夾叫做 smali，裡面存放著的就是從 classes.dex 還原出來的東西，也就是程式碼
Smali 是跑在 Android Dalvik VM 上的 byte code，有著自己的一套語法規則，如果想要看到我們熟悉的 Java 程式碼，必須要將 smali 還原成 Java。</p></blockquote><h3 id=jadx>JADX
<a class=anchor href=#jadx>#</a></h3><p>其實用jadx也可以直接反編譯，而且還有GUI可以看，不香ㄇ
<img src=https://hackmd.io/_uploads/B1i_mB1xT.png alt>
用JADX一樣可以在相同的地方找到code，只是這一些code已經被還原成java</p><pre tabindex=0><code class=language-java! data-lang=java!>package com.hellocmu.picoctf;

import android.content.Context;

/* loaded from: classes.dex */
public class FlagstaffHill {
    public static native String fenugreek(String str);

    public static String getFlag(String input, Context ctx) {
        String password = ctx.getString(R.string.password);
        return input.equals(password) ? fenugreek(input) : &#34;NOPE&#34;;
    }
}
</code></pre><p>可以看到FlagstaffHill這個class有兩個member(fenugreek/getFlag)，所以看起來他會把我們輸入的東西和password這個variable做比較，如果一樣就會去call fenugreek(input)，否則回傳NOPE
而password是從R.string.password來的，可以看到password的值是0x7f0b002f應該是一個offset?或是一個地址，不是很確定
<img src=https://hackmd.io/_uploads/HJ3jNr1la.png alt>
反正最後取strings的地方在<code>./Resource/resources.arsc/res/values/strings.xml</code>
<img src=https://hackmd.io/_uploads/rkmrrSkea.png alt></p><p>然後我們就可以利用Android Studio或是直接在自己的手機安裝這個apk，接著輸入password(opossum)就可以拿到flag了
<img src=https://hackmd.io/_uploads/HyyTBByxp.png alt></p><p>Flag: <code>picoCTF{pining.for.the.fjords}</code></p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://picoctf2019.haydenhousen.com/reverse-engineering/droids1>droids1</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://blog.huli.tw/2023/04/27/android-apk-decompile-intro-2/>Android App 逆向入門之二：修改 smali 程式碼 </a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#backgroud>Backgroud</a></li><li><a href=#tools>Tools</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a><ul><li><a href=#apktools>ApkTools</a></li><li><a href=#jadx>JADX</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>