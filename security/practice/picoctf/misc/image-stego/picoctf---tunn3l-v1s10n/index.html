<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  PicoCTF - tunn3l v1s10n
  #


  tags: PicoCTF CTF Misc
  #

Challenge: tunn3l v1s10n

  Background
  #

[筆記] BMP點陣圖格式說明

  Exploit - Recover file
  #


Analyze
$ exiftool tunn3l_v1s10n
ExifTool Version Number         : 11.88
File Name                       : tunn3l_v1s10n
Directory                       : .
File Size                       : 2.8 MB
File Modification Date/Time     : 2023:02:17 04:11:33+08:00
File Access Date/Time           : 2023:02:17 04:12:37+08:00
File Inode Change Date/Time     : 2023:02:17 04:11:35+08:00
File Permissions                : rw-r--r--
File Type                       : BMP
File Type Extension             : bmp
MIME Type                       : image/bmp
BMP Version                     : Unknown (53434)
Image Width                     : 1134
Image Height                    : 306
Planes                          : 1
Bit Depth                       : 24
Compression                     : None
Image Length                    : 2893400
Pixels Per Meter X              : 5669
Pixels Per Meter Y              : 5669
Num Colors                      : Use BitDepth
Num Important Colors            : All
Red Mask                        : 0x27171a23
Green Mask                      : 0x20291b1e
Blue Mask                       : 0x1e212a1d
Alpha Mask                      : 0x311a1d26
Color Space                     : Unknown (,5%()
Rendering Intent                : Unknown (826103054)
Image Size                      : 1134x306
Megapixels                      : 0.347
It seems a bmp file and check the file signature of the 2 bytes is 42 4D :heavy_check_mark:
Check file headers
According to BMP_file_format and BMP點陣圖格式說明


:heavy_check_mark:size: 8E 26 2C 00 $\to$ 0x2C268E $\to$ 2893454 bytes

:heavy_check_mark:reserved1: 00 00
:heavy_check_mark:reserved2:  00 00
:negative_squared_cross_mark:offset: BA D0 00 00 $\to$ 0xD0BA $\to$ 53434 means it&rsquo;ll read the bitmap data from offset 53434 bytes. But actually, the data of bitmap is just connect with the header. So, we just need to shift 14 bytes for file header + 40 bytes for info header = 54 bytes $\to$ 0x36





We can peek the data first&mldr;

It said notaflag{sorry}, means we need to recover other parts."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/picoctf/misc/image-stego/picoctf---tunn3l-v1s10n/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="PicoCTF - `tunn3l v1s10n`"><meta property="og:description" content="PicoCTF - tunn3l v1s10n # tags: PicoCTF CTF Misc # Challenge: tunn3l v1s10n
Background # [筆記] BMP點陣圖格式說明
Exploit - Recover file # Analyze $ exiftool tunn3l_v1s10n ExifTool Version Number : 11.88 File Name : tunn3l_v1s10n Directory : . File Size : 2.8 MB File Modification Date/Time : 2023:02:17 04:11:33+08:00 File Access Date/Time : 2023:02:17 04:12:37+08:00 File Inode Change Date/Time : 2023:02:17 04:11:35+08:00 File Permissions : rw-r--r-- File Type : BMP File Type Extension : bmp MIME Type : image/bmp BMP Version : Unknown (53434) Image Width : 1134 Image Height : 306 Planes : 1 Bit Depth : 24 Compression : None Image Length : 2893400 Pixels Per Meter X : 5669 Pixels Per Meter Y : 5669 Num Colors : Use BitDepth Num Important Colors : All Red Mask : 0x27171a23 Green Mask : 0x20291b1e Blue Mask : 0x1e212a1d Alpha Mask : 0x311a1d26 Color Space : Unknown (,5%() Rendering Intent : Unknown (826103054) Image Size : 1134x306 Megapixels : 0.347 It seems a bmp file and check the file signature of the 2 bytes is 42 4D :heavy_check_mark: Check file headers According to BMP_file_format and BMP點陣圖格式說明 :heavy_check_mark:size: 8E 26 2C 00 $\to$ 0x2C268E $\to$ 2893454 bytes :heavy_check_mark:reserved1: 00 00 :heavy_check_mark:reserved2: 00 00 :negative_squared_cross_mark:offset: BA D0 00 00 $\to$ 0xD0BA $\to$ 53434 means it’ll read the bitmap data from offset 53434 bytes. But actually, the data of bitmap is just connect with the header. So, we just need to shift 14 bytes for file header + 40 bytes for info header = 54 bytes $\to$ 0x36 We can peek the data first… It said notaflag{sorry}, means we need to recover other parts."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="PicoCTF"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Misc"><title>PicoCTF - `tunn3l v1s10n` | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/picoctf/misc/image-stego/picoctf---tunn3l-v1s10n/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>PicoCTF - `tunn3l v1s10n`</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#exploit---recover-file>Exploit - Recover file</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=picoctf---tunn3l-v1s10n>PicoCTF - <code>tunn3l v1s10n</code>
<a class=anchor href=#picoctf---tunn3l-v1s10n>#</a></h1><h6 id=tags-picoctf-ctf-misc>tags: <code>PicoCTF</code> <code>CTF</code> <code>Misc</code>
<a class=anchor href=#tags-picoctf-ctf-misc>#</a></h6><p>Challenge: <a href="https://play.picoctf.org/practice/challenge/112?category=4&amp;page=1">tunn3l v1s10n</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://www.jinnsblog.com/2009/08/bmp-format-graphic-illustration.html>[筆記] BMP點陣圖格式說明</a></p><h2 id=exploit---recover-file>Exploit - Recover file
<a class=anchor href=#exploit---recover-file>#</a></h2><ol><li>Analyze<pre tabindex=0><code class=language-bash! data-lang=bash!>$ exiftool tunn3l_v1s10n
ExifTool Version Number         : 11.88
File Name                       : tunn3l_v1s10n
Directory                       : .
File Size                       : 2.8 MB
File Modification Date/Time     : 2023:02:17 04:11:33+08:00
File Access Date/Time           : 2023:02:17 04:12:37+08:00
File Inode Change Date/Time     : 2023:02:17 04:11:35+08:00
File Permissions                : rw-r--r--
File Type                       : BMP
File Type Extension             : bmp
MIME Type                       : image/bmp
BMP Version                     : Unknown (53434)
Image Width                     : 1134
Image Height                    : 306
Planes                          : 1
Bit Depth                       : 24
Compression                     : None
Image Length                    : 2893400
Pixels Per Meter X              : 5669
Pixels Per Meter Y              : 5669
Num Colors                      : Use BitDepth
Num Important Colors            : All
Red Mask                        : 0x27171a23
Green Mask                      : 0x20291b1e
Blue Mask                       : 0x1e212a1d
Alpha Mask                      : 0x311a1d26
Color Space                     : Unknown (,5%()
Rendering Intent                : Unknown (826103054)
Image Size                      : 1134x306
Megapixels                      : 0.347
</code></pre>It seems a <code>bmp</code> file and check the file signature of the 2 bytes is <code>42 4D</code> :heavy_check_mark:</li><li>Check file headers
According to <a href=https://en.wikipedia.org/wiki/BMP_file_format>BMP_file_format</a> and <a href=https://www.jinnsblog.com/2009/08/bmp-format-graphic-illustration.html>BMP點陣圖格式說明</a>
<img src=https://i.imgur.com/YU6exro.png alt><ul><li>:heavy_check_mark:size: <code>8E 26 2C 00</code> $\to$ <code>0x2C268E</code> $\to$ <code>2893454 bytes</code>
<img src=https://i.imgur.com/H6G44kT.png alt></li><li>:heavy_check_mark:reserved1: <code>00 00</code></li><li>:heavy_check_mark:reserved2: <code>00 00</code></li><li>:negative_squared_cross_mark:offset: <code>BA D0 00 00</code> $\to$ <code>0xD0BA</code> $\to$ <code>53434</code> means it&rsquo;ll read the bitmap data from offset 53434 bytes. But actually, the data of bitmap is just connect with the header. So, we just need to shift 14 bytes for file header + 40 bytes for info header = 54 bytes $\to$ <code>0x36</code>
<img src=https://i.imgur.com/crETYOD.png alt></li></ul></li></ol><hr><p>We can peek the data first&mldr;
<img src=https://i.imgur.com/DWesnDl.png alt>
It said <code>notaflag{sorry}</code>, means we need to recover other parts.</p><hr><ol start=3><li>Check info headers
<img src=https://i.imgur.com/SMZn71k.png alt></li></ol><ul><li>:negative_squared_cross_mark:size：<code>BA D0 00 00</code> $\to$ <code>0x0DBA</code> $\to$ <code>3514 bytes</code> means the size of info header. However, the real size is <code>40 bytes</code> $\to$ <code>0x28</code> $\to$ <code>28 00 00 00</code></li></ul><p>Something strange with the following header:</p><ul><li>width：<code>6E 04 00 00</code> $\to$ <code>0x46E</code> $\to$ <code>1134 pixels</code></li><li>height：<code>32 01 00 00</code> $\to$ <code>0x132</code> $\to$ <code>306 pixels</code></li><li>bits：<code>18 00</code> $\to$ <code>0x18</code> $\to$ <code>each pixels need 24 bits</code>
If these headers are true:
$$
1134\ pixels\ *\ 306\ pixels\ *\ 24\ bits\ per\ pixel\ /\ 8\ bits\ per\ byte=1041012\ bytes
$$
And this is obviously not the real storage size system told us(2893454 bytes)</li></ul><ol start=4><li><p>Modify height pixels
$$
2893454\ bytes\ *\ 8\ bits\ per\ bytes\ /\ 24\ bits\ per\ pixel\ /\ 1134\ pixels=850.5\ pixels
$$
The height should be 850 pixels $\to$ <code>0x352</code> $\to$ <code>52 03 00 00</code></p></li><li><p>Done!!!
:::spoiler flag
<img src=https://i.imgur.com/IJMO8Pd.jpg alt>
:::</p></li></ol><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><p><a href=https://ctftime.org/writeup/28157>CTFtime Write Up</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#exploit---recover-file>Exploit - Recover file</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>