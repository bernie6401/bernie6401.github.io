<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  PicoCTF - RPS
  #


  Background
  #

strstr() in C/C++

In C++, std::strstr() is a predefined function used for string handling. string.h is the header file required for string functions. This function takes two strings s1 and s2 as an argument and finds the first occurrence of the sub-string s2 in the string s1. The process of matching does not include the terminating null-characters(‘\0’), but function stops there.
Syntax:"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/picoctf/pwn/picoctf---rps/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="PicoCTF - RPS"><meta property="og:description" content="PicoCTF - RPS # Background # strstr() in C/C++
In C++, std::strstr() is a predefined function used for string handling. string.h is the header file required for string functions. This function takes two strings s1 and s2 as an argument and finds the first occurrence of the sub-string s2 in the string s1. The process of matching does not include the terminating null-characters(‘\0’), but function stops there. Syntax:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="PicoCTF"><meta property="article:tag" content="CTF"><meta property="article:tag" content="PWN"><title>PicoCTF - RPS | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/picoctf/pwn/picoctf---rps/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>PicoCTF - RPS</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=picoctf---rps>PicoCTF - RPS
<a class=anchor href=#picoctf---rps>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://www.geeksforgeeks.org/strstr-in-ccpp/>strstr() in C/C++</a></p><blockquote><p>In C++, std::strstr() is a predefined function used for string handling. string.h is the header file required for string functions. This function takes two strings s1 and s2 as an argument and finds the first occurrence of the sub-string s2 in the string s1. The process of matching does not include the terminating null-characters(‘\0’), but function stops there.
Syntax:</p><pre tabindex=0><code>char *strstr (const char *s1, const char *s2);

Parameters:
s1: This is the main string to be examined.
s2: This is the sub-string to be searched in s1 string.
</code></pre><p>Return Value: This function returns a pointer points to the first character of the found s2 in s1 otherwise a null pointer if s2 is not present in s1. If s2 points to an empty string, s1 is returned.</p></blockquote><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler Source Code</p><pre tabindex=0><code class="language-cpp=" data-lang="cpp=">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdbool.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/time.h&gt;
#include &lt;sys/types.h&gt;


#define WAIT 60



static const char* flag = &#34;[REDACTED]&#34;;

char* hands[3] = {&#34;rock&#34;, &#34;paper&#34;, &#34;scissors&#34;};
char* loses[3] = {&#34;paper&#34;, &#34;scissors&#34;, &#34;rock&#34;};
int wins = 0;



int tgetinput(char *input, unsigned int l)
{
    fd_set          input_set;
    struct timeval  timeout;
    int             ready_for_reading = 0;
    int             read_bytes = 0;
    
    if( l &lt;= 0 )
    {
      printf(&#34;&#39;l&#39; for tgetinput must be greater than 0\n&#34;);
      return -2;
    }
    
    
    /* Empty the FD Set */
    FD_ZERO(&amp;input_set );
    /* Listen to the input descriptor */
    FD_SET(STDIN_FILENO, &amp;input_set);

    /* Waiting for some seconds */
    timeout.tv_sec = WAIT;    // WAIT seconds
    timeout.tv_usec = 0;    // 0 milliseconds

    /* Listening for input stream for any activity */
    ready_for_reading = select(1, &amp;input_set, NULL, NULL, &amp;timeout);
    /* Here, first parameter is number of FDs in the set, 
     * second is our FD set for reading,
     * third is the FD set in which any write activity needs to updated,
     * which is not required in this case. 
     * Fourth is timeout
     */

    if (ready_for_reading == -1) {
        /* Some error has occured in input */
        printf(&#34;Unable to read your input\n&#34;);
        return -1;
    } 

    if (ready_for_reading) {
        read_bytes = read(0, input, l-1);
        if(input[read_bytes-1]==&#39;\n&#39;){
        --read_bytes;
        input[read_bytes]=&#39;\0&#39;;
        }
        if(read_bytes==0){
            printf(&#34;No data given.\n&#34;);
            return -4;
        } else {
            return 0;
        }
    } else {
        printf(&#34;Timed out waiting for user input. Press Ctrl-C to disconnect\n&#34;);
        return -3;
    }

    return 0;
}


bool play () {
  char player_turn[100];
  srand(time(0));
  int r;

  printf(&#34;Please make your selection (rock/paper/scissors):\n&#34;);
  r = tgetinput(player_turn, 100);
  // Timeout on user input
  if(r == -3)
  {
    printf(&#34;Goodbye!\n&#34;);
    exit(0);
  }

  int computer_turn = rand() % 3;
  printf(&#34;You played: %s\n&#34;, player_turn);
  printf(&#34;The computer played: %s\n&#34;, hands[computer_turn]);

  if (strstr(player_turn, loses[computer_turn])) {
    puts(&#34;You win! Play again?&#34;);
    return true;
  } else {
    puts(&#34;Seems like you didn&#39;t win this time. Play again?&#34;);
    return false;
  }
}


int main () {
  char input[3] = {&#39;\0&#39;};
  int command;
  int r;

  puts(&#34;Welcome challenger to the game of Rock, Paper, Scissors&#34;);
  puts(&#34;For anyone that beats me 5 times in a row, I will offer up a flag I found&#34;);
  puts(&#34;Are you ready?&#34;);
  
  while (true) {
    puts(&#34;Type &#39;1&#39; to play a game&#34;);
    puts(&#34;Type &#39;2&#39; to exit the program&#34;);
    r = tgetinput(input, 3);
    // Timeout on user input
    if(r == -3)
    {
      printf(&#34;Goodbye!\n&#34;);
      exit(0);
    }
    
    if ((command = strtol(input, NULL, 10)) == 0) {
      puts(&#34;Please put in a valid number&#34;);
      
    } else if (command == 1) {
      printf(&#34;\n\n&#34;);
      if (play()) {
        wins++;
      } else {
        wins = 0;
      }

      if (wins &gt;= 5) {
        puts(&#34;Congrats, here&#39;s the flag!&#34;);
        puts(flag);
      }
    } else if (command == 2) {
      return 0;
    } else {
      puts(&#34;Please type either 1 or 2&#34;);
    }
  }

  return 0;
}
</code></pre><p>:::</p><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>這一題有reverse的感覺，主要是利用<code>strstr()</code>這個function拿到win++，在第100行的地方是利用<code>strstr()</code>搜索字串達到判斷勝利的功能，但是如果我們把三種結果結合在一起，則這一段結果就一定會試true</p><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><p>Payload: <code>paperscissorsrock</code>
:::spoiler Whole Progress</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ nc saturn.picoctf.net <span style=color:#ae81ff>51418</span>
</span></span><span style=display:flex><span>Welcome challenger to the game of Rock, Paper, Scissors
</span></span><span style=display:flex><span>For anyone that beats me <span style=color:#ae81ff>5</span> times in a row, I will offer up a flag I found
</span></span><span style=display:flex><span>Are you ready?
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;1&#39;</span> to play a game
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;2&#39;</span> to exit the program
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please make your selection <span style=color:#f92672>(</span>rock/paper/scissors<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>paperscissorsrock
</span></span><span style=display:flex><span>paperscissorsrock
</span></span><span style=display:flex><span>You played: paperscissorsrock
</span></span><span style=display:flex><span>The computer played: scissors
</span></span><span style=display:flex><span>You win! Play again?
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;1&#39;</span> to play a game
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;2&#39;</span> to exit the program
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please make your selection <span style=color:#f92672>(</span>rock/paper/scissors<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>paperscissorsrock
</span></span><span style=display:flex><span>paperscissorsrock
</span></span><span style=display:flex><span>You played: paperscissorsrock
</span></span><span style=display:flex><span>The computer played: rock
</span></span><span style=display:flex><span>You win! Play again?
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;1&#39;</span> to play a game
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;2&#39;</span> to exit the program
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please make your selection <span style=color:#f92672>(</span>rock/paper/scissors<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>paperscissorsrock
</span></span><span style=display:flex><span>paperscissorsrock
</span></span><span style=display:flex><span>You played: paperscissorsrock
</span></span><span style=display:flex><span>The computer played: scissors
</span></span><span style=display:flex><span>You win! Play again?
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;1&#39;</span> to play a game
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;2&#39;</span> to exit the program
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please make your selection <span style=color:#f92672>(</span>rock/paper/scissors<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>paperscissorsrock
</span></span><span style=display:flex><span>paperscissorsrock
</span></span><span style=display:flex><span>You played: paperscissorsrock
</span></span><span style=display:flex><span>The computer played: paper
</span></span><span style=display:flex><span>You win! Play again?
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;1&#39;</span> to play a game
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;2&#39;</span> to exit the program
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please make your selection <span style=color:#f92672>(</span>rock/paper/scissors<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>paperscissorsrock
</span></span><span style=display:flex><span>paperscissorsrock
</span></span><span style=display:flex><span>You played: paperscissorsrock
</span></span><span style=display:flex><span>The computer played: rock
</span></span><span style=display:flex><span>You win! Play again?
</span></span><span style=display:flex><span>Congrats, here<span style=color:#e6db74>&#39;s the flag!
</span></span></span><span style=display:flex><span><span style=color:#e6db74>picoCTF{50M3_3X7R3M3_1UCK_58F0F41B}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Type &#39;</span>1<span style=color:#e6db74>&#39; to play a game
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Type &#39;</span>2<span style=color:#960050;background-color:#1e0010>&#39;</span> to exit the program
</span></span></code></pre></div><p>:::
Flag: <code>picoCTF{50M3_3X7R3M3_1UCK_58F0F41B}</code></p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><p><a href=https://www.it-sec.fail/picoctf-2022-binary-exploitation-rps/>picoCTF 2022: binary-exploitation – RPS</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>