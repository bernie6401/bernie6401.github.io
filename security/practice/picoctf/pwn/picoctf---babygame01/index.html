<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  PicoCTF - babygame01
  #


  Background
  #

Bof

  Description & Hint
  #


Get the flag and reach the exit. Welcome to BabyGame! Navigate around the map and see what you can find! The game is available to download here. There is no source available, so you&rsquo;ll have to figure your way around the map. You can connect with it using nc saturn.picoctf.net 50227.
Hint 1: Use &lsquo;w&rsquo;,&lsquo;a&rsquo;,&rsquo;s&rsquo;,&rsquo;d&rsquo; to move around.
Hint 2: There may be secret commands to make your life easy."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/picoctf/pwn/picoctf---babygame01/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="PicoCTF - babygame01"><meta property="og:description" content="PicoCTF - babygame01 # Background # Bof
Description & Hint # Get the flag and reach the exit. Welcome to BabyGame! Navigate around the map and see what you can find! The game is available to download here. There is no source available, so you’ll have to figure your way around the map. You can connect with it using nc saturn.picoctf.net 50227. Hint 1: Use ‘w’,‘a’,’s’,’d’ to move around. Hint 2: There may be secret commands to make your life easy."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="PicoCTF"><meta property="article:tag" content="CTF"><meta property="article:tag" content="PWN"><title>PicoCTF - babygame01 | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/picoctf/pwn/picoctf---babygame01/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>PicoCTF - babygame01</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#description--hint>Description & Hint</a></li><li><a href=#source-code>Source Code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=picoctf---babygame01>PicoCTF - babygame01
<a class=anchor href=#picoctf---babygame01>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>Bof</p><h2 id=description--hint>Description & Hint
<a class=anchor href=#description--hint>#</a></h2><blockquote><p>Get the flag and reach the exit. Welcome to BabyGame! Navigate around the map and see what you can find! The game is available to download here. There is no source available, so you&rsquo;ll have to figure your way around the map. You can connect with it using nc saturn.picoctf.net 50227.
Hint 1: Use &lsquo;w&rsquo;,&lsquo;a&rsquo;,&rsquo;s&rsquo;,&rsquo;d&rsquo; to move around.
Hint 2: There may be secret commands to make your life easy.</p></blockquote><h2 id=source-code>Source Code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler IDA Main Function</p><pre tabindex=0><code class="language-cpp=" data-lang="cpp=">int __cdecl main(int argc, const char **argv, const char **envp)
{
  char input; // [esp+1h] [ebp-AA5h]
  int position[2]; // [esp+2h] [ebp-AA4h] BYREF
  char win_var; // [esp+Ah] [ebp-A9Ch]
  char map[2700]; // [esp+Eh] [ebp-A98h] BYREF
  unsigned int v8; // [esp+A9Ah] [ebp-Ch]
  int *p_argc; // [esp+A9Eh] [ebp-8h]

  p_argc = &amp;argc;
  v8 = __readgsdword(0x14u);
  init_player(position);
  init_map(map, position);
  print_map(map, position);
  signal(2, sigint_handler);
  do
  {
    do
    {
      input = getchar();
      move_player(position, input, map);
      print_map(map, position);
    }
    while ( position[0] != 29 );
  }
  while ( position[1] != 89 );
  puts(&#34;You win!&#34;);
  if ( win_var )
  {
    puts(&#34;flage&#34;);
    win();
    fflush(stdout);
  }
  return 0;
}
</code></pre><p>:::</p><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>這一題蠻有趣的，一樣是觸發類似Bof的概念，可以先用靜態的方式看，如果要用動態的方式看得話，需要讓glibc可以解析x32的檔案，另外glibc的版本也需要2.34，所以可以從<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>這兩個ref解決gdb版本的問題</p><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><ol><li><p>Hint當中有提到金手指的操作，觀察source code當中的move_player function中可以按p可以直接跑到終點，這樣就可以不用這麼麻煩</p></li><li><p>可以看到main function中要使<code>win_var</code>達到非零才能夠進入win function，印出flag，所以看了別人的WP<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>，可以讓player的位置覆蓋掉原本win_var的value，可以看一下在進入第一個getchar()之前stack的狀態
<img src=https://hackmd.io/_uploads/SkeT2IAq3.png alt></p></li><li><p>往左邊走之後，user input就會放在$esp+3的地方，而$esp+4放y軸的座標，$esp+8放x軸的座標，所以可想而知，win_var應該是放在$esp+12的地方
<img src=https://hackmd.io/_uploads/BkluaLCq2.png alt></p></li><li><p>在座標零零的地方又往左邊走之後x座標會變成0xffffffff，而雖然$esp+12還是0，但是可以看到$esp+15變成0x40也就是(<code>@</code>)這個字元的ascii，所以我們可以在往左邊走點
<img src=https://hackmd.io/_uploads/H1GYCL0qh.png alt></p></li><li><p>現在win_var已經變成0x40了，所以player就有64個flag，此時就可以直接按p到達終點，拿到flag
<img src=https://hackmd.io/_uploads/BkqVfwR9n.png alt>
<img src=https://hackmd.io/_uploads/ryxwGP0ch.png alt>
<img src=https://hackmd.io/_uploads/Hy0qMD0q3.png alt></p></li></ol><p>Flag: <code>picoCTF{gamer_m0d3_enabled_054c1d5a}</code></p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://blog.csdn.net/huazhang_001/article/details/128828999>version `GLIBC_2.34‘ not found简单有效解决方法</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://www.zendei.com/article/55341.html>解決gdb運行文件報錯During startup program exited with code 127.</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://youtu.be/I9BL3fZOj1M>picoCTF 2023 babygame01</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#description--hint>Description & Hint</a></li><li><a href=#source-code>Source Code</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit>Exploit</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>