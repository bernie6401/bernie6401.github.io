<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  PicoCTF - Easy Peasy
  #


  tags: PicoCTF CTF Crypto
  #

Challenge: Easy Peasy

  Background
  #


  Source code
  #

:::spoiler source code
#!/usr/bin/python3 -u
import os.path

KEY_FILE = "key"
KEY_LEN = 50000
FLAG_FILE = "flag"

def startup(key_location):
	flag = open(FLAG_FILE).read()
	kf = open(KEY_FILE, "rb").read()

	start = key_location
	stop = key_location + len(flag)

	key = kf[start:stop]
	key_location = stop

	result = list(map(lambda p, k: "{:02x}".format(ord(p) ^ k), flag, key))
	print("This is the encrypted flag!\n{}\n".format("".join(result)))

	return key_location

def encrypt(key_location):
	ui = input("What data would you like to encrypt? ").rstrip()
	if len(ui) == 0 or len(ui) > KEY_LEN:
		return -1

	start = key_location
	stop = key_location + len(ui)

	kf = open(KEY_FILE, "rb").read()

	if stop >= KEY_LEN:
		stop = stop % KEY_LEN
		key = kf[start:] + kf[:stop]
	else:
		key = kf[start:stop]
	key_location = stop

	result = list(map(lambda p, k: "{:02x}".format(ord(p) ^ k), ui, key))

	print("Here ya go!\n{}\n".format("".join(result)))

	return key_location


print("******************Welcome to our OTP implementation!******************")
c = startup(0)
while c >= 0:
	c = encrypt(c)
:::'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/picoctf/crypto/classic/picoctf---easy-peasy/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="PicoCTF - Easy Peasy"><meta property="og:description" content='PicoCTF - Easy Peasy # tags: PicoCTF CTF Crypto # Challenge: Easy Peasy
Background # Source code # :::spoiler source code
#!/usr/bin/python3 -u import os.path KEY_FILE = "key" KEY_LEN = 50000 FLAG_FILE = "flag" def startup(key_location): flag = open(FLAG_FILE).read() kf = open(KEY_FILE, "rb").read() start = key_location stop = key_location + len(flag) key = kf[start:stop] key_location = stop result = list(map(lambda p, k: "{:02x}".format(ord(p) ^ k), flag, key)) print("This is the encrypted flag!\n{}\n".format("".join(result))) return key_location def encrypt(key_location): ui = input("What data would you like to encrypt? ").rstrip() if len(ui) == 0 or len(ui) > KEY_LEN: return -1 start = key_location stop = key_location + len(ui) kf = open(KEY_FILE, "rb").read() if stop >= KEY_LEN: stop = stop % KEY_LEN key = kf[start:] + kf[:stop] else: key = kf[start:stop] key_location = stop result = list(map(lambda p, k: "{:02x}".format(ord(p) ^ k), ui, key)) print("Here ya go!\n{}\n".format("".join(result))) return key_location print("******************Welcome to our OTP implementation!******************") c = startup(0) while c >= 0: c = encrypt(c) :::'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="PicoCTF"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Crypto"><title>PicoCTF - Easy Peasy | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/picoctf/crypto/classic/picoctf---easy-peasy/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>PicoCTF - Easy Peasy</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#exploit---reuse-key>Exploit - Reuse Key</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=picoctf---easy-peasy>PicoCTF - Easy Peasy
<a class=anchor href=#picoctf---easy-peasy>#</a></h1><h6 id=tags-picoctf-ctf-crypto>tags: <code>PicoCTF</code> <code>CTF</code> <code>Crypto</code>
<a class=anchor href=#tags-picoctf-ctf-crypto>#</a></h6><p>Challenge: <a href>Easy Peasy</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler source code</p><pre tabindex=0><code class="language-python=" data-lang="python=">#!/usr/bin/python3 -u
import os.path

KEY_FILE = &#34;key&#34;
KEY_LEN = 50000
FLAG_FILE = &#34;flag&#34;

def startup(key_location):
	flag = open(FLAG_FILE).read()
	kf = open(KEY_FILE, &#34;rb&#34;).read()

	start = key_location
	stop = key_location + len(flag)

	key = kf[start:stop]
	key_location = stop

	result = list(map(lambda p, k: &#34;{:02x}&#34;.format(ord(p) ^ k), flag, key))
	print(&#34;This is the encrypted flag!\n{}\n&#34;.format(&#34;&#34;.join(result)))

	return key_location

def encrypt(key_location):
	ui = input(&#34;What data would you like to encrypt? &#34;).rstrip()
	if len(ui) == 0 or len(ui) &gt; KEY_LEN:
		return -1

	start = key_location
	stop = key_location + len(ui)

	kf = open(KEY_FILE, &#34;rb&#34;).read()

	if stop &gt;= KEY_LEN:
		stop = stop % KEY_LEN
		key = kf[start:] + kf[:stop]
	else:
		key = kf[start:stop]
	key_location = stop

	result = list(map(lambda p, k: &#34;{:02x}&#34;.format(ord(p) ^ k), ui, key))

	print(&#34;Here ya go!\n{}\n&#34;.format(&#34;&#34;.join(result)))

	return key_location


print(&#34;******************Welcome to our OTP implementation!******************&#34;)
c = startup(0)
while c &gt;= 0:
	c = encrypt(c)
</code></pre><p>:::</p><h2 id=exploit---reuse-key>Exploit - Reuse Key
<a class=anchor href=#exploit---reuse-key>#</a></h2><ol><li><p>Observe the length of key
It&rsquo;s 50000. So, we can reuse it after sending the trash value with length $50000 - len(flag)\ /\ 2$</p></li><li><p>Then send a given strings with length 32
After sending the trash data, we can reuse the key and though we do not know the flag nor key, we can send something with size 32 that we construct ourselves such as <code>'a' * 32</code>
The workflow is as below:
$flag\ xor\ key = A$
${&lsquo;a&rsquo;*32}\ xor\ key = B$
The exploit is $\to$
$B\ xor\ {&lsquo;a&rsquo;*32}=key$
$key\ xor\ A=flag$</p><p>So, the whole expression is $B\ xor\ {&lsquo;a&rsquo;*32}\ xor\ A=flag$</p></li><li><p>These code aimed to find the cipher flag and cipher <code>'a'*32</code></p><pre tabindex=0><code class="language-python!=" data-lang="python!=">from pwn import *
import sys


r = remote(&#39;mercury.picoctf.net&#39;, 11188)
context.arch = &#39;amd64&#39;
r.recvline()
r.recvline()
cipher_flag = r.recvlineS(keepends = False)
log.info(f&#34;Cipher flag: {cipher_flag}&#34;)

r.recvline()
r.sendline(b&#39;a&#39;*(50000 - int(len(cipher_flag) / 2)))
r.recvline()
r.recvline()
r.recvline()
r.sendline(b&#39;a&#39; * 32)
r.recvline()
encrypt_32a = r.recvlineS(keepends = False)
log.info(f&#34;Cipher &#39;a&#39; * 32: {encrypt_32a}&#34;)

plaintext_32a = &#39;61&#39; * 32
log.info(f&#34;Plaintext &#39;a&#39; * 32: {plaintext_32a}&#34;)

r.interactive()
</code></pre></li><li><p>Find flag</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python
</span></span><span style=display:flex><span>&gt;&gt;&gt; a <span style=color:#f92672>=</span> 0x551e6c4c5e55644b56566d1b5100153d4004026a4b52066b4a5556383d4b0007
</span></span><span style=display:flex><span>&gt;&gt;&gt; b <span style=color:#f92672>=</span> 0x03463d1959523d1907513d190503163d1903543d1904573d1900003b3d190457
</span></span><span style=display:flex><span>&gt;&gt;&gt; c <span style=color:#f92672>=</span> 0x6161616161616161616161616161616161616161616161616161616161616161
</span></span><span style=display:flex><span>&gt;&gt;&gt; <span style=color:#e6db74>&#39;{:x}&#39;</span>.format<span style=color:#f92672>(</span>a^b^c<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;3739303466663833306631633562626138663736333730373234376261336531&#39;</span>
</span></span><span style=display:flex><span>&gt;&gt;&gt; print<span style=color:#f92672>(</span>bytes.fromhex<span style=color:#f92672>(</span>d<span style=color:#f92672>)</span>.decode<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;utf-8&#39;</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>7904ff830f1c5bba8f763707247ba3e1
</span></span></code></pre></div><p>The flag is <strong><code>picoCTF{7904ff830f1c5bba8f763707247ba3e1}</code></strong></p></li></ol><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><p><a href=https://youtu.be/VodIW2TT_ag>picoCTF 2021 easypeasy</a>
<a href=https://github.com/Dvd848/CTFs/blob/master/2021_picoCTF/Easy_Peasy.md>Easy Peasy - write up</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#exploit---reuse-key>Exploit - Reuse Key</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>