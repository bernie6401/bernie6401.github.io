<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  PicoCTF - Some Assembly Required 2
  #


  tags: PicoCTF CTF Web
  #


  Background
  #


  Source code
  #

:::spoiler source
const list_str = ['copy_char', 'value', '207aLjBod', '1301420SaUSqf', '233ZRpipt', '2224QffgXU', 'check_flag', '408533hsoVYx', 'instance', '278338GVFUrH', 'Correct!', '549933ZVjkwI', 'innerHTML', 'charCodeAt', './aD8SvhyVkb', 'result', '977AzKzwq', 'Incorrect!', 'exports', 'length', 'getElementById', '1jIrMBu', 'input', '615361geljRK'];
const func1_cal = function(var_a, var_b) {
    var_a = var_a - 195;
    let list_strc4 = list_str[var_a];
    return list_strc4;
};
(function(var_a, var_b) {
    const func1_cal = func1_cal;
    while (!![]) {
        try {
            const var_c = -parseInt(func1_cal(200)) * -parseInt(func1_cal(201)) + -parseInt(func1_cal(205)) + parseInt(func1_cal(207)) + parseInt(func1_cal(195)) + -parseInt(func1_cal(198)) * parseInt(func1_cal(212)) + parseInt(func1_cal(203)) + -parseInt(func1_cal(217)) * parseInt(func1_cal(199));
            if (var_c === var_b) break;
            else var_a['push'](var_a['shift']());
        } catch (_0x4f8a) {
            var_a['push'](var_a['shift']());
        }
    }
}(list_str, 310022));
let exports;
(async () => {
    const func1_cal = func1_cal;
    let res_1 = await fetch(func1_cal(210)),
        res_2 = await WebAssembly['instantiate'](await res_1['arrayBuffer']()),
        res_3 = res_2[func1_cal(204)];
    exports = res_3[func1_cal(214)];
})();

function onButtonPress() {
    const func1_cal = func1_cal;
    let res_1 = document[func1_cal(216)](func1_cal(218))[func1_cal(197)];
    for (let idx = 0; idx < res_1['length']; idx++) {
        exports[func1_cal(196)](res_1[func1_cal(209)](idx), idx);
    }
    exports['copy_char'](0, res_1[func1_cal(215)]), exports[func1_cal(202)]() == 1 ? document['getElementById'](func1_cal(211))[func1_cal(208)] = func1_cal(206) : document[func1_cal(216)](func1_cal(211))['innerHTML'] = func1_cal(213);
}
:::"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/picoctf/web/picoctf---some-assembly-required-2/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="PicoCTF - Some Assembly Required 2"><meta property="og:description" content="PicoCTF - Some Assembly Required 2 # tags: PicoCTF CTF Web # Background # Source code # :::spoiler source
const list_str = ['copy_char', 'value', '207aLjBod', '1301420SaUSqf', '233ZRpipt', '2224QffgXU', 'check_flag', '408533hsoVYx', 'instance', '278338GVFUrH', 'Correct!', '549933ZVjkwI', 'innerHTML', 'charCodeAt', './aD8SvhyVkb', 'result', '977AzKzwq', 'Incorrect!', 'exports', 'length', 'getElementById', '1jIrMBu', 'input', '615361geljRK']; const func1_cal = function(var_a, var_b) { var_a = var_a - 195; let list_strc4 = list_str[var_a]; return list_strc4; }; (function(var_a, var_b) { const func1_cal = func1_cal; while (!![]) { try { const var_c = -parseInt(func1_cal(200)) * -parseInt(func1_cal(201)) + -parseInt(func1_cal(205)) + parseInt(func1_cal(207)) + parseInt(func1_cal(195)) + -parseInt(func1_cal(198)) * parseInt(func1_cal(212)) + parseInt(func1_cal(203)) + -parseInt(func1_cal(217)) * parseInt(func1_cal(199)); if (var_c === var_b) break; else var_a['push'](var_a['shift']()); } catch (_0x4f8a) { var_a['push'](var_a['shift']()); } } }(list_str, 310022)); let exports; (async () => { const func1_cal = func1_cal; let res_1 = await fetch(func1_cal(210)), res_2 = await WebAssembly['instantiate'](await res_1['arrayBuffer']()), res_3 = res_2[func1_cal(204)]; exports = res_3[func1_cal(214)]; })(); function onButtonPress() { const func1_cal = func1_cal; let res_1 = document[func1_cal(216)](func1_cal(218))[func1_cal(197)]; for (let idx = 0; idx < res_1['length']; idx++) { exports[func1_cal(196)](res_1[func1_cal(209)](idx), idx); } exports['copy_char'](0, res_1[func1_cal(215)]), exports[func1_cal(202)]() == 1 ? document['getElementById'](func1_cal(211))[func1_cal(208)] = func1_cal(206) : document[func1_cal(216)](func1_cal(211))['innerHTML'] = func1_cal(213); } :::"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="PicoCTF"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Web"><title>PicoCTF - Some Assembly Required 2 | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/picoctf/web/picoctf---some-assembly-required-2/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>PicoCTF - Some Assembly Required 2</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#exploit>Exploit</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=picoctf---some-assembly-required-2>PicoCTF - Some Assembly Required 2
<a class=anchor href=#picoctf---some-assembly-required-2>#</a></h1><h6 id=tags-picoctf-ctf-web>tags: <code>PicoCTF</code> <code>CTF</code> <code>Web</code>
<a class=anchor href=#tags-picoctf-ctf-web>#</a></h6><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler source</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>list_str</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;copy_char&#39;</span>, <span style=color:#e6db74>&#39;value&#39;</span>, <span style=color:#e6db74>&#39;207aLjBod&#39;</span>, <span style=color:#e6db74>&#39;1301420SaUSqf&#39;</span>, <span style=color:#e6db74>&#39;233ZRpipt&#39;</span>, <span style=color:#e6db74>&#39;2224QffgXU&#39;</span>, <span style=color:#e6db74>&#39;check_flag&#39;</span>, <span style=color:#e6db74>&#39;408533hsoVYx&#39;</span>, <span style=color:#e6db74>&#39;instance&#39;</span>, <span style=color:#e6db74>&#39;278338GVFUrH&#39;</span>, <span style=color:#e6db74>&#39;Correct!&#39;</span>, <span style=color:#e6db74>&#39;549933ZVjkwI&#39;</span>, <span style=color:#e6db74>&#39;innerHTML&#39;</span>, <span style=color:#e6db74>&#39;charCodeAt&#39;</span>, <span style=color:#e6db74>&#39;./aD8SvhyVkb&#39;</span>, <span style=color:#e6db74>&#39;result&#39;</span>, <span style=color:#e6db74>&#39;977AzKzwq&#39;</span>, <span style=color:#e6db74>&#39;Incorrect!&#39;</span>, <span style=color:#e6db74>&#39;exports&#39;</span>, <span style=color:#e6db74>&#39;length&#39;</span>, <span style=color:#e6db74>&#39;getElementById&#39;</span>, <span style=color:#e6db74>&#39;1jIrMBu&#39;</span>, <span style=color:#e6db74>&#39;input&#39;</span>, <span style=color:#e6db74>&#39;615361geljRK&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>func1_cal</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>var_a</span>, <span style=color:#a6e22e>var_b</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>var_a</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>var_a</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>195</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>list_strc4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>list_str</span>[<span style=color:#a6e22e>var_a</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>list_strc4</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>var_a</span>, <span style=color:#a6e22e>var_b</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>func1_cal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>func1_cal</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#f92672>!!</span>[]) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>var_c</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>200</span>)) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>201</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>205</span>)) <span style=color:#f92672>+</span> parseInt(<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>207</span>)) <span style=color:#f92672>+</span> parseInt(<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>195</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>198</span>)) <span style=color:#f92672>*</span> parseInt(<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>212</span>)) <span style=color:#f92672>+</span> parseInt(<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>203</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>217</span>)) <span style=color:#f92672>*</span> parseInt(<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>199</span>));
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>var_c</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>var_b</span>) <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>var_a</span>[<span style=color:#e6db74>&#39;push&#39;</span>](<span style=color:#a6e22e>var_a</span>[<span style=color:#e6db74>&#39;shift&#39;</span>]());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>_0x4f8a</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>var_a</span>[<span style=color:#e6db74>&#39;push&#39;</span>](<span style=color:#a6e22e>var_a</span>[<span style=color:#e6db74>&#39;shift&#39;</span>]());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}(<span style=color:#a6e22e>list_str</span>, <span style=color:#ae81ff>310022</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>exports</span>;
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>func1_cal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>func1_cal</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>res_1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>210</span>)),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res_2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>WebAssembly</span>[<span style=color:#e6db74>&#39;instantiate&#39;</span>](<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>res_1</span>[<span style=color:#e6db74>&#39;arrayBuffer&#39;</span>]()),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res_3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>res_2</span>[<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>204</span>)];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>res_3</span>[<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>214</span>)];
</span></span><span style=display:flex><span>})();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onButtonPress</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>func1_cal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>func1_cal</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>res_1</span> <span style=color:#f92672>=</span> document[<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>216</span>)](<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>218</span>))[<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>197</span>)];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>idx</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>idx</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>res_1</span>[<span style=color:#e6db74>&#39;length&#39;</span>]; <span style=color:#a6e22e>idx</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>exports</span>[<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>196</span>)](<span style=color:#a6e22e>res_1</span>[<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>209</span>)](<span style=color:#a6e22e>idx</span>), <span style=color:#a6e22e>idx</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span>[<span style=color:#e6db74>&#39;copy_char&#39;</span>](<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>res_1</span>[<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>215</span>)]), <span style=color:#a6e22e>exports</span>[<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>202</span>)]() <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> document[<span style=color:#e6db74>&#39;getElementById&#39;</span>](<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>211</span>))[<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>208</span>)] <span style=color:#f92672>=</span> <span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>206</span>) <span style=color:#f92672>:</span> document[<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>216</span>)](<span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>211</span>))[<span style=color:#e6db74>&#39;innerHTML&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>func1_cal</span>(<span style=color:#ae81ff>213</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>:::</p><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><p>這一題也是想破頭了，首先應該很容易可以拿到前端驗證的code如上，beautify之後可以看到一個<code>./aD8SvhyVkb</code>的可疑檔案，取得之後發現是一個<code>.wasm</code> file</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ file aD8SvhyVkb
</span></span><span style=display:flex><span>aD8SvhyVkb: WebAssembly <span style=color:#f92672>(</span>wasm<span style=color:#f92672>)</span> binary module version 0x1 <span style=color:#f92672>(</span>MVP<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>$ strings aD8SvhyVkb
</span></span><span style=display:flex><span>memory
</span></span><span style=display:flex><span>__wasm_call_ctors
</span></span><span style=display:flex><span>strcmp
</span></span><span style=display:flex><span>check_flag
</span></span><span style=display:flex><span>input
</span></span><span style=display:flex><span>        copy_char
</span></span><span style=display:flex><span>__dso_handle
</span></span><span style=display:flex><span>__data_end
</span></span><span style=display:flex><span>__global_base
</span></span><span style=display:flex><span>__heap_base
</span></span><span style=display:flex><span>__memory_base
</span></span><span style=display:flex><span>__table_base
</span></span><span style=display:flex><span>j!
</span></span><span style=display:flex><span>  F!!A
</span></span><span style=display:flex><span>!<span style=color:#e6db74>&#34; ! &#34;</span>q!# <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>!% $ %q!&amp;
</span></span><span style=display:flex><span>!<span style=color:#f92672>(</span> <span style=color:#960050;background-color:#1e0010>&#39;</span> <span style=color:#f92672>(</span>q!<span style=color:#f92672>)</span> &amp; <span style=color:#f92672>)</span>k!*
</span></span><span style=display:flex><span>!+ +
</span></span><span style=display:flex><span>        q!
</span></span><span style=display:flex><span>+xakgK<span style=color:#ae81ff>\N</span>s&gt;&lt;m:i1&gt;1991:nkjl&lt;ii1j0n<span style=color:#f92672>=</span>mm09;&lt;i:u
</span></span></code></pre></div><p>感覺最後的字串有一點奇怪，丟到<a href=https://gchq.github.io/CyberChef>cyberchef</a>用magic解看看，就出現flag了，其實就只是XOR 8而已
Flag: <code>picoCTF{64e2a9691192fcbd4aa9b8f5ee8134a2}</code></p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><p><a href=https://youtu.be/2TCZEkW0bjc>picoCTF 2021 Some Assembly Required 2</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#source-code>Source code</a></li><li><a href=#exploit>Exploit</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>