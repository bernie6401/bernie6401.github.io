<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  BTLO - Secrets
  #

Challenge: https://blueteamlabs.online/home/challenge/secrets-85aa2bb3a9
:::spoiler TOC
[TOC]
:::

  Scenario
  #


You’re a senior cyber security engineer and during your shift, we have intercepted/noticed a high privilege actions from unknown source that could be identified as malicious. We have got you the ticket that made these actions.
You are the one who created the secret for these tickets. Please fix this and submit the low privilege ticket so we can make sure that you deserve this position.
Here is the ticket:"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/security/practice/btlo/incident-response/btlo---secrets/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="BTLO - Secrets"><meta property="og:description" content="BTLO - Secrets # Challenge: https://blueteamlabs.online/home/challenge/secrets-85aa2bb3a9
:::spoiler TOC [TOC] :::
Scenario # You’re a senior cyber security engineer and during your shift, we have intercepted/noticed a high privilege actions from unknown source that could be identified as malicious. We have got you the ticket that made these actions. You are the one who created the secret for these tickets. Please fix this and submit the low privilege ticket so we can make sure that you deserve this position. Here is the ticket:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="security"><meta property="article:tag" content="BTLO"><meta property="article:tag" content="Incident Response"><title>BTLO - Secrets | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/security/practice/btlo/incident-response/btlo---secrets/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>BTLO - Secrets</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#scenario>Scenario</a></li><li><a href=#q1>==Q1==</a><ul><li><a href=#recon>Recon</a></li></ul></li><li><a href=#q2>==Q2==</a><ul><li><a href=#recon-1>Recon</a></li></ul></li><li><a href=#q3>==Q3==</a><ul><li><a href=#recon-2>Recon</a></li></ul></li><li><a href=#q4>==Q4==</a><ul><li><a href=#recon-3>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#q5>==Q5==</a><ul><li><a href=#recon-4>Recon</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=btlo---secrets>BTLO - Secrets
<a class=anchor href=#btlo---secrets>#</a></h1><p>Challenge: <a href=https://blueteamlabs.online/home/challenge/secrets-85aa2bb3a9>https://blueteamlabs.online/home/challenge/secrets-85aa2bb3a9</a></p><p>:::spoiler TOC
[TOC]
:::</p><h2 id=scenario>Scenario
<a class=anchor href=#scenario>#</a></h2><blockquote><p>You’re a senior cyber security engineer and during your shift, we have intercepted/noticed a high privilege actions from unknown source that could be identified as malicious. We have got you the ticket that made these actions.
You are the one who created the secret for these tickets. Please fix this and submit the low privilege ticket so we can make sure that you deserve this position.
Here is the ticket:</p><p>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmbGFnIjoiQlRMe180X0V5ZXN9IiwiaWF0Ijo5MDAwMDAwMCwibmFtZSI6IkdyZWF0RXhwIiwiYWRtaW4iOnRydWV9.jbkZHll_W17BOALT95JQ17glHBj9nY-oWhT1uiahtv8</p></blockquote><h2 id=q1>==Q1==
<a class=anchor href=#q1>#</a></h2><blockquote><p>Can you identify the name of the token? (Format: String)</p></blockquote><h3 id=recon>Recon
<a class=anchor href=#recon>#</a></h3><p>看到三段用<code>.</code>拼起來就直覺是jwt</p><p>:::spoiler Flag
Flag: <code>jwt</code>
:::</p><h2 id=q2>==Q2==
<a class=anchor href=#q2>#</a></h2><blockquote><p>What is the structure of this token? (Format: Section.Section.Section)</p></blockquote><h3 id=recon-1>Recon
<a class=anchor href=#recon-1>#</a></h3><p>Common Sense就是header + payload + signature
<img src=https://hackmd.io/_uploads/rk--WjCva.png alt=圖片></p><p>:::spoiler Flag
Flag: <code>header.payload.signature</code>
:::</p><h2 id=q3>==Q3==
<a class=anchor href=#q3>#</a></h2><blockquote><p>What is the hint you found from this token? (Format: String)</p></blockquote><h3 id=recon-2>Recon
<a class=anchor href=#recon-2>#</a></h3><p>這一題真的不知道在衝三小，最後參考<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>才知道，但實在是太隱晦了，不管是問題還是答案出乎意料</p><p>:::spoiler Flag
Flag: <code>_4_Eyes</code>
:::</p><h2 id=q4>==Q4==
<a class=anchor href=#q4>#</a></h2><blockquote><p>What is the Secret? (Format: String)</p></blockquote><h3 id=recon-3>Recon
<a class=anchor href=#recon-3>#</a></h3><p>這個直覺就是要爆破簽署的secrets，因為看來看去都沒有其他地方有leak出來，所以可以用hashcat或是john爆破出來</p><h3 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h3><ul><li>Hashcat - <a href=https://blog.pentesteracademy.com/hacking-jwt-tokens-bruteforcing-weak-signing-key-hashcat-7dba165e905e>Hacking JWT Tokens: Bruteforcing Weak Signing Key (Hashcat)</a><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmbGFnIjoiQlRMe180X0V5ZXN9IiwiaWF0Ijo5MDAwMDAwMCwibmFtZSI6IkdyZWF0RXhwIiwiYWRtaW4iOnRydWV9.jbkZHll_W17BOALT95JQ17glHBj9nY-oWhT1uiahtv8&#39;</span>&gt; jwt.txt
</span></span><span style=display:flex><span>$ hashcat -a <span style=color:#ae81ff>3</span> -m <span style=color:#ae81ff>16500</span> jwt.txt ?a?a?a?a
</span></span><span style=display:flex><span>hashcat <span style=color:#f92672>(</span>v6.2.6<span style=color:#f92672>)</span> starting
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>OpenCL API <span style=color:#f92672>(</span>OpenCL 3.0 PoCL 4.0+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.7, SLEEF, DISTRO, POCL_DEBUG<span style=color:#f92672>)</span> - Platform <span style=color:#75715e>#1 [The pocl project]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>==================================================================================================================================================</span>
</span></span><span style=display:flex><span>* Device <span style=color:#75715e>#1: cpu-sandybridge-Intel(R) Core(TM) i7-10700F CPU @ 2.90GHz, 2910/5884 MB (1024 MB allocatable), 4MCU</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Minimum password length supported by kernel: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Maximum password length supported by kernel: <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Hashes: <span style=color:#ae81ff>1</span> digests; <span style=color:#ae81ff>1</span> unique digests, <span style=color:#ae81ff>1</span> unique salts
</span></span><span style=display:flex><span>Bitmaps: <span style=color:#ae81ff>16</span> bits, <span style=color:#ae81ff>65536</span> entries, 0x0000ffff mask, <span style=color:#ae81ff>262144</span> bytes, 5/13 rotates
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Optimizers applied:
</span></span><span style=display:flex><span>* Zero-Byte
</span></span><span style=display:flex><span>* Not-Iterated
</span></span><span style=display:flex><span>* Single-Hash
</span></span><span style=display:flex><span>* Single-Salt
</span></span><span style=display:flex><span>* Brute-Force
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Watchdog: Temperature abort trigger set to 90c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host memory required <span style=color:#66d9ef>for</span> this attack: <span style=color:#ae81ff>1</span> MB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmbGFnIjoiQlRMe180X0V5ZXN9IiwiaWF0Ijo5MDAwMDAwMCwibmFtZSI6IkdyZWF0RXhwIiwiYWRtaW4iOnRydWV9.jbkZHll_W17BOALT95JQ17glHBj9nY-oWhT1uiahtv8:bT!0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Session..........: hashcat
</span></span><span style=display:flex><span>Status...........: Cracked
</span></span><span style=display:flex><span>Hash.Mode........: <span style=color:#ae81ff>16500</span> <span style=color:#f92672>(</span>JWT <span style=color:#f92672>(</span>JSON Web Token<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>Hash.Target......: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmbGFnIjoiQl...iahtv8
</span></span><span style=display:flex><span>Time.Started.....: Sun Dec <span style=color:#ae81ff>31</span> 03:50:45 <span style=color:#ae81ff>2023</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>7</span> secs<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Time.Estimated...: Sun Dec <span style=color:#ae81ff>31</span> 03:50:52 <span style=color:#ae81ff>2023</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> secs<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Kernel.Feature...: Pure Kernel
</span></span><span style=display:flex><span>Guess.Mask.......: ?a?a?a?a <span style=color:#f92672>[</span>4<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Guess.Queue......: 1/1 <span style=color:#f92672>(</span>100.00%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Speed.#1.........:  2621.9 kH/s <span style=color:#f92672>(</span>6.10ms<span style=color:#f92672>)</span> @ Accel:128 Loops:47 Thr:1 Vec:8
</span></span><span style=display:flex><span>Recovered........: 1/1 <span style=color:#f92672>(</span>100.00%<span style=color:#f92672>)</span> Digests <span style=color:#f92672>(</span>total<span style=color:#f92672>)</span>, 1/1 <span style=color:#f92672>(</span>100.00%<span style=color:#f92672>)</span> Digests <span style=color:#f92672>(</span>new<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Progress.........: 16902144/81450625 <span style=color:#f92672>(</span>20.75%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Rejected.........: 0/16902144 <span style=color:#f92672>(</span>0.00%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Restore.Point....: 177664/857375 <span style=color:#f92672>(</span>20.72%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Restore.Sub.#1...: Salt:0 Amplifier:0-47 Iteration:0-47
</span></span><span style=display:flex><span>Candidate.Engine.: Device Generator
</span></span><span style=display:flex><span>Candidates.#1....: s5VH -&gt; RT^a
</span></span><span style=display:flex><span>Hardware.Mon.#1..: Util: 95%
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Started: Sun Dec <span style=color:#ae81ff>31</span> 03:50:44 <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>Stopped: Sun Dec <span style=color:#ae81ff>31</span> 03:50:53 <span style=color:#ae81ff>2023</span>
</span></span></code></pre></div></li><li>John - <a href=https://blog.pentesteracademy.com/hacking-jwt-tokens-bruteforcing-weak-signing-key-johntheripper-89f0c7e6a87>Hacking JWT Tokens: Bruteforcing Weak Signing Key (JohnTheRipper)</a>
這要取決於wordlist有沒有，所以我只是先以secret=1234，然後用john爆破
<img src=https://hackmd.io/_uploads/rkTfhsRDT.png alt=圖片><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmbGFnIjoiQlRMe180X0V5ZXN9IiwiaWF0Ijo5MDAwMDAwMCwibmFtZSI6IkdyZWF0RXhwIiwiYWRtaW4iOnRydWV9.2kwB24fBrrmotFu9cdeRb1EMg1kRfGlLQPvhE1OUtp0&#39;</span>&gt; jwt.txt
</span></span><span style=display:flex><span>$ john jwt.txt --wordlist<span style=color:#f92672>=</span>/usr/share/wordlists/rockyou.txt --format<span style=color:#f92672>=</span>HMAC-SHA256                                                                                                                 
</span></span><span style=display:flex><span>Using default input encoding: UTF-8
</span></span><span style=display:flex><span>Loaded <span style=color:#ae81ff>1</span> password hash <span style=color:#f92672>(</span>HMAC-SHA256 <span style=color:#f92672>[</span>password is key, SHA256 128/128 AVX 4x<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>Will run <span style=color:#ae81ff>4</span> OpenMP threads
</span></span><span style=display:flex><span>Press <span style=color:#e6db74>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#66d9ef>for</span> status
</span></span><span style=display:flex><span><span style=color:#ae81ff>1234</span>             <span style=color:#f92672>(</span>?<span style=color:#f92672>)</span>     
</span></span><span style=display:flex><span>1g 0:00:00:00 DONE <span style=color:#f92672>(</span>2023-12-31 03:46<span style=color:#f92672>)</span> 100.0g/s 409600p/s 409600c/s 409600C/s 123456..oooooo
</span></span><span style=display:flex><span>Use the <span style=color:#e6db74>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span style=display:flex><span>Session completed. 
</span></span></code></pre></div></li></ul><p>:::spoiler Flag
Flag: <code>bT!0</code>
:::</p><h2 id=q5>==Q5==
<a class=anchor href=#q5>#</a></h2><blockquote><p>Can you generate a new verified signature ticket with a low privilege? (Format: String.String.String)</p></blockquote><h3 id=recon-4>Recon
<a class=anchor href=#recon-4>#</a></h3><p>我們知道了secrets===bT!0==，所以我們可以用這個secrets簽章新的payload
<img src=https://hackmd.io/_uploads/ByhNToRvT.png alt=圖片></p><p>:::spoiler Flag
Flag: <code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmbGFnIjoiQlRMe180X0V5ZXN9IiwiaWF0Ijo5MDAwMDAwMCwibmFtZSI6IkdyZWF0RXhwIiwiYWRtaW4iOmZhbHNlfQ.nMXNFvttCvtDcpswOQA8u_LpURwv6ZrCJ-ftIXegtX4</code>
:::</p><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://medium.com/@prajjwal029/btlo-secrets-5314312e4aef>BTLO — Secrets Walkthrough</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#scenario>Scenario</a></li><li><a href=#q1>==Q1==</a><ul><li><a href=#recon>Recon</a></li></ul></li><li><a href=#q2>==Q2==</a><ul><li><a href=#recon-1>Recon</a></li></ul></li><li><a href=#q3>==Q3==</a><ul><li><a href=#recon-2>Recon</a></li></ul></li><li><a href=#q4>==Q4==</a><ul><li><a href=#recon-3>Recon</a></li><li><a href=#exploit>Exploit</a></li></ul></li><li><a href=#q5>==Q5==</a><ul><li><a href=#recon-4>Recon</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside></main></body></html>