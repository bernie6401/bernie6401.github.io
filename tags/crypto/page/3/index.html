<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/tags/crypto/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="Crypto"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><title>Crypto | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/tags/crypto/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script><link rel=alternate type=application/rss+xml href=https://bernie6401.github.io/tags/crypto/index.xml title="SBK Hugo Site"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Crypto</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav><ul><li class=book-section-flat><strong>Categories</strong><ul></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/ad/>AD</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/adworld/>Adworld</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/aegis/>AEGIS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ai/>AI</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ais3/>AIS3</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/android/>Android</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/balsnctf/>BalsnCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/book/>Book</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/btlo/>BTLO</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/cggc/>CGGC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/chatgpt/>ChatGPT</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/crewctf/>CrewCTF</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/crypto/>Crypto</a>
<span>36</span></li><li class="flex justify-between"><a href=/tags/cryptography/>Cryptography</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/csc/>CSC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ctf/>CTF</a>
<span>267</span></li><li class="flex justify-between"><a href=/tags/cyberdefender/>CyberDefender</a>
<span>23</span></li><li class="flex justify-between"><a href=/tags/data-structure/>Data Structure</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/deadfacectf/>DeadFaceCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/digital-forensics/>Digital Forensics</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/drozer/>Drozer</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/easy/>Easy</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/eductf/>Eductf</a>
<span>85</span></li><li class="flex justify-between"><a href=/tags/endpoint-forensics/>Endpoint Forensics</a>
<span>16</span></li><li class="flex justify-between"><a href=/tags/english-writing/>English Writing</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/forensics/>Forensics</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/general-skill/>General Skill</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/hackthebox/>Hackthebox</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/incident-response/>Incident Response</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/information-security/>Information Security</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/interview/>Interview</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/latex/>LaTeX</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/leetcode/>LeetCode</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/machine-learning/>Machine Learning</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/malware-reverse-engineering-and-analysis/>Malware Reverse Engineering and Analysis</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/meeting-paper/>Meeting Paper</a>
<span>20</span></li><li class="flex justify-between"><a href=/tags/misc/>Misc</a>
<span>44</span></li><li class="flex justify-between"><a href=/tags/mobsf/>MobSF</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/network-forensics/>Network Forensics</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/nisra/>NISRA</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu/>NTU</a>
<span>67</span></li><li class="flex justify-between"><a href=/tags/ntu_ct/>NTU_CT</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/ntu_ml/>NTU_ML</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/ntu_mr/>NTU_MR</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/ntu_os/>NTU_OS</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/ntu_padns/>NTU_PADNS</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu_st/>NTU_ST</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/ntucns/>NTUCNS</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/ntust/>NTUST</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ntustisc/>NTUSTISC</a>
<span>32</span></li><li class="flex justify-between"><a href=/tags/ntustws/>NTUSTWS</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/nycu/>NYCU</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/picoctf/>PicoCTF</a>
<span>112</span></li><li class="flex justify-between"><a href=/tags/portswigger-web-security-academy/>Portswigger Web Security Academy</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/problem-solution/>Problem Solution</a>
<span>28</span></li><li class="flex justify-between"><a href=/tags/pwn/>PWN</a>
<span>57</span></li><li class="flex justify-between"><a href=/tags/reverse/>Reverse</a>
<span>46</span></li><li class="flex justify-between"><a href=/tags/security-operation/>Security Operation</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/side-project/>Side Project</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/software-testing/>Software Testing</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/special-topic/>Special Topic</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/taiwanholyhigh/>TaiwanHolyHigh</a>
<span>9</span></li><li class="flex justify-between"><a href=/tags/tcivs/>TCIVS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/threat-intel/>Threat Intel</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/tools/>Tools</a>
<span>19</span></li><li class="flex justify-between"><a href=/tags/tscctf/>TSCCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/web/>Web</a>
<span>93</span></li><li class="flex justify-between"><a href=/tags/welcome/>Welcome</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/windows/>Windows</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/%E5%90%8D%E8%A9%9E%E8%A7%A3%E9%87%8B/>名詞解釋</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/%E8%AE%80%E6%9B%B8%E5%BF%83%E5%BE%97/>讀書心得</a>
<span>2</span></li></ul></li></ul></nav></aside></header><article class="markdown book-post"><h2><a href=/security/practice/picoctf/crypto/classic/picoctf---xtraordinary/>PicoCTF - XtraORdinary</a></h2><div class=text-small><a href=/tags/picoctf/>PicoCTF</a>,
<a href=/tags/ctf/>CTF</a>,
<a href=/tags/crypto/>Crypto</a></div><p><h1 id=picoctf---xtraordinary>PicoCTF - XtraORdinary
<a class=anchor href=#picoctf---xtraordinary>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://blog.finxter.com/how-to-convert-hex-string-to-bytes-in-python/>How to Convert Hex String to Bytes in Python?</a>
<a href=https://myapollo.com.tw/blog/python-itertools-more-itertools/>Python 好用模組介紹 - itertools & more-itertools</a>
<a href=https://www.w3schools.com/python/ref_file_readline.asp>Python File readline() Method</a>
<a href=https://www.geeksforgeeks.org/python-append-to-a-file/>Python append to a file</a></p><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler Source Code</p><pre tabindex=0><code class="language-python=" data-lang="python=">#!/usr/bin/env python3

from random import randint
with open(&#39;flag.txt&#39;, &#39;rb&#39;) as f:
    flag = f.read()

with open(&#39;secret-key.txt&#39;, &#39;rb&#39;) as f:
    key = f.read()

def encrypt(ptxt, key):
    ctxt = b&#39;&#39;
    for i in range(len(ptxt)):
        a = ptxt[i]
        b = key[i % len(key)]
        ctxt += bytes([a ^ b])
    return ctxt

ctxt = encrypt(flag, key)

random_strs = [
    b&#39;my encryption method&#39;,
    b&#39;is absolutely impenetrable&#39;,
    b&#39;and you will never&#39;,
    b&#39;ever&#39;,
    b&#39;ever&#39;,
    b&#39;ever&#39;,
    b&#39;ever&#39;,
    b&#39;ever&#39;,
    b&#39;ever&#39;,
    b&#39;break it&#39;
]

for random_str in random_strs:
    for i in range(randint(0, pow(2, 8))):
        for j in range(randint(0, pow(2, 6))):
            for k in range(randint(0, pow(2, 4))):
                for l in range(randint(0, pow(2, 2))):
                    for m in range(randint(0, pow(2, 0))):
                        ctxt = encrypt(ctxt, random_str)

with open(&#39;output.txt&#39;, &#39;w&#39;) as f:
    f.write(ctxt.hex())
</code></pre><p>:::</p><a href=/security/practice/picoctf/crypto/classic/picoctf---xtraordinary/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/crypto/simple-crypto---0x01modular-operation/>Simple Crypto - 0x01(Modular Operation)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/crypto/>Crypto</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-crypto---0x01modular-operation>Simple Crypto - 0x01(Modular Operation)
<a class=anchor href=#simple-crypto---0x01modular-operation>#</a></h1><h6 id=tags-ctf-crypto-eductf>tags: <code>CTF</code> <code>Crypto</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-crypto-eductf>#</a></h6><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://ithelp.ithome.com.tw/articles/10225768>『Day 23密碼卷宗現代篇非對稱章 - RSA</a>
<a href=https://blog.csdn.net/lion19930924/article/details/61926019>模运算与逆元</a>
模運算基本特性:
$$
(a + b) % p = (a % p + b % p) % p \
(a - b) % p = (a % p - b % p) % p \
(a * b) % p = (a % p * b % p) % p \
(a ^ b) % p = ((a % p) ^ b ) % p
$$
模運算的结合律：
$$
((a + b) % p + c) % p= (a + (b + c) % p) % p \
((a * b) % p * c) % p = (a * (b * c) % p ) % p
$$
交換律：
$$
(a + b) % p = (b+a) % p \
(a * b) % p = (b * a) % p
$$
分配率：
$$
((a +b) % p * c) % p = ((a * c) % p + (b * c) % p) % p
$$</p><a href=/security/course/ntu-cs/crypto/simple-crypto---0x01modular-operation/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/crypto/simple-crypto---0x02random-number-generator---lcg/>Simple Crypto - 0x02(Random Number Generator - LCG)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/crypto/>Crypto</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-crypto---0x02random-number-generator---lcg>Simple Crypto - 0x02(Random Number Generator - LCG)
<a class=anchor href=#simple-crypto---0x02random-number-generator---lcg>#</a></h1><h6 id=tags-ctf-crypto-eductf>tags: <code>CTF</code> <code>Crypto</code> <code>eductf</code>
<a class=anchor href=#tags-ctf-crypto-eductf>#</a></h6><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>Linear Congruential Generator:
<img src=https://i.imgur.com/pCTWEcO.png alt></p><h2 id=analysis>Analysis
<a class=anchor href=#analysis>#</a></h2><p>LCG Formula
$$
\begin{aligned}
Unknown: S_0&=Seed,\ A,\ B,\ m = 2^{32} \
Given: S_1&,\ S_2,\ S_3\
S_1 &\equiv (AS_0\ +\ B)\ %\ m\
S_2 &\equiv (AS_1\ +\ B)\ %\ m\
S_3 &\equiv (AS_2\ +\ B)\ %\ m\
\end{aligned}
$$</p><p>Derived A
$$
\begin{aligned}
&\left{
\begin{array}{c}
S_2 &\equiv (AS_1\ +\ B)\ %\ m\
S_3 &\equiv (AS_2\ +\ B)\ %\ m
\end{array}
\right.
\ \ \ \ \ \ minus \ two \ formula\ \
&\to (S_2-S_3) \equiv (AS_1\ +\ B)\ %\ m-(AS_2\ +\ B)\ %\ m \
&\to (S_2-S_3)\ % \ m\equiv [(AS_1\ +\ B)\ %\ m-(AS_2\ +\ B)\ %\ m]\ %\ m \
&\to (S_2-S_3)\ % \ m\equiv [(AS_1\ +\ B)-(AS_2\ +\ B)]\ %\ m \
&\to (S_2-S_3)\ % \ m\equiv \ A\ (S_1-S_2)\ \ %\ m =(S_2-S_3)\
A&=((S_2-S_3)(S_1-S_2)^{-1})\ %\ m
\end{aligned}
$$</p><a href=/security/course/ntu-cs/crypto/simple-crypto---0x02random-number-generator---lcg/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/crypto/simple-crypto---0x032023-lab---cor/>Simple Crypto - 0x03(2023 Lab - COR)</a></h2><div class=text-small><a href=/tags/eductf/>Eductf</a>,
<a href=/tags/crypto/>Crypto</a>,
<a href=/tags/ctf/>CTF</a></div><p><h1 id=simple-crypto---0x032023-lab---cor>Simple Crypto - 0x03(2023 Lab - COR)
<a class=anchor href=#simple-crypto---0x032023-lab---cor>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href=https://hackmd.io/@SBK6401/rkiE18Kas>Simple Crypto - 0x03(Lab - LFSR)</a></p><h2 id=source-code>Source Code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> random
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> secret <span style=color:#f92672>import</span> FLAG
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LFSR</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, tap, state):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_tap <span style=color:#f92672>=</span> tap
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_state <span style=color:#f92672>=</span> state
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getbit</span>(self):
</span></span><span style=display:flex><span>        f <span style=color:#f92672>=</span> sum([self<span style=color:#f92672>.</span>_state[i] <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>_tap]) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        x <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_state[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_state <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_state[<span style=color:#ae81ff>1</span>:] <span style=color:#f92672>+</span> [f]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> x
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>triLFSR</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, lfsr1, lfsr2, lfsr3):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lfsr1 <span style=color:#f92672>=</span> lfsr1
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lfsr2 <span style=color:#f92672>=</span> lfsr2
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lfsr3 <span style=color:#f92672>=</span> lfsr3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getbit</span>(self):
</span></span><span style=display:flex><span>        x1 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>lfsr1<span style=color:#f92672>.</span>getbit()
</span></span><span style=display:flex><span>        x2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>lfsr2<span style=color:#f92672>.</span>getbit()
</span></span><span style=display:flex><span>        x3 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>lfsr3<span style=color:#f92672>.</span>getbit()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> x2 <span style=color:#66d9ef>if</span> x1 <span style=color:#66d9ef>else</span> x3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lfsr1 <span style=color:#f92672>=</span> LFSR([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>5</span>], [random<span style=color:#f92672>.</span>randrange(<span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>19</span>)])
</span></span><span style=display:flex><span>lfsr2 <span style=color:#f92672>=</span> LFSR([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>5</span>], [random<span style=color:#f92672>.</span>randrange(<span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>23</span>)])
</span></span><span style=display:flex><span>lfsr3 <span style=color:#f92672>=</span> LFSR([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>5</span>], [random<span style=color:#f92672>.</span>randrange(<span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>27</span>)])
</span></span><span style=display:flex><span>cipher <span style=color:#f92672>=</span> triLFSR(lfsr1, lfsr2, lfsr3)
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> map(int, <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join([<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:08b}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(c) <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> FLAG]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>200</span>):
</span></span><span style=display:flex><span>    output<span style=color:#f92672>.</span>append(cipher<span style=color:#f92672>.</span>getbit())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> b <span style=color:#f92672>in</span> flag:
</span></span><span style=display:flex><span>    output<span style=color:#f92672>.</span>append(cipher<span style=color:#f92672>.</span>getbit() <span style=color:#f92672>^</span> b)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(output)
</span></span><span style=display:flex><span><span style=color:#75715e># [0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0]</span>
</span></span></code></pre></div><p>:::</p><a href=/security/course/ntu-cs/crypto/simple-crypto---0x032023-lab---cor/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/crypto/simple-crypto---0x03lab---lfsr/>Simple Crypto - 0x03(Lab - LFSR)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/crypto/>Crypto</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-crypto---0x03lab---lfsr>Simple Crypto - 0x03(Lab - LFSR)
<a class=anchor href=#simple-crypto---0x03lab---lfsr>#</a></h1><h6 id=tags-eductf-ctf-crypto>tags: <code>eductf</code> <code>CTF</code> <code>Crypto</code>
<a class=anchor href=#tags-eductf-ctf-crypto>#</a></h6><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href="https://youtu.be/hnXtaiyvQ3s?t=945">[2022 fall] 0923 Crypto - LFSR</a>
<a href="https://youtu.be/dYyNeMeDM20?t=4386">Crypto I - LFSR</a></p><h2 id=source-code>Source Code
<a class=anchor href=#source-code>#</a></h2><p>Must read the source code first with some comment I added
:::spoiler source code</p><pre tabindex=0><code class="language-pytho=" data-lang="pytho=">import random

# from secret import FLAG

FLAG = b&#39;00001111&#39;

class LFSR:
    def __init__(self, tap, state):
        self._tap = tap
        self._state = state

    def getbit(self):
        # f is the new bit that append in last position
        f = sum([self._state[i] for i in self._tap]) &amp; 1

        # x is the output bit
        x = self._state[0]
        
        # self._state is a new state
        self._state = self._state[1:] + [f]
        return x

class triLFSR:
    def __init__(self, lfsr1, lfsr2, lfsr3):
        self.lfsr1 = lfsr1
        self.lfsr2 = lfsr2
        self.lfsr3 = lfsr3

    def getbit(self):
        x1 = self.lfsr1.getbit()
        x2 = self.lfsr2.getbit()
        x3 = self.lfsr3.getbit()
        return x2 if x1 else x3
# These are the state of lfsr1, lfsr2, and lfsr3
A = [random.randrange(2) for _ in range(27)]
B = [random.randrange(2) for _ in range(23)]
C = [random.randrange(2) for _ in range(25)]
print(A, B, C)

# tap is a filter that decide the last bit is 1 or 0
tap1 = [0, 13, 16, 26]
tap2 = [0, 5, 7, 22]
tap3 = [0, 17, 19, 24]

lfsr1 = LFSR(tap1, A)
lfsr2 = LFSR(tap2, B)
lfsr3 = LFSR(tap3, C)
cipher = triLFSR(lfsr1, lfsr2, lfsr3)

# Transfer the flag to ascii code and expressed in binary
# e.g. FLAG = &#39;00001111&#39; → &#39;3030303031313131&#39; → &#39;001100000011000000110000...00110001&#39;(64 bits)
flag = map(int, &#39;&#39;.join([&#34;{:08b}&#34;.format(c) for c in FLAG]))

output = []

for b in flag:
    # print(b)
    output.append(cipher.getbit() ^ b)

for _ in range(200):
    output.append(cipher.getbit())

# print(output)
</code></pre><p>:::</p><a href=/security/course/ntu-cs/crypto/simple-crypto---0x03lab---lfsr/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/crypto/simple-crypto---0x042023-lab---poa/>Simple Crypto - 0x04(2023 Lab - POA)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/crypto/>Crypto</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-crypto---0x042023-lab---poa>Simple Crypto - 0x04(2023 Lab - POA)
<a class=anchor href=#simple-crypto---0x042023-lab---poa>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href="https://youtu.be/dYyNeMeDM20?si=BEvBPBzCsg8oWv_Q&amp;t=8317">Crypto I - Timmy</a></p><h2 id=source-code>Source Code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler Source Code</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#! /usr/bin/python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Cipher <span style=color:#f92672>import</span> AES
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> secret <span style=color:#f92672>import</span> FLAG
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>pad</span>(data, block_size):
</span></span><span style=display:flex><span>    data <span style=color:#f92672>+=</span> bytes([<span style=color:#ae81ff>0x80</span>] <span style=color:#f92672>+</span> [<span style=color:#ae81ff>0x00</span>] <span style=color:#f92672>*</span> (<span style=color:#ae81ff>15</span> <span style=color:#f92672>-</span> len(data) <span style=color:#f92672>%</span> block_size))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> data
</span></span><span style=display:flex><span><span style=color:#75715e># padding style: &lt;oooooo[0x80][0x00]...[0x00]&gt; (find first [0x80])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>unpad</span>(data, block_size):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(data) <span style=color:#f92672>%</span> block_size:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    padding_len <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, len(data) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> data[<span style=color:#f92672>-</span>i] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x80</span>:
</span></span><span style=display:flex><span>            padding_len <span style=color:#f92672>=</span> i
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> data[<span style=color:#f92672>-</span>i] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0x00</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> data[:<span style=color:#f92672>-</span>padding_len]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>urandom(<span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>cipher <span style=color:#f92672>=</span> AES<span style=color:#f92672>.</span>new(key, AES<span style=color:#f92672>.</span>MODE_CBC)
</span></span><span style=display:flex><span>ct <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>encrypt(pad(FLAG, AES<span style=color:#f92672>.</span>block_size))
</span></span><span style=display:flex><span>iv <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>iv
</span></span><span style=display:flex><span>print((iv <span style=color:#f92672>+</span> ct)<span style=color:#f92672>.</span>hex())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># same encryption</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        inp <span style=color:#f92672>=</span> bytes<span style=color:#f92672>.</span>fromhex(input()<span style=color:#f92672>.</span>strip()) <span style=color:#75715e># hex style input</span>
</span></span><span style=display:flex><span>        iv, ct <span style=color:#f92672>=</span> inp[:<span style=color:#ae81ff>16</span>], inp[<span style=color:#ae81ff>16</span>:] <span style=color:#75715e># get first 16 bytes from input </span>
</span></span><span style=display:flex><span>        cipher <span style=color:#f92672>=</span> AES<span style=color:#f92672>.</span>new(key, AES<span style=color:#f92672>.</span>MODE_CBC, iv) 
</span></span><span style=display:flex><span>        pt <span style=color:#f92672>=</span> unpad(cipher<span style=color:#f92672>.</span>decrypt(ct), AES<span style=color:#f92672>.</span>block_size)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Well received :)&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Something went wrong :(&#34;</span>)
</span></span></code></pre></div><p>:::</p><a href=/security/course/ntu-cs/crypto/simple-crypto---0x042023-lab---poa/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/crypto/simple-crypto---0x052023-lab---lsb/>Simple Crypto - 0x05(2023 Lab - LSB)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/crypto/>Crypto</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-crypto---0x052023-lab---lsb>Simple Crypto - 0x05(2023 Lab - LSB)
<a class=anchor href=#simple-crypto---0x052023-lab---lsb>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href="https://www.youtube.com/live/mqQ2zgK8a0Y?si=GRgtEKGHsCNcKuqU&amp;t=7176">[edu-ctf 2023] week01 - crypto1</a></p><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler Source Code</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#! /usr/bin/python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> bytes_to_long, getPrime
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> secret <span style=color:#f92672>import</span> FLAG
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> getPrime(<span style=color:#ae81ff>1024</span>)
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> getPrime(<span style=color:#ae81ff>1024</span>)
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> p <span style=color:#f92672>*</span> q
</span></span><span style=display:flex><span>phi <span style=color:#f92672>=</span> (p <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>65537</span>
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> pow(e, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, phi)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> bytes_to_long(FLAG <span style=color:#f92672>+</span> os<span style=color:#f92672>.</span>urandom(<span style=color:#ae81ff>256</span> <span style=color:#f92672>-</span> len(FLAG)))
</span></span><span style=display:flex><span><span style=color:#66d9ef>assert</span> m <span style=color:#f92672>&lt;</span> n
</span></span><span style=display:flex><span>enc <span style=color:#f92672>=</span> pow(m, e, n)
</span></span><span style=display:flex><span>print(n)
</span></span><span style=display:flex><span>print(e)
</span></span><span style=display:flex><span>print(enc)
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    inp <span style=color:#f92672>=</span> int(input()<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>    pt <span style=color:#f92672>=</span> pow(inp, d, n)
</span></span><span style=display:flex><span>    print(pt <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span>)
</span></span></code></pre></div><p>:::</p><a href=/security/course/ntu-cs/crypto/simple-crypto---0x052023-lab---lsb/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/crypto/simple-crypto---0x062023-hw---lfsr/>Simple Crypto - 0x06(2023 HW - LFSR)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/crypto/>Crypto</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-crypto---0x062023-hw---lfsr>Simple Crypto - 0x06(2023 HW - LFSR)
<a class=anchor href=#simple-crypto---0x062023-hw---lfsr>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><ul><li><a href=https://www.geeksforgeeks.org/python-list-xor/>Python – List XOR</a><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> funtools <span style=color:#f92672>import</span> reduce
</span></span><span style=display:flex><span>test_list <span style=color:#f92672>=</span> [<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>9</span>]
</span></span><span style=display:flex><span>res <span style=color:#f92672>=</span> reduce(<span style=color:#66d9ef>lambda</span> x, y: x <span style=color:#f92672>^</span> y, test_list) <span style=color:#75715e># The output is 2</span>
</span></span></code></pre></div></blockquote></li><li><a href=https://www.qiniu.com/qfans/qnso-67006518#comments>Numpy矩陣乘法，但不是乘法，而是XOR的元素</a><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span>m1 <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([[<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>], [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>], [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>]])
</span></span><span style=display:flex><span>m2 <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([[<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>], [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>], [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>]])
</span></span><span style=display:flex><span>mr <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>empty((m2<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>0</span>], m1<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>1</span>]), dtype <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>int64)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(mr<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>0</span>]):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(mr<span style=color:#f92672>.</span>shape[<span style=color:#ae81ff>1</span>]):
</span></span><span style=display:flex><span>        mr[i, j] <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>sum(m1[:, j] <span style=color:#f92672>^</span> m2[i, :])
</span></span><span style=display:flex><span>print(mr)
</span></span></code></pre></div></blockquote></li><li><a href=https://pyradise.com/%e4%bd%bf%e7%94%a8-python-%e4%be%86%e8%aa%8d%e8%ad%98%e7%9f%a9%e9%99%a3-915376207187>使用 Python 來認識矩陣</a></li><li><a href=https://ithelp.ithome.com.tw/articles/10203624>[Day07]Learning Numpy - 建立、合併、分割 - CheetSheet for Numpy</a></li><li>Sage<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt install sagemath -y <span style=color:#75715e># wsl/unix base可以直接安裝，如果是windows要下載sage binary，有1.4GB</span>
</span></span><span style=display:flex><span>$ sage -n <span style=color:#75715e># 開起sage notebook，也就是可以用sage kernel運行jupyter</span>
</span></span><span style=display:flex><span>$ sage &lt;.py/.sage file&gt; <span style=color:#75715e># 用sage運行腳本</span>
</span></span><span style=display:flex><span>$ sage <span style=color:#75715e># 直接開啟sage interactive shell</span>
</span></span></code></pre></div></li></ul><h2 id=recon>Recon
<a class=anchor href=#recon>#</a></h2><p>這一題和前面的triLFSR不一樣的地方在於他只有一層的LFSR，但他只會每個70個才會給一個state，換句話說我們只能拿到$S_{71<em>0+70},\ S_{71</em>1+70},\ S_{71<em>2+70},\ S_{71</em>3+70}&mldr;$(從0開始算)，而前面256個拿到的State最後會和flag進行XOR，只有最後70個是最純粹的State</p><a href=/security/course/ntu-cs/crypto/simple-crypto---0x062023-hw---lfsr/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/crypto/simple-crypto---0x072023-hw---oracle/>Simple Crypto - 0x07(2023 HW - Oracle)</a></h2><div class=text-small><a href=/tags/eductf/>Eductf</a>,
<a href=/tags/ctf/>CTF</a>,
<a href=/tags/crypto/>Crypto</a></div><p><h1 id=simple-crypto---0x072023-hw---oracle>Simple Crypto - 0x07(2023 HW - Oracle)
<a class=anchor href=#simple-crypto---0x072023-hw---oracle>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>POA/RSA</p><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler Oracle.py</p><pre tabindex=0><code class="language-python=" data-lang="python=">from Crypto.Util.number import bytes_to_long
from Crypto.Cipher import AES
from random import randbytes
from secret import aes_key, p, q

def pad(m):
    length = 16-len(m) % 16
    return m + chr(length).encode()*length

def unpad(c):
    length = c[-1]
    for char in c[-length:]:
        if char != length:
            raise ValueError
    return c[:-length]

def asymmetric_encryption(message, N, e):
    # encrypt message with RSA
    # message must be 16 bytes
    # padding 100 bytes random value
    padded_message = randbytes(100) + message
    return pow(bytes_to_long(padded_message), e, N)

def symmetric_encryption(message, key):
    # ecrypt message with AES + CBC Mode
    # message can be arbitrary length
    cipher = AES.new(key, AES.MODE_CBC)
    ct = cipher.encrypt(pad(message))
    iv = cipher.iv
    return iv, ct

## Alice: This is my public key.
# p = getPrime(512)
# q = getPrime(512)
N = p * q
e = 65537
print( f&#34;{N = }, {e = }&#34; )
# N = 69214008498642035761243756357619851816607540327248468473247478342523127723748756926949706235406640562827724567100157104972969498385528097714986614165867074449238186426536742677816881849038677123630836686152379963670139334109846133566156815333584764063197379180877984670843831985941733688575703811651087495223
# e = 65537

## Bob: I want to send message to Alice! But my message is too looooooong......
flag = open(&#34;flag.png&#34;, &#34;rb&#34;).read()

## Bob: Oh! I can use symmetric encryption.
iv, ct = symmetric_encryption(flag, aes_key)
encrypted_key = asymmetric_encryption(aes_key, N, e)
encrypted_iv = asymmetric_encryption(iv, N, e)
print( f&#34;{encrypted_key = }&#34; )
print( f&#34;{encrypted_iv = }&#34; )
open(&#34;encrypted_flag.not_png&#34;, &#34;wb&#34;).write(ct)

## Bob: Ha ha! Now no one can decrypt my message except Alice!
# encrypted_key = 65690013242775728459842109842683020587149462096059598501313133592635945234121561534622365974927219223034823754673718159579772056712404749324225325531206903216411508240699572153162745754564955215041783396329242482406426376133687186983187563217156659178000486342335478915053049498619169740534463504372971359692
# encrypted_iv = 35154524936059729204581782839781987236407179504895959653768093617367549802652967862418906182387861924584809825831862791349195432705129622783580000716829283234184762744224095175044663151370869751957952842383581513986293064879608592662677541628813345923397286253057417592725291925603753086190402107943880261658
</code></pre><p>:::
:::spoiler Alice.py</p><a href=/security/course/ntu-cs/crypto/simple-crypto---0x072023-hw---oracle/>...</a></p></article><article class="markdown book-post"><h2><a href=/security/course/ntu-cs/crypto/simple-crypto---0x082023-lab---dlog/>Simple Crypto - 0x08(2023 Lab - dlog)</a></h2><div class=text-small><a href=/tags/ctf/>CTF</a>,
<a href=/tags/crypto/>Crypto</a>,
<a href=/tags/eductf/>Eductf</a></div><p><h1 id=simple-crypto---0x082023-lab---dlog>Simple Crypto - 0x08(2023 Lab - dlog)
<a class=anchor href=#simple-crypto---0x082023-lab---dlog>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p><a href="https://www.youtube.com/live/u4ZVc8PuJC0?si=2wbiGreg_BZQ-dff">[edu-ctf 2023] week03 - crypto2 </a><a href=https://hackmd.io/@SBK6401/SJobiaxQ3#5-Little-Knowledge-Proof>Cryptography and Network Security – Homework 2 - Little Knowledge Proof</a></p><h2 id=source-code>Source code
<a class=anchor href=#source-code>#</a></h2><p>:::spoiler Source Code</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> isPrime, bytes_to_long
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> secret <span style=color:#f92672>import</span> FLAG
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> int(input(<span style=color:#e6db74>&#34;give me a prime: &#34;</span>)<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> isPrime(p):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Do you know what is primes?&#34;</span>)
</span></span><span style=display:flex><span>    exit(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> p<span style=color:#f92672>.</span>bit_length() <span style=color:#f92672>!=</span> <span style=color:#ae81ff>1024</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Bit length need to be 1024&#34;</span>)
</span></span><span style=display:flex><span>    exit(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>g <span style=color:#f92672>=</span> int(input(<span style=color:#e6db74>&#34;give me a number: &#34;</span>)<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> bytes_to_long(FLAG)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;The hint about my secret:&#39;</span>, pow(g, flag, p))
</span></span></code></pre></div><p>:::</p><a href=/security/course/ntu-cs/crypto/simple-crypto---0x082023-lab---dlog/>...</a></p></article><ul class="pagination pagination-default"><li class=page-item><a href=/tags/crypto/ aria-label=First class=page-link role=button><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/tags/crypto/page/2/ aria-label=Previous class=page-link role=button><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a href=/tags/crypto/ aria-label="Page 1" class=page-link role=button>1</a></li><li class=page-item><a href=/tags/crypto/page/2/ aria-label="Page 2" class=page-link role=button>2</a></li><li class="page-item active"><a aria-current=page aria-label="Page 3" class=page-link role=button>3</a></li><li class=page-item><a href=/tags/crypto/page/4/ aria-label="Page 4" class=page-link role=button>4</a></li><li class=page-item><a href=/tags/crypto/page/4/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/tags/crypto/page/4/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav><ul><li class=book-section-flat><strong>Categories</strong><ul></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/ad/>AD</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/adworld/>Adworld</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/aegis/>AEGIS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ai/>AI</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ais3/>AIS3</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/android/>Android</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/balsnctf/>BalsnCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/book/>Book</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/btlo/>BTLO</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/cggc/>CGGC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/chatgpt/>ChatGPT</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/crewctf/>CrewCTF</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/crypto/>Crypto</a>
<span>36</span></li><li class="flex justify-between"><a href=/tags/cryptography/>Cryptography</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/csc/>CSC</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ctf/>CTF</a>
<span>267</span></li><li class="flex justify-between"><a href=/tags/cyberdefender/>CyberDefender</a>
<span>23</span></li><li class="flex justify-between"><a href=/tags/data-structure/>Data Structure</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/deadfacectf/>DeadFaceCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/digital-forensics/>Digital Forensics</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/drozer/>Drozer</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/easy/>Easy</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/eductf/>Eductf</a>
<span>85</span></li><li class="flex justify-between"><a href=/tags/endpoint-forensics/>Endpoint Forensics</a>
<span>16</span></li><li class="flex justify-between"><a href=/tags/english-writing/>English Writing</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/forensics/>Forensics</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/general-skill/>General Skill</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/hackthebox/>Hackthebox</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/incident-response/>Incident Response</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/information-security/>Information Security</a>
<span>25</span></li><li class="flex justify-between"><a href=/tags/interview/>Interview</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/latex/>LaTeX</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/leetcode/>LeetCode</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/machine-learning/>Machine Learning</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/malware-reverse-engineering-and-analysis/>Malware Reverse Engineering and Analysis</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/meeting-paper/>Meeting Paper</a>
<span>20</span></li><li class="flex justify-between"><a href=/tags/misc/>Misc</a>
<span>44</span></li><li class="flex justify-between"><a href=/tags/mobsf/>MobSF</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/network-forensics/>Network Forensics</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/nisra/>NISRA</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu/>NTU</a>
<span>67</span></li><li class="flex justify-between"><a href=/tags/ntu_ct/>NTU_CT</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/ntu_ml/>NTU_ML</a>
<span>5</span></li><li class="flex justify-between"><a href=/tags/ntu_mr/>NTU_MR</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/ntu_os/>NTU_OS</a>
<span>4</span></li><li class="flex justify-between"><a href=/tags/ntu_padns/>NTU_PADNS</a>
<span>8</span></li><li class="flex justify-between"><a href=/tags/ntu_st/>NTU_ST</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/ntucns/>NTUCNS</a>
<span>11</span></li><li class="flex justify-between"><a href=/tags/ntust/>NTUST</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ntustisc/>NTUSTISC</a>
<span>32</span></li><li class="flex justify-between"><a href=/tags/ntustws/>NTUSTWS</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/nycu/>NYCU</a>
<span>6</span></li><li class="flex justify-between"><a href=/tags/picoctf/>PicoCTF</a>
<span>112</span></li><li class="flex justify-between"><a href=/tags/portswigger-web-security-academy/>Portswigger Web Security Academy</a>
<span>29</span></li><li class="flex justify-between"><a href=/tags/problem-solution/>Problem Solution</a>
<span>28</span></li><li class="flex justify-between"><a href=/tags/pwn/>PWN</a>
<span>57</span></li><li class="flex justify-between"><a href=/tags/reverse/>Reverse</a>
<span>46</span></li><li class="flex justify-between"><a href=/tags/security-operation/>Security Operation</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/side-project/>Side Project</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/software-testing/>Software Testing</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/special-topic/>Special Topic</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/taiwanholyhigh/>TaiwanHolyHigh</a>
<span>9</span></li><li class="flex justify-between"><a href=/tags/tcivs/>TCIVS</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/threat-intel/>Threat Intel</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/tools/>Tools</a>
<span>19</span></li><li class="flex justify-between"><a href=/tags/tscctf/>TSCCTF</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/web/>Web</a>
<span>93</span></li><li class="flex justify-between"><a href=/tags/welcome/>Welcome</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/windows/>Windows</a>
<span>7</span></li><li class="flex justify-between"><a href=/tags/%E5%90%8D%E8%A9%9E%E8%A7%A3%E9%87%8B/>名詞解釋</a>
<span>10</span></li><li class="flex justify-between"><a href=/tags/%E8%AE%80%E6%9B%B8%E5%BF%83%E5%BE%97/>讀書心得</a>
<span>2</span></li></ul></li></ul></nav></div></aside></main></body></html>