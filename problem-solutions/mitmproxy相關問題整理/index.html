<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  MITMProxy相關問題整理
  #

資料來源: https://github.com/mitmproxy/mitmproxy/issues/5442

  Server TLS handshake failed. The remote server does not speak TLS.
  #

代表連線的標的無法處理https的scheme，如果確定連線的目標是開在localhost或是一定是http scheme的話，可以利用script去hook流量把https改掉
from mitmproxy import http

def request(flow: http.HTTPFlow) -> None:
    # 檢查請求是否是 HTTPS
    if flow.request.scheme == &#34;https&#34;:
        # 將 URL 中的 HTTPS 替換為 HTTP
        flow.request.url = flow.request.url.replace('https://', 'http://')

  Unable to establish TLS connection with server (The remote server does not speak TLS.). Trying to establish TLS with client anyway. If you plan to redirect requests away from this server, consider setting connection_strategy to lazy to suppress early connections.
  #

出現這個warning，"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/problem-solutions/mitmproxy%E7%9B%B8%E9%97%9C%E5%95%8F%E9%A1%8C%E6%95%B4%E7%90%86/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="MITMProxy相關問題整理"><meta property="og:description" content="MITMProxy相關問題整理 # 資料來源: https://github.com/mitmproxy/mitmproxy/issues/5442
Server TLS handshake failed. The remote server does not speak TLS. # 代表連線的標的無法處理https的scheme，如果確定連線的目標是開在localhost或是一定是http scheme的話，可以利用script去hook流量把https改掉
from mitmproxy import http def request(flow: http.HTTPFlow) -> None: # 檢查請求是否是 HTTPS if flow.request.scheme == &#34;https&#34;: # 將 URL 中的 HTTPS 替換為 HTTP flow.request.url = flow.request.url.replace('https://', 'http://') Unable to establish TLS connection with server (The remote server does not speak TLS.). Trying to establish TLS with client anyway. If you plan to redirect requests away from this server, consider setting connection_strategy to lazy to suppress early connections. # 出現這個warning，"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="problem-solutions"><meta property="article:tag" content="Problem Solution"><title>MITMProxy相關問題整理 | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/problem-solutions/mitmproxy%E7%9B%B8%E9%97%9C%E5%95%8F%E9%A1%8C%E6%95%B4%E7%90%86/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>MITMProxy相關問題整理</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#server-tls-handshake-failed-the-remote-server-does-not-speak-tls>Server TLS handshake failed. The remote server does not speak TLS.</a></li><li><a href=#unable-to-establish-tls-connection-with-server-the-remote-server-does-not-speak-tls-trying-to-establish-tls-with-client-anyway-if-you-plan-to-redirect-requests-away-from-this-server-consider-setting-connection_strategy-to-lazy-to-suppress-early-connections>Unable to establish TLS connection with server (The remote server does not speak TLS.). Trying to establish TLS with client anyway. If you plan to redirect requests away from this server, consider setting <code>connection_strategy</code> to <code>lazy</code> to suppress early connections.</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=mitmproxy相關問題整理>MITMProxy相關問題整理
<a class=anchor href=#mitmproxy%e7%9b%b8%e9%97%9c%e5%95%8f%e9%a1%8c%e6%95%b4%e7%90%86>#</a></h1><p>資料來源: <a href=https://github.com/mitmproxy/mitmproxy/issues/5442>https://github.com/mitmproxy/mitmproxy/issues/5442</a></p><h2 id=server-tls-handshake-failed-the-remote-server-does-not-speak-tls>Server TLS handshake failed. The remote server does not speak TLS.
<a class=anchor href=#server-tls-handshake-failed-the-remote-server-does-not-speak-tls>#</a></h2><p>代表連線的標的無法處理https的scheme，如果確定連線的目標是開在localhost或是一定是http scheme的話，可以利用script去hook流量把https改掉</p><pre tabindex=0><code class=language-python! data-lang=python!>from mitmproxy import http

def request(flow: http.HTTPFlow) -&gt; None:
    # 檢查請求是否是 HTTPS
    if flow.request.scheme == &#34;https&#34;:
        # 將 URL 中的 HTTPS 替換為 HTTP
        flow.request.url = flow.request.url.replace(&#39;https://&#39;, &#39;http://&#39;)
</code></pre><h2 id=unable-to-establish-tls-connection-with-server-the-remote-server-does-not-speak-tls-trying-to-establish-tls-with-client-anyway-if-you-plan-to-redirect-requests-away-from-this-server-consider-setting-connection_strategy-to-lazy-to-suppress-early-connections>Unable to establish TLS connection with server (The remote server does not speak TLS.). Trying to establish TLS with client anyway. If you plan to redirect requests away from this server, consider setting <code>connection_strategy</code> to <code>lazy</code> to suppress early connections.
<a class=anchor href=#unable-to-establish-tls-connection-with-server-the-remote-server-does-not-speak-tls-trying-to-establish-tls-with-client-anyway-if-you-plan-to-redirect-requests-away-from-this-server-consider-setting-connection_strategy-to-lazy-to-suppress-early-connections>#</a></h2><p>出現這個warning，</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#server-tls-handshake-failed-the-remote-server-does-not-speak-tls>Server TLS handshake failed. The remote server does not speak TLS.</a></li><li><a href=#unable-to-establish-tls-connection-with-server-the-remote-server-does-not-speak-tls-trying-to-establish-tls-with-client-anyway-if-you-plan-to-redirect-requests-away-from-this-server-consider-setting-connection_strategy-to-lazy-to-suppress-early-connections>Unable to establish TLS connection with server (The remote server does not speak TLS.). Trying to establish TLS with client anyway. If you plan to redirect requests away from this server, consider setting <code>connection_strategy</code> to <code>lazy</code> to suppress early connections.</a></li></ul></nav></div></aside></main></body></html>