<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  How to install LogonTracer?
  #


  Installation
  #


  環境
  #

WSL2 - Ubuntu 20.04
Docker

  Reference
  #

二刀流Windows日誌分析　精準掌握資安蛛絲馬跡

  Docker Version
  #


安裝Docker(上網找)
Pull Image & Run
$ docker pull jpcertcc/docker-logontracer
$ docker run --detach --publish=7474:7474  --publish=7687:7687 --publish=8080:8080 -e LTHOSTNAME=0.0.0.0 jpcertcc/docker-logontracer

先進入neo4j(localhost:7474)
預設密碼: neo4j/neo4j
:::info
若有遇到登入不進去的問題，error message$\to$Neo.ClientError.Security.Unauthorized: The client is unauthorized due to authentication failure.
可參考訪問neo4j驗證失敗，我是直接把neo4j.conf的驗證註解拿掉
$ docker exec -it {neo4j container name} bash
root@5aac14bfd6fd:/var/lib/neo4j# find / -name neo4j.conf
/var/lib/neo4j/conf/neo4j.conf
root@5aac14bfd6fd:/var/lib/neo4j# cd conf/
root@5aac14bfd6fd:/var/lib/neo4j/conf# apt install vim -y
root@5aac14bfd6fd:/var/lib/neo4j/conf# vim neo4j.conf
# 只要把dbms.security.auth_enabled=false的註解拿掉就可以了
root@5aac14bfd6fd:/var/lib/neo4j/conf# exit
exit
$ docker restart nifty_stonebraker
nifty_stonebraker
之後再重新進入localhost:7474，用預設帳密登入就可以了
:::
進入LogonTracer(localhost:8080)
預設帳密也是neo4j/neo4j


  Python Version (Recommended)
  #

如果上面的版本不行用的話，就直接用他們發在github的版本會比較穩定，詳細的步驟都已經寫在他們wiki了，不過有幾個問題還是需要先克服"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/problem-solutions/how-to-install-logontracer_/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="How to install LogonTracer?"><meta property="og:description" content="How to install LogonTracer? # Installation # 環境 # WSL2 - Ubuntu 20.04 Docker
Reference # 二刀流Windows日誌分析　精準掌握資安蛛絲馬跡
Docker Version # 安裝Docker(上網找) Pull Image & Run $ docker pull jpcertcc/docker-logontracer $ docker run --detach --publish=7474:7474 --publish=7687:7687 --publish=8080:8080 -e LTHOSTNAME=0.0.0.0 jpcertcc/docker-logontracer 先進入neo4j(localhost:7474) 預設密碼: neo4j/neo4j :::info 若有遇到登入不進去的問題，error message$\to$Neo.ClientError.Security.Unauthorized: The client is unauthorized due to authentication failure. 可參考訪問neo4j驗證失敗，我是直接把neo4j.conf的驗證註解拿掉 $ docker exec -it {neo4j container name} bash root@5aac14bfd6fd:/var/lib/neo4j# find / -name neo4j.conf /var/lib/neo4j/conf/neo4j.conf root@5aac14bfd6fd:/var/lib/neo4j# cd conf/ root@5aac14bfd6fd:/var/lib/neo4j/conf# apt install vim -y root@5aac14bfd6fd:/var/lib/neo4j/conf# vim neo4j.conf # 只要把dbms.security.auth_enabled=false的註解拿掉就可以了 root@5aac14bfd6fd:/var/lib/neo4j/conf# exit exit $ docker restart nifty_stonebraker nifty_stonebraker 之後再重新進入localhost:7474，用預設帳密登入就可以了 ::: 進入LogonTracer(localhost:8080) 預設帳密也是neo4j/neo4j Python Version (Recommended) # 如果上面的版本不行用的話，就直接用他們發在github的版本會比較穩定，詳細的步驟都已經寫在他們wiki了，不過有幾個問題還是需要先克服"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="problem-solutions"><meta property="article:tag" content="Problem Solution"><title>How to install LogonTracer? | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/problem-solutions/how-to-install-logontracer_/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>How to install LogonTracer?</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#installation>Installation</a><ul><li><a href=#環境>環境</a></li><li><a href=#reference>Reference</a></li><li><a href=#docker-version>Docker Version</a></li><li><a href=#python-version-recommended>Python Version (Recommended)</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=how-to-install-logontracer>How to install LogonTracer?
<a class=anchor href=#how-to-install-logontracer>#</a></h1><h2 id=installation>Installation
<a class=anchor href=#installation>#</a></h2><h3 id=環境>環境
<a class=anchor href=#%e7%92%b0%e5%a2%83>#</a></h3><p>WSL2 - Ubuntu 20.04
Docker</p><h3 id=reference>Reference
<a class=anchor href=#reference>#</a></h3><p><a href=https://www.netadmin.com.tw/netadmin/zh-tw/technology/84E5EAA4BC494BB6A4B15607E62418A0>二刀流Windows日誌分析　精準掌握資安蛛絲馬跡</a></p><h3 id=docker-version>Docker Version
<a class=anchor href=#docker-version>#</a></h3><ol><li>安裝Docker(上網找)</li><li>Pull Image & Run<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker pull jpcertcc/docker-logontracer
</span></span><span style=display:flex><span>$ docker run --detach --publish<span style=color:#f92672>=</span>7474:7474  --publish<span style=color:#f92672>=</span>7687:7687 --publish<span style=color:#f92672>=</span>8080:8080 -e LTHOSTNAME<span style=color:#f92672>=</span>0.0.0.0 jpcertcc/docker-logontracer
</span></span></code></pre></div></li><li>先進入neo4j(<code>localhost:7474</code>)
預設密碼: <code>neo4j/neo4j</code>
:::info
若有遇到登入不進去的問題，error message$\to$<code>Neo.ClientError.Security.Unauthorized: The client is unauthorized due to authentication failure.</code>
可參考<a href=https://blog.csdn.net/weixin_39198406/article/details/85068102>訪問neo4j驗證失敗</a>，我是直接把neo4j.conf的驗證註解拿掉<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker exec -it <span style=color:#f92672>{</span>neo4j container name<span style=color:#f92672>}</span> bash
</span></span><span style=display:flex><span>root@5aac14bfd6fd:/var/lib/neo4j# find / -name neo4j.conf
</span></span><span style=display:flex><span>/var/lib/neo4j/conf/neo4j.conf
</span></span><span style=display:flex><span>root@5aac14bfd6fd:/var/lib/neo4j# cd conf/
</span></span><span style=display:flex><span>root@5aac14bfd6fd:/var/lib/neo4j/conf# apt install vim -y
</span></span><span style=display:flex><span>root@5aac14bfd6fd:/var/lib/neo4j/conf# vim neo4j.conf
</span></span><span style=display:flex><span><span style=color:#75715e># 只要把dbms.security.auth_enabled=false的註解拿掉就可以了</span>
</span></span><span style=display:flex><span>root@5aac14bfd6fd:/var/lib/neo4j/conf# exit
</span></span><span style=display:flex><span>exit
</span></span><span style=display:flex><span>$ docker restart nifty_stonebraker
</span></span><span style=display:flex><span>nifty_stonebraker
</span></span></code></pre></div>之後再重新進入<code>localhost:7474</code>，用預設帳密登入就可以了
:::</li><li>進入LogonTracer(<code>localhost:8080</code>)
預設帳密也是<code>neo4j/neo4j</code></li></ol><h3 id=python-version-recommended>Python Version (Recommended)
<a class=anchor href=#python-version-recommended>#</a></h3><p>如果上面的版本不行用的話，就直接用他們發在<a href=https://github.com/JPCERTCC/LogonTracer/wiki/how-to-use>github的版本</a>會比較穩定，詳細的步驟都已經寫在他們wiki了，不過有幾個問題還是需要先克服</p><ol><li>首先github version沒辦法用在windows上，只能運行在unix</li><li>建議用conda創一個新環境</li><li>如果用他們的requirement.txt安裝dependencies可能會有問題，會有一些版本上或是語法上的衝突，例如<code>Werkzeug</code>如果安裝最新版<code>3.0.1</code>，他沒有辦法<code>import url_encode, url_decode</code>，這是<code>2.3.7</code>以下才有的function name，而因為flask會用到但還沒有跟進，所以解決方式就是把<code>Werkzeug</code>的版本降到<code>2.3.7</code></li><li>但這樣會有conflic的問題，對於flask最新版來說，一定要<code>Werkzeug>=3.0.0</code>，所以我們還需要把flask降版本才行變成<code>flask==2.3.3</code></li><li>另外，python的版本也不能太高，目前最高是12，但hmmlearn還沒有支援到python12，所以也要特別注意，11是沒問題的</li><li>最後安裝都沒問題後pandas的部分因為是安裝最新版，所以語法上會有差，若是在<code>2.0</code>以上，就不能用<code>append</code>，要改成<code>_append</code>，這個就要慢慢看logontrace的log慢慢去改</li></ol><ul><li>實作<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ conda create --name test python<span style=color:#f92672>=</span>3.11 -y
</span></span><span style=display:flex><span>$ conda activate test
</span></span><span style=display:flex><span>$ pip install -r requirements.txt
</span></span><span style=display:flex><span>$ cat requirements.txt
</span></span><span style=display:flex><span>numpy
</span></span><span style=display:flex><span>py2neo&gt;<span style=color:#f92672>=</span>2020.0.0
</span></span><span style=display:flex><span>evtx
</span></span><span style=display:flex><span>lxml
</span></span><span style=display:flex><span>scipy
</span></span><span style=display:flex><span>changefinder
</span></span><span style=display:flex><span>flask<span style=color:#f92672>==</span>2.3.3
</span></span><span style=display:flex><span>hmmlearn&gt;<span style=color:#f92672>=</span>0.2.8
</span></span><span style=display:flex><span>scikit-learn
</span></span><span style=display:flex><span>elasticsearch-dsl&gt;<span style=color:#f92672>=</span>7.0.0,&lt;8.0.0
</span></span><span style=display:flex><span>pyyaml
</span></span><span style=display:flex><span>flask-sqlalchemy
</span></span><span style=display:flex><span>flask-login
</span></span><span style=display:flex><span>flask_wtf
</span></span><span style=display:flex><span>wtforms
</span></span><span style=display:flex><span>GitPython
</span></span><span style=display:flex><span>sigmatools
</span></span><span style=display:flex><span>Werkzeug<span style=color:#f92672>==</span>2.3.7
</span></span><span style=display:flex><span>$ pip install -r requirements.txt
</span></span><span style=display:flex><span>$ python logontracer.py -r -o <span style=color:#ae81ff>8000</span> -u neo4j -p neo4j -s localhost
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Script start. 2023/10/25 23:28:44
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Neo4j Kernel 4.4.14 <span style=color:#f92672>(</span>Community<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Can<span style=color:#e6db74>&#39;t create database. This feature is in Neo4j Enterprise.
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Serving Flask app &#39;</span>logontracer<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span><span style=display:flex><span> * Debug mode: off
</span></span></code></pre></div>我的requirements.txt和原本的有一點不一樣，然後只要按照這個步驟就可以正常啟動logontracer，前提是neo4j也有好好啟動(這部分可以用docker自行安裝)</li></ul><p>:::info
在使用上有一點要特別注意，因為source code中的#1954的地方會判斷目前的紀錄是不是來自localhost，如果是就不儲存username/domain/hostname，我是不知道為甚麼要這樣設計，但反正如果給的evtx不夠大或是不夠複雜，他就沒辦法parse，或者應該說他認為沒必要parse，因為只是內部的log紀錄?我不確定
:::</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#installation>Installation</a><ul><li><a href=#環境>環境</a></li><li><a href=#reference>Reference</a></li><li><a href=#docker-version>Docker Version</a></li><li><a href=#python-version-recommended>Python Version (Recommended)</a></li></ul></li></ul></nav></div></aside></main></body></html>