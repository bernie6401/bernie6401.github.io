<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  How How to use Mailgun/Resend as SMTP server?
  #

會有這個紀錄是因為deploy Mastodon Instance時需要用到SMTP Server，雖然是Optional，但還是嘗試建立一個試看看

  Prerequisite
  #


有一台具有domain的device


  Mailgun Step
  #


先到官網註冊帳號
在Sending > Domains中新增Domain，我是只有domain name，而不是包含subdomain

其他參數不用改

進入到DNS records並且查看有哪些東西需要加進去到DNS的紀錄，以我的為例，因為我有開啟automatic sender security，所以有以下6個

包含3個CNAME，2個MX，一個TXT
接著就到當初申請domain的網站，以我的為例是namesilo，新增這幾個紀錄，就是複製貼上，最後新增完如下

接著就一直等，由於DNS更新也會需要時間，所以mailgun要verify也可能要等很久，我大概是等了半小時才好，在Mailgun的Domain Setting頁面，會顯示所有的紀錄為Verified或是Active的字樣(如上上圖)
接著就看哪一個service需要用到SMTP，以我的為例就是Mastodon Instance，他會建立一個.env.production，裡面就要放SMTP會用到的環境變數，如下
SMTP_SERVER=smtp.mailgun.org
SMTP_PORT=587
SMTP_LOGIN=postmaster@sbk6401.sbs
SMTP_PASSWORD=<your SMTP Password>
SMTP_AUTH_METHOD=plain
SMTP_OPENSSL_VERIFY_MODE=none
SMTP_ENABLE_STARTTLS=auto
SMTP_FROM_ADDRESS='Mastodon <notifications@mastodon.sbk6401.sbs>'
首先解釋一下上面的變數
SMTP_SERVER和SMTP_PORT建議不要改，login如果沒有特別指定，就是使用postmaster@<your domain name>，而password要到Mailgun的SMTP Credentials中，利用Reset Password並且複製新的密碼就可以貼上

而auto_method、openssl_verify和enable_starttls則是有其他的選項可以選，可以視情況自行使用，from_address則是看要用什麼身份傳送mail，我是直接使用mastodon的預設模式
Done!!!
通常這樣沒有什麼問題的話就完成了，只要mastodon有出現任何被Follow、登入、被tag發文等操作，都應該要發送信件通知才對


  Resend Step
  #

我發現在設定Bluesky的SMTP的時候，無法用mailgun當作server，不確定是什麼原因，但官方doc說建議用Resend或是SendGrid，然後和Mailgun設定的差不多，先新增一個自己的domain，然後他會給4個DNS config的紀錄(3個TXT和1個MX)

就直接到自己當初申請domain的DNS Server設定，接下來就是等DNS server更新

等到更新成功後，先申請API key，到API Keys > Create API Keys 建立SMTP的API，然後就可以開始填寫pds.env"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bernie6401.github.io/problem-solutions/how-how-to-use-mailgun_resend-as-smtp-server_/"><meta property="og:site_name" content="SBK Hugo Site"><meta property="og:title" content="How How to use Mailgun/Resend as SMTP server?"><meta property="og:description" content="How How to use Mailgun/Resend as SMTP server? # 會有這個紀錄是因為deploy Mastodon Instance時需要用到SMTP Server，雖然是Optional，但還是嘗試建立一個試看看
Prerequisite # 有一台具有domain的device Mailgun Step # 先到官網註冊帳號 在Sending > Domains中新增Domain，我是只有domain name，而不是包含subdomain 其他參數不用改 進入到DNS records並且查看有哪些東西需要加進去到DNS的紀錄，以我的為例，因為我有開啟automatic sender security，所以有以下6個 包含3個CNAME，2個MX，一個TXT 接著就到當初申請domain的網站，以我的為例是namesilo，新增這幾個紀錄，就是複製貼上，最後新增完如下 接著就一直等，由於DNS更新也會需要時間，所以mailgun要verify也可能要等很久，我大概是等了半小時才好，在Mailgun的Domain Setting頁面，會顯示所有的紀錄為Verified或是Active的字樣(如上上圖) 接著就看哪一個service需要用到SMTP，以我的為例就是Mastodon Instance，他會建立一個.env.production，裡面就要放SMTP會用到的環境變數，如下 SMTP_SERVER=smtp.mailgun.org SMTP_PORT=587 SMTP_LOGIN=postmaster@sbk6401.sbs SMTP_PASSWORD=<your SMTP Password> SMTP_AUTH_METHOD=plain SMTP_OPENSSL_VERIFY_MODE=none SMTP_ENABLE_STARTTLS=auto SMTP_FROM_ADDRESS='Mastodon <notifications@mastodon.sbk6401.sbs>' 首先解釋一下上面的變數 SMTP_SERVER和SMTP_PORT建議不要改，login如果沒有特別指定，就是使用postmaster@<your domain name>，而password要到Mailgun的SMTP Credentials中，利用Reset Password並且複製新的密碼就可以貼上 而auto_method、openssl_verify和enable_starttls則是有其他的選項可以選，可以視情況自行使用，from_address則是看要用什麼身份傳送mail，我是直接使用mastodon的預設模式 Done!!! 通常這樣沒有什麼問題的話就完成了，只要mastodon有出現任何被Follow、登入、被tag發文等操作，都應該要發送信件通知才對 Resend Step # 我發現在設定Bluesky的SMTP的時候，無法用mailgun當作server，不確定是什麼原因，但官方doc說建議用Resend或是SendGrid，然後和Mailgun設定的差不多，先新增一個自己的domain，然後他會給4個DNS config的紀錄(3個TXT和1個MX) 就直接到自己當初申請domain的DNS Server設定，接下來就是等DNS server更新 等到更新成功後，先申請API key，到API Keys > Create API Keys 建立SMTP的API，然後就可以開始填寫pds.env"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="problem-solutions"><meta property="article:tag" content="Problem Solution"><title>How How to use Mailgun/Resend as SMTP server? | SBK Hugo Site</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://bernie6401.github.io/problem-solutions/how-how-to-use-mailgun_resend-as-smtp-server_/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.acdc41c8d39e6c69d70d8a23779875e0a3733fefead3e428d5344966bb12f562.js integrity="sha256-rNxByNOebGnXDYojd5h14KNzP+/q0+Qo1TRJZrsS9WI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>SBK Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>How How to use Mailgun/Resend as SMTP server?</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#prerequisite>Prerequisite</a></li><li><a href=#mailgun-step>Mailgun Step</a></li><li><a href=#resend-step>Resend Step</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=how-how-to-use-mailgunresend-as-smtp-server>How How to use Mailgun/Resend as SMTP server?
<a class=anchor href=#how-how-to-use-mailgunresend-as-smtp-server>#</a></h1><p>會有這個紀錄是因為deploy Mastodon Instance時需要用到SMTP Server，雖然是Optional，但還是嘗試建立一個試看看</p><h2 id=prerequisite>Prerequisite
<a class=anchor href=#prerequisite>#</a></h2><ul><li>有一台具有domain的device</li></ul><h2 id=mailgun-step>Mailgun Step
<a class=anchor href=#mailgun-step>#</a></h2><ol><li>先到<a href=https://app.mailgun.com>官網</a>註冊帳號</li><li>在Sending > Domains中新增Domain，我是只有domain name，而不是包含subdomain
<img src=https://hackmd.io/_uploads/HygMAixKM1g.png alt=圖片>
其他參數不用改
<img src=https://hackmd.io/_uploads/SyrSnlKG1l.png alt=圖片></li><li>進入到DNS records並且查看有哪些東西需要加進去到DNS的紀錄，以我的為例，因為我有開啟automatic sender security，所以有以下6個
<img src=https://hackmd.io/_uploads/HkHA2gKM1x.png alt=圖片>
包含3個CNAME，2個MX，一個TXT
接著就到當初申請domain的網站，以我的為例是namesilo，新增這幾個紀錄，就是複製貼上，最後新增完如下
<img src=https://hackmd.io/_uploads/r1CLpgYGkg.png alt=圖片></li><li>接著就一直等，由於DNS更新也會需要時間，所以mailgun要verify也可能要等很久，我大概是等了半小時才好，在Mailgun的Domain Setting頁面，會顯示所有的紀錄為Verified或是Active的字樣(如上上圖)</li><li>接著就看哪一個service需要用到SMTP，以我的為例就是Mastodon Instance，他會建立一個.env.production，裡面就要放SMTP會用到的環境變數，如下<pre tabindex=0><code>SMTP_SERVER=smtp.mailgun.org
SMTP_PORT=587
SMTP_LOGIN=postmaster@sbk6401.sbs
SMTP_PASSWORD=&lt;your SMTP Password&gt;
SMTP_AUTH_METHOD=plain
SMTP_OPENSSL_VERIFY_MODE=none
SMTP_ENABLE_STARTTLS=auto
SMTP_FROM_ADDRESS=&#39;Mastodon &lt;notifications@mastodon.sbk6401.sbs&gt;&#39;
</code></pre>首先解釋一下上面的變數
SMTP_SERVER和SMTP_PORT建議不要改，login如果沒有特別指定，就是使用postmaster@&lt;your domain name>，而password要到Mailgun的SMTP Credentials中，利用Reset Password並且複製新的密碼就可以貼上
<img src=https://hackmd.io/_uploads/HyWxlWKfJx.png alt=圖片>
而auto_method、openssl_verify和enable_starttls則是有其他的選項可以選，可以視情況自行使用，from_address則是看要用什麼身份傳送mail，我是直接使用mastodon的預設模式</li><li>Done!!!
通常這樣沒有什麼問題的話就完成了，只要mastodon有出現任何被Follow、登入、被tag發文等操作，都應該要發送信件通知才對</li></ol><h2 id=resend-step>Resend Step
<a class=anchor href=#resend-step>#</a></h2><p>我發現在設定Bluesky的SMTP的時候，無法用mailgun當作server，不確定是什麼原因，但官方doc說建議用<a href=https://resend.com>Resend</a>或是<a href=https://sendgrid.com/>SendGrid</a>，然後和Mailgun設定的差不多，先新增一個自己的domain，然後他會給4個DNS config的紀錄(3個TXT和1個MX)
<img src=https://hackmd.io/_uploads/ryI8KTzX1g.png alt=image>
就直接到自己當初申請domain的DNS Server設定，接下來就是等DNS server更新
<img src=https://hackmd.io/_uploads/ByPKYaf7yx.png alt=image>
等到更新成功後，先申請API key，到API Keys > Create API Keys 建立SMTP的API，然後就可以開始填寫pds.env</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vim /pds/pds.env
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Add the following to pds.env</span>
</span></span><span style=display:flex><span>PDS_EMAIL_FROM_ADDRESS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;admin@bluesky.sbk6401.sbs&#34;</span>
</span></span><span style=display:flex><span>PDS_EMAIL_SMTP_URL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;smtps://resend:&lt;my resend api key&gt;@smtp.resend.org:465/&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ systemctl restart pds
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#prerequisite>Prerequisite</a></li><li><a href=#mailgun-step>Mailgun Step</a></li><li><a href=#resend-step>Resend Step</a></li></ul></nav></div></aside></main></body></html>